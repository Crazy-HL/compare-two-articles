{"ast":null,"code":"import { ref, onMounted, onUnmounted } from \"vue\";\nimport LoadingSpinner from \"./LoadingSpinner.vue\";\nimport ErrorDisplay from \"./ErrorDisplay.vue\";\nimport PopupOverlay from \"./PopupOverlay.vue\";\nimport { fetchWikipediaContent, injectWikipediaStyles } from \"@/js/apiUtils\";\nimport * as d3 from \"d3\";\nimport { renderChart } from \"@/js/chartUtils\";\nexport default {\n  __name: 'MainComponent',\n  props: {\n    pageTitle: String,\n    divId: String,\n    selectContentClass: String\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const pageHtml = ref(\"\");\n    const loading = ref(true);\n    const error = ref(\"\");\n    const selectedText = ref({});\n    const showPopup = ref({});\n    const divRef = ref(null);\n    const visualizationLoading = ref(false);\n    const handleSelection = () => {\n      const selection = window.getSelection();\n      if (!selection.rangeCount) return;\n      const range = selection.getRangeAt(0);\n      const selectedHtml = range.cloneContents();\n      const tempDiv = document.createElement(\"div\");\n      tempDiv.appendChild(selectedHtml);\n      const table = tempDiv.querySelector(\"table\");\n      if (table) {\n        table.classList.add(\"custom-table\");\n        selectedText.value[props.divId] = tempDiv.innerHTML;\n      } else {\n        const text = selection.toString().trim();\n        if (!text) return;\n        selectedText.value[props.divId] = text;\n      }\n      showPopup.value[props.divId] = true;\n    };\n    const closePopup = () => {\n      showPopup.value[props.divId] = false;\n      selectedText.value[props.divId] = \"\";\n      const container = props.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\n      d3.select(container).html(\"\");\n    };\n    const switchView = async view => {\n      if (view === \"visual\") {\n        visualizationLoading.value = true;\n        await processText();\n        visualizationLoading.value = false;\n      }\n    };\n    const processText = async () => {\n      try {\n        // Call your API to process text and render chart\n      } catch (error) {\n        console.error(\"Error processing text:\", error);\n      }\n    };\n    onMounted(() => {\n      fetchWikipediaContent(props.pageTitle).then(html => {\n        pageHtml.value = html;\n        injectWikipediaStyles();\n      }).catch(err => {\n        error.value = err.message;\n      }).finally(() => {\n        loading.value = false;\n      });\n      if (divRef.value) {\n        divRef.value.addEventListener(\"mouseup\", handleSelection);\n      }\n    });\n    onUnmounted(() => {\n      if (divRef.value) {\n        divRef.value.removeEventListener(\"mouseup\", handleSelection);\n      }\n    });\n    const __returned__ = {\n      props,\n      pageHtml,\n      loading,\n      error,\n      selectedText,\n      showPopup,\n      divRef,\n      visualizationLoading,\n      handleSelection,\n      closePopup,\n      switchView,\n      processText,\n      ref,\n      onMounted,\n      onUnmounted,\n      LoadingSpinner,\n      ErrorDisplay,\n      PopupOverlay,\n      get fetchWikipediaContent() {\n        return fetchWikipediaContent;\n      },\n      get injectWikipediaStyles() {\n        return injectWikipediaStyles;\n      },\n      get d3() {\n        return d3;\n      },\n      get renderChart() {\n        return renderChart;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","LoadingSpinner","ErrorDisplay","PopupOverlay","fetchWikipediaContent","injectWikipediaStyles","d3","renderChart","props","__props","pageHtml","loading","error","selectedText","showPopup","divRef","visualizationLoading","handleSelection","selection","window","getSelection","rangeCount","range","getRangeAt","selectedHtml","cloneContents","tempDiv","document","createElement","appendChild","table","querySelector","classList","add","value","divId","innerHTML","text","toString","trim","closePopup","container","select","html","switchView","view","processText","console","pageTitle","then","catch","err","message","finally","addEventListener","removeEventListener"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/base/MainComponent.vue"],"sourcesContent":["<template>\r\n\t<div :class=\"['div0', selectContentClass]\" :id=\"divId\" ref=\"divRef\">\r\n\t\t<h1>{{ pageTitle }}</h1>\r\n\r\n\t\t<!-- 加载动画 -->\r\n\t\t<LoadingSpinner v-if=\"loading\" />\r\n\r\n\t\t<!-- 错误信息 -->\r\n\t\t<ErrorDisplay\r\n\t\t\tv-else-if=\"error\"\r\n\t\t\t:error=\"error\"\r\n\t\t\t@retry=\"fetchWikipediaContent\" />\r\n\r\n\t\t<!-- 文章内容 -->\r\n\t\t<div\r\n\t\t\tv-else\r\n\t\t\tclass=\"showHtml wikipedia-content\"\r\n\t\t\tv-html=\"pageHtml\"\r\n\t\t\t@mouseup=\"handleSelection\"></div>\r\n\r\n\t\t<!-- 弹出框和遮罩层 -->\r\n\t\t<PopupOverlay\r\n\t\t\tv-if=\"showPopup[divId]\"\r\n\t\t\t:show=\"showPopup[divId]\"\r\n\t\t\t:selectedText=\"selectedText[divId]\"\r\n\t\t\t:divId=\"divId\"\r\n\t\t\t:visualizationLoading=\"visualizationLoading\"\r\n\t\t\t@closePopup=\"closePopup\"\r\n\t\t\t@switchView=\"switchView\" />\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted } from \"vue\";\r\n\timport LoadingSpinner from \"./LoadingSpinner.vue\";\r\n\timport ErrorDisplay from \"./ErrorDisplay.vue\";\r\n\timport PopupOverlay from \"./PopupOverlay.vue\";\r\n\timport { fetchWikipediaContent, injectWikipediaStyles } from \"@/js/apiUtils\";\r\n\timport * as d3 from \"d3\";\r\n\timport { renderChart } from \"@/js/chartUtils\";\r\n\r\n\tconst props = defineProps({\r\n\t\tpageTitle: String,\r\n\t\tdivId: String,\r\n\t\tselectContentClass: String\r\n\t});\r\n\r\n\tconst pageHtml = ref(\"\");\r\n\tconst loading = ref(true);\r\n\tconst error = ref(\"\");\r\n\tconst selectedText = ref({});\r\n\tconst showPopup = ref({});\r\n\tconst divRef = ref(null);\r\n\tconst visualizationLoading = ref(false);\r\n\r\n\tconst handleSelection = () => {\r\n\t\tconst selection = window.getSelection();\r\n\t\tif (!selection.rangeCount) return;\r\n\r\n\t\tconst range = selection.getRangeAt(0);\r\n\t\tconst selectedHtml = range.cloneContents();\r\n\r\n\t\tconst tempDiv = document.createElement(\"div\");\r\n\t\ttempDiv.appendChild(selectedHtml);\r\n\r\n\t\tconst table = tempDiv.querySelector(\"table\");\r\n\t\tif (table) {\r\n\t\t\ttable.classList.add(\"custom-table\");\r\n\t\t\tselectedText.value[props.divId] = tempDiv.innerHTML;\r\n\t\t} else {\r\n\t\t\tconst text = selection.toString().trim();\r\n\t\t\tif (!text) return;\r\n\t\t\tselectedText.value[props.divId] = text;\r\n\t\t}\r\n\r\n\t\tshowPopup.value[props.divId] = true;\r\n\t};\r\n\r\n\tconst closePopup = () => {\r\n\t\tshowPopup.value[props.divId] = false;\r\n\t\tselectedText.value[props.divId] = \"\";\r\n\r\n\t\tconst container =\r\n\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\t\td3.select(container).html(\"\");\r\n\t};\r\n\r\n\tconst switchView = async view => {\r\n\t\tif (view === \"visual\") {\r\n\t\t\tvisualizationLoading.value = true;\r\n\t\t\tawait processText();\r\n\t\t\tvisualizationLoading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\tconst processText = async () => {\r\n\t\ttry {\r\n\t\t\t// Call your API to process text and render chart\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error processing text:\", error);\r\n\t\t}\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tfetchWikipediaContent(props.pageTitle)\r\n\t\t\t.then(html => {\r\n\t\t\t\tpageHtml.value = html;\r\n\t\t\t\tinjectWikipediaStyles();\r\n\t\t\t})\r\n\t\t\t.catch(err => {\r\n\t\t\t\terror.value = err.message;\r\n\t\t\t})\r\n\t\t\t.finally(() => {\r\n\t\t\t\tloading.value = false;\r\n\t\t\t});\r\n\r\n\t\tif (divRef.value) {\r\n\t\t\tdivRef.value.addEventListener(\"mouseup\", handleSelection);\r\n\t\t}\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tif (divRef.value) {\r\n\t\t\tdivRef.value.removeEventListener(\"mouseup\", handleSelection);\r\n\t\t}\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t/* ... (same as before) */\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}