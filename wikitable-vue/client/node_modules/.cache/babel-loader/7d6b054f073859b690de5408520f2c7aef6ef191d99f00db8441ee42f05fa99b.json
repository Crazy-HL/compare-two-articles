{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, computed, watch, onMounted, onBeforeUnmount } from \"vue\";\nimport SparklineChart from \"./SparklineChart.vue\";\nimport FullChart from \"./FullChart.vue\";\nimport { debounce } from \"lodash-es\";\nexport default {\n  __name: 'CompareTable',\n  props: {\n    div1RawData: String,\n    div3RawData: String\n  },\n  emits: [\"tables-ready\", \"processing-error\"],\n  setup(__props, _ref) {\n    let {\n      expose: __expose,\n      emit: __emit\n    } = _ref;\n    const props = __props;\n\n    // 容器引用\n    const containerRef = ref(null);\n\n    // 图表尺寸控制\n    const chartMaxWidth = ref(250);\n    const chartMaxHeight = ref(80);\n    const leftChartColor = ref(\"#4a90e2\");\n    const rightChartColor = ref(\"#ef4444\");\n\n    // 表格数据处理\n    const processedTable1 = ref({\n      title: \"表格1\",\n      rows: [],\n      columns: [],\n      timeSeriesData: {}\n    });\n    const processedTable2 = ref({\n      title: \"表格2\",\n      rows: [],\n      columns: [],\n      timeSeriesData: {}\n    });\n\n    // 图表引用\n    const chartRefs1 = ref({});\n    const chartRefs2 = ref({});\n\n    // 完整图表弹窗相关状态\n    const showFullChartModal = ref(false);\n    const currentAttribute = ref(\"\");\n    const currentChartData = ref({\n      type: \"line\",\n      data: []\n    });\n    const currentSide = ref(\"left\");\n\n    // 更新图表尺寸\n    const updateChartSize = debounce(() => {\n      if (containerRef.value) {\n        const containerWidth = containerRef.value.clientWidth;\n        chartMaxWidth.value = Math.min(250, containerWidth * 0.3);\n        // 可以根据需要动态计算高度\n        chartMaxHeight.value = 80;\n      }\n    }, 100);\n    const emit = __emit;\n\n    // 新增处理状态\n    const processingStatus = ref({\n      isProcessing: false,\n      error: null,\n      lastUpdated: null\n    });\n\n    // 初始化尺寸和监听\n    onMounted(() => {\n      updateChartSize();\n      window.addEventListener(\"resize\", updateChartSize);\n    });\n    onBeforeUnmount(() => {\n      window.removeEventListener(\"resize\", updateChartSize);\n    });\n\n    // 修改后的处理函数\n    const processTables = async () => {\n      processingStatus.value = {\n        isProcessing: true,\n        error: null,\n        lastUpdated: null\n      };\n      try {\n        // 处理表格数据\n        processedTable1.value = await parseTableToStandardJSON(props.div1RawData, \"表格1\");\n        processedTable2.value = await parseTableToStandardJSON(props.div3RawData, \"表格2\");\n\n        // 验证数据\n        if (!processedTable1.value.timeSeriesData || !processedTable2.value.timeSeriesData) {\n          throw new Error(\"表格数据不完整\");\n        }\n\n        // 准备公共属性\n        const commonAttrs = computedCommonAttributes.value;\n\n        // 发射事件\n        emit(\"tables-ready\", {\n          table1: {\n            ...processedTable1.value\n          },\n          table2: {\n            ...processedTable2.value\n          },\n          commonAttributes: commonAttrs\n        });\n        processingStatus.value = {\n          isProcessing: false,\n          error: null,\n          lastUpdated: new Date()\n        };\n      } catch (error) {\n        processingStatus.value = {\n          isProcessing: false,\n          error: error.message,\n          lastUpdated: null\n        };\n        emit(\"processing-error\", error.message);\n        console.error(\"表格处理错误:\", error);\n      }\n    };\n\n    // 计算公共属性\n    const computedCommonAttributes = computed(() => {\n      const attrs1 = Object.keys(processedTable1.value.timeSeriesData || {});\n      const attrs2 = Object.keys(processedTable2.value.timeSeriesData || {});\n      return attrs1.filter(attr => attrs2.includes(attr));\n    });\n    const showFullChart = (attr, side) => {\n      currentAttribute.value = attr;\n      currentSide.value = side;\n      const chartRef = side === \"left\" ? chartRefs1.value[attr] : chartRefs2.value[attr];\n      const chartType = chartRef?.chartType || \"line\";\n      if (side === \"left\") {\n        currentChartData.value = {\n          type: chartType,\n          data: processedTable1.value.timeSeriesData[attr] || []\n        };\n      } else {\n        currentChartData.value = {\n          type: chartType,\n          data: processedTable2.value.timeSeriesData[attr] || []\n        };\n      }\n      showFullChartModal.value = true;\n    };\n    const hideFullChart = () => {\n      showFullChartModal.value = false;\n    };\n    const hasData = computed(() => {\n      return props.div1RawData && props.div3RawData && processedTable1.value.columns.length > 0 && processedTable2.value.columns.length > 0;\n    });\n    const commonAttributes = computed(() => {\n      const attrs1 = processedTable1.value.rows || [];\n      const attrs2 = processedTable2.value.rows || [];\n      return attrs1.filter(attr => attrs2.includes(attr) && (hasDataForAttribute(processedTable1.value, attr) || hasDataForAttribute(processedTable2.value, attr)));\n    });\n    function parseTableToStandardJSON(html) {\n      let defaultTitle = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"未命名表格\";\n      const result = {\n        title: extractTitleFromHTML(html) || defaultTitle,\n        rows: [],\n        columns: [],\n        timeSeriesData: {}\n      };\n      try {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(html, \"text/html\");\n        const table = doc.querySelector(\"table\");\n        if (!table) return result;\n\n        // 提取表头\n        const headerCells = table.querySelector(\"tr\")?.children || [];\n        result.rows = Array.from(headerCells).map(cell => {\n          return cell.textContent.replace(/[\\n†*]/g, \"\").trim().replace(/\\s+/g, \" \");\n        });\n\n        // 检查是否有Year列\n        const yearColumnIndex = result.rows.findIndex(header => header.toLowerCase().includes(\"year\"));\n        const hasYearColumn = yearColumnIndex !== -1;\n\n        // 辅助函数：清理年份格式\n        const cleanYear = yearStr => {\n          if (!yearStr) return null;\n          let cleaned = yearStr.toString().replace(/[†*]/g, \"\").trim();\n          if (/^\\d{4}[\\u2013\\u2014-]\\d{2}$/.test(cleaned)) {\n            const startYear = cleaned.substring(0, 4);\n            return parseInt(startYear);\n          }\n          const yearMatch = cleaned.match(/\\d{4}/);\n          return yearMatch ? parseInt(yearMatch[0]) : null;\n        };\n\n        // 提取数据行\n        const dataRows = Array.from(table.querySelectorAll(\"tr:not(:first-child)\"));\n        dataRows.forEach(row => {\n          const cells = Array.from(row.children);\n          if (cells.length === 0) return;\n          const recordName = cells[0].textContent.trim();\n          const recordData = {};\n          result.rows.forEach((header, index) => {\n            if (index < cells.length) {\n              let value = cells[index].textContent.trim();\n              if (index === yearColumnIndex) {\n                value = cleanYear(value);\n              } else {\n                value = smartValueConversion(value);\n              }\n              recordData[header] = value;\n            }\n          });\n          if (!hasYearColumn || hasYearColumn && recordData.Year) {\n            result.columns.push({\n              name: recordName,\n              data: recordData\n            });\n            if (hasYearColumn && recordData.Year) {\n              const year = recordData.Year;\n              result.rows.forEach(header => {\n                if (header === \"Year\" || typeof recordData[header] !== \"number\") return;\n                if (!result.timeSeriesData[header]) {\n                  result.timeSeriesData[header] = [];\n                }\n                result.timeSeriesData[header].push({\n                  year: year,\n                  value: recordData[header],\n                  recordName: recordName\n                });\n              });\n            }\n          }\n        });\n\n        // 对每个属性的时间序列数据按年份排序\n        if (hasYearColumn) {\n          Object.keys(result.timeSeriesData).forEach(attr => {\n            result.timeSeriesData[attr].sort((a, b) => a.year - b.year);\n          });\n        }\n        console.log(\"解析后的表格数据:\", result);\n        return result;\n      } catch (error) {\n        console.error(\"表格解析错误:\", error);\n        return result;\n      }\n    }\n    function smartValueConversion(rawValue) {\n      if (!rawValue || [\"-\", \"—\", \"N/A\"].includes(rawValue)) return null;\n      if (/^\\.\\d+$/.test(rawValue)) return parseFloat(rawValue);\n      const numericValue = parseFloat(rawValue.replace(/[^\\d.-]/g, \"\"));\n      if (!isNaN(numericValue)) return numericValue;\n      if (/(\\d{4}-\\d{2}-\\d{2})|(\\d{2}\\/\\d{2}\\/\\d{4})/.test(rawValue)) return rawValue;\n      if ([\"true\", \"false\"].includes(rawValue.toLowerCase())) {\n        return rawValue.toLowerCase() === \"true\";\n      }\n      return rawValue;\n    }\n    function extractTitleFromHTML(html) {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(html, \"text/html\");\n      return doc.querySelector(\"h1, h2, h3, h4, caption\")?.textContent.trim() || null;\n    }\n    function hasDataForAttribute(table, attr) {\n      return table.timeSeriesData[attr]?.length > 0;\n    }\n    function getAverage(table, attr) {\n      const values = table.timeSeriesData[attr]?.map(item => item.value) || [];\n      return values.length ? (values.reduce((a, b) => a + b, 0) / values.length).toFixed(2) : \"N/A\";\n    }\n    function getMax(table, attr) {\n      const values = table.timeSeriesData[attr]?.map(item => item.value) || [];\n      return values.length ? Math.max(...values).toFixed(2) : \"N/A\";\n    }\n\n    // async function sendToBackend() {\n    // \ttry {\n    // \t\tconst response = await api.post(\"table_compare\", {\n    // \t\t\ttable1: processedTable1.value,\n    // \t\t\ttable2: processedTable2.value\n    // \t\t});\n    // \t\tconsole.log(\"分析结果:\", response);\n    // \t} catch (error) {\n    // \t\tconsole.error(\"API请求失败:\", error);\n    // \t}\n    // }\n    // 修改watch监听\n    watch([() => props.div1RawData, () => props.div3RawData], _ref2 => {\n      let [newDiv1, newDiv3] = _ref2;\n      if (newDiv1 && newDiv3) {\n        processTables();\n      }\n    }, {\n      immediate: true\n    });\n\n    // 暴露给父组件的方法\n    __expose({\n      getTableData: () => ({\n        table1: {\n          ...processedTable1.value\n        },\n        table2: {\n          ...processedTable2.value\n        },\n        commonAttributes: computedCommonAttributes.value,\n        status: {\n          ...processingStatus.value\n        }\n      }),\n      reprocessTables: processTables\n    });\n    const __returned__ = {\n      props,\n      containerRef,\n      chartMaxWidth,\n      chartMaxHeight,\n      leftChartColor,\n      rightChartColor,\n      processedTable1,\n      processedTable2,\n      chartRefs1,\n      chartRefs2,\n      showFullChartModal,\n      currentAttribute,\n      currentChartData,\n      currentSide,\n      updateChartSize,\n      emit,\n      processingStatus,\n      processTables,\n      computedCommonAttributes,\n      showFullChart,\n      hideFullChart,\n      hasData,\n      commonAttributes,\n      parseTableToStandardJSON,\n      smartValueConversion,\n      extractTitleFromHTML,\n      hasDataForAttribute,\n      getAverage,\n      getMax,\n      ref,\n      computed,\n      watch,\n      onMounted,\n      onBeforeUnmount,\n      SparklineChart,\n      FullChart,\n      get debounce() {\n        return debounce;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","watch","onMounted","onBeforeUnmount","SparklineChart","FullChart","debounce","props","__props","containerRef","chartMaxWidth","chartMaxHeight","leftChartColor","rightChartColor","processedTable1","title","rows","columns","timeSeriesData","processedTable2","chartRefs1","chartRefs2","showFullChartModal","currentAttribute","currentChartData","type","data","currentSide","updateChartSize","value","containerWidth","clientWidth","Math","min","emit","__emit","processingStatus","isProcessing","error","lastUpdated","window","addEventListener","removeEventListener","processTables","parseTableToStandardJSON","div1RawData","div3RawData","Error","commonAttrs","computedCommonAttributes","table1","table2","commonAttributes","Date","message","console","attrs1","Object","keys","attrs2","filter","attr","includes","showFullChart","side","chartRef","chartType","hideFullChart","hasData","length","hasDataForAttribute","html","defaultTitle","arguments","undefined","result","extractTitleFromHTML","parser","DOMParser","doc","parseFromString","table","querySelector","headerCells","children","Array","from","map","cell","textContent","replace","trim","yearColumnIndex","findIndex","header","toLowerCase","hasYearColumn","cleanYear","yearStr","cleaned","toString","test","startYear","substring","parseInt","yearMatch","match","dataRows","querySelectorAll","forEach","row","cells","recordName","recordData","index","smartValueConversion","Year","push","name","year","sort","a","b","log","rawValue","parseFloat","numericValue","isNaN","getAverage","values","item","reduce","toFixed","getMax","max","_ref2","newDiv1","newDiv3","immediate","__expose","getTableData","status","reprocessTables"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/CompareTable.vue"],"sourcesContent":["<template>\r\n\t<div class=\"compare-container\" ref=\"containerRef\">\r\n\t\t<div class=\"table-grid\">\r\n\t\t\t<!-- 表头 -->\r\n\t\t\t<div class=\"header left-column\">\r\n\t\t\t\t{{ processedTable1.title || \"表格1\" }}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"header middle-column\">对比属性</div>\r\n\t\t\t<div class=\"header right-column\">\r\n\t\t\t\t{{ processedTable2.title || \"表格2\" }}\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- 数据行 -->\r\n\t\t\t<template v-if=\"hasData\">\r\n\t\t\t\t<template v-for=\"attr in commonAttributes\" :key=\"attr\">\r\n\t\t\t\t\t<div class=\"cell left-column\" @click=\"showFullChart(attr, 'left')\">\r\n\t\t\t\t\t\t<template v-if=\"hasDataForAttribute(processedTable1, attr)\">\r\n\t\t\t\t\t\t\t<div class=\"chart-wrapper\">\r\n\t\t\t\t\t\t\t\t<SparklineChart\r\n\t\t\t\t\t\t\t\t\tref=\"leftCharts\"\r\n\t\t\t\t\t\t\t\t\t:data=\"processedTable1.timeSeriesData[attr]\"\r\n\t\t\t\t\t\t\t\t\t:compare-data=\"processedTable2.timeSeriesData[attr]\"\r\n\t\t\t\t\t\t\t\t\t:max-width=\"chartMaxWidth\"\r\n\t\t\t\t\t\t\t\t\t:max-height=\"chartMaxHeight\"\r\n\t\t\t\t\t\t\t\t\t:show-year-markers=\"true\"\r\n\t\t\t\t\t\t\t\t\t:line-color=\"leftChartColor\"\r\n\t\t\t\t\t\t\t\t\t@chart-mounted=\"chart => (chartRefs1[attr] = chart)\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<!-- <div class=\"stats-summary\">\r\n\t\t\t\t\t\t\t\t平均: {{ getAverage(processedTable1, attr) }} | 最大:\r\n\t\t\t\t\t\t\t\t{{ getMax(processedTable1, attr) }}\r\n\t\t\t\t\t\t\t</div> -->\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<div v-else class=\"no-data\">无数据</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"cell middle-column\">\r\n\t\t\t\t\t\t<div class=\"attribute-name\">{{ attr }}</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"cell right-column\" @click=\"showFullChart(attr, 'right')\">\r\n\t\t\t\t\t\t<template v-if=\"hasDataForAttribute(processedTable2, attr)\">\r\n\t\t\t\t\t\t\t<div class=\"chart-wrapper\">\r\n\t\t\t\t\t\t\t\t<SparklineChart\r\n\t\t\t\t\t\t\t\t\tref=\"rightCharts\"\r\n\t\t\t\t\t\t\t\t\t:data=\"processedTable2.timeSeriesData[attr]\"\r\n\t\t\t\t\t\t\t\t\t:compare-data=\"processedTable1.timeSeriesData[attr]\"\r\n\t\t\t\t\t\t\t\t\t:max-width=\"chartMaxWidth\"\r\n\t\t\t\t\t\t\t\t\t:max-height=\"chartMaxHeight\"\r\n\t\t\t\t\t\t\t\t\t:show-year-markers=\"true\"\r\n\t\t\t\t\t\t\t\t\t:line-color=\"rightChartColor\"\r\n\t\t\t\t\t\t\t\t\t@chart-mounted=\"chart => (chartRefs2[attr] = chart)\" />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<!-- <div class=\"stats-summary\">\r\n\t\t\t\t\t\t\t\t平均: {{ getAverage(processedTable2, attr) }} | 最大:\r\n\t\t\t\t\t\t\t\t{{ getMax(processedTable2, attr) }}\r\n\t\t\t\t\t\t\t</div> -->\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<div v-else class=\"no-data\">无数据</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</template>\r\n\t\t\t<template v-else>\r\n\t\t\t\t<!-- 空状态下的行 -->\r\n\t\t\t\t<div class=\"cell left-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell middle-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell right-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell left-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell middle-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell right-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell left-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell middle-column empty-cell\"></div>\r\n\t\t\t\t<div class=\"cell right-column empty-cell\"></div>\r\n\t\t\t</template>\r\n\t\t</div>\r\n\r\n\t\t<!-- 完整图表弹窗 -->\r\n\t\t<div\r\n\t\t\tv-if=\"showFullChartModal\"\r\n\t\t\tclass=\"full-chart-modal\"\r\n\t\t\t@click.self=\"hideFullChart\">\r\n\t\t\t<div class=\"modal-content\">\r\n\t\t\t\t<div class=\"modal-header\">\r\n\t\t\t\t\t<h3>{{ currentAttribute }}</h3>\r\n\t\t\t\t\t<button @click=\"hideFullChart\" class=\"close-button\">×</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<FullChart\r\n\t\t\t\t\t:data=\"currentChartData\"\r\n\t\t\t\t\t:title=\"currentAttribute\"\r\n\t\t\t\t\t:side=\"currentSide\" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\r\n\t\twatch,\r\n\t\tonMounted,\r\n\t\tonBeforeUnmount,\r\n\t\tdefineEmits,\r\n\t\tdefineExpose\r\n\t} from \"vue\";\r\n\timport SparklineChart from \"./SparklineChart.vue\";\r\n\timport FullChart from \"./FullChart.vue\";\r\n\timport { debounce } from \"lodash-es\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdiv1RawData: String,\r\n\t\tdiv3RawData: String\r\n\t});\r\n\r\n\t// 容器引用\r\n\tconst containerRef = ref(null);\r\n\r\n\t// 图表尺寸控制\r\n\tconst chartMaxWidth = ref(250);\r\n\tconst chartMaxHeight = ref(80);\r\n\tconst leftChartColor = ref(\"#4a90e2\");\r\n\tconst rightChartColor = ref(\"#ef4444\");\r\n\r\n\t// 表格数据处理\r\n\tconst processedTable1 = ref({\r\n\t\ttitle: \"表格1\",\r\n\t\trows: [],\r\n\t\tcolumns: [],\r\n\t\ttimeSeriesData: {}\r\n\t});\r\n\tconst processedTable2 = ref({\r\n\t\ttitle: \"表格2\",\r\n\t\trows: [],\r\n\t\tcolumns: [],\r\n\t\ttimeSeriesData: {}\r\n\t});\r\n\r\n\t// 图表引用\r\n\tconst chartRefs1 = ref({});\r\n\tconst chartRefs2 = ref({});\r\n\r\n\t// 完整图表弹窗相关状态\r\n\tconst showFullChartModal = ref(false);\r\n\tconst currentAttribute = ref(\"\");\r\n\tconst currentChartData = ref({ type: \"line\", data: [] });\r\n\tconst currentSide = ref(\"left\");\r\n\r\n\t// 更新图表尺寸\r\n\tconst updateChartSize = debounce(() => {\r\n\t\tif (containerRef.value) {\r\n\t\t\tconst containerWidth = containerRef.value.clientWidth;\r\n\t\t\tchartMaxWidth.value = Math.min(250, containerWidth * 0.3);\r\n\t\t\t// 可以根据需要动态计算高度\r\n\t\t\tchartMaxHeight.value = 80;\r\n\t\t}\r\n\t}, 100);\r\n\r\n\tconst emit = defineEmits([\"tables-ready\", \"processing-error\"]);\r\n\r\n\t// 新增处理状态\r\n\tconst processingStatus = ref({\r\n\t\tisProcessing: false,\r\n\t\terror: null,\r\n\t\tlastUpdated: null\r\n\t});\r\n\r\n\t// 初始化尺寸和监听\r\n\tonMounted(() => {\r\n\t\tupdateChartSize();\r\n\t\twindow.addEventListener(\"resize\", updateChartSize);\r\n\t});\r\n\r\n\tonBeforeUnmount(() => {\r\n\t\twindow.removeEventListener(\"resize\", updateChartSize);\r\n\t});\r\n\r\n\t// 修改后的处理函数\r\n\tconst processTables = async () => {\r\n\t\tprocessingStatus.value = {\r\n\t\t\tisProcessing: true,\r\n\t\t\terror: null,\r\n\t\t\tlastUpdated: null\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\t// 处理表格数据\r\n\t\t\tprocessedTable1.value = await parseTableToStandardJSON(\r\n\t\t\t\tprops.div1RawData,\r\n\t\t\t\t\"表格1\"\r\n\t\t\t);\r\n\t\t\tprocessedTable2.value = await parseTableToStandardJSON(\r\n\t\t\t\tprops.div3RawData,\r\n\t\t\t\t\"表格2\"\r\n\t\t\t);\r\n\r\n\t\t\t// 验证数据\r\n\t\t\tif (\r\n\t\t\t\t!processedTable1.value.timeSeriesData ||\r\n\t\t\t\t!processedTable2.value.timeSeriesData\r\n\t\t\t) {\r\n\t\t\t\tthrow new Error(\"表格数据不完整\");\r\n\t\t\t}\r\n\r\n\t\t\t// 准备公共属性\r\n\t\t\tconst commonAttrs = computedCommonAttributes.value;\r\n\r\n\t\t\t// 发射事件\r\n\t\t\temit(\"tables-ready\", {\r\n\t\t\t\ttable1: { ...processedTable1.value },\r\n\t\t\t\ttable2: { ...processedTable2.value },\r\n\t\t\t\tcommonAttributes: commonAttrs\r\n\t\t\t});\r\n\r\n\t\t\tprocessingStatus.value = {\r\n\t\t\t\tisProcessing: false,\r\n\t\t\t\terror: null,\r\n\t\t\t\tlastUpdated: new Date()\r\n\t\t\t};\r\n\t\t} catch (error) {\r\n\t\t\tprocessingStatus.value = {\r\n\t\t\t\tisProcessing: false,\r\n\t\t\t\terror: error.message,\r\n\t\t\t\tlastUpdated: null\r\n\t\t\t};\r\n\t\t\temit(\"processing-error\", error.message);\r\n\t\t\tconsole.error(\"表格处理错误:\", error);\r\n\t\t}\r\n\t};\r\n\r\n\t// 计算公共属性\r\n\tconst computedCommonAttributes = computed(() => {\r\n\t\tconst attrs1 = Object.keys(processedTable1.value.timeSeriesData || {});\r\n\t\tconst attrs2 = Object.keys(processedTable2.value.timeSeriesData || {});\r\n\t\treturn attrs1.filter(attr => attrs2.includes(attr));\r\n\t});\r\n\r\n\tconst showFullChart = (attr, side) => {\r\n\t\tcurrentAttribute.value = attr;\r\n\t\tcurrentSide.value = side;\r\n\r\n\t\tconst chartRef =\r\n\t\t\tside === \"left\" ? chartRefs1.value[attr] : chartRefs2.value[attr];\r\n\t\tconst chartType = chartRef?.chartType || \"line\";\r\n\r\n\t\tif (side === \"left\") {\r\n\t\t\tcurrentChartData.value = {\r\n\t\t\t\ttype: chartType,\r\n\t\t\t\tdata: processedTable1.value.timeSeriesData[attr] || []\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tcurrentChartData.value = {\r\n\t\t\t\ttype: chartType,\r\n\t\t\t\tdata: processedTable2.value.timeSeriesData[attr] || []\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tshowFullChartModal.value = true;\r\n\t};\r\n\r\n\tconst hideFullChart = () => {\r\n\t\tshowFullChartModal.value = false;\r\n\t};\r\n\r\n\tconst hasData = computed(() => {\r\n\t\treturn (\r\n\t\t\tprops.div1RawData &&\r\n\t\t\tprops.div3RawData &&\r\n\t\t\tprocessedTable1.value.columns.length > 0 &&\r\n\t\t\tprocessedTable2.value.columns.length > 0\r\n\t\t);\r\n\t});\r\n\r\n\tconst commonAttributes = computed(() => {\r\n\t\tconst attrs1 = processedTable1.value.rows || [];\r\n\t\tconst attrs2 = processedTable2.value.rows || [];\r\n\t\treturn attrs1.filter(\r\n\t\t\tattr =>\r\n\t\t\t\tattrs2.includes(attr) &&\r\n\t\t\t\t(hasDataForAttribute(processedTable1.value, attr) ||\r\n\t\t\t\t\thasDataForAttribute(processedTable2.value, attr))\r\n\t\t);\r\n\t});\r\n\r\n\tfunction parseTableToStandardJSON(html, defaultTitle = \"未命名表格\") {\r\n\t\tconst result = {\r\n\t\t\ttitle: extractTitleFromHTML(html) || defaultTitle,\r\n\t\t\trows: [],\r\n\t\t\tcolumns: [],\r\n\t\t\ttimeSeriesData: {}\r\n\t\t};\r\n\r\n\t\ttry {\r\n\t\t\tconst parser = new DOMParser();\r\n\t\t\tconst doc = parser.parseFromString(html, \"text/html\");\r\n\t\t\tconst table = doc.querySelector(\"table\");\r\n\t\t\tif (!table) return result;\r\n\r\n\t\t\t// 提取表头\r\n\t\t\tconst headerCells = table.querySelector(\"tr\")?.children || [];\r\n\t\t\tresult.rows = Array.from(headerCells).map(cell => {\r\n\t\t\t\treturn cell.textContent\r\n\t\t\t\t\t.replace(/[\\n†*]/g, \"\")\r\n\t\t\t\t\t.trim()\r\n\t\t\t\t\t.replace(/\\s+/g, \" \");\r\n\t\t\t});\r\n\r\n\t\t\t// 检查是否有Year列\r\n\t\t\tconst yearColumnIndex = result.rows.findIndex(header =>\r\n\t\t\t\theader.toLowerCase().includes(\"year\")\r\n\t\t\t);\r\n\t\t\tconst hasYearColumn = yearColumnIndex !== -1;\r\n\r\n\t\t\t// 辅助函数：清理年份格式\r\n\t\t\tconst cleanYear = yearStr => {\r\n\t\t\t\tif (!yearStr) return null;\r\n\t\t\t\tlet cleaned = yearStr.toString().replace(/[†*]/g, \"\").trim();\r\n\t\t\t\tif (/^\\d{4}[\\u2013\\u2014-]\\d{2}$/.test(cleaned)) {\r\n\t\t\t\t\tconst startYear = cleaned.substring(0, 4);\r\n\t\t\t\t\treturn parseInt(startYear);\r\n\t\t\t\t}\r\n\t\t\t\tconst yearMatch = cleaned.match(/\\d{4}/);\r\n\t\t\t\treturn yearMatch ? parseInt(yearMatch[0]) : null;\r\n\t\t\t};\r\n\r\n\t\t\t// 提取数据行\r\n\t\t\tconst dataRows = Array.from(\r\n\t\t\t\ttable.querySelectorAll(\"tr:not(:first-child)\")\r\n\t\t\t);\r\n\r\n\t\t\tdataRows.forEach(row => {\r\n\t\t\t\tconst cells = Array.from(row.children);\r\n\t\t\t\tif (cells.length === 0) return;\r\n\r\n\t\t\t\tconst recordName = cells[0].textContent.trim();\r\n\t\t\t\tconst recordData = {};\r\n\r\n\t\t\t\tresult.rows.forEach((header, index) => {\r\n\t\t\t\t\tif (index < cells.length) {\r\n\t\t\t\t\t\tlet value = cells[index].textContent.trim();\r\n\t\t\t\t\t\tif (index === yearColumnIndex) {\r\n\t\t\t\t\t\t\tvalue = cleanYear(value);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tvalue = smartValueConversion(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trecordData[header] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!hasYearColumn || (hasYearColumn && recordData.Year)) {\r\n\t\t\t\t\tresult.columns.push({\r\n\t\t\t\t\t\tname: recordName,\r\n\t\t\t\t\t\tdata: recordData\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (hasYearColumn && recordData.Year) {\r\n\t\t\t\t\t\tconst year = recordData.Year;\r\n\t\t\t\t\t\tresult.rows.forEach(header => {\r\n\t\t\t\t\t\t\tif (header === \"Year\" || typeof recordData[header] !== \"number\")\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\tif (!result.timeSeriesData[header]) {\r\n\t\t\t\t\t\t\t\tresult.timeSeriesData[header] = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresult.timeSeriesData[header].push({\r\n\t\t\t\t\t\t\t\tyear: year,\r\n\t\t\t\t\t\t\t\tvalue: recordData[header],\r\n\t\t\t\t\t\t\t\trecordName: recordName\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// 对每个属性的时间序列数据按年份排序\r\n\t\t\tif (hasYearColumn) {\r\n\t\t\t\tObject.keys(result.timeSeriesData).forEach(attr => {\r\n\t\t\t\t\tresult.timeSeriesData[attr].sort((a, b) => a.year - b.year);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"解析后的表格数据:\", result);\r\n\t\t\treturn result;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"表格解析错误:\", error);\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction smartValueConversion(rawValue) {\r\n\t\tif (!rawValue || [\"-\", \"—\", \"N/A\"].includes(rawValue)) return null;\r\n\t\tif (/^\\.\\d+$/.test(rawValue)) return parseFloat(rawValue);\r\n\t\tconst numericValue = parseFloat(rawValue.replace(/[^\\d.-]/g, \"\"));\r\n\t\tif (!isNaN(numericValue)) return numericValue;\r\n\t\tif (/(\\d{4}-\\d{2}-\\d{2})|(\\d{2}\\/\\d{2}\\/\\d{4})/.test(rawValue))\r\n\t\t\treturn rawValue;\r\n\t\tif ([\"true\", \"false\"].includes(rawValue.toLowerCase())) {\r\n\t\t\treturn rawValue.toLowerCase() === \"true\";\r\n\t\t}\r\n\t\treturn rawValue;\r\n\t}\r\n\r\n\tfunction extractTitleFromHTML(html) {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(html, \"text/html\");\r\n\t\treturn (\r\n\t\t\tdoc.querySelector(\"h1, h2, h3, h4, caption\")?.textContent.trim() || null\r\n\t\t);\r\n\t}\r\n\r\n\tfunction hasDataForAttribute(table, attr) {\r\n\t\treturn table.timeSeriesData[attr]?.length > 0;\r\n\t}\r\n\r\n\tfunction getAverage(table, attr) {\r\n\t\tconst values = table.timeSeriesData[attr]?.map(item => item.value) || [];\r\n\t\treturn values.length\r\n\t\t\t? (values.reduce((a, b) => a + b, 0) / values.length).toFixed(2)\r\n\t\t\t: \"N/A\";\r\n\t}\r\n\r\n\tfunction getMax(table, attr) {\r\n\t\tconst values = table.timeSeriesData[attr]?.map(item => item.value) || [];\r\n\t\treturn values.length ? Math.max(...values).toFixed(2) : \"N/A\";\r\n\t}\r\n\r\n\t// async function sendToBackend() {\r\n\t// \ttry {\r\n\t// \t\tconst response = await api.post(\"table_compare\", {\r\n\t// \t\t\ttable1: processedTable1.value,\r\n\t// \t\t\ttable2: processedTable2.value\r\n\t// \t\t});\r\n\t// \t\tconsole.log(\"分析结果:\", response);\r\n\t// \t} catch (error) {\r\n\t// \t\tconsole.error(\"API请求失败:\", error);\r\n\t// \t}\r\n\t// }\r\n\t// 修改watch监听\r\n\twatch(\r\n\t\t[() => props.div1RawData, () => props.div3RawData],\r\n\t\t([newDiv1, newDiv3]) => {\r\n\t\t\tif (newDiv1 && newDiv3) {\r\n\t\t\t\tprocessTables();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ immediate: true }\r\n\t);\r\n\r\n\t// 暴露给父组件的方法\r\n\tdefineExpose({\r\n\t\tgetTableData: () => ({\r\n\t\t\ttable1: { ...processedTable1.value },\r\n\t\t\ttable2: { ...processedTable2.value },\r\n\t\t\tcommonAttributes: computedCommonAttributes.value,\r\n\t\t\tstatus: { ...processingStatus.value }\r\n\t\t}),\r\n\t\treprocessTables: processTables\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.compare-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 10px;\r\n\t\tbox-sizing: border-box;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.table-grid {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: minmax(200px, 1fr) minmax(100px, 0.5fr) minmax(\r\n\t\t\t\t200px,\r\n\t\t\t\t1fr\r\n\t\t\t);\r\n\t\twidth: 98%;\r\n\t\tmax-width: 1200px;\r\n\t\tmin-width: 320px;\r\n\t\tmargin: 0 auto;\r\n\t\tbackground: white;\r\n\t\tflex: 1;\r\n\t\toverflow-x: auto;\r\n\t\toverflow-y: auto;\r\n\t\tborder-collapse: separate;\r\n\t\tborder-spacing: 0;\r\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\r\n\t\tborder: 1px solid #e2e8f0;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.header {\r\n\t\tpadding: 12px;\r\n\t\tbackground: #2c3e50;\r\n\t\tcolor: white;\r\n\t\tfont-weight: bold;\r\n\t\ttext-align: center;\r\n\t\tposition: sticky;\r\n\t\ttop: 0;\r\n\t\tz-index: 1;\r\n\t\tborder-right: 1px solid #475569;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tmin-height: 50px;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\r\n\t.header.middle-column {\r\n\t\tpadding: 12px 10px;\r\n\t\tbackground: #1e293b;\r\n\t}\r\n\r\n\t.cell {\r\n\t\tpadding: 10px 5px;\r\n\t\tbackground: white;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tmin-height: 120px;\r\n\t\tborder-bottom: 1px solid #f0f0f0;\r\n\t\tborder-right: 1px solid #f0f0f0;\r\n\t\tcursor: pointer;\r\n\t\ttext-align: center;\r\n\t\tword-break: break-word;\r\n\t\toverflow: hidden;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.chart-wrapper {\r\n\t\twidth: 100%;\r\n\t\theight: 80px;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.middle-column {\r\n\t\tbackground-color: #f8fafc;\r\n\t\tborder-right: 1px solid #f0f0f0;\r\n\t\tfont-weight: 600;\r\n\t\tmin-width: 100px;\r\n\t}\r\n\r\n\t.attribute-name {\r\n\t\tfont-weight: 600;\r\n\t\tmargin-bottom: 4px;\r\n\t\tcolor: #2c3e50;\r\n\t\tfont-size: clamp(0.9em, 2vw, 1.1em);\r\n\t\ttext-align: center;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.stats-summary {\r\n\t\tmargin-top: 5px;\r\n\t\tfont-size: clamp(0.7rem, 1.5vw, 0.85rem);\r\n\t\tcolor: #34495e;\r\n\t\ttext-align: center;\r\n\t\tline-height: 1.3;\r\n\t\twidth: 100%;\r\n\t\tpadding: 0 5px;\r\n\t\tbox-sizing: border-box;\r\n\t\toverflow: hidden;\r\n\t\twhite-space: normal;\r\n\t}\r\n\r\n\t.no-data {\r\n\t\tcolor: #95a5a6;\r\n\t\tfont-style: italic;\r\n\t\tfont-size: 0.9em;\r\n\t\ttext-align: center;\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.full-chart-modal {\r\n\t\tposition: fixed;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground: rgba(255, 255, 255, 0.58);\r\n\t\tz-index: 1000;\r\n\t\tbackdrop-filter: blur(5px);\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\toverflow: auto;\r\n\t\tpadding: 20px;\r\n\t\tbox-sizing: border-box;\r\n\t}\r\n\r\n\t.modal-content {\r\n\t\tbackground-color: white;\r\n\t\tborder-radius: 8px;\r\n\t\twidth: 95%;\r\n\t\tmax-width: 900px;\r\n\t\tmax-height: 85vh;\r\n\t\toverflow: auto;\r\n\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\r\n\t\tpadding: 20px;\r\n\t}\r\n\r\n\t.modal-header {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 20px;\r\n\t\tpadding-bottom: 10px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t}\r\n\r\n\t.close-button {\r\n\t\tbackground: none;\r\n\t\tborder: none;\r\n\t\tfont-size: 24px;\r\n\t\tcursor: pointer;\r\n\t\tcolor: #64748b;\r\n\t\ttransition: color 0.2s;\r\n\t}\r\n\r\n\t.close-button:hover {\r\n\t\tcolor: #334155;\r\n\t}\r\n\r\n\t@media (max-width: 992px) {\r\n\t\t.table-grid {\r\n\t\t\tgrid-template-columns: minmax(150px, 1fr) minmax(80px, 0.5fr) minmax(\r\n\t\t\t\t\t150px,\r\n\t\t\t\t\t1fr\r\n\t\t\t\t);\r\n\t\t}\r\n\r\n\t\t.header {\r\n\t\t\tpadding: 10px 8px;\r\n\t\t\tfont-size: 0.95em;\r\n\t\t}\r\n\t}\r\n\r\n\t@media (max-width: 768px) {\r\n\t\t.table-grid {\r\n\t\t\tgrid-template-columns: 1fr;\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-width: auto;\r\n\t\t}\r\n\r\n\t\t.header {\r\n\t\t\tdisplay: flex;\r\n\t\t\tmin-height: 40px;\r\n\t\t\tfont-size: 0.9em;\r\n\t\t}\r\n\r\n\t\t.header.middle-column {\r\n\t\t\tpadding: 10px;\r\n\t\t}\r\n\r\n\t\t.cell {\r\n\t\t\tmin-height: auto;\r\n\t\t\tpadding: 8px;\r\n\t\t\tborder-right: 1px solid #f0f0f0 !important;\r\n\t\t}\r\n\r\n\t\t.left-column,\r\n\t\t.middle-column,\r\n\t\t.right-column {\r\n\t\t\tborder-left: 1px solid #f0f0f0;\r\n\t\t}\r\n\r\n\t\t.chart-wrapper {\r\n\t\t\theight: 70px;\r\n\t\t}\r\n\r\n\t\t.stats-summary {\r\n\t\t\tfont-size: 0.7rem;\r\n\t\t}\r\n\t}\r\n\r\n\t@media (max-width: 480px) {\r\n\t\t.compare-container {\r\n\t\t\tpadding: 5px 0;\r\n\t\t}\r\n\r\n\t\t.table-grid {\r\n\t\t\twidth: 100%;\r\n\t\t\tborder-radius: 0;\r\n\t\t}\r\n\r\n\t\t.attribute-name {\r\n\t\t\tfont-size: 0.95em;\r\n\t\t}\r\n\r\n\t\t.chart-wrapper {\r\n\t\t\theight: 60px;\r\n\t\t}\r\n\r\n\t\t.stats-summary {\r\n\t\t\tfont-size: 0.65rem;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}