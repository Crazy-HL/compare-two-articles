{"ast":null,"code":"import { ref, onMounted, watch, nextTick } from \"vue\";\nimport Chart from \"chart.js/auto\";\nexport default {\n  __name: 'FullChart',\n  props: {\n    field: Object,\n    type: String,\n    visualization: String,\n    isCombined: Boolean,\n    leftTitle: String,\n    rightTitle: String\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const combinedChartCanvas = ref(null);\n    const chartCanvas = ref(null);\n    let chartInstance = null;\n    let combinedChartInstance = null;\n    const renderCombinedChart = () => {\n      if (!combinedChartCanvas.value || !props.field) return;\n      if (combinedChartInstance) {\n        combinedChartInstance.destroy();\n      }\n      const ctx = combinedChartCanvas.value.getContext(\"2d\");\n\n      // 准备合并图表数据\n      const chartData = {\n        labels: [\"对比数据\"],\n        datasets: [{\n          label: props.leftTitle,\n          data: props.field.left.data,\n          backgroundColor: \"rgba(54, 162, 235, 0.5)\",\n          borderColor: \"rgba(54, 162, 235, 1)\",\n          borderWidth: 1\n        }, {\n          label: props.rightTitle,\n          data: props.field.right.data,\n          backgroundColor: \"rgba(255, 99, 132, 0.5)\",\n          borderColor: \"rgba(255, 99, 132, 1)\",\n          borderWidth: 1\n        }]\n      };\n      combinedChartInstance = new Chart(ctx, {\n        type: \"bar\",\n        data: chartData,\n        options: {\n          responsive: true,\n          plugins: {\n            title: {\n              display: true,\n              text: \"数据对比\"\n            },\n            legend: {\n              position: \"top\"\n            }\n          },\n          scales: {\n            y: {\n              beginAtZero: true\n            }\n          }\n        }\n      });\n    };\n    const renderSingleChart = () => {\n      if (!chartCanvas.value || !props.field) return;\n      if (chartInstance) {\n        chartInstance.destroy();\n      }\n      const ctx = chartCanvas.value.getContext(\"2d\");\n\n      // 根据可视化类型渲染单图表\n      let chartType = \"bar\";\n      if (props.visualization === \"pie-chart\") chartType = \"pie\";else if (props.visualization === \"line-chart\") chartType = \"line\";\n      chartInstance = new Chart(ctx, {\n        type: chartType,\n        data: {\n          labels: Array.isArray(props.field) ? props.field.map((_, i) => `数据${i + 1}`) : [\"数据\"],\n          datasets: [{\n            label: props.typeLabel || \"数据\",\n            data: Array.isArray(props.field) ? props.field : [props.field],\n            backgroundColor: [\"rgba(255, 99, 132, 0.5)\", \"rgba(54, 162, 235, 0.5)\", \"rgba(255, 206, 86, 0.5)\", \"rgba(75, 192, 192, 0.5)\", \"rgba(153, 102, 255, 0.5)\", \"rgba(255, 159, 64, 0.5)\"],\n            borderColor: [\"rgba(255, 99, 132, 1)\", \"rgba(54, 162, 235, 1)\", \"rgba(255, 206, 86, 1)\", \"rgba(75, 192, 192, 1)\", \"rgba(153, 102, 255, 1)\", \"rgba(255, 159, 64, 1)\"],\n            borderWidth: 1\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            title: {\n              display: true,\n              text: props.typeLabel || \"数据图表\"\n            }\n          },\n          scales: {\n            y: {\n              beginAtZero: true\n            }\n          }\n        }\n      });\n    };\n    onMounted(() => {\n      nextTick(() => {\n        if (props.isCombined) {\n          renderCombinedChart();\n        } else {\n          renderSingleChart();\n        }\n      });\n    });\n    watch(() => props.field, () => {\n      nextTick(() => {\n        if (props.isCombined) {\n          renderCombinedChart();\n        } else {\n          renderSingleChart();\n        }\n      });\n    }, {\n      deep: true\n    });\n    watch(() => props.isCombined, () => {\n      nextTick(() => {\n        if (props.isCombined) {\n          renderCombinedChart();\n        } else {\n          renderSingleChart();\n        }\n      });\n    });\n    const __returned__ = {\n      props,\n      combinedChartCanvas,\n      chartCanvas,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      get combinedChartInstance() {\n        return combinedChartInstance;\n      },\n      set combinedChartInstance(v) {\n        combinedChartInstance = v;\n      },\n      renderCombinedChart,\n      renderSingleChart,\n      ref,\n      onMounted,\n      watch,\n      nextTick,\n      get Chart() {\n        return Chart;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","nextTick","Chart","props","__props","combinedChartCanvas","chartCanvas","chartInstance","combinedChartInstance","renderCombinedChart","value","field","destroy","ctx","getContext","chartData","labels","datasets","label","leftTitle","data","left","backgroundColor","borderColor","borderWidth","rightTitle","right","type","options","responsive","plugins","title","display","text","legend","position","scales","y","beginAtZero","renderSingleChart","chartType","visualization","Array","isArray","map","_","i","typeLabel","isCombined","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/FullChart.vue"],"sourcesContent":["<template>\r\n\t<div class=\"full-chart\">\r\n\t\t<div v-if=\"isCombined\" class=\"combined-chart-container\">\r\n\t\t\t<canvas ref=\"combinedChartCanvas\"></canvas>\r\n\t\t</div>\r\n\t\t<div v-else class=\"single-chart-container\">\r\n\t\t\t<canvas ref=\"chartCanvas\"></canvas>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, nextTick } from \"vue\";\r\n\timport Chart from \"chart.js/auto\";\r\n\r\n\tconst props = defineProps({\r\n\t\tfield: Object,\r\n\t\ttype: String,\r\n\t\tvisualization: String,\r\n\t\tisCombined: Boolean,\r\n\t\tleftTitle: String,\r\n\t\trightTitle: String\r\n\t});\r\n\r\n\tconst combinedChartCanvas = ref(null);\r\n\tconst chartCanvas = ref(null);\r\n\tlet chartInstance = null;\r\n\tlet combinedChartInstance = null;\r\n\r\n\tconst renderCombinedChart = () => {\r\n\t\tif (!combinedChartCanvas.value || !props.field) return;\r\n\r\n\t\tif (combinedChartInstance) {\r\n\t\t\tcombinedChartInstance.destroy();\r\n\t\t}\r\n\r\n\t\tconst ctx = combinedChartCanvas.value.getContext(\"2d\");\r\n\r\n\t\t// 准备合并图表数据\r\n\t\tconst chartData = {\r\n\t\t\tlabels: [\"对比数据\"],\r\n\t\t\tdatasets: [\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: props.leftTitle,\r\n\t\t\t\t\tdata: props.field.left.data,\r\n\t\t\t\t\tbackgroundColor: \"rgba(54, 162, 235, 0.5)\",\r\n\t\t\t\t\tborderColor: \"rgba(54, 162, 235, 1)\",\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tlabel: props.rightTitle,\r\n\t\t\t\t\tdata: props.field.right.data,\r\n\t\t\t\t\tbackgroundColor: \"rgba(255, 99, 132, 0.5)\",\r\n\t\t\t\t\tborderColor: \"rgba(255, 99, 132, 1)\",\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\r\n\t\tcombinedChartInstance = new Chart(ctx, {\r\n\t\t\ttype: \"bar\",\r\n\t\t\tdata: chartData,\r\n\t\t\toptions: {\r\n\t\t\t\tresponsive: true,\r\n\t\t\t\tplugins: {\r\n\t\t\t\t\ttitle: {\r\n\t\t\t\t\t\tdisplay: true,\r\n\t\t\t\t\t\ttext: \"数据对比\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlegend: {\r\n\t\t\t\t\t\tposition: \"top\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tscales: {\r\n\t\t\t\t\ty: {\r\n\t\t\t\t\t\tbeginAtZero: true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst renderSingleChart = () => {\r\n\t\tif (!chartCanvas.value || !props.field) return;\r\n\r\n\t\tif (chartInstance) {\r\n\t\t\tchartInstance.destroy();\r\n\t\t}\r\n\r\n\t\tconst ctx = chartCanvas.value.getContext(\"2d\");\r\n\r\n\t\t// 根据可视化类型渲染单图表\r\n\t\tlet chartType = \"bar\";\r\n\t\tif (props.visualization === \"pie-chart\") chartType = \"pie\";\r\n\t\telse if (props.visualization === \"line-chart\") chartType = \"line\";\r\n\r\n\t\tchartInstance = new Chart(ctx, {\r\n\t\t\ttype: chartType,\r\n\t\t\tdata: {\r\n\t\t\t\tlabels: Array.isArray(props.field)\r\n\t\t\t\t\t? props.field.map((_, i) => `数据${i + 1}`)\r\n\t\t\t\t\t: [\"数据\"],\r\n\t\t\t\tdatasets: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlabel: props.typeLabel || \"数据\",\r\n\t\t\t\t\t\tdata: Array.isArray(props.field) ? props.field : [props.field],\r\n\t\t\t\t\t\tbackgroundColor: [\r\n\t\t\t\t\t\t\t\"rgba(255, 99, 132, 0.5)\",\r\n\t\t\t\t\t\t\t\"rgba(54, 162, 235, 0.5)\",\r\n\t\t\t\t\t\t\t\"rgba(255, 206, 86, 0.5)\",\r\n\t\t\t\t\t\t\t\"rgba(75, 192, 192, 0.5)\",\r\n\t\t\t\t\t\t\t\"rgba(153, 102, 255, 0.5)\",\r\n\t\t\t\t\t\t\t\"rgba(255, 159, 64, 0.5)\"\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tborderColor: [\r\n\t\t\t\t\t\t\t\"rgba(255, 99, 132, 1)\",\r\n\t\t\t\t\t\t\t\"rgba(54, 162, 235, 1)\",\r\n\t\t\t\t\t\t\t\"rgba(255, 206, 86, 1)\",\r\n\t\t\t\t\t\t\t\"rgba(75, 192, 192, 1)\",\r\n\t\t\t\t\t\t\t\"rgba(153, 102, 255, 1)\",\r\n\t\t\t\t\t\t\t\"rgba(255, 159, 64, 1)\"\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\toptions: {\r\n\t\t\t\tresponsive: true,\r\n\t\t\t\tplugins: {\r\n\t\t\t\t\ttitle: {\r\n\t\t\t\t\t\tdisplay: true,\r\n\t\t\t\t\t\ttext: props.typeLabel || \"数据图表\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tscales: {\r\n\t\t\t\t\ty: {\r\n\t\t\t\t\t\tbeginAtZero: true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tnextTick(() => {\r\n\t\t\tif (props.isCombined) {\r\n\t\t\t\trenderCombinedChart();\r\n\t\t\t} else {\r\n\t\t\t\trenderSingleChart();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => props.field,\r\n\t\t() => {\r\n\t\t\tnextTick(() => {\r\n\t\t\t\tif (props.isCombined) {\r\n\t\t\t\t\trenderCombinedChart();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderSingleChart();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n\r\n\twatch(\r\n\t\t() => props.isCombined,\r\n\t\t() => {\r\n\t\t\tnextTick(() => {\r\n\t\t\t\tif (props.isCombined) {\r\n\t\t\t\t\trenderCombinedChart();\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderSingleChart();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t);\r\n</script>\r\n\r\n<style scoped>\r\n\t.full-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.combined-chart-container,\r\n\t.single-chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 400px;\r\n\t}\r\n\r\n\tcanvas {\r\n\t\twidth: 100% !important;\r\n\t\theight: 100% !important;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}