{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, vModelSelect as _vModelSelect, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createStaticVNode as _createStaticVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-1a5dde20\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h1\", null, \"Data Visualization with D3.js\", -1 /* HOISTED */));\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"jsonData\"\n}, \"输入 JSON 数据：\", -1 /* HOISTED */));\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"visualizationType\"\n}, \"选择可视化类型：\", -1 /* HOISTED */));\nconst _hoisted_4 = /*#__PURE__*/_createStaticVNode(\"<option value=\\\"bar\\\" data-v-1a5dde20>柱状图 (Bar Chart)</option><option value=\\\"line\\\" data-v-1a5dde20>折线图 (Line Chart)</option><option value=\\\"pie\\\" data-v-1a5dde20>饼图 (Pie Chart)</option><option value=\\\"scatter\\\" data-v-1a5dde20>散点图 (Scatter Plot)</option><option value=\\\"treemap\\\" data-v-1a5dde20>树状图 (Treemap)</option>\", 5);\nconst _hoisted_9 = [_hoisted_4];\nconst _hoisted_10 = {\n  key: 0\n};\nconst _hoisted_11 = {\n  ref: \"chart\"\n};\nexport function render(_ctx, _cache) {\n  return _openBlock(), _createElementBlock(\"div\", null, [_hoisted_1, _createElementVNode(\"div\", null, [_hoisted_2, _withDirectives(_createElementVNode(\"textarea\", {\n    id: \"jsonData\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => _ctx.jsonData = $event),\n    rows: \"5\",\n    cols: \"50\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, _ctx.jsonData]])]), _createElementVNode(\"div\", null, [_hoisted_3, _withDirectives(_createElementVNode(\"select\", {\n    id: \"visualizationType\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.selectedVisualizationType = $event)\n  }, [..._hoisted_9], 512 /* NEED_PATCH */), [[_vModelSelect, _ctx.selectedVisualizationType]])]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = function () {\n      return _ctx.fetchRecommendation && _ctx.fetchRecommendation(...arguments);\n    })\n  }, \"获取可视化推荐\"), _createElementVNode(\"button\", {\n    onClick: _cache[3] || (_cache[3] = function () {\n      return _ctx.renderChart && _ctx.renderChart(...arguments);\n    })\n  }, \"手动渲染图表\"), _ctx.visualizationType ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_createElementVNode(\"h2\", null, \"推荐的可视化类型：\" + _toDisplayString(_ctx.visualizationType), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_11, null, 512 /* NEED_PATCH */)])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["_createElementVNode","for","_createStaticVNode","_hoisted_4","key","ref","_createElementBlock","_hoisted_1","_hoisted_2","id","_cache","$event","_ctx","jsonData","rows","cols","_hoisted_3","selectedVisualizationType","_hoisted_9","onClick","fetchRecommendation","arguments","renderChart","visualizationType","_hoisted_10","_toDisplayString","_hoisted_11","_createCommentVNode"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\Vis.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<h1>Data Visualization with D3.js</h1>\r\n\t\t<div>\r\n\t\t\t<label for=\"jsonData\">输入 JSON 数据：</label>\r\n\t\t\t<textarea id=\"jsonData\" v-model=\"jsonData\" rows=\"5\" cols=\"50\"></textarea>\r\n\t\t</div>\r\n\t\t<div>\r\n\t\t\t<label for=\"visualizationType\">选择可视化类型：</label>\r\n\t\t\t<select id=\"visualizationType\" v-model=\"selectedVisualizationType\">\r\n\t\t\t\t<option value=\"bar\">柱状图 (Bar Chart)</option>\r\n\t\t\t\t<option value=\"line\">折线图 (Line Chart)</option>\r\n\t\t\t\t<option value=\"pie\">饼图 (Pie Chart)</option>\r\n\t\t\t\t<option value=\"scatter\">散点图 (Scatter Plot)</option>\r\n\t\t\t\t<option value=\"treemap\">树状图 (Treemap)</option>\r\n\t\t\t</select>\r\n\t\t</div>\r\n\t\t<button @click=\"fetchRecommendation\">获取可视化推荐</button>\r\n\t\t<button @click=\"renderChart\">手动渲染图表</button>\r\n\t\t<div v-if=\"visualizationType\">\r\n\t\t\t<h2>推荐的可视化类型：{{ visualizationType }}</h2>\r\n\t\t\t<div ref=\"chart\"></div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\t\timport * as d3 from \"d3\";\r\n\r\n\t\texport default {\r\n\t\t\tdata() {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tjsonData: '{\"A\": 10, \"B\": 20, \"C\": 30, \"D\": 40}', // 默认 JSON 数据\r\n\t\t\t\t\tvisualizationType: \"\", // 推荐的可视化类型\r\n\t\t\t\t\tselectedVisualizationType: \"bar\", // 用户选择的可视化类型\r\n\t\t\t\t\tchartData: {} // 用于存储图表数据\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tmethods: {\r\n\t\t\t\t// 获取后端推荐的可视化类型\r\n\t\t\t\tasync fetchRecommendation() {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst response = await fetch(\r\n\t\t\t\t\t\t\t\"http://localhost:8888/recommend_visualization\",\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tbody: JSON.stringify({\r\n\t\t\t\t\t\t\t\t\tdata: JSON.parse(this.jsonData)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tconst result = await response.json();\r\n\t\t\t\t\t\tthis.visualizationType = result.visualization_type;\r\n\t\t\t\t\t\tthis.chartData = result.data;\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.renderChart(); // 确保 DOM 更新后渲染图表\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tconsole.error(\"获取推荐失败：\", error);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t// 手动渲染图表\r\n\t\t\t\trenderChart() {\r\n\t\t\t\t\tconst chartElement = this.$refs.chart;\r\n\t\t\t\t\tif (!chartElement) {\r\n\t\t\t\t\t\tconsole.error(\"图表容器未找到\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 清空之前的图表\r\n\t\t\t\t\tchartElement.innerHTML = \"\";\r\n\r\n\t\t\t\t\tconst svg = d3\r\n\t\t\t\t\t\t.select(chartElement)\r\n\t\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t\t.attr(\"width\", 500)\r\n\t\t\t\t\t\t.attr(\"height\", 500);\r\n\r\n\t\t\t\t\tconst data = Object.entries(this.chartData);\r\n\r\n\t\t\t\t\t// 根据用户选择的可视化类型渲染图表\r\n\t\t\t\t\tswitch (this.selectedVisualizationType) {\r\n\t\t\t\t\t\tcase \"bar\":\r\n\t\t\t\t\t\t\tthis.renderBarChart(svg, data);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"line\":\r\n\t\t\t\t\t\t\tthis.renderLineChart(svg, data);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"pie\":\r\n\t\t\t\t\t\t\tthis.renderPieChart(svg, data);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"scatter\":\r\n\t\t\t\t\t\t\tthis.renderScatterChart(svg, data);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"treemap\":\r\n\t\t\t\t\t\t\tthis.renderTreemap(svg, data);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.error(\"未知的可视化类型：\", this.selectedVisualizationType);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t// 渲染柱状图\r\n\t\t\t\trenderBarChart(svg, data) {\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.selectAll(\"rect\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"x\", (d, i) => i * 100)\r\n\t\t\t\t\t\t.attr(\"y\", d => 500 - d[1] * 10)\r\n\t\t\t\t\t\t.attr(\"width\", 50)\r\n\t\t\t\t\t\t.attr(\"height\", d => d[1] * 10)\r\n\t\t\t\t\t\t.attr(\"fill\", \"blue\");\r\n\t\t\t\t},\r\n\t\t\t\t// 渲染折线图\r\n\t\t\t\trenderLineChart(svg, data) {\r\n\t\t\t\t\tconst line = d3\r\n\t\t\t\t\t\t.line()\r\n\t\t\t\t\t\t.x((d, i) => i * 50)\r\n\t\t\t\t\t\t.y(d => 500 - d[1] * 10);\r\n\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t\t.datum(data)\r\n\t\t\t\t\t\t.attr(\"d\", line)\r\n\t\t\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t\t\t.attr(\"stroke\", \"green\")\r\n\t\t\t\t\t\t.attr(\"stroke-width\", 2);\r\n\t\t\t\t},\r\n\t\t\t\t// 渲染饼图\r\n\t\t\t\trenderPieChart(svg, data) {\r\n\t\t\t\t\tconst pie = d3.pie().value(d => d[1]);\r\n\r\n\t\t\t\t\tconst arcs = pie(data);\r\n\r\n\t\t\t\t\tconst arc = d3.arc().innerRadius(0).outerRadius(200);\r\n\r\n\t\t\t\t\tconst g = svg.append(\"g\").attr(\"transform\", \"translate(250, 250)\");\r\n\r\n\t\t\t\t\tg.selectAll(\"path\")\r\n\t\t\t\t\t\t.data(arcs)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t\t.attr(\"d\", arc)\r\n\t\t\t\t\t\t.attr(\"fill\", (d, i) => d3.schemeCategory10[i]);\r\n\t\t\t\t},\r\n\t\t\t\t// 渲染散点图\r\n\t\t\t\trenderScatterChart(svg, data) {\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.selectAll(\"circle\")\r\n\t\t\t\t\t\t.data(data)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"circle\")\r\n\t\t\t\t\t\t.attr(\"cx\", (d, i) => i * 100)\r\n\t\t\t\t\t\t.attr(\"cy\", d => 500 - d[1] * 10)\r\n\t\t\t\t\t\t.attr(\"r\", 5)\r\n\t\t\t\t\t\t.attr(\"fill\", \"red\");\r\n\t\t\t\t},\r\n\t\t\t\t// 渲染树状图\r\n\t\t\t\trenderTreemap(svg, data) {\r\n\t\t\t\t\tconst root = d3.hierarchy({ children: data }).sum(d => d[1]); // 使用数据的值作为权重\r\n\r\n\t\t\t\t\tconst treemap = d3\r\n\t\t\t\t\t\t.treemap()\r\n\t\t\t\t\t\t.size([500, 500]) // 设置树状图的大小\r\n\t\t\t\t\t\t.padding(1);\r\n\r\n\t\t\t\t\ttreemap(root);\r\n\r\n\t\t\t\t\tconst cells = svg\r\n\t\t\t\t\t\t.selectAll(\"g\")\r\n\t\t\t\t\t\t.data(root.leaves())\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr(\"transform\", d => `translate(${d.x0},${d.y0})`);\r\n\r\n\t\t\t\t\tcells\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"width\", d => d.x1 - d.x0)\r\n\t\t\t\t\t\t.attr(\"height\", d => d.y1 - d.y0)\r\n\t\t\t\t\t\t.attr(\"fill\", (d, i) => d3.schemeCategory10[i % 10]);\r\n\r\n\t\t\t\t\tcells\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"x\", 5)\r\n\t\t\t\t\t\t.attr(\"y\", 20)\r\n\t\t\t\t\t\t.text(d => d.data[0]); // 显示标签\r\n\t\t\t\t}\r\n\r\n\t      const renderChart = (svg, data) => {\r\n\t    const dms = {\r\n\t        width: 1000,\r\n\t        height: 500,\r\n\t        margin: { top: 50, bottom: 50, right: 100, left: 100 },\r\n\t    };\r\n\r\n\t    dms.contentWidth = dms.width - dms.margin.left - dms.margin.right;\r\n\t    dms.contentHeight = dms.height - dms.margin.top - dms.margin.bottom;\r\n\r\n\t    // 创建根节点\r\n\t    let root = d3.hierarchy(data);\r\n\t    root = d3.tree().size([dms.contentWidth, dms.contentHeight])(root);\r\n\r\n\t    // 创建SVG容器\r\n\t    const box = svg\r\n\t        .attr(\"width\", dms.width)\r\n\t        .attr(\"height\", dms.height)\r\n\t        .append(\"g\")\r\n\t        .attr(\"transform\", `translate(${dms.margin.left},${dms.margin.top})`);\r\n\r\n\t    // 创建图形容器\r\n\t    const circles = box.append(\"g\").attr(\"class\", \"circles\");\r\n\t    const paths = box.append(\"g\").attr(\"class\", \"paths\");\r\n\t    const up_lines = box.append(\"g\").attr(\"class\", \"up_lines\");\r\n\t    const down_lines = box.append(\"g\").attr(\"class\", \"down_lines\");\r\n\t    const transverse_lines = paths.append(\"g\").attr(\"class\", \"transverse_lines\");\r\n\r\n\t    // 渲染树形图\r\n\t    renderLines(down_lines, up_lines, root);\r\n\t    renderTransverseLines(transverse_lines, root);\r\n\t    renderCircles(circles, root);\r\n\t};\r\n\r\n\tconst renderLines = (down_lines, up_lines, data) => {\r\n\t    // 绘制下竖线\r\n\t    down_lines\r\n\t        .selectAll(\"path\")\r\n\t        .data(data.links())\r\n\t        .join(\"path\")\r\n\t        .attr(\"fill\", \"none\")\r\n\t        .attr(\"stroke\", \"black\")\r\n\t        .attr(\"stroke-width\", 1.5)\r\n\t        .attr(\"d\", d => `M${d.source.x},${d.source.y + 50},${d.source.x},${d.target.y - 20}`);\r\n\r\n\t    // 绘制上竖线\r\n\t    up_lines\r\n\t        .selectAll(\"path\")\r\n\t        .data(data.links())\r\n\t        .join(\"path\")\r\n\t        .attr(\"fill\", \"none\")\r\n\t        .attr(\"stroke\", \"black\")\r\n\t        .attr(\"stroke-width\", 1.5)\r\n\t        .attr(\"d\", d => `M${d.target.x},${d.target.y},${d.target.x},${d.target.y - 20}`);\r\n\t};\r\n\r\n\tconst renderTransverseLines = (transverse_lines, data) => {\r\n\t    const levelObj = {};\r\n\t    const level = [];\r\n\r\n\t    // 计算每一层的横线坐标\r\n\t    const kData = data.descendants();\r\n\t    for (let i = 0; i < kData.length; i++) {\r\n\t        kData[i].key = i;\r\n\t    }\r\n\r\n\t    kData.forEach(d => {\r\n\t        if (d.parent) {\r\n\t            if (!levelObj[d.parent.key]) {\r\n\t                levelObj[d.parent.key] = [];\r\n\t            }\r\n\t        }\r\n\t    });\r\n\r\n\t    kData.forEach(d => {\r\n\t        if (d.parent) {\r\n\t            levelObj[d.parent.key].push([d.x, d.y]);\r\n\t        }\r\n\t    });\r\n\r\n\t    // 渲染每一层的横线\r\n\t    Object.values(levelObj).forEach(d => {\r\n\t        transverse_lines\r\n\t            .selectAll(\"path\")\r\n\t            .data([d])\r\n\t            .join(\"path\")\r\n\t            .attr(\"fill\", \"none\")\r\n\t            .attr(\"stroke\", \"black\")\r\n\t            .attr(\"stroke-width\", 1.5)\r\n\t            .attr(\"d\", d => {\r\n\t                const startX = d[0][0];\r\n\t                const y = d[0][1] - 20;\r\n\t                const endX = d[d.length - 1][0];\r\n\t                return `M${startX},${y} L${endX},${y}`;\r\n\t            });\r\n\t    });\r\n\t};\r\n\r\n\tconst renderCircles = (circles, data) => {\r\n\t    // 渲染每个矩形\r\n\t    circles\r\n\t        .selectAll()\r\n\t        .data(data.descendants())\r\n\t        .join(\"rect\")\r\n\t        .attr(\"x\", d => d.x - 5)\r\n\t        .attr(\"y\", d => d.y)\r\n\t        .attr(\"width\", 10)\r\n\t        .attr(\"height\", 50)\r\n\t        .attr(\"stroke-width\", 3)\r\n\t        .attr(\"fill\", d => {\r\n\t            if (d.depth === 0) {\r\n\t                return \"blue\";\r\n\t            } else {\r\n\t                return d.data.attitude === \"y\" ? \"green\" : \"red\";\r\n\t            }\r\n\t        });\r\n\t};\r\n\r\n\t// 使用 `renderChart` 渲染树形图\r\n\tconst svg = d3.select(\"#box-div\").append(\"svg\");\r\n\tapi.get(\"arg_json\", {}, (data) => {\r\n\t    renderChart(svg, data);\r\n\t});\r\n\r\n\t\t\t}\r\n\t\t};\r\n</script>\r\n\r\n<style scoped>\r\n\ttextarea {\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\tbutton {\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\t.chart {\r\n\t\tmargin: 20px;\r\n\t}\r\n</style>\r\n"],"mappings":";;gEAEEA,mBAAA,CAAsC,YAAlC,+BAA6B;gEAEhCA,mBAAA,CAAyC;EAAlCC,GAAG,EAAC;AAAU,GAAC,aAAW;gEAIjCD,mBAAA,CAA+C;EAAxCC,GAAG,EAAC;AAAmB,GAAC,UAAQ;gCAR1CC,kBAAA;oBAUIC,UAA4C,C;;EAVhDC,GAAA;AAAA;;EAqBQC,GAAG,EAAC;AAAO;;uBApBlBC,mBAAA,CAsBM,cArBLC,UAAsC,EACtCP,mBAAA,CAGM,cAFLQ,UAAyC,E,gBACzCR,mBAAA,CAAyE;IAA/DS,EAAE,EAAC,UAAU;IAL1B,uBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAKoCC,IAAA,CAAAC,QAAQ,GAAAF,MAAA;IAAEG,IAAI,EAAC,GAAG;IAACC,IAAI,EAAC;iDAAxBH,IAAA,CAAAC,QAAQ,E,KAE1Cb,mBAAA,CASM,cARLgB,UAA+C,E,gBAC/ChB,mBAAA,CAMS;IANDS,EAAE,EAAC,mBAAmB;IATjC,uBAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAS2CC,IAAA,CAAAK,yBAAyB,GAAAN,MAAA;KATpE,IAAAO,UAAA,2B,gBAS2CN,IAAA,CAAAK,yBAAyB,E,KAQlEjB,mBAAA,CAAqD;IAA5CmB,OAAK,EAAAT,MAAA,QAAAA,MAAA;MAAA,OAAEE,IAAA,CAAAQ,mBAAA,IAAAR,IAAA,CAAAQ,mBAAA,IAAAC,SAAA,CAAmB;IAAA;KAAE,SAAO,GAC5CrB,mBAAA,CAA4C;IAAnCmB,OAAK,EAAAT,MAAA,QAAAA,MAAA;MAAA,OAAEE,IAAA,CAAAU,WAAA,IAAAV,IAAA,CAAAU,WAAA,IAAAD,SAAA,CAAW;IAAA;KAAE,QAAM,GACxBT,IAAA,CAAAW,iBAAiB,I,cAA5BjB,mBAAA,CAGM,OAtBRkB,WAAA,GAoBGxB,mBAAA,CAAyC,YAArC,WAAS,GAAAyB,gBAAA,CAAGb,IAAA,CAAAW,iBAAiB,kBACjCvB,mBAAA,CAAuB,OAAvB0B,WAAuB,8B,KArB1BC,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}