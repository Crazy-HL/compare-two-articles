{"ast":null,"code":"import { ref, onMounted, watch } from \"vue\";\nimport * as d3 from \"d3\";\nexport default {\n  __name: 'FullChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    title: {\n      type: String,\n      default: \"\"\n    },\n    side: {\n      type: String,\n      default: \"left\"\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartContainer = ref(null);\n    const color = props.side === \"left\" ? \"#4a90e2\" : \"#ef4444\";\n    const drawChart = () => {\n      if (!chartContainer.value || props.data.length === 0) return;\n      d3.select(chartContainer.value).selectAll(\"*\").remove();\n      const margin = {\n        top: 30,\n        right: 30,\n        bottom: 50,\n        left: 50\n      };\n      const width = 800 - margin.left - margin.right;\n      const height = 500 - margin.top - margin.bottom;\n      const svg = d3.select(chartContainer.value).append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", `translate(${margin.left},${margin.top})`);\n      const data = props.data.sort((a, b) => a.year - b.year);\n      const x = d3.scaleLinear().domain(d3.extent(data, d => d.year)).range([0, width]);\n      const y = d3.scaleLinear().domain([0, d3.max(data, d => d.value) * 1.1]).range([height, 0]);\n\n      // 添加网格线\n      svg.append(\"g\").attr(\"class\", \"grid\").call(d3.axisLeft(y).tickSize(-width).tickFormat(\"\")).selectAll(\"line\").attr(\"stroke\", \"#e2e8f0\").attr(\"stroke-dasharray\", \"2,2\");\n\n      // 添加X轴\n      svg.append(\"g\").attr(\"transform\", `translate(0,${height})`).call(d3.axisBottom(x).tickFormat(d3.format(\"d\")));\n\n      // 添加Y轴\n      svg.append(\"g\").call(d3.axisLeft(y));\n\n      // 添加X轴标签\n      svg.append(\"text\").attr(\"transform\", `translate(${width / 2},${height + margin.top + 10})`).style(\"text-anchor\", \"middle\").text(\"年份\");\n\n      // 添加Y轴标签\n      svg.append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"y\", 0 - margin.left).attr(\"x\", 0 - height / 2).attr(\"dy\", \"1em\").style(\"text-anchor\", \"middle\").text(\"数值\");\n\n      // 添加标题\n      svg.append(\"text\").attr(\"x\", width / 2).attr(\"y\", 0 - margin.top / 2).attr(\"text-anchor\", \"middle\").style(\"font-size\", \"16px\").style(\"font-weight\", \"bold\").text(props.title);\n\n      // 创建折线\n      const line = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);\n\n      // 添加折线路径\n      svg.append(\"path\").datum(data).attr(\"fill\", \"none\").attr(\"stroke\", color).attr(\"stroke-width\", 3).attr(\"d\", line);\n\n      // 添加数据点\n      svg.selectAll(\".dot\").data(data).enter().append(\"circle\").attr(\"class\", \"dot\").attr(\"cx\", d => x(d.year)).attr(\"cy\", d => y(d.value)).attr(\"r\", 6).attr(\"fill\", color).attr(\"stroke\", \"white\").attr(\"stroke-width\", 2);\n\n      // 添加数据标签\n      svg.selectAll(\".text\").data(data).enter().append(\"text\").attr(\"x\", d => x(d.year)).attr(\"y\", d => y(d.value) - 12).text(d => d.value.toLocaleString()).attr(\"font-size\", \"12px\").attr(\"text-anchor\", \"middle\").attr(\"fill\", color);\n    };\n    watch(() => [props.data, props.title, props.side], drawChart);\n    onMounted(drawChart);\n    const __returned__ = {\n      props,\n      chartContainer,\n      color,\n      drawChart,\n      ref,\n      onMounted,\n      watch,\n      get d3() {\n        return d3;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","d3","props","__props","chartContainer","color","side","drawChart","value","data","length","select","selectAll","remove","margin","top","right","bottom","left","width","height","svg","append","attr","sort","a","b","year","x","scaleLinear","domain","extent","d","range","y","max","call","axisLeft","tickSize","tickFormat","axisBottom","format","style","text","title","line","curve","curveMonotoneX","datum","enter","toLocaleString"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/FullChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"full-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"\"\r\n\t\t},\r\n\t\tside: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"left\"\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartContainer = ref(null);\r\n\tconst color = props.side === \"left\" ? \"#4a90e2\" : \"#ef4444\";\r\n\r\n\tconst drawChart = () => {\r\n\t\tif (!chartContainer.value || props.data.length === 0) return;\r\n\r\n\t\td3.select(chartContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\tconst margin = { top: 30, right: 30, bottom: 50, left: 50 };\r\n\t\tconst width = 800 - margin.left - margin.right;\r\n\t\tconst height = 500 - margin.top - margin.bottom;\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(chartContainer.value)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", width + margin.left + margin.right)\r\n\t\t\t.attr(\"height\", height + margin.top + margin.bottom)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n\t\tconst data = props.data.sort((a, b) => a.year - b.year);\r\n\r\n\t\tconst x = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain(d3.extent(data, d => d.year))\r\n\t\t\t.range([0, width]);\r\n\r\n\t\tconst y = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain([0, d3.max(data, d => d.value) * 1.1])\r\n\t\t\t.range([height, 0]);\r\n\r\n\t\t// 添加网格线\r\n\t\tsvg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(d3.axisLeft(y).tickSize(-width).tickFormat(\"\"))\r\n\t\t\t.selectAll(\"line\")\r\n\t\t\t.attr(\"stroke\", \"#e2e8f0\")\r\n\t\t\t.attr(\"stroke-dasharray\", \"2,2\");\r\n\r\n\t\t// 添加X轴\r\n\t\tsvg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(0,${height})`)\r\n\t\t\t.call(d3.axisBottom(x).tickFormat(d3.format(\"d\")));\r\n\r\n\t\t// 添加Y轴\r\n\t\tsvg.append(\"g\").call(d3.axisLeft(y));\r\n\r\n\t\t// 添加X轴标签\r\n\t\tsvg\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"transform\", `translate(${width / 2},${height + margin.top + 10})`)\r\n\t\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t\t.text(\"年份\");\r\n\r\n\t\t// 添加Y轴标签\r\n\t\tsvg\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"transform\", \"rotate(-90)\")\r\n\t\t\t.attr(\"y\", 0 - margin.left)\r\n\t\t\t.attr(\"x\", 0 - height / 2)\r\n\t\t\t.attr(\"dy\", \"1em\")\r\n\t\t\t.style(\"text-anchor\", \"middle\")\r\n\t\t\t.text(\"数值\");\r\n\r\n\t\t// 添加标题\r\n\t\tsvg\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", width / 2)\r\n\t\t\t.attr(\"y\", 0 - margin.top / 2)\r\n\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t.style(\"font-size\", \"16px\")\r\n\t\t\t.style(\"font-weight\", \"bold\")\r\n\t\t\t.text(props.title);\r\n\r\n\t\t// 创建折线\r\n\t\tconst line = d3\r\n\t\t\t.line()\r\n\t\t\t.x(d => x(d.year))\r\n\t\t\t.y(d => y(d.value))\r\n\t\t\t.curve(d3.curveMonotoneX);\r\n\r\n\t\t// 添加折线路径\r\n\t\tsvg\r\n\t\t\t.append(\"path\")\r\n\t\t\t.datum(data)\r\n\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t.attr(\"stroke\", color)\r\n\t\t\t.attr(\"stroke-width\", 3)\r\n\t\t\t.attr(\"d\", line);\r\n\r\n\t\t// 添加数据点\r\n\t\tsvg\r\n\t\t\t.selectAll(\".dot\")\r\n\t\t\t.data(data)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"circle\")\r\n\t\t\t.attr(\"class\", \"dot\")\r\n\t\t\t.attr(\"cx\", d => x(d.year))\r\n\t\t\t.attr(\"cy\", d => y(d.value))\r\n\t\t\t.attr(\"r\", 6)\r\n\t\t\t.attr(\"fill\", color)\r\n\t\t\t.attr(\"stroke\", \"white\")\r\n\t\t\t.attr(\"stroke-width\", 2);\r\n\r\n\t\t// 添加数据标签\r\n\t\tsvg\r\n\t\t\t.selectAll(\".text\")\r\n\t\t\t.data(data)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", d => x(d.year))\r\n\t\t\t.attr(\"y\", d => y(d.value) - 12)\r\n\t\t\t.text(d => d.value.toLocaleString())\r\n\t\t\t.attr(\"font-size\", \"12px\")\r\n\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t.attr(\"fill\", color);\r\n\t};\r\n\r\n\twatch(() => [props.data, props.title, props.side], drawChart);\r\n\tonMounted(drawChart);\r\n</script>\r\n\r\n<style scoped>\r\n\t.full-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 500px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}