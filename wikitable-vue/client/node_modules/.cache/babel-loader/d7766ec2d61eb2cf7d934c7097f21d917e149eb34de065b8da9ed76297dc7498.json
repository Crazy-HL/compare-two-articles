{"ast":null,"code":"import { ref, watch, nextTick, onMounted } from \"vue\";\nimport * as d3 from \"d3\";\nimport { renderBarChart, renderPieChart, renderLineChart, renderNonVisualChart, renderChart } from \"@/js/chartUtils2\";\nexport default {\n  props: {\n    title: String,\n    leftHeader: {\n      type: String,\n      default: \"表格1\"\n    },\n    middleHeader: {\n      type: String,\n      default: \"公共属性\"\n    },\n    rightHeader: {\n      type: String,\n      default: \"表格2\"\n    },\n    tableData1: {\n      type: Object,\n      default: () => ({})\n    },\n    tableData2: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: [\"row-selected\"],\n  setup(props, _ref) {\n    let {\n      emit\n    } = _ref;\n    const commonAttributes = ref([]);\n    const leftCharts = ref([]);\n    const rightCharts = ref([]);\n    const selectedRow = ref(-1);\n\n    // 提取公共属性\n    const getCommonAttributes = () => {\n      if (!props.tableData1 || !props.tableData2) return [];\n      const attrs1 = Object.keys(props.tableData1);\n      const attrs2 = Object.keys(props.tableData2);\n      return attrs1.filter(attr => attrs2.includes(attr) && props.tableData1[attr] && props.tableData2[attr]);\n    };\n\n    // 渲染图表\n    const renderCharts = () => {\n      nextTick(() => {\n        commonAttributes.value.forEach((attr, index) => {\n          // 渲染左侧图表 (tableData1)\n          if (leftCharts.value[index]) {\n            renderChart(leftCharts.value[index], props.tableData1[attr], `${attr} (${props.leftHeader})`);\n          }\n\n          // 渲染右侧图表 (tableData2)\n          if (rightCharts.value[index]) {\n            renderChart(rightCharts.value[index], props.tableData2[attr], `${attr} (${props.rightHeader})`);\n          }\n        });\n      });\n    };\n\n    // 图表渲染方法\n    const renderChart = (container, data, title) => {\n      // 清空容器\n      container.innerHTML = \"\";\n\n      // 根据数据类型选择图表类型\n      if (Array.isArray(data)) {\n        // 如果是数组数据，使用柱状图\n        renderBarChart(container, {\n          title,\n          data: data.map((item, i) => ({\n            name: item.name || `项目${i + 1}`,\n            value: item.value || item\n          }))\n        });\n      } else if (typeof data === \"object\") {\n        // 如果是对象，使用饼图\n        renderPieChart(container, {\n          title,\n          data: Object.entries(data).map(_ref2 => {\n            let [name, value] = _ref2;\n            return {\n              name,\n              value\n            };\n          })\n        });\n      } else {\n        // 其他类型使用简单文本显示\n        const div = document.createElement(\"div\");\n        div.className = \"simple-value\";\n        div.textContent = data;\n        container.appendChild(div);\n      }\n    };\n\n    // 行选择\n    const selectRow = index => {\n      selectedRow.value = index;\n      emit(\"row-selected\", {\n        index,\n        attribute: commonAttributes.value[index]\n      });\n    };\n\n    // 监听数据变化\n    watch(() => [props.tableData1, props.tableData2], () => {\n      commonAttributes.value = getCommonAttributes();\n      renderCharts();\n    }, {\n      immediate: true,\n      deep: true\n    });\n    return {\n      commonAttributes,\n      leftCharts,\n      rightCharts,\n      selectedRow,\n      selectRow\n    };\n  }\n};","map":{"version":3,"names":["ref","watch","nextTick","onMounted","d3","renderBarChart","renderPieChart","renderLineChart","renderNonVisualChart","renderChart","props","title","String","leftHeader","type","default","middleHeader","rightHeader","tableData1","Object","tableData2","emits","setup","_ref","emit","commonAttributes","leftCharts","rightCharts","selectedRow","getCommonAttributes","attrs1","keys","attrs2","filter","attr","includes","renderCharts","value","forEach","index","container","data","innerHTML","Array","isArray","map","item","i","name","entries","_ref2","div","document","createElement","className","textContent","appendChild","selectRow","attribute","immediate","deep"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\CompareTable.vue"],"sourcesContent":["<template>\r\n\t<div class=\"comparison-table\">\r\n\t\t<div class=\"table-grid\">\r\n\t\t\t<!-- 表头 -->\r\n\t\t\t<div class=\"header left-column\">{{ leftHeader }}</div>\r\n\t\t\t<div class=\"header middle-column\">{{ middleHeader }}</div>\r\n\t\t\t<div class=\"header right-column\">{{ rightHeader }}</div>\r\n\r\n\t\t\t<!-- 数据行 -->\r\n\t\t\t<template v-for=\"(attr, index) in commonAttributes\" :key=\"attr\">\r\n\t\t\t\t<!-- 左侧图表 -->\r\n\t\t\t\t<div class=\"cell left-column\">\r\n\t\t\t\t\t<div class=\"chart-container\" ref=\"leftCharts\" :data-attr=\"attr\"></div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<!-- 属性名称 -->\r\n\t\t\t\t<div class=\"cell middle-column\" @click=\"selectRow(index)\">\r\n\t\t\t\t\t{{ attr }}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<!-- 右侧图表 -->\r\n\t\t\t\t<div class=\"cell right-column\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclass=\"chart-container\"\r\n\t\t\t\t\t\tref=\"rightCharts\"\r\n\t\t\t\t\t\t:data-attr=\"attr\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport { ref, watch, nextTick, onMounted } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\timport {\r\n\t\trenderBarChart,\r\n\t\trenderPieChart,\r\n\t\trenderLineChart,\r\n\t\trenderNonVisualChart,\r\n\t\trenderChart\r\n\t} from \"@/js/chartUtils2\";\r\n\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\ttitle: String,\r\n\t\t\tleftHeader: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"表格1\"\r\n\t\t\t},\r\n\t\t\tmiddleHeader: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"公共属性\"\r\n\t\t\t},\r\n\t\t\trightHeader: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"表格2\"\r\n\t\t\t},\r\n\t\t\ttableData1: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({})\r\n\t\t\t},\r\n\t\t\ttableData2: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({})\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\temits: [\"row-selected\"],\r\n\r\n\t\tsetup(props, { emit }) {\r\n\t\t\tconst commonAttributes = ref([]);\r\n\t\t\tconst leftCharts = ref([]);\r\n\t\t\tconst rightCharts = ref([]);\r\n\t\t\tconst selectedRow = ref(-1);\r\n\r\n\t\t\t// 提取公共属性\r\n\t\t\tconst getCommonAttributes = () => {\r\n\t\t\t\tif (!props.tableData1 || !props.tableData2) return [];\r\n\r\n\t\t\t\tconst attrs1 = Object.keys(props.tableData1);\r\n\t\t\t\tconst attrs2 = Object.keys(props.tableData2);\r\n\r\n\t\t\t\treturn attrs1.filter(\r\n\t\t\t\t\tattr =>\r\n\t\t\t\t\t\tattrs2.includes(attr) &&\r\n\t\t\t\t\t\tprops.tableData1[attr] &&\r\n\t\t\t\t\t\tprops.tableData2[attr]\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\t// 渲染图表\r\n\t\t\tconst renderCharts = () => {\r\n\t\t\t\tnextTick(() => {\r\n\t\t\t\t\tcommonAttributes.value.forEach((attr, index) => {\r\n\t\t\t\t\t\t// 渲染左侧图表 (tableData1)\r\n\t\t\t\t\t\tif (leftCharts.value[index]) {\r\n\t\t\t\t\t\t\trenderChart(\r\n\t\t\t\t\t\t\t\tleftCharts.value[index],\r\n\t\t\t\t\t\t\t\tprops.tableData1[attr],\r\n\t\t\t\t\t\t\t\t`${attr} (${props.leftHeader})`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// 渲染右侧图表 (tableData2)\r\n\t\t\t\t\t\tif (rightCharts.value[index]) {\r\n\t\t\t\t\t\t\trenderChart(\r\n\t\t\t\t\t\t\t\trightCharts.value[index],\r\n\t\t\t\t\t\t\t\tprops.tableData2[attr],\r\n\t\t\t\t\t\t\t\t`${attr} (${props.rightHeader})`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// 图表渲染方法\r\n\t\t\tconst renderChart = (container, data, title) => {\r\n\t\t\t\t// 清空容器\r\n\t\t\t\tcontainer.innerHTML = \"\";\r\n\r\n\t\t\t\t// 根据数据类型选择图表类型\r\n\t\t\t\tif (Array.isArray(data)) {\r\n\t\t\t\t\t// 如果是数组数据，使用柱状图\r\n\t\t\t\t\trenderBarChart(container, {\r\n\t\t\t\t\t\ttitle,\r\n\t\t\t\t\t\tdata: data.map((item, i) => ({\r\n\t\t\t\t\t\t\tname: item.name || `项目${i + 1}`,\r\n\t\t\t\t\t\t\tvalue: item.value || item\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (typeof data === \"object\") {\r\n\t\t\t\t\t// 如果是对象，使用饼图\r\n\t\t\t\t\trenderPieChart(container, {\r\n\t\t\t\t\t\ttitle,\r\n\t\t\t\t\t\tdata: Object.entries(data).map(([name, value]) => ({ name, value }))\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 其他类型使用简单文本显示\r\n\t\t\t\t\tconst div = document.createElement(\"div\");\r\n\t\t\t\t\tdiv.className = \"simple-value\";\r\n\t\t\t\t\tdiv.textContent = data;\r\n\t\t\t\t\tcontainer.appendChild(div);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 行选择\r\n\t\t\tconst selectRow = index => {\r\n\t\t\t\tselectedRow.value = index;\r\n\t\t\t\temit(\"row-selected\", {\r\n\t\t\t\t\tindex,\r\n\t\t\t\t\tattribute: commonAttributes.value[index]\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\t// 监听数据变化\r\n\t\t\twatch(\r\n\t\t\t\t() => [props.tableData1, props.tableData2],\r\n\t\t\t\t() => {\r\n\t\t\t\t\tcommonAttributes.value = getCommonAttributes();\r\n\t\t\t\t\trenderCharts();\r\n\t\t\t\t},\r\n\t\t\t\t{ immediate: true, deep: true }\r\n\t\t\t);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcommonAttributes,\r\n\t\t\t\tleftCharts,\r\n\t\t\t\trightCharts,\r\n\t\t\t\tselectedRow,\r\n\t\t\t\tselectRow\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.comparison-table {\r\n\t\twidth: 100%;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 8px;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.table-grid {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: 1fr 1fr 1fr;\r\n\t\tgrid-auto-rows: minmax(100px, auto);\r\n\t\tgap: 1px;\r\n\t\tbackground: #eee;\r\n\t}\r\n\r\n\t.header {\r\n\t\tpadding: 12px;\r\n\t\tbackground: #f9f9f9;\r\n\t\tfont-weight: 500;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.cell {\r\n\t\tpadding: 12px;\r\n\t\tbackground: white;\r\n\t\tmin-height: 120px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.left-column {\r\n\t\tborder-right: 1px solid #eee;\r\n\t}\r\n\r\n\t.right-column {\r\n\t\tborder-left: 1px solid #eee;\r\n\t}\r\n\r\n\t.middle-column {\r\n\t\tcursor: pointer;\r\n\t\ttransition: background 0.2s;\r\n\t}\r\n\r\n\t.middle-column:hover {\r\n\t\tbackground: #f0f7ff;\r\n\t}\r\n\r\n\t.chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 100px;\r\n\t}\r\n\r\n\t.simple-value {\r\n\t\tpadding: 8px;\r\n\t\tbackground: #f5f5f5;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}