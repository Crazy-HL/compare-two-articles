{"ast":null,"code":"import { ref, onMounted, watch, computed } from \"vue\";\nimport * as echarts from \"echarts\";\nexport default {\n  __name: 'BarChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => [],\n      validator: data => {\n        // 验证数据格式：[{name, value, year?}]\n        return data.every(item => item.name && !isNaN(item.value));\n      }\n    },\n    title: String,\n    year: String,\n    showTotal: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartEl = ref(null);\n    let chartInstance = null;\n\n    // 计算标准化比例（确保总和为100%）\n    const normalizedData = computed(() => {\n      const sum = props.data.reduce((acc, cur) => acc + Math.abs(Number(cur.value)), 0);\n      return props.data.map(item => ({\n        ...item,\n        value: sum > 0 ? Number(item.value) / sum * 100 : 0,\n        rawValue: Number(item.value)\n      }));\n    });\n    const initChart = () => {\n      if (!chartEl.value || normalizedData.value.length === 0) return;\n      chartInstance = echarts.init(chartEl.value);\n      const option = {\n        title: {\n          text: props.title,\n          subtext: props.year ? `(${props.year})` : \"\",\n          left: \"center\",\n          top: 10,\n          textStyle: {\n            fontSize: 14\n          }\n        },\n        tooltip: {\n          trigger: \"item\",\n          formatter: params => {\n            const data = normalizedData.value[params.dataIndex];\n            return `\n        ${params.marker} ${params.name}<br/>\n        比例: ${params.percent}%<br/>\n        原始值: ${data.rawValue}%${data.year ? ` (${data.year})` : \"\"}\n        `;\n          }\n        },\n        legend: {\n          orient: \"vertical\",\n          right: 10,\n          top: \"center\"\n        },\n        series: [{\n          name: \"比例\",\n          type: \"pie\",\n          radius: [\"40%\", \"70%\"],\n          avoidLabelOverlap: true,\n          itemStyle: {\n            borderRadius: 5,\n            borderColor: \"#fff\",\n            borderWidth: 2\n          },\n          label: {\n            show: true,\n            formatter: params => {\n              return `${params.name}: ${params.percent}%`;\n            }\n          },\n          emphasis: {\n            label: {\n              show: true,\n              fontSize: \"18\",\n              fontWeight: \"bold\"\n            }\n          },\n          data: normalizedData.value.map((item, index) => ({\n            name: item.name,\n            value: item.value,\n            year: item.year,\n            itemStyle: {\n              color: [\"#5470c6\", \"#91cc75\", \"#fac858\", \"#ee6666\", \"#73c0de\", \"#3ba272\"][index % 6]\n            }\n          }))\n        }]\n      };\n\n      // 显示总和为100%的提示（可选）\n      if (props.showTotal) {\n        option.graphic = {\n          type: \"text\",\n          left: \"center\",\n          top: \"75%\",\n          style: {\n            text: \"总计: 100%\",\n            textAlign: \"center\",\n            fill: \"#999\",\n            fontSize: 12\n          }\n        };\n      }\n      chartInstance.setOption(option);\n    };\n    onMounted(() => {\n      console.log(\"data:\", props.data);\n      initChart();\n      window.addEventListener(\"resize\", () => chartInstance?.resize());\n    });\n    watch(() => [props.data, props.title], initChart, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartEl,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      normalizedData,\n      initChart,\n      ref,\n      onMounted,\n      watch,\n      computed,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","computed","echarts","props","__props","chartEl","chartInstance","normalizedData","sum","data","reduce","acc","cur","Math","abs","Number","value","map","item","rawValue","initChart","length","init","option","title","text","subtext","year","left","top","textStyle","fontSize","tooltip","trigger","formatter","params","dataIndex","marker","name","percent","legend","orient","right","series","type","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","label","show","emphasis","fontWeight","index","color","showTotal","graphic","style","textAlign","fill","setOption","console","log","window","addEventListener","resize","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/BarChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartEl\" class=\"correct-pie-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [],\r\n\t\t\tvalidator: data => {\r\n\t\t\t\t// 验证数据格式：[{name, value, year?}]\r\n\t\t\t\treturn data.every(item => item.name && !isNaN(item.value));\r\n\t\t\t}\r\n\t\t},\r\n\t\ttitle: String,\r\n\t\tyear: String,\r\n\t\tshowTotal: { type: Boolean, default: false }\r\n\t});\r\n\r\n\tconst chartEl = ref(null);\r\n\tlet chartInstance = null;\r\n\r\n\t// 计算标准化比例（确保总和为100%）\r\n\tconst normalizedData = computed(() => {\r\n\t\tconst sum = props.data.reduce(\r\n\t\t\t(acc, cur) => acc + Math.abs(Number(cur.value)),\r\n\t\t\t0\r\n\t\t);\r\n\t\treturn props.data.map(item => ({\r\n\t\t\t...item,\r\n\t\t\tvalue: sum > 0 ? (Number(item.value) / sum) * 100 : 0,\r\n\t\t\trawValue: Number(item.value)\r\n\t\t}));\r\n\t});\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartEl.value || normalizedData.value.length === 0) return;\r\n\r\n\t\tchartInstance = echarts.init(chartEl.value);\r\n\r\n\t\tconst option = {\r\n\t\t\ttitle: {\r\n\t\t\t\ttext: props.title,\r\n\t\t\t\tsubtext: props.year ? `(${props.year})` : \"\",\r\n\t\t\t\tleft: \"center\",\r\n\t\t\t\ttop: 10,\r\n\t\t\t\ttextStyle: {\r\n\t\t\t\t\tfontSize: 14\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: \"item\",\r\n\t\t\t\tformatter: params => {\r\n\t\t\t\t\tconst data = normalizedData.value[params.dataIndex];\r\n\t\t\t\t\treturn `\r\n        ${params.marker} ${params.name}<br/>\r\n        比例: ${params.percent}%<br/>\r\n        原始值: ${data.rawValue}%${data.year ? ` (${data.year})` : \"\"}\r\n        `;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t\torient: \"vertical\",\r\n\t\t\t\tright: 10,\r\n\t\t\t\ttop: \"center\"\r\n\t\t\t},\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"比例\",\r\n\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\tradius: [\"40%\", \"70%\"],\r\n\t\t\t\t\tavoidLabelOverlap: true,\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tborderRadius: 5,\r\n\t\t\t\t\t\tborderColor: \"#fff\",\r\n\t\t\t\t\t\tborderWidth: 2\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\tformatter: params => {\r\n\t\t\t\t\t\t\treturn `${params.name}: ${params.percent}%`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\tfontSize: \"18\",\r\n\t\t\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: normalizedData.value.map((item, index) => ({\r\n\t\t\t\t\t\tname: item.name,\r\n\t\t\t\t\t\tvalue: item.value,\r\n\t\t\t\t\t\tyear: item.year,\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\tcolor: [\r\n\t\t\t\t\t\t\t\t\"#5470c6\",\r\n\t\t\t\t\t\t\t\t\"#91cc75\",\r\n\t\t\t\t\t\t\t\t\"#fac858\",\r\n\t\t\t\t\t\t\t\t\"#ee6666\",\r\n\t\t\t\t\t\t\t\t\"#73c0de\",\r\n\t\t\t\t\t\t\t\t\"#3ba272\"\r\n\t\t\t\t\t\t\t][index % 6]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\r\n\t\t// 显示总和为100%的提示（可选）\r\n\t\tif (props.showTotal) {\r\n\t\t\toption.graphic = {\r\n\t\t\t\ttype: \"text\",\r\n\t\t\t\tleft: \"center\",\r\n\t\t\t\ttop: \"75%\",\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\ttext: \"总计: 100%\",\r\n\t\t\t\t\ttextAlign: \"center\",\r\n\t\t\t\t\tfill: \"#999\",\r\n\t\t\t\t\tfontSize: 12\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tchartInstance.setOption(option);\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tconsole.log(\"data:\", props.data);\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", () => chartInstance?.resize());\r\n\t});\r\n\r\n\twatch(() => [props.data, props.title], initChart, { deep: true });\r\n</script>\r\n\r\n<style scoped>\r\n\t.correct-pie-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 400px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}