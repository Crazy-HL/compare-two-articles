{"ast":null,"code":"// mouse-selection.js\n\nconst MouseSelection = {\n  install(app) {\n    // 防抖函数\n    function debounce(fn) {\n      let time = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;\n      let timeout = null;\n      return function () {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => {\n          fn.apply(this, arguments);\n        }, time);\n      };\n    }\n\n    // 获取选择的内容\n    const getSelectContent = () => {\n      const selection = window.getSelection();\n      if (selection) {\n        if (selection.isCollapsed) {\n          return selection.toString().trim().length ? {\n            type: 'text',\n            content: selection.toString().trim()\n          } : null;\n        }\n        const range = selection.getRangeAt(0);\n        const rangeClone = range.cloneContents();\n        if (rangeClone.childElementCount > 0) {\n          const container = document.createElement('div');\n          container.appendChild(rangeClone);\n          if (!selection.toString().trim().length) {\n            const hasSpNode = getSpNode(container);\n            return hasSpNode ? {\n              type: 'html',\n              content: container.innerHTML\n            } : null;\n          }\n          return {\n            type: 'html',\n            content: container.innerHTML\n          };\n        } else {\n          return selection.toString().trim().length ? {\n            type: 'text',\n            content: selection.toString().trim()\n          } : null;\n        }\n      } else {\n        return null;\n      }\n    };\n\n    // 判断是否包含特殊元素\n    const getSpNode = parent => {\n      const nodeNameList = ['iframe', 'svg', 'img', 'audio', 'video'];\n      const inpList = ['input', 'textarea', 'select'];\n      return Array.from(parent.children).some(node => {\n        if (nodeNameList.includes(node.nodeName.toLowerCase())) return true;\n        if (inpList.includes(node.nodeName.toLowerCase()) && node.value.trim().length) return true;\n        if (node.children) {\n          return getSpNode(node);\n        }\n        return false;\n      });\n    };\n\n    // 获取选择的内容并触发回调\n    const selectionChangeFun = debounce(callback => {\n      const selectContent = getSelectContent();\n      if (selectContent) {\n        callback(selectContent);\n      } else {\n        callback(null);\n      }\n    });\n\n    // 插件安装时，初始化事件监听\n    app.config.globalProperties.$mouseSelection = {\n      start() {\n        let selectionchangeMouseTrack = false;\n\n        // 鼠标按下事件\n        document.addEventListener('mousedown', () => {\n          selectionchangeMouseTrack = true;\n        });\n\n        // 鼠标抬起事件\n        document.addEventListener('mouseup', debounce(() => {\n          selectionChangeFun(selectContent => {\n            if (selectContent) {\n              console.log('选中的内容:', selectContent);\n            } else {\n              console.log('没有选择内容');\n            }\n          });\n        }, 100));\n\n        // 选择区域发生变化时\n        document.addEventListener('selectionchange', debounce(() => {\n          if (selectionchangeMouseTrack) return;\n          selectionChangeFun(selectContent => {\n            if (selectContent) {\n              console.log('选中的内容:', selectContent);\n            } else {\n              console.log('没有选择内容');\n            }\n          });\n        }));\n\n        // 双击事件\n        document.addEventListener('dblclick', () => {\n          selectionChangeFun(selectContent => {\n            if (selectContent) {\n              console.log('选中的内容:', selectContent);\n            } else {\n              console.log('没有选择内容');\n            }\n          });\n        });\n\n        // 右键事件\n        document.addEventListener('contextmenu', debounce(() => {\n          selectionChangeFun(selectContent => {\n            if (selectContent) {\n              console.log('选中的内容:', selectContent);\n            } else {\n              console.log('没有选择内容');\n            }\n          });\n        }));\n      }\n    };\n  }\n};\nexport default MouseSelection;","map":{"version":3,"names":["MouseSelection","install","app","debounce","fn","time","arguments","length","undefined","timeout","clearTimeout","setTimeout","apply","getSelectContent","selection","window","getSelection","isCollapsed","toString","trim","type","content","range","getRangeAt","rangeClone","cloneContents","childElementCount","container","document","createElement","appendChild","hasSpNode","getSpNode","innerHTML","parent","nodeNameList","inpList","Array","from","children","some","node","includes","nodeName","toLowerCase","value","selectionChangeFun","callback","selectContent","config","globalProperties","$mouseSelection","start","selectionchangeMouseTrack","addEventListener","console","log"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/textSelectionTool.js"],"sourcesContent":["// mouse-selection.js\r\n\r\nconst MouseSelection = {\r\n    install(app) {\r\n      // 防抖函数\r\n      function debounce(fn, time = 500) {\r\n        let timeout = null;\r\n        return function () {\r\n          clearTimeout(timeout);\r\n          timeout = setTimeout(() => {\r\n            fn.apply(this, arguments);\r\n          }, time);\r\n        };\r\n      }\r\n  \r\n      // 获取选择的内容\r\n      const getSelectContent = () => {\r\n        const selection = window.getSelection();\r\n        if (selection) {\r\n          if (selection.isCollapsed) {\r\n            return selection.toString().trim().length ? {\r\n              type: 'text',\r\n              content: selection.toString().trim()\r\n            } : null;\r\n          }\r\n  \r\n          const range = selection.getRangeAt(0);\r\n          const rangeClone = range.cloneContents();\r\n          if (rangeClone.childElementCount > 0) {\r\n            const container = document.createElement('div');\r\n            container.appendChild(rangeClone);\r\n            if (!selection.toString().trim().length) {\r\n              const hasSpNode = getSpNode(container);\r\n              return hasSpNode ? {\r\n                type: 'html',\r\n                content: container.innerHTML\r\n              } : null;\r\n            }\r\n            return {\r\n              type: 'html',\r\n              content: container.innerHTML\r\n            };\r\n          } else {\r\n            return selection.toString().trim().length ? {\r\n              type: 'text',\r\n              content: selection.toString().trim()\r\n            } : null;\r\n          }\r\n        } else {\r\n          return null;\r\n        }\r\n      };\r\n  \r\n      // 判断是否包含特殊元素\r\n      const getSpNode = (parent) => {\r\n        const nodeNameList = ['iframe', 'svg', 'img', 'audio', 'video'];\r\n        const inpList = ['input', 'textarea', 'select'];\r\n        return Array.from(parent.children).some((node) => {\r\n          if (nodeNameList.includes(node.nodeName.toLowerCase())) return true;\r\n          if (inpList.includes(node.nodeName.toLowerCase()) && node.value.trim().length) return true;\r\n          if (node.children) {\r\n            return getSpNode(node);\r\n          }\r\n          return false;\r\n        });\r\n      };\r\n  \r\n      // 获取选择的内容并触发回调\r\n      const selectionChangeFun = debounce((callback) => {\r\n        const selectContent = getSelectContent();\r\n        if (selectContent) {\r\n          callback(selectContent);\r\n        } else {\r\n          callback(null);\r\n        }\r\n      });\r\n  \r\n      // 插件安装时，初始化事件监听\r\n      app.config.globalProperties.$mouseSelection = {\r\n        start() {\r\n          let selectionchangeMouseTrack = false;\r\n  \r\n          // 鼠标按下事件\r\n          document.addEventListener('mousedown', () => {\r\n            selectionchangeMouseTrack = true;\r\n          });\r\n  \r\n          // 鼠标抬起事件\r\n          document.addEventListener('mouseup', debounce(() => {\r\n            selectionChangeFun((selectContent) => {\r\n              if (selectContent) {\r\n                console.log('选中的内容:', selectContent);\r\n              } else {\r\n                console.log('没有选择内容');\r\n              }\r\n            });\r\n          }, 100));\r\n  \r\n          // 选择区域发生变化时\r\n          document.addEventListener('selectionchange', debounce(() => {\r\n            if (selectionchangeMouseTrack) return;\r\n            selectionChangeFun((selectContent) => {\r\n              if (selectContent) {\r\n                console.log('选中的内容:', selectContent);\r\n              } else {\r\n                console.log('没有选择内容');\r\n              }\r\n            });\r\n          }));\r\n  \r\n          // 双击事件\r\n          document.addEventListener('dblclick', () => {\r\n            selectionChangeFun((selectContent) => {\r\n              if (selectContent) {\r\n                console.log('选中的内容:', selectContent);\r\n              } else {\r\n                console.log('没有选择内容');\r\n              }\r\n            });\r\n          });\r\n  \r\n          // 右键事件\r\n          document.addEventListener('contextmenu', debounce(() => {\r\n            selectionChangeFun((selectContent) => {\r\n              if (selectContent) {\r\n                console.log('选中的内容:', selectContent);\r\n              } else {\r\n                console.log('没有选择内容');\r\n              }\r\n            });\r\n          }));\r\n        }\r\n      };\r\n    }\r\n  };\r\n  \r\n  export default MouseSelection;\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}