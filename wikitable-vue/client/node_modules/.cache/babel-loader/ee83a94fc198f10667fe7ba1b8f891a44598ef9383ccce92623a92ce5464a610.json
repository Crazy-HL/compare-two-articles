{"ast":null,"code":"import { computed, ref, onMounted, watch, nextTick } from \"vue\";\nimport * as d3 from \"d3\";\nexport default {\n  props: {\n    field: {\n      type: [Object, Array, String, Number],\n      default: null\n    },\n    type: {\n      type: String,\n      default: \"\"\n    },\n    visualization: {\n      type: String,\n      default: \"\"\n    },\n    fieldKey: {\n      type: String,\n      default: \"\"\n    },\n    range: {\n      type: Object,\n      default: () => ({\n        min: 0,\n        max: 1\n      })\n    }\n  },\n  emits: [\"chartClick\"],\n  setup(props, _ref) {\n    let {\n      emit\n    } = _ref;\n    const hoveredIndex = ref(null);\n    const activeIndex = ref(null);\n    const isTextHovered = ref(false);\n    const pieContainer = ref(null);\n    const barContainer = ref(null);\n    const lineContainer = ref(null);\n    const colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\n    const remainderColor = \"#f0f0f0\";\n\n    // 确保数据格式统一\n    const normalizedData = computed(() => {\n      if (!props.field) return [];\n      if (Array.isArray(props.field)) {\n        return props.field.map(item => ({\n          raw: item.raw || item.value || item,\n          value: item.value\n        }));\n      }\n      if (typeof props.field === \"object\") {\n        return [{\n          raw: props.field.raw || props.field.value || props.field,\n          value: props.field.value\n        }];\n      }\n      return [{\n        raw: props.field,\n        value: props.field\n      }];\n    });\n    onMounted(() => {\n      watch(() => [props.field, props.visualization, props.range], () => {\n        nextTick(() => {\n          if (props.visualization === \"pie-chart\" && hasData.value && isValidPieData.value) {\n            renderPieChart();\n          } else if (props.visualization === \"bar-chart\" && hasData.value) {\n            renderBarChart();\n          } else if (props.visualization === \"line-chart\" && hasData.value) {\n            renderLineChart();\n          }\n        });\n      }, {\n        immediate: true,\n        deep: true\n      });\n    });\n    const renderBarChart = () => {\n      if (!barContainer.value) return;\n      d3.select(barContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(barContainer.value);\n      const width = barContainer.value.clientWidth;\n      const height = barContainer.value.clientHeight;\n      const margin = {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 10\n      };\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${width} ${height}`);\n\n      // 使用统一范围\n      const y = d3.scaleLinear().domain([props.range.min, props.range.max]).nice().range([height - margin.bottom, margin.top]);\n      const x = d3.scaleBand().domain(d3.range(normalizedData.value.length)).range([margin.left, width - margin.right]).padding(0.2);\n      svg.selectAll(\".bar\").data(normalizedData.value).enter().append(\"rect\").attr(\"class\", \"bar\").attr(\"x\", (d, i) => x(i)).attr(\"y\", d => y(d.value)).attr(\"width\", x.bandwidth()).attr(\"height\", d => y(0) - y(d.value)).attr(\"fill\", (d, i) => colors[i % colors.length]).style(\"opacity\", 0.8).on(\"mouseover\", function (event, d) {\n        hoveredIndex.value = d.index;\n        d3.select(this).transition().duration(200).style(\"opacity\", 1).attr(\"y\", d => y(d.value) - 5).attr(\"height\", d => y(0) - y(d.value) + 5);\n        tooltip.style(\"visibility\", \"visible\").html(`${formatTooltip(d.raw, props.fieldKey)}`);\n      }).on(\"mouseout\", function () {\n        hoveredIndex.value = null;\n        d3.select(this).transition().duration(200).style(\"opacity\", 0.8).attr(\"y\", d => y(d.value)).attr(\"height\", d => y(0) - y(d.value));\n        tooltip.style(\"visibility\", \"hidden\");\n      }).on(\"click\", function (event, d) {\n        activeIndex.value = d.index;\n        emit(\"chartClick\", {\n          type: \"bar\",\n          index: d.index,\n          data: d,\n          value: d.value\n        });\n      });\n      const tooltip = container.append(\"div\").attr(\"class\", \"d3-tooltip\").style(\"position\", \"absolute\").style(\"visibility\", \"hidden\").style(\"background\", \"rgba(0,0,0,0.8)\").style(\"color\", \"white\").style(\"padding\", \"6px 12px\").style(\"border-radius\", \"4px\").style(\"font-size\", \"12px\");\n    };\n\n    // 专用tooltip格式化函数\n    const formatTooltip = (value, fieldKey) => {\n      if (value === undefined || value === null) return \"-\";\n\n      // 特殊字段处理\n      if (fieldKey === \"GDP\") {\n        const num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\n        return isNaN(num) ? value : `${(num / 1000000000000).toFixed(2)}T`;\n      } else if (fieldKey === \"Population\") {\n        const num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\n        return isNaN(num) ? value : `${(num / 100000000).toFixed(2)}亿`;\n      } else if (props.type === \"percentage\") {\n        const num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\n        return isNaN(num) ? value : `${num.toFixed(1)}%`;\n      }\n      return value;\n    };\n\n    // 其他渲染函数保持不变...\n    const renderPieChart = () => {\n      // 原有实现保持不变\n    };\n    const renderLineChart = () => {\n      // 原有实现保持不变\n    };\n\n    // 其他方法保持不变...\n    const handleTextHover = () => {\n      isTextHovered.value = true;\n    };\n    const resetHover = () => {\n      hoveredIndex.value = null;\n      isTextHovered.value = false;\n    };\n    const handleTextClick = () => {\n      emit(\"chartClick\", {\n        type: \"text\",\n        data: props.field,\n        value: props.field\n      });\n    };\n    const formatSimpleText = value => {\n      if (!value) return \"-\";\n      if (Array.isArray(value)) {\n        const items = value.map(item => item.raw || item.value || item);\n        return items.length > 2 ? items.slice(0, 2).join(\"; \") + \"...\" : items.join(\"; \");\n      }\n      if (typeof value === \"object\") {\n        return value.raw || value.value || \"-\";\n      }\n      return value.toString().length > 50 ? value.toString().substring(0, 50) + \"...\" : value.toString();\n    };\n    const isYearEntry = value => {\n      if (typeof value !== \"string\") return false;\n      const trimmedValue = value.trim();\n      return /^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) || /^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) || /^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) || /^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue);\n    };\n    const hasData = computed(() => {\n      if (!props.field) return false;\n      if (Array.isArray(props.field)) return props.field.length > 0;\n      if (typeof props.field === \"object\") return Object.keys(props.field).length > 0;\n      return String(props.field).trim().length > 0;\n    });\n    const pieData = computed(() => {\n      // 原有实现保持不变\n    });\n    const isValidPieData = computed(() => {\n      // 原有实现保持不变\n    });\n    return {\n      hoveredIndex,\n      activeIndex,\n      isTextHovered,\n      pieContainer,\n      barContainer,\n      lineContainer,\n      handleTextHover,\n      resetHover,\n      handleTextClick,\n      formatSimpleText,\n      hasData,\n      isValidPieData,\n      pieData,\n      formatTooltip\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","onMounted","watch","nextTick","d3","props","field","type","Object","Array","String","Number","default","visualization","fieldKey","range","min","max","emits","setup","_ref","emit","hoveredIndex","activeIndex","isTextHovered","pieContainer","barContainer","lineContainer","colors","remainderColor","normalizedData","isArray","map","item","raw","value","hasData","isValidPieData","renderPieChart","renderBarChart","renderLineChart","immediate","deep","select","selectAll","remove","container","width","clientWidth","height","clientHeight","margin","top","right","bottom","left","svg","append","attr","y","scaleLinear","domain","nice","x","scaleBand","length","padding","data","enter","d","i","bandwidth","style","on","event","index","transition","duration","tooltip","html","formatTooltip","undefined","num","parseFloat","toString","replace","isNaN","toFixed","handleTextHover","resetHover","handleTextClick","formatSimpleText","items","slice","join","substring","isYearEntry","trimmedValue","trim","test","keys","pieData"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\SimpleChart.vue"],"sourcesContent":["<template>\r\n\t<div class=\"simple-chart\">\r\n\t\t<template v-if=\"visualization === 'text-only'\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(field) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\r\n\t\t<template v-else-if=\"visualization === 'pie-chart'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"hasData && isValidPieData\"\r\n\t\t\t\tclass=\"d3-chart-container\"\r\n\t\t\t\tref=\"pieContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<template v-else-if=\"visualization === 'bar-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"barContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<template v-else-if=\"visualization === 'line-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"lineContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<template v-else>\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(field) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport { computed, ref, onMounted, watch, nextTick } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tfield: {\r\n\t\t\t\ttype: [Object, Array, String, Number],\r\n\t\t\t\tdefault: null\r\n\t\t\t},\r\n\t\t\ttype: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tvisualization: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tfieldKey: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\trange: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({ min: 0, max: 1 })\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\temits: [\"chartClick\"],\r\n\r\n\t\tsetup(props, { emit }) {\r\n\t\t\tconst hoveredIndex = ref(null);\r\n\t\t\tconst activeIndex = ref(null);\r\n\t\t\tconst isTextHovered = ref(false);\r\n\r\n\t\t\tconst pieContainer = ref(null);\r\n\t\t\tconst barContainer = ref(null);\r\n\t\t\tconst lineContainer = ref(null);\r\n\r\n\t\t\tconst colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\r\n\t\t\tconst remainderColor = \"#f0f0f0\";\r\n\r\n\t\t\t// 确保数据格式统一\r\n\t\t\tconst normalizedData = computed(() => {\r\n\t\t\t\tif (!props.field) return [];\r\n\r\n\t\t\t\tif (Array.isArray(props.field)) {\r\n\t\t\t\t\treturn props.field.map(item => ({\r\n\t\t\t\t\t\traw: item.raw || item.value || item,\r\n\t\t\t\t\t\tvalue: item.value\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof props.field === \"object\") {\r\n\t\t\t\t\treturn [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\traw: props.field.raw || props.field.value || props.field,\r\n\t\t\t\t\t\t\tvalue: props.field.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\traw: props.field,\r\n\t\t\t\t\t\tvalue: props.field\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\t\t\t});\r\n\r\n\t\t\tonMounted(() => {\r\n\t\t\t\twatch(\r\n\t\t\t\t\t() => [props.field, props.visualization, props.range],\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"pie-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value &&\r\n\t\t\t\t\t\t\t\tisValidPieData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderPieChart();\r\n\t\t\t\t\t\t\t} else if (props.visualization === \"bar-chart\" && hasData.value) {\r\n\t\t\t\t\t\t\t\trenderBarChart();\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"line-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderLineChart();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ immediate: true, deep: true }\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tconst renderBarChart = () => {\r\n\t\t\t\tif (!barContainer.value) return;\r\n\r\n\t\t\t\td3.select(barContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(barContainer.value);\r\n\t\t\t\tconst width = barContainer.value.clientWidth;\r\n\t\t\t\tconst height = barContainer.value.clientHeight;\r\n\t\t\t\tconst margin = { top: 10, right: 10, bottom: 10, left: 10 };\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`);\r\n\r\n\t\t\t\t// 使用统一范围\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([props.range.min, props.range.max])\r\n\t\t\t\t\t.nice()\r\n\t\t\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t\t\tconst x = d3\r\n\t\t\t\t\t.scaleBand()\r\n\t\t\t\t\t.domain(d3.range(normalizedData.value.length))\r\n\t\t\t\t\t.range([margin.left, width - margin.right])\r\n\t\t\t\t\t.padding(0.2);\r\n\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".bar\")\r\n\t\t\t\t\t.data(normalizedData.value)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"bar\")\r\n\t\t\t\t\t.attr(\"x\", (d, i) => x(i))\r\n\t\t\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t\t\t.attr(\"height\", d => y(0) - y(d.value))\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => colors[i % colors.length])\r\n\t\t\t\t\t.style(\"opacity\", 0.8)\r\n\t\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\t\thoveredIndex.value = d.index;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(200)\r\n\t\t\t\t\t\t\t.style(\"opacity\", 1)\r\n\t\t\t\t\t\t\t.attr(\"y\", d => y(d.value) - 5)\r\n\t\t\t\t\t\t\t.attr(\"height\", d => y(0) - y(d.value) + 5);\r\n\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.style(\"visibility\", \"visible\")\r\n\t\t\t\t\t\t\t.html(`${formatTooltip(d.raw, props.fieldKey)}`);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function () {\r\n\t\t\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(200)\r\n\t\t\t\t\t\t\t.style(\"opacity\", 0.8)\r\n\t\t\t\t\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t\t\t\t\t.attr(\"height\", d => y(0) - y(d.value));\r\n\r\n\t\t\t\t\t\ttooltip.style(\"visibility\", \"hidden\");\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"click\", function (event, d) {\r\n\t\t\t\t\t\tactiveIndex.value = d.index;\r\n\t\t\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\t\t\ttype: \"bar\",\r\n\t\t\t\t\t\t\tindex: d.index,\r\n\t\t\t\t\t\t\tdata: d,\r\n\t\t\t\t\t\t\tvalue: d.value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tconst tooltip = container\r\n\t\t\t\t\t.append(\"div\")\r\n\t\t\t\t\t.attr(\"class\", \"d3-tooltip\")\r\n\t\t\t\t\t.style(\"position\", \"absolute\")\r\n\t\t\t\t\t.style(\"visibility\", \"hidden\")\r\n\t\t\t\t\t.style(\"background\", \"rgba(0,0,0,0.8)\")\r\n\t\t\t\t\t.style(\"color\", \"white\")\r\n\t\t\t\t\t.style(\"padding\", \"6px 12px\")\r\n\t\t\t\t\t.style(\"border-radius\", \"4px\")\r\n\t\t\t\t\t.style(\"font-size\", \"12px\");\r\n\t\t\t};\r\n\r\n\t\t\t// 专用tooltip格式化函数\r\n\t\t\tconst formatTooltip = (value, fieldKey) => {\r\n\t\t\t\tif (value === undefined || value === null) return \"-\";\r\n\r\n\t\t\t\t// 特殊字段处理\r\n\t\t\t\tif (fieldKey === \"GDP\") {\r\n\t\t\t\t\tconst num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\r\n\t\t\t\t\treturn isNaN(num) ? value : `${(num / 1000000000000).toFixed(2)}T`;\r\n\t\t\t\t} else if (fieldKey === \"Population\") {\r\n\t\t\t\t\tconst num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\r\n\t\t\t\t\treturn isNaN(num) ? value : `${(num / 100000000).toFixed(2)}亿`;\r\n\t\t\t\t} else if (props.type === \"percentage\") {\r\n\t\t\t\t\tconst num = parseFloat(value.toString().replace(/[^0-9.-]/g, \"\"));\r\n\t\t\t\t\treturn isNaN(num) ? value : `${num.toFixed(1)}%`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t};\r\n\r\n\t\t\t// 其他渲染函数保持不变...\r\n\t\t\tconst renderPieChart = () => {\r\n\t\t\t\t// 原有实现保持不变\r\n\t\t\t};\r\n\r\n\t\t\tconst renderLineChart = () => {\r\n\t\t\t\t// 原有实现保持不变\r\n\t\t\t};\r\n\r\n\t\t\t// 其他方法保持不变...\r\n\t\t\tconst handleTextHover = () => {\r\n\t\t\t\tisTextHovered.value = true;\r\n\t\t\t};\r\n\r\n\t\t\tconst resetHover = () => {\r\n\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\tisTextHovered.value = false;\r\n\t\t\t};\r\n\r\n\t\t\tconst handleTextClick = () => {\r\n\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tdata: props.field,\r\n\t\t\t\t\tvalue: props.field\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tconst formatSimpleText = value => {\r\n\t\t\t\tif (!value) return \"-\";\r\n\t\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\t\tconst items = value.map(item => item.raw || item.value || item);\r\n\t\t\t\t\treturn items.length > 2\r\n\t\t\t\t\t\t? items.slice(0, 2).join(\"; \") + \"...\"\r\n\t\t\t\t\t\t: items.join(\"; \");\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof value === \"object\") {\r\n\t\t\t\t\treturn value.raw || value.value || \"-\";\r\n\t\t\t\t}\r\n\t\t\t\treturn value.toString().length > 50\r\n\t\t\t\t\t? value.toString().substring(0, 50) + \"...\"\r\n\t\t\t\t\t: value.toString();\r\n\t\t\t};\r\n\r\n\t\t\tconst isYearEntry = value => {\r\n\t\t\t\tif (typeof value !== \"string\") return false;\r\n\t\t\t\tconst trimmedValue = value.trim();\r\n\t\t\t\treturn (\r\n\t\t\t\t\t/^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) ||\r\n\t\t\t\t\t/^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue)\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\tconst hasData = computed(() => {\r\n\t\t\t\tif (!props.field) return false;\r\n\t\t\t\tif (Array.isArray(props.field)) return props.field.length > 0;\r\n\t\t\t\tif (typeof props.field === \"object\")\r\n\t\t\t\t\treturn Object.keys(props.field).length > 0;\r\n\t\t\t\treturn String(props.field).trim().length > 0;\r\n\t\t\t});\r\n\r\n\t\t\tconst pieData = computed(() => {\r\n\t\t\t\t// 原有实现保持不变\r\n\t\t\t});\r\n\r\n\t\t\tconst isValidPieData = computed(() => {\r\n\t\t\t\t// 原有实现保持不变\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\thoveredIndex,\r\n\t\t\t\tactiveIndex,\r\n\t\t\t\tisTextHovered,\r\n\t\t\t\tpieContainer,\r\n\t\t\t\tbarContainer,\r\n\t\t\t\tlineContainer,\r\n\t\t\t\thandleTextHover,\r\n\t\t\t\tresetHover,\r\n\t\t\t\thandleTextClick,\r\n\t\t\t\tformatSimpleText,\r\n\t\t\t\thasData,\r\n\t\t\t\tisValidPieData,\r\n\t\t\t\tpieData,\r\n\t\t\t\tformatTooltip\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.simple-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t\tfont-family: Arial, sans-serif;\r\n\t}\r\n\r\n\t.simple-text {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 14px;\r\n\t\tword-break: break-word;\r\n\t\tpadding: 8px;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.2s ease;\r\n\t\tborder-radius: 4px;\r\n\t\tbackground-color: #f8f9fa;\r\n\t\tmax-width: 100%;\r\n\t}\r\n\r\n\t.simple-text:hover {\r\n\t\tbackground-color: #e9ecef;\r\n\t\ttransform: translateY(-2px);\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.text-tooltip {\r\n\t\tposition: absolute;\r\n\t\ttop: -25px;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\tbackground-color: rgba(0, 0, 0, 0.8);\r\n\t\tcolor: white;\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-size: 12px;\r\n\t\tpointer-events: none;\r\n\t\twhite-space: nowrap;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t.d3-chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 80px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.d3-tooltip {\r\n\t\tz-index: 10;\r\n\t\twhite-space: nowrap;\r\n\t\tpointer-events: none;\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\r\n\t}\r\n\r\n\t.no-data {\r\n\t\tcolor: #999;\r\n\t\tfont-style: italic;\r\n\t\tpadding: 10px;\r\n\t}\r\n\r\n\t@media (max-width: 768px) {\r\n\t\t.simple-text {\r\n\t\t\tfont-size: 12px;\r\n\t\t}\r\n\r\n\t\t.d3-chart-container {\r\n\t\t\tmin-height: 60px;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}