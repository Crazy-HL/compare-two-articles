{"ast":null,"code":"import { ref, onMounted, onUnmounted } from \"vue\";\nimport TextPopup from \"./TextPopup.vue\";\nimport VisualizationView from \"./VisualizationView.vue\";\nimport LoadingSpinner from \"./LoadingSpinner.vue\";\nimport ErrorMessage from \"./ErrorMessage.vue\";\nexport default {\n  __name: 'WikipediaContent2',\n  props: {\n    pageTitle: String,\n    divId: String,\n    selectContentClass: String\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const pageHtml = ref(\"\");\n    const loading = ref(true);\n    const error = ref(\"\");\n    const selectedText = ref(\"\");\n    const showPopup = ref(false);\n    const divRef = ref(null);\n    const currentView = ref(\"text\");\n\n    // 获取 Wikipedia 内容\n    const fetchWikipediaContent = async () => {\n      try {\n        const apiUrl = `https://en.wikipedia.org/api/rest_v1/page/html/${encodeURIComponent(props.pageTitle)}`;\n        const response = await fetch(apiUrl);\n        if (!response.ok) throw new Error(\"Failed to fetch data\");\n        pageHtml.value = await response.text();\n      } catch (err) {\n        error.value = \"Error fetching Wikipedia content: \" + err.message;\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 处理选中文字\n    const handleSelection = () => {\n      const selection = window.getSelection().toString().trim();\n      if (selection) {\n        selectedText.value = selection;\n        showPopup.value = true;\n      }\n    };\n\n    // 关闭弹出框\n    const closePopup = () => {\n      showPopup.value = false;\n      selectedText.value = \"\";\n    };\n\n    // 切换视图\n    const switchView = view => {\n      currentView.value = view;\n    };\n    onMounted(() => {\n      fetchWikipediaContent();\n      divRef.value?.addEventListener(\"mouseup\", handleSelection);\n    });\n    onUnmounted(() => {\n      divRef.value?.removeEventListener(\"mouseup\", handleSelection);\n    });\n    const __returned__ = {\n      props,\n      pageHtml,\n      loading,\n      error,\n      selectedText,\n      showPopup,\n      divRef,\n      currentView,\n      fetchWikipediaContent,\n      handleSelection,\n      closePopup,\n      switchView,\n      ref,\n      onMounted,\n      onUnmounted,\n      TextPopup,\n      VisualizationView,\n      LoadingSpinner,\n      ErrorMessage\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","TextPopup","VisualizationView","LoadingSpinner","ErrorMessage","props","__props","pageHtml","loading","error","selectedText","showPopup","divRef","currentView","fetchWikipediaContent","apiUrl","encodeURIComponent","pageTitle","response","fetch","ok","Error","value","text","err","message","handleSelection","selection","window","getSelection","toString","trim","closePopup","switchView","view","addEventListener","removeEventListener"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/WikipediaContent2.vue"],"sourcesContent":["<template>\r\n\t<div :class=\"['div0', selectContentClass]\" :id=\"divId\" ref=\"divRef\">\r\n\t\t<h1>{{ pageTitle }}</h1>\r\n\r\n\t\t<!-- 加载动画 -->\r\n\t\t<LoadingSpinner v-if=\"loading\" />\r\n\r\n\t\t<!-- 错误信息 -->\r\n\t\t<ErrorMessage\r\n\t\t\tv-else-if=\"error\"\r\n\t\t\t:message=\"error\"\r\n\t\t\t@retry=\"fetchWikipediaContent\" />\r\n\r\n\t\t<!-- 文章内容 -->\r\n\t\t<div\r\n\t\t\tv-else\r\n\t\t\tclass=\"showHtml wikipedia-content\"\r\n\t\t\tv-html=\"pageHtml\"\r\n\t\t\t@mouseup=\"handleSelection\"></div>\r\n\r\n\t\t<!-- 选中内容弹窗 -->\r\n\t\t<TextPopup\r\n\t\t\tv-if=\"showPopup\"\r\n\t\t\t:content=\"selectedText\"\r\n\t\t\t:divId=\"divId\"\r\n\t\t\t@close=\"closePopup\"\r\n\t\t\t@switch-view=\"switchView\" />\r\n\r\n\t\t<!-- 可视化展示 -->\r\n\t\t<VisualizationView\r\n\t\t\tv-if=\"currentView === 'visual'\"\r\n\t\t\t:text=\"selectedText\"\r\n\t\t\t:divId=\"divId\" />\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted } from \"vue\";\r\n\timport TextPopup from \"./TextPopup.vue\";\r\n\timport VisualizationView from \"./VisualizationView.vue\";\r\n\timport LoadingSpinner from \"./LoadingSpinner.vue\";\r\n\timport ErrorMessage from \"./ErrorMessage.vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tpageTitle: String,\r\n\t\tdivId: String,\r\n\t\tselectContentClass: String\r\n\t});\r\n\r\n\tconst pageHtml = ref(\"\");\r\n\tconst loading = ref(true);\r\n\tconst error = ref(\"\");\r\n\tconst selectedText = ref(\"\");\r\n\tconst showPopup = ref(false);\r\n\tconst divRef = ref(null);\r\n\tconst currentView = ref(\"text\");\r\n\r\n\t// 获取 Wikipedia 内容\r\n\tconst fetchWikipediaContent = async () => {\r\n\t\ttry {\r\n\t\t\tconst apiUrl = `https://en.wikipedia.org/api/rest_v1/page/html/${encodeURIComponent(\r\n\t\t\t\tprops.pageTitle\r\n\t\t\t)}`;\r\n\t\t\tconst response = await fetch(apiUrl);\r\n\t\t\tif (!response.ok) throw new Error(\"Failed to fetch data\");\r\n\t\t\tpageHtml.value = await response.text();\r\n\t\t} catch (err) {\r\n\t\t\terror.value = \"Error fetching Wikipedia content: \" + err.message;\r\n\t\t} finally {\r\n\t\t\tloading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\t// 处理选中文字\r\n\tconst handleSelection = () => {\r\n\t\tconst selection = window.getSelection().toString().trim();\r\n\t\tif (selection) {\r\n\t\t\tselectedText.value = selection;\r\n\t\t\tshowPopup.value = true;\r\n\t\t}\r\n\t};\r\n\r\n\t// 关闭弹出框\r\n\tconst closePopup = () => {\r\n\t\tshowPopup.value = false;\r\n\t\tselectedText.value = \"\";\r\n\t};\r\n\r\n\t// 切换视图\r\n\tconst switchView = view => {\r\n\t\tcurrentView.value = view;\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tfetchWikipediaContent();\r\n\t\tdivRef.value?.addEventListener(\"mouseup\", handleSelection);\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tdivRef.value?.removeEventListener(\"mouseup\", handleSelection);\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.div0 {\r\n\t\tpadding: 20px;\r\n\t\tbackground-color: #f9f9f9;\r\n\t\tborder-radius: 5px;\r\n\t\tmargin: 10px;\r\n\t}\r\n\t.wikipedia-content {\r\n\t\tborder: 1px solid #ddd;\r\n\t\tpadding: 15px;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 5px;\r\n\t}\r\n</style>\r\n"],"mappings":"AAqCC,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAK;AACjD,OAAOC,SAAS,MAAM,iBAAiB;AACvC,OAAOC,iBAAiB,MAAM,yBAAyB;AACvD,OAAOC,cAAc,MAAM,sBAAsB;AACjD,OAAOC,YAAY,MAAM,oBAAoB;;;;;;;;;;;;;IAE7C,MAAMC,KAAK,GAAGC,OAIZ;IAEF,MAAMC,QAAQ,GAAGT,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMU,OAAO,GAAGV,GAAG,CAAC,IAAI,CAAC;IACzB,MAAMW,KAAK,GAAGX,GAAG,CAAC,EAAE,CAAC;IACrB,MAAMY,YAAY,GAAGZ,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMa,SAAS,GAAGb,GAAG,CAAC,KAAK,CAAC;IAC5B,MAAMc,MAAM,GAAGd,GAAG,CAAC,IAAI,CAAC;IACxB,MAAMe,WAAW,GAAGf,GAAG,CAAC,MAAM,CAAC;;IAE/B;IACA,MAAMgB,qBAAqB,GAAG,MAAAA,CAAA,KAAY;MACzC,IAAI;QACH,MAAMC,MAAM,GAAG,kDAAkDC,kBAAkB,CAClFX,KAAK,CAACY,SACP,CAAC,EAAE;QACH,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACJ,MAAM,CAAC;QACpC,IAAI,CAACG,QAAQ,CAACE,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,sBAAsB,CAAC;QACzDd,QAAQ,CAACe,KAAK,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;MACvC,CAAC,CAAC,OAAOC,GAAG,EAAE;QACbf,KAAK,CAACa,KAAK,GAAG,oCAAoC,GAAGE,GAAG,CAACC,OAAO;MACjE,CAAC,SAAS;QACTjB,OAAO,CAACc,KAAK,GAAG,KAAK;MACtB;IACD,CAAC;;IAED;IACA,MAAMI,eAAe,GAAGA,CAAA,KAAM;MAC7B,MAAMC,SAAS,GAAGC,MAAM,CAACC,YAAY,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;MACzD,IAAIJ,SAAS,EAAE;QACdjB,YAAY,CAACY,KAAK,GAAGK,SAAS;QAC9BhB,SAAS,CAACW,KAAK,GAAG,IAAI;MACvB;IACD,CAAC;;IAED;IACA,MAAMU,UAAU,GAAGA,CAAA,KAAM;MACxBrB,SAAS,CAACW,KAAK,GAAG,KAAK;MACvBZ,YAAY,CAACY,KAAK,GAAG,EAAE;IACxB,CAAC;;IAED;IACA,MAAMW,UAAU,GAAGC,IAAI,IAAI;MAC1BrB,WAAW,CAACS,KAAK,GAAGY,IAAI;IACzB,CAAC;IAEDnC,SAAS,CAAC,MAAM;MACfe,qBAAqB,CAAC,CAAC;MACvBF,MAAM,CAACU,KAAK,EAAEa,gBAAgB,CAAC,SAAS,EAAET,eAAe,CAAC;IAC3D,CAAC,CAAC;IAEF1B,WAAW,CAAC,MAAM;MACjBY,MAAM,CAACU,KAAK,EAAEc,mBAAmB,CAAC,SAAS,EAAEV,eAAe,CAAC;IAC9D,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}