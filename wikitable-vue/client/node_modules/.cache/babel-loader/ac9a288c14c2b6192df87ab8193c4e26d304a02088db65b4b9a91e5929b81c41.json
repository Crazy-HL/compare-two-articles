{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\nimport bus from \"@/js/eventBus.js\";\nimport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\nimport CausalFlowChart from \"@/components/compoents_base/CausalFlowChart.vue\";\nimport { formatMarkdown } from \"@/js/markdown\";\nimport { safeApiCall } from \"@/js/api\";\n\n// 常量定义\n\nexport default {\n  __name: 'Div2',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const PRESERVED_FIELDS_BY_SECTION = {\n      Statistics: [\"Population\", \"GDP\", \"GDP rank\", \"GDP growth\", \"GDP per capita\", \"GDP per capita rank\", \"GDP by sector\", \"Inflation (CPI)\", \"Population below poverty line\", \"Gini coefficient\", \"Human Development Index\", \"Corruption Perceptions Index\", \"Labor force\", \"Labor force by occupation\", \"Unemployment\", \"Average gross salary\", \"Average net salary\", \"Main industries\"],\n      \"Public finances\": [\"Government debt\", \"Foreign reserves\", \"Budget balance\", \"Revenues\", \"Expenses\", \"Economic aid\", \"Credit rating\"]\n    };\n\n    // 响应式状态\n    const userQuestion = ref(\"\");\n    const chatHistory = ref([]);\n    const div1RawData = ref(null);\n    const div3RawData = ref(null);\n    const isLoading = ref(false);\n    const showSuggestedQuestion = ref(false);\n    const suggestedQuestion = ref(\"\");\n\n    // Infobox数据\n    const infoboxData = ref({\n      div1: null,\n      div3: null\n    });\n\n    // 对比状态\n    const comparisonState = ref({\n      leftData: null,\n      rightData: null,\n      currentFieldKey: \"\",\n      leftTitle: \"\",\n      rightTitle: \"\",\n      fieldType: \"\",\n      fieldLabel: \"\"\n    });\n\n    // 工具方法\n    const getPlainTextFromSelection = htmlContent => {\n      const container = document.createElement(\"div\");\n      container.innerHTML = htmlContent;\n      return container.innerText || container.textContent || \"\";\n    };\n\n    // 事件处理\n    const handleSelectionEvent = (data, source) => {\n      const plainText = getPlainTextFromSelection(data.content);\n      const target = source === \"div1\" ? div1RawData : div3RawData;\n      target.value = data.content;\n    };\n    const updateInfobox = source => data => {\n      infoboxData.value[source] = data;\n    };\n\n    // 生命周期\n    onMounted(() => {\n      loadChatHistory();\n      bus.on(\"div1_Event\", data => handleSelectionEvent(data, \"div1\"));\n      bus.on(\"div3_Event\", data => handleSelectionEvent(data, \"div3\"));\n      bus.on(\"div1_InfoboxData\", updateInfobox(\"div1\"));\n      bus.on(\"div3_InfoboxData\", updateInfobox(\"div3\"));\n    });\n    onUnmounted(() => {\n      [\"div1_Event\", \"div3_Event\", \"div1_InfoboxData\", \"div3_InfoboxData\"].forEach(event => {\n        bus.off(event);\n      });\n    });\n\n    // 数据持久化\n    const loadChatHistory = () => {\n      const saved = localStorage.getItem(\"chatHistory\");\n      if (saved) {\n        try {\n          chatHistory.value = JSON.parse(saved);\n        } catch (e) {\n          console.error(\"加载聊天记录失败:\", e);\n        }\n      }\n    };\n    watch(chatHistory, newVal => {\n      localStorage.setItem(\"chatHistory\", JSON.stringify(newVal));\n    }, {\n      deep: true\n    });\n\n    // UI交互\n    const scrollToBottom = () => {\n      nextTick(() => {\n        const container = document.querySelector(\".chat-history\");\n        if (container) {\n          container.scrollTop = container.scrollHeight;\n        }\n      });\n    };\n    const useSuggestedQuestion = () => {\n      userQuestion.value = suggestedQuestion.value;\n      showSuggestedQuestion.value = false;\n      nextTick(() => {\n        document.querySelector(\".input-container textarea\").focus();\n      });\n    };\n\n    // 数据处理逻辑\n    const extractEssentialData = fieldData => {\n      if (!fieldData) return null;\n      return {\n        value: fieldData.value,\n        type: fieldData.type,\n        ...(fieldData.unit && {\n          unit: fieldData.unit\n        }),\n        ...(fieldData.currency && {\n          currency: fieldData.currency\n        }),\n        ...(fieldData.extracted && {\n          raw: fieldData.raw\n        })\n      };\n    };\n    const simplifyInfobox = infobox => {\n      if (!infobox) return {};\n      return {\n        title: infobox.title,\n        type: infobox.type,\n        sections: Object.entries(infobox.sections || {}).reduce((acc, _ref2) => {\n          let [sectionName, sectionData] = _ref2;\n          const preservedFields = PRESERVED_FIELDS_BY_SECTION[sectionName] || [];\n          acc[sectionName] = preservedFields.reduce((fields, fieldName) => {\n            if (sectionData[fieldName]) {\n              fields[fieldName] = extractEssentialData(sectionData[fieldName]);\n            }\n            return fields;\n          }, {});\n          return acc;\n        }, {})\n      };\n    };\n    const parseCausalChains = text => {\n      return text.split(/##\\s*(韩国|日本)/).filter(Boolean).reduce((chains, part, index) => {\n        if (index % 2 === 1) {\n          const country = part === \"韩国\" ? \"korea\" : \"japan\";\n          const steps = text.split(/(→|\\d+\\.)/).map(step => step.trim()).filter(step => step && ![\"→\", \"1.\", \"2.\", \"3.\", \"4.\", \"5.\", \"6.\"].includes(step));\n          chains.push({\n            country,\n            steps: steps.slice(0, 6).map(text => ({\n              text: text.replace(/\\(.*?\\)/g, \"\").trim(),\n              evidence: text.match(/\\((.*?)\\)/)?.[1] || null\n            }))\n          });\n        }\n        return chains;\n      }, []);\n    };\n\n    // API请求处理\n    const handleApiResponse = function (response) {\n      let isCausalFlow = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      const formatted = formatMarkdown(response.analysis || response.answer);\n      const causalChains = isCausalFlow ? parseCausalChains(response.analysis) : [];\n      chatHistory.value.push({\n        role: \"assistant\",\n        content: isCausalFlow ? \"以下是因果分析：\" : formatted,\n        isCausalFlow,\n        causalChains,\n        timestamp: new Date().toLocaleString()\n      });\n      if (!isCausalFlow) {\n        suggestedQuestion.value = `请结合其他属性深入分析${comparisonState.value.currentFieldKey}差异的原因`;\n        showSuggestedQuestion.value = true;\n      }\n      scrollToBottom();\n    };\n\n    // 核心业务逻辑\n    const askQuestion = async () => {\n      if (!userQuestion.value.trim()) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"问题不能为空\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n      chatHistory.value.push({\n        role: \"user\",\n        content: userQuestion.value,\n        timestamp: new Date().toLocaleString()\n      });\n      const question = userQuestion.value;\n      userQuestion.value = \"\";\n      showSuggestedQuestion.value = false;\n      const isComparativeAnalysis = comparisonState.value.currentFieldKey && question.includes(\"分析\") && question.includes(\"原因\");\n      const apiParams = isComparativeAnalysis ? {\n        method: \"compare_attributes\",\n        payload: {\n          chartData: {\n            ...comparisonState.value,\n            leftInfobox: simplifyInfobox(infoboxData.value.div1),\n            rightInfobox: simplifyInfobox(infoboxData.value.div3)\n          },\n          chartType: \"comparison\",\n          followUp: true,\n          previousAnalysis: chatHistory.value.reverse().find(msg => msg.role === \"assistant\" && !msg.error)?.content || \"\"\n        }\n      } : {\n        method: \"ask_infobox\",\n        payload: {\n          question,\n          leftInfobox: simplifyInfobox(infoboxData.value.div1),\n          rightInfobox: simplifyInfobox(infoboxData.value.div3)\n        }\n      };\n      await safeApiCall(apiParams.method, apiParams.payload, response => handleApiResponse(response, isComparativeAnalysis), error => {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `请求失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        isLoading.value = false;\n        scrollToBottom();\n      });\n    };\n    const handleAttributeComparison = async payload => {\n      comparisonState.value = {\n        ...payload\n      };\n      if (!payload.leftData || !payload.rightData) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"请先选择要对比的数据\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n      await safeApiCall(\"compare_attributes\", {\n        chartData: {\n          ...payload,\n          leftInfobox: simplifyInfobox(infoboxData.value.div1),\n          rightInfobox: simplifyInfobox(infoboxData.value.div3)\n        },\n        chartType: \"comparison\"\n      }, response => handleApiResponse(response), error => {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `对比分析失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        isLoading.value = false;\n        scrollToBottom();\n      });\n    };\n    const __returned__ = {\n      PRESERVED_FIELDS_BY_SECTION,\n      userQuestion,\n      chatHistory,\n      div1RawData,\n      div3RawData,\n      isLoading,\n      showSuggestedQuestion,\n      suggestedQuestion,\n      infoboxData,\n      comparisonState,\n      getPlainTextFromSelection,\n      handleSelectionEvent,\n      updateInfobox,\n      loadChatHistory,\n      scrollToBottom,\n      useSuggestedQuestion,\n      extractEssentialData,\n      simplifyInfobox,\n      parseCausalChains,\n      handleApiResponse,\n      askQuestion,\n      handleAttributeComparison,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch,\n      nextTick,\n      get bus() {\n        return bus;\n      },\n      CompareTable,\n      CausalFlowChart,\n      get formatMarkdown() {\n        return formatMarkdown;\n      },\n      get safeApiCall() {\n        return safeApiCall;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","nextTick","bus","CompareTable","CausalFlowChart","formatMarkdown","safeApiCall","PRESERVED_FIELDS_BY_SECTION","Statistics","userQuestion","chatHistory","div1RawData","div3RawData","isLoading","showSuggestedQuestion","suggestedQuestion","infoboxData","div1","div3","comparisonState","leftData","rightData","currentFieldKey","leftTitle","rightTitle","fieldType","fieldLabel","getPlainTextFromSelection","htmlContent","container","document","createElement","innerHTML","innerText","textContent","handleSelectionEvent","data","source","plainText","content","target","value","updateInfobox","loadChatHistory","on","forEach","event","off","saved","localStorage","getItem","JSON","parse","e","console","error","newVal","setItem","stringify","deep","scrollToBottom","querySelector","scrollTop","scrollHeight","useSuggestedQuestion","focus","extractEssentialData","fieldData","type","unit","currency","extracted","raw","simplifyInfobox","infobox","title","sections","Object","entries","reduce","acc","_ref2","sectionName","sectionData","preservedFields","fields","fieldName","parseCausalChains","text","split","filter","Boolean","chains","part","index","country","steps","map","step","trim","includes","push","slice","replace","evidence","match","handleApiResponse","response","isCausalFlow","arguments","length","undefined","formatted","analysis","answer","causalChains","role","timestamp","Date","toLocaleString","askQuestion","question","isComparativeAnalysis","apiParams","method","payload","chartData","leftInfobox","rightInfobox","chartType","followUp","previousAnalysis","reverse","find","msg","message","handleAttributeComparison"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/Div2.vue"],"sourcesContent":["<template>\r\n\t<div class=\"main-container\">\r\n\t\t<div class=\"chat-container\">\r\n\t\t\t<div class=\"chat-history\">\r\n\t\t\t\t<component\r\n\t\t\t\t\tv-for=\"(message, index) in chatHistory\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:is=\"message.isCausalFlow ? CausalFlowChart : 'div'\"\r\n\t\t\t\t\t:class=\"['message', message.role, { error: message.error }]\"\r\n\t\t\t\t\t:chains=\"message.causalChains\"\r\n\t\t\t\t\tv-bind=\"\r\n\t\t\t\t\t\tmessage.isCausalFlow ? { class: 'causal-flow-container' } : {}\r\n\t\t\t\t\t\">\r\n\t\t\t\t\t<template v-if=\"!message.isCausalFlow\">\r\n\t\t\t\t\t\t<div class=\"message-content\" v-html=\"message.content\"></div>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</component>\r\n\t\t\t\t<div v-if=\"isLoading\" class=\"loading-indicator\">\r\n\t\t\t\t\t<div class=\"loading-spinner\"></div>\r\n\t\t\t\t\t正在处理中...\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"showSuggestedQuestion\" class=\"suggested-question\">\r\n\t\t\t\t\t<div class=\"suggestion-text\">建议深入分析的问题：</div>\r\n\t\t\t\t\t<div class=\"suggestion-content\" @click=\"useSuggestedQuestion\">\r\n\t\t\t\t\t\t{{ suggestedQuestion }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"vis-container\">\r\n\t\t\t<CompareTable\r\n\t\t\t\tclass=\"compare-table\"\r\n\t\t\t\t:div1-raw-data=\"div1RawData\"\r\n\t\t\t\t:div3-raw-data=\"div3RawData\"\r\n\t\t\t\t@compareAttribute=\"handleAttributeComparison\" />\r\n\t\t</div>\r\n\t\t<div class=\"input-area\">\r\n\t\t\t<div class=\"input-container\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tv-model=\"userQuestion\"\r\n\t\t\t\t\trows=\"2\"\r\n\t\t\t\t\tplaceholder=\"请输入你想问的问题...\"\r\n\t\t\t\t\t:disabled=\"isLoading\"></textarea>\r\n\t\t\t\t<div class=\"button-container\">\r\n\t\t\t\t\t<button @click=\"askQuestion\" :disabled=\"isLoading\">\r\n\t\t\t\t\t\t{{ isLoading ? \"处理中...\" : \"发送\" }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\timport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\r\n\timport CausalFlowChart from \"@/components/compoents_base/CausalFlowChart.vue\";\r\n\timport { formatMarkdown } from \"@/js/markdown\";\r\n\timport { safeApiCall } from \"@/js/api\";\r\n\r\n\t// 常量定义\r\n\tconst PRESERVED_FIELDS_BY_SECTION = {\r\n\t\tStatistics: [\r\n\t\t\t\"Population\",\r\n\t\t\t\"GDP\",\r\n\t\t\t\"GDP rank\",\r\n\t\t\t\"GDP growth\",\r\n\t\t\t\"GDP per capita\",\r\n\t\t\t\"GDP per capita rank\",\r\n\t\t\t\"GDP by sector\",\r\n\t\t\t\"Inflation (CPI)\",\r\n\t\t\t\"Population below poverty line\",\r\n\t\t\t\"Gini coefficient\",\r\n\t\t\t\"Human Development Index\",\r\n\t\t\t\"Corruption Perceptions Index\",\r\n\t\t\t\"Labor force\",\r\n\t\t\t\"Labor force by occupation\",\r\n\t\t\t\"Unemployment\",\r\n\t\t\t\"Average gross salary\",\r\n\t\t\t\"Average net salary\",\r\n\t\t\t\"Main industries\"\r\n\t\t],\r\n\t\t\"Public finances\": [\r\n\t\t\t\"Government debt\",\r\n\t\t\t\"Foreign reserves\",\r\n\t\t\t\"Budget balance\",\r\n\t\t\t\"Revenues\",\r\n\t\t\t\"Expenses\",\r\n\t\t\t\"Economic aid\",\r\n\t\t\t\"Credit rating\"\r\n\t\t]\r\n\t};\r\n\r\n\t// 响应式状态\r\n\tconst userQuestion = ref(\"\");\r\n\tconst chatHistory = ref([]);\r\n\tconst div1RawData = ref(null);\r\n\tconst div3RawData = ref(null);\r\n\tconst isLoading = ref(false);\r\n\tconst showSuggestedQuestion = ref(false);\r\n\tconst suggestedQuestion = ref(\"\");\r\n\r\n\t// Infobox数据\r\n\tconst infoboxData = ref({\r\n\t\tdiv1: null,\r\n\t\tdiv3: null\r\n\t});\r\n\r\n\t// 对比状态\r\n\tconst comparisonState = ref({\r\n\t\tleftData: null,\r\n\t\trightData: null,\r\n\t\tcurrentFieldKey: \"\",\r\n\t\tleftTitle: \"\",\r\n\t\trightTitle: \"\",\r\n\t\tfieldType: \"\",\r\n\t\tfieldLabel: \"\"\r\n\t});\r\n\r\n\t// 工具方法\r\n\tconst getPlainTextFromSelection = htmlContent => {\r\n\t\tconst container = document.createElement(\"div\");\r\n\t\tcontainer.innerHTML = htmlContent;\r\n\t\treturn container.innerText || container.textContent || \"\";\r\n\t};\r\n\r\n\t// 事件处理\r\n\tconst handleSelectionEvent = (data, source) => {\r\n\t\tconst plainText = getPlainTextFromSelection(data.content);\r\n\t\tconst target = source === \"div1\" ? div1RawData : div3RawData;\r\n\t\ttarget.value = data.content;\r\n\t};\r\n\r\n\tconst updateInfobox = source => data => {\r\n\t\tinfoboxData.value[source] = data;\r\n\t};\r\n\r\n\t// 生命周期\r\n\tonMounted(() => {\r\n\t\tloadChatHistory();\r\n\t\tbus.on(\"div1_Event\", data => handleSelectionEvent(data, \"div1\"));\r\n\t\tbus.on(\"div3_Event\", data => handleSelectionEvent(data, \"div3\"));\r\n\t\tbus.on(\"div1_InfoboxData\", updateInfobox(\"div1\"));\r\n\t\tbus.on(\"div3_InfoboxData\", updateInfobox(\"div3\"));\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\t[\r\n\t\t\t\"div1_Event\",\r\n\t\t\t\"div3_Event\",\r\n\t\t\t\"div1_InfoboxData\",\r\n\t\t\t\"div3_InfoboxData\"\r\n\t\t].forEach(event => {\r\n\t\t\tbus.off(event);\r\n\t\t});\r\n\t});\r\n\r\n\t// 数据持久化\r\n\tconst loadChatHistory = () => {\r\n\t\tconst saved = localStorage.getItem(\"chatHistory\");\r\n\t\tif (saved) {\r\n\t\t\ttry {\r\n\t\t\t\tchatHistory.value = JSON.parse(saved);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"加载聊天记录失败:\", e);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\twatch(\r\n\t\tchatHistory,\r\n\t\tnewVal => {\r\n\t\t\tlocalStorage.setItem(\"chatHistory\", JSON.stringify(newVal));\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n\r\n\t// UI交互\r\n\tconst scrollToBottom = () => {\r\n\t\tnextTick(() => {\r\n\t\t\tconst container = document.querySelector(\".chat-history\");\r\n\t\t\tif (container) {\r\n\t\t\t\tcontainer.scrollTop = container.scrollHeight;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst useSuggestedQuestion = () => {\r\n\t\tuserQuestion.value = suggestedQuestion.value;\r\n\t\tshowSuggestedQuestion.value = false;\r\n\t\tnextTick(() => {\r\n\t\t\tdocument.querySelector(\".input-container textarea\").focus();\r\n\t\t});\r\n\t};\r\n\r\n\t// 数据处理逻辑\r\n\tconst extractEssentialData = fieldData => {\r\n\t\tif (!fieldData) return null;\r\n\t\treturn {\r\n\t\t\tvalue: fieldData.value,\r\n\t\t\ttype: fieldData.type,\r\n\t\t\t...(fieldData.unit && { unit: fieldData.unit }),\r\n\t\t\t...(fieldData.currency && { currency: fieldData.currency }),\r\n\t\t\t...(fieldData.extracted && { raw: fieldData.raw })\r\n\t\t};\r\n\t};\r\n\r\n\tconst simplifyInfobox = infobox => {\r\n\t\tif (!infobox) return {};\r\n\t\treturn {\r\n\t\t\ttitle: infobox.title,\r\n\t\t\ttype: infobox.type,\r\n\t\t\tsections: Object.entries(infobox.sections || {}).reduce(\r\n\t\t\t\t(acc, [sectionName, sectionData]) => {\r\n\t\t\t\t\tconst preservedFields =\r\n\t\t\t\t\t\tPRESERVED_FIELDS_BY_SECTION[sectionName] || [];\r\n\t\t\t\t\tacc[sectionName] = preservedFields.reduce((fields, fieldName) => {\r\n\t\t\t\t\t\tif (sectionData[fieldName]) {\r\n\t\t\t\t\t\t\tfields[fieldName] = extractEssentialData(sectionData[fieldName]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn fields;\r\n\t\t\t\t\t}, {});\r\n\t\t\t\t\treturn acc;\r\n\t\t\t\t},\r\n\t\t\t\t{}\r\n\t\t\t)\r\n\t\t};\r\n\t};\r\n\r\n\tconst parseCausalChains = text => {\r\n\t\treturn text\r\n\t\t\t.split(/##\\s*(韩国|日本)/)\r\n\t\t\t.filter(Boolean)\r\n\t\t\t.reduce((chains, part, index) => {\r\n\t\t\t\tif (index % 2 === 1) {\r\n\t\t\t\t\tconst country = part === \"韩国\" ? \"korea\" : \"japan\";\r\n\t\t\t\t\tconst steps = text\r\n\t\t\t\t\t\t.split(/(→|\\d+\\.)/)\r\n\t\t\t\t\t\t.map(step => step.trim())\r\n\t\t\t\t\t\t.filter(\r\n\t\t\t\t\t\t\tstep =>\r\n\t\t\t\t\t\t\t\tstep &&\r\n\t\t\t\t\t\t\t\t![\"→\", \"1.\", \"2.\", \"3.\", \"4.\", \"5.\", \"6.\"].includes(step)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\tchains.push({\r\n\t\t\t\t\t\tcountry,\r\n\t\t\t\t\t\tsteps: steps.slice(0, 6).map(text => ({\r\n\t\t\t\t\t\t\ttext: text.replace(/\\(.*?\\)/g, \"\").trim(),\r\n\t\t\t\t\t\t\tevidence: text.match(/\\((.*?)\\)/)?.[1] || null\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn chains;\r\n\t\t\t}, []);\r\n\t};\r\n\r\n\t// API请求处理\r\n\tconst handleApiResponse = (response, isCausalFlow = false) => {\r\n\t\tconst formatted = formatMarkdown(response.analysis || response.answer);\r\n\t\tconst causalChains = isCausalFlow\r\n\t\t\t? parseCausalChains(response.analysis)\r\n\t\t\t: [];\r\n\r\n\t\tchatHistory.value.push({\r\n\t\t\trole: \"assistant\",\r\n\t\t\tcontent: isCausalFlow ? \"以下是因果分析：\" : formatted,\r\n\t\t\tisCausalFlow,\r\n\t\t\tcausalChains,\r\n\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t});\r\n\r\n\t\tif (!isCausalFlow) {\r\n\t\t\tsuggestedQuestion.value = `请结合其他属性深入分析${comparisonState.value.currentFieldKey}差异的原因`;\r\n\t\t\tshowSuggestedQuestion.value = true;\r\n\t\t}\r\n\t\tscrollToBottom();\r\n\t};\r\n\r\n\t// 核心业务逻辑\r\n\tconst askQuestion = async () => {\r\n\t\tif (!userQuestion.value.trim()) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"问题不能为空\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tchatHistory.value.push({\r\n\t\t\trole: \"user\",\r\n\t\t\tcontent: userQuestion.value,\r\n\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t});\r\n\t\tconst question = userQuestion.value;\r\n\t\tuserQuestion.value = \"\";\r\n\t\tshowSuggestedQuestion.value = false;\r\n\r\n\t\tconst isComparativeAnalysis =\r\n\t\t\tcomparisonState.value.currentFieldKey &&\r\n\t\t\tquestion.includes(\"分析\") &&\r\n\t\t\tquestion.includes(\"原因\");\r\n\r\n\t\tconst apiParams = isComparativeAnalysis\r\n\t\t\t? {\r\n\t\t\t\t\tmethod: \"compare_attributes\",\r\n\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\tchartData: {\r\n\t\t\t\t\t\t\t...comparisonState.value,\r\n\t\t\t\t\t\t\tleftInfobox: simplifyInfobox(infoboxData.value.div1),\r\n\t\t\t\t\t\t\trightInfobox: simplifyInfobox(infoboxData.value.div3)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tchartType: \"comparison\",\r\n\t\t\t\t\t\tfollowUp: true,\r\n\t\t\t\t\t\tpreviousAnalysis:\r\n\t\t\t\t\t\t\tchatHistory.value\r\n\t\t\t\t\t\t\t\t.reverse()\r\n\t\t\t\t\t\t\t\t.find(msg => msg.role === \"assistant\" && !msg.error)?.content ||\r\n\t\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t: {\r\n\t\t\t\t\tmethod: \"ask_infobox\",\r\n\t\t\t\t\tpayload: {\r\n\t\t\t\t\t\tquestion,\r\n\t\t\t\t\t\tleftInfobox: simplifyInfobox(infoboxData.value.div1),\r\n\t\t\t\t\t\trightInfobox: simplifyInfobox(infoboxData.value.div3)\r\n\t\t\t\t\t}\r\n\t\t\t  };\r\n\r\n\t\tawait safeApiCall(\r\n\t\t\tapiParams.method,\r\n\t\t\tapiParams.payload,\r\n\t\t\tresponse => handleApiResponse(response, isComparativeAnalysis),\r\n\t\t\terror => {\r\n\t\t\t\tchatHistory.value.push({\r\n\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\tcontent: `请求失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\t\terror: true\r\n\t\t\t\t});\r\n\t\t\t\tisLoading.value = false;\r\n\t\t\t\tscrollToBottom();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\tconst handleAttributeComparison = async payload => {\r\n\t\tcomparisonState.value = { ...payload };\r\n\r\n\t\tif (!payload.leftData || !payload.rightData) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"请先选择要对比的数据\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tawait safeApiCall(\r\n\t\t\t\"compare_attributes\",\r\n\t\t\t{\r\n\t\t\t\tchartData: {\r\n\t\t\t\t\t...payload,\r\n\t\t\t\t\tleftInfobox: simplifyInfobox(infoboxData.value.div1),\r\n\t\t\t\t\trightInfobox: simplifyInfobox(infoboxData.value.div3)\r\n\t\t\t\t},\r\n\t\t\t\tchartType: \"comparison\"\r\n\t\t\t},\r\n\t\t\tresponse => handleApiResponse(response),\r\n\t\t\terror => {\r\n\t\t\t\tchatHistory.value.push({\r\n\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\tcontent: `对比分析失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\t\terror: true\r\n\t\t\t\t});\r\n\t\t\t\tisLoading.value = false;\r\n\t\t\t\tscrollToBottom();\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.main-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tbackground: #f5f7fa;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.chat-container {\r\n\t\theight: 50vh;\r\n\t\tmin-height: 50vh;\r\n\t\toverflow: hidden;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tmargin: 10px;\r\n\t}\r\n\r\n\t.chat-history {\r\n\t\tflex: 1;\r\n\t\toverflow-y: auto;\r\n\t\tpadding: 20px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t\tscroll-behavior: smooth;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.vis-container {\r\n\t\theight: 30vh;\r\n\t\tmin-height: 30vh;\r\n\t\tpadding: 10px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tmargin: 0 10px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t\toverflow: auto;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.compare-table {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.input-area {\r\n\t\theight: 15vh;\r\n\t\tmin-height: 15vh;\r\n\t\tpadding: 15px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-top: 1px solid #e0e0e0;\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\r\n\t.message {\r\n\t\tmargin-bottom: 20px;\r\n\t\tpadding: 15px 20px;\r\n\t\tborder-radius: 12px;\r\n\t\tline-height: 1.6;\r\n\t\tposition: relative;\r\n\t\tmax-width: 85%;\r\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.message.user {\r\n\t\tbackground: #e3f2fd;\r\n\t\tmargin-left: auto;\r\n\t\tborder-bottom-right-radius: 4px;\r\n\t\tborder: 1px solid #bbdefb;\r\n\t}\r\n\r\n\t.message.assistant {\r\n\t\tbackground: #f8f9fa;\r\n\t\tmargin-right: auto;\r\n\t\tborder-bottom-left-radius: 4px;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.message.error {\r\n\t\tbackground: #ffebee;\r\n\t\tborder-left: 4px solid #f44336;\r\n\t}\r\n\r\n\t.message-content {\r\n\t\tword-wrap: break-word;\r\n\t}\r\n\r\n\t.input-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\t\theight: 100%;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.input-container textarea {\r\n\t\twidth: 100%;\r\n\t\tpadding: 12px 16px;\r\n\t\tborder: none;\r\n\t\tborder-radius: 12px;\r\n\t\tresize: none;\r\n\t\tfont-size: 14px;\r\n\t\toutline: none;\r\n\t\tbackground: #f9f9f9;\r\n\t}\r\n\r\n\t.input-container textarea:focus {\r\n\t\tbackground: #ffffff;\r\n\t}\r\n\r\n\t.button-container {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-end;\r\n\t\tpadding: 8px;\r\n\t}\r\n\r\n\t.button-container button {\r\n\t\tbackground: #4285f4;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 8px 20px;\r\n\t\tborder-radius: 8px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 14px;\r\n\t\tfont-weight: 500;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\r\n\t.button-container button:hover {\r\n\t\tbackground: #3367d6;\r\n\t\ttransform: translateY(-1px);\r\n\t}\r\n\r\n\t.button-container button:disabled {\r\n\t\tbackground: #b3c6e0;\r\n\t\tcursor: not-allowed;\r\n\t\ttransform: none;\r\n\t}\r\n\r\n\t.loading-indicator {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 15px;\r\n\t\tcolor: #666;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\t.loading-spinner {\r\n\t\tborder: 3px solid rgba(66, 133, 244, 0.2);\r\n\t\tborder-radius: 50%;\r\n\t\tborder-top: 3px solid #4285f4;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tanimation: spin 1s linear infinite;\r\n\t\tmargin-right: 10px;\r\n\t}\r\n\r\n\t@keyframes spin {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\r\n\t.markdown-content {\r\n\t\tline-height: 1.7;\r\n\t\tfont-size: 15px;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.markdown-content h1 {\r\n\t\tfont-size: 1.5em;\r\n\t\tmargin: 20px 0 15px;\r\n\t\tpadding-bottom: 5px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\tcolor: #2c3e50;\r\n\t}\r\n\r\n\t.markdown-content h2 {\r\n\t\tfont-size: 1.3em;\r\n\t\tmargin: 18px 0 12px;\r\n\t\tcolor: #34495e;\r\n\t}\r\n\r\n\t.markdown-content h3 {\r\n\t\tfont-size: 1.1em;\r\n\t\tmargin: 15px 0 10px;\r\n\t\tcolor: #4285f4;\r\n\t}\r\n\r\n\t.markdown-content ul,\r\n\t.markdown-content ol {\r\n\t\tpadding-left: 25px;\r\n\t\tmargin: 12px 0;\r\n\t}\r\n\r\n\t.markdown-content li {\r\n\t\tmargin-bottom: 8px;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.markdown-content ul li::before {\r\n\t\tcontent: \"•\";\r\n\t\tcolor: #4285f4;\r\n\t\tposition: absolute;\r\n\t\tleft: -15px;\r\n\t}\r\n\r\n\t.markdown-content strong {\r\n\t\tcolor: #2c3e50;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.markdown-content em {\r\n\t\tcolor: #666;\r\n\t\tfont-style: italic;\r\n\t}\r\n\r\n\t.markdown-content code {\r\n\t\tbackground: rgba(66, 133, 244, 0.1);\r\n\t\tpadding: 2px 6px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, monospace;\r\n\t\tfont-size: 0.9em;\r\n\t\tcolor: #d63384;\r\n\t}\r\n\r\n\t.markdown-content blockquote {\r\n\t\tborder-left: 3px solid #4285f4;\r\n\t\tpadding: 10px 15px;\r\n\t\tmargin: 15px 0;\r\n\t\tbackground: rgba(66, 133, 244, 0.05);\r\n\t\tcolor: #555;\r\n\t}\r\n\r\n\t.markdown-content a {\r\n\t\tcolor: #4285f4;\r\n\t\ttext-decoration: none;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.markdown-content a:hover {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\r\n\t.suggested-question {\r\n\t\tmargin: 15px 0;\r\n\t\tpadding: 12px;\r\n\t\tbackground-color: #f5f7fa;\r\n\t\tborder-radius: 8px;\r\n\t\tborder: 1px dashed #4285f4;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\r\n\t.suggested-question:hover {\r\n\t\tbackground-color: #e8f0fe;\r\n\t}\r\n\r\n\t.suggestion-text {\r\n\t\tfont-size: 12px;\r\n\t\tcolor: #666;\r\n\t\tmargin-bottom: 5px;\r\n\t}\r\n\r\n\t.suggestion-content {\r\n\t\tcolor: #4285f4;\r\n\t\tfont-weight: 500;\r\n\t\tpadding: 5px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.causal-flow-container {\r\n\t\twidth: 100%;\r\n\t\tmax-width: 100%;\r\n\t\toverflow: hidden;\r\n\t\tpadding: 0 5px;\r\n\t\tmargin-top: 15px;\r\n\t\tmargin-bottom: 5px;\r\n\t}\r\n\r\n\t@media (max-width: 768px) {\r\n\t\t.chat-container {\r\n\t\t\theight: 45vh;\r\n\t\t\tmin-height: 45vh;\r\n\t\t}\r\n\r\n\t\t.vis-container {\r\n\t\t\theight: 35vh;\r\n\t\t\tmin-height: 35vh;\r\n\t\t}\r\n\r\n\t\t.input-area {\r\n\t\t\theight: 20vh;\r\n\t\t\tmin-height: 20vh;\r\n\t\t}\r\n\r\n\t\t.message {\r\n\t\t\tmax-width: 90%;\r\n\t\t\tpadding: 12px 15px;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}