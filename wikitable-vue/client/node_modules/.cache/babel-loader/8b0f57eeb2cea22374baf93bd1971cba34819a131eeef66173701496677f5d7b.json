{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withModifiers as _withModifiers, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-7a7e37dd\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"view-switcher\"\n};\nconst _hoisted_2 = {\n  key: 0\n};\nconst _hoisted_3 = [\"innerHTML\"];\nconst _hoisted_4 = {\n  key: 1\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"visualization-container\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"loading-spinner\"\n};\nconst _hoisted_7 = {\n  key: 1,\n  class: \"chart-container1\"\n};\nconst _hoisted_8 = {\n  key: 2,\n  class: \"chart-container2\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_font_awesome_icon = _resolveComponent(\"font-awesome-icon\");\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"text-popup\",\n    onClick: _cache[2] || (_cache[2] = function () {\n      return _ctx.closePopup && _ctx.closePopup(...arguments);\n    })\n  }, [_createCommentVNode(\" 切换视图按钮 \"), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = _withModifiers($event => $setup.switchView('text'), [\"prevent\", \"stop\"])),\n    class: _normalizeClass({\n      active: $setup.currentView === 'text'\n    }),\n    title: \"文本视图\"\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: ['fas', 'align-left']\n  })], 2 /* CLASS */), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = _withModifiers($event => $setup.switchView('visual'), [\"prevent\", \"stop\"])),\n    class: _normalizeClass({\n      active: $setup.currentView === 'visual'\n    }),\n    title: \"可视化视图\"\n  }, [_createVNode(_component_font_awesome_icon, {\n    icon: ['fas', 'chart-bar']\n  })], 2 /* CLASS */)]), _createCommentVNode(\" 文本视图 \"), $setup.currentView === 'text' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [$setup.isTable($props.selectedText) ? (_openBlock(), _createElementBlock(\"div\", {\n    key: 0,\n    class: \"table-container\",\n    innerHTML: $props.selectedText\n  }, null, 8 /* PROPS */, _hoisted_3)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"p\", null, _toDisplayString($props.selectedText), 1 /* TEXT */)]))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 可视化视图 \"), $setup.currentView === 'visual' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [$setup.visualizationLoading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6)) : $props.divId === 'div1' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_8))])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","onClick","_cache","_ctx","closePopup","arguments","_createCommentVNode","_createElementVNode","_hoisted_1","_withModifiers","$event","$setup","switchView","_normalizeClass","active","currentView","title","_createVNode","_component_font_awesome_icon","icon","_hoisted_2","isTable","$props","selectedText","innerHTML","_hoisted_3","_hoisted_4","_toDisplayString","_hoisted_5","visualizationLoading","_hoisted_6","divId","_hoisted_7","_hoisted_8"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\PopupContent.vue"],"sourcesContent":["<template>\r\n\t<div class=\"text-popup\" @click=\"closePopup\">\r\n\t\t<!-- 切换视图按钮 -->\r\n\t\t<div class=\"view-switcher\">\r\n\t\t\t<button\r\n\t\t\t\t@click.prevent.stop=\"switchView('text')\"\r\n\t\t\t\t:class=\"{ active: currentView === 'text' }\"\r\n\t\t\t\ttitle=\"文本视图\">\r\n\t\t\t\t<font-awesome-icon :icon=\"['fas', 'align-left']\" />\r\n\t\t\t</button>\r\n\r\n\t\t\t<button\r\n\t\t\t\t@click.prevent.stop=\"switchView('visual')\"\r\n\t\t\t\t:class=\"{ active: currentView === 'visual' }\"\r\n\t\t\t\ttitle=\"可视化视图\">\r\n\t\t\t\t<font-awesome-icon :icon=\"['fas', 'chart-bar']\" />\r\n\t\t\t</button>\r\n\t\t</div>\r\n\r\n\t\t<!-- 文本视图 -->\r\n\t\t<div v-if=\"currentView === 'text'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"isTable(selectedText)\"\r\n\t\t\t\tclass=\"table-container\"\r\n\t\t\t\tv-html=\"selectedText\"></div>\r\n\t\t\t<div v-else>\r\n\t\t\t\t<p>{{ selectedText }}</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 可视化视图 -->\r\n\t\t<div v-if=\"currentView === 'visual'\" class=\"visualization-container\">\r\n\t\t\t<div v-if=\"visualizationLoading\" class=\"loading-spinner\"></div>\r\n\t\t\t<div v-else-if=\"divId === 'div1'\" class=\"chart-container1\"></div>\r\n\t\t\t<div v-else class=\"chart-container2\"></div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\timport {\r\n\t\trenderLineChart,\r\n\t\trenderBarChart,\r\n\t\trenderPieChart,\r\n\t\trenderNonVisualChart\r\n\t} from \"@/js/chartUtils\";\r\n\r\n\tconst props = defineProps({\r\n\t\tselectedText: String,\r\n\t\tdivId: String\r\n\t});\r\n\r\n\tconst currentView = ref(\"text\"); // 当前视图模式：text 或 visual\r\n\tconst visualizationLoading = ref(false); // 可视化图表加载状态\r\n\r\n\t// 判断是否是表格内容\r\n\tconst isTable = content => {\r\n\t\treturn /<table.*?>.*?<\\/table>/s.test(content);\r\n\t};\r\n\r\n\t// 切换视图\r\n\tconst switchView = async view => {\r\n\t\tcurrentView.value = view;\r\n\t\tif (view === \"visual\") {\r\n\t\t\tvisualizationLoading.value = true;\r\n\t\t\tawait processText(); // 调用后端处理文本并渲染图表\r\n\t\t\tvisualizationLoading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\t// 获取可视化 JSON 数据\r\n\tasync function processText() {\r\n\t\ttry {\r\n\t\t\tapi.post(\r\n\t\t\t\t\"process_text\",\r\n\t\t\t\t{ text: props.selectedText.toString().trim() }, // 使用对应 divId 的选中内容\r\n\t\t\t\tdata => {\r\n\t\t\t\t\tif (data.error) {\r\n\t\t\t\t\t\tconsole.error(\"后端返回的错误:\", data.error);\r\n\t\t\t\t\t\talert(`处理文章内容时出错: ${data.message}`);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst jsonData = data.json_data;\r\n\t\t\t\t\tconsole.log(\"后端返回的数据:\", jsonData);\r\n\r\n\t\t\t\t\t// 根据 divId 选择容器\r\n\t\t\t\t\tconst container =\r\n\t\t\t\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\r\n\t\t\t\t\tif (data.data_type === \"Non-Visual\") {\r\n\t\t\t\t\t\trenderNonVisualChart(container, data, {\r\n\t\t\t\t\t\t\tmessage: \"当前数据无法可视化\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderChart(jsonData);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"处理文章内容时出错:\", error);\r\n\t\t\talert(\"处理文章内容时出错，请稍后重试\");\r\n\t\t}\r\n\t}\r\n\r\n\t// 渲染图表\r\n\tfunction renderChart(rawJsonData) {\r\n\t\tif (!rawJsonData || typeof rawJsonData !== \"object\" || !rawJsonData.data) {\r\n\t\t\tconst container =\r\n\t\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\t\t\trenderNonVisualChart(container, rawJsonData, {\r\n\t\t\t\tmessage: \"JSON 数据无效\"\r\n\t\t\t});\r\n\t\t\tconsole.error(\"JSON 数据无效:\", rawJsonData);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 根据 divId 选择容器\r\n\t\tconst container =\r\n\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\r\n\t\t// 清空之前的图表\r\n\t\td3.select(container).html(\"\");\r\n\r\n\t\tconst chartType = rawJsonData.type;\r\n\t\tconst data = rawJsonData.data;\r\n\t\tconst options = rawJsonData.options || {};\r\n\r\n\t\t// 根据图表类型渲染\r\n\t\tif (chartType === \"line\") {\r\n\t\t\trenderLineChart(container, data, options);\r\n\t\t} else if (chartType === \"bar\") {\r\n\t\t\trenderBarChart(container, data, options);\r\n\t\t} else if (chartType === \"pie\") {\r\n\t\t\trenderPieChart(container, data, options);\r\n\t\t} else {\r\n\t\t\tconsole.error(\"未知的图表类型:\", chartType);\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t.text-popup {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: 90%;\r\n\t\tmax-height: 80vh;\r\n\t\toverflow: auto;\r\n\t\tbackground: rgba(255, 255, 255, 0.98);\r\n\t\tpadding: 25px;\r\n\t\tbox-shadow: 0px 10px 30px rgba(0, 0, 0, 0.4);\r\n\t\tborder-radius: 12px;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 0.8vw;\r\n\t\tfont-weight: 500;\r\n\t\tline-height: 1.6;\r\n\t\tcolor: #333;\r\n\t\tz-index: 100;\r\n\t\tcursor: pointer;\r\n\t\tbackdrop-filter: blur(20px);\r\n\t\tanimation: fadeIn 0.3s ease-in-out;\r\n\t\tborder: 1px solid rgba(255, 255, 255, 0.2);\r\n\t\tmargin: 0;\r\n\t}\r\n\r\n\t.view-switcher {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\r\n\t.view-switcher button {\r\n\t\tpadding: 8px;\r\n\t\tmargin: 0 5px;\r\n\t\tborder: none;\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: #f0f0f0;\r\n\t\tcursor: pointer;\r\n\t\ttransition: background-color 0.3s ease, transform 0.2s ease;\r\n\t\twidth: 36px;\r\n\t\theight: 36px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.view-switcher button:hover {\r\n\t\tbackground-color: #ddd;\r\n\t\ttransform: scale(1.1);\r\n\t}\r\n\r\n\t.view-switcher button.active {\r\n\t\tbackground-color: #0077b6;\r\n\t\tcolor: white;\r\n\t}\r\n\r\n\t.view-switcher button i {\r\n\t\tfont-size: 16px;\r\n\t\tcolor: inherit;\r\n\t}\r\n\r\n\t.visualization-container {\r\n\t\twidth: 100%;\r\n\t\theight: 300px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n</style>\r\n"],"mappings":";;;EAGOA,KAAK,EAAC;AAAe;;EAH5BC,GAAA;AAAA;mBAAA;;EAAAA,GAAA;AAAA;;EAAAA,GAAA;EA+BuCD,KAAK,EAAC;;;EA/B7CC,GAAA;EAgCoCD,KAAK,EAAC;;;EAhC1CC,GAAA;EAiCqCD,KAAK,EAAC;;;EAjC3CC,GAAA;EAkCeD,KAAK,EAAC;;;;uBAjCpBE,mBAAA,CAmCM;IAnCDF,KAAK,EAAC,YAAY;IAAEG,OAAK,EAAAC,MAAA,QAAAA,MAAA;MAAA,OAAEC,IAAA,CAAAC,UAAA,IAAAD,IAAA,CAAAC,UAAA,IAAAC,SAAA,CAAU;IAAA;MACzCC,mBAAA,YAAe,EACfC,mBAAA,CAcM,OAdNC,UAcM,GAbLD,mBAAA,CAKS;IAJPN,OAAK,EAAAC,MAAA,QAAAA,MAAA,MALVO,cAAA,CAAAC,MAAA,IAKyBC,MAAA,CAAAC,UAAU;IAC9Bd,KAAK,EANVe,eAAA;MAAAC,MAAA,EAMsBH,MAAA,CAAAI,WAAW;IAAA;IAC7BC,KAAK,EAAC;MACNC,YAAA,CAAmDC,4BAAA;IAA/BC,IAAI,EAAE;EAAqB,G,kBAGhDZ,mBAAA,CAKS;IAJPN,OAAK,EAAAC,MAAA,QAAAA,MAAA,MAZVO,cAAA,CAAAC,MAAA,IAYyBC,MAAA,CAAAC,UAAU;IAC9Bd,KAAK,EAbVe,eAAA;MAAAC,MAAA,EAasBH,MAAA,CAAAI,WAAW;IAAA;IAC7BC,KAAK,EAAC;MACNC,YAAA,CAAkDC,4BAAA;IAA9BC,IAAI,EAAE;EAAoB,G,oBAIhDb,mBAAA,UAAa,EACFK,MAAA,CAAAI,WAAW,e,cAAtBf,mBAAA,CAQM,OA5BRoB,UAAA,GAsBUT,MAAA,CAAAU,OAAO,CAACC,MAAA,CAAAC,YAAY,K,cAD3BvB,mBAAA,CAG6B;IAxBhCD,GAAA;IAuBID,KAAK,EAAC,iBAAiB;IACvB0B,SAAqB,EAAbF,MAAA,CAAAC;0BAxBZE,UAAA,M,cAyBGzB,mBAAA,CAEM,OA3BT0B,UAAA,GA0BInB,mBAAA,CAAyB,WAAAoB,gBAAA,CAAnBL,MAAA,CAAAC,YAAY,iB,QA1BtBjB,mBAAA,gBA8BEA,mBAAA,WAAc,EACHK,MAAA,CAAAI,WAAW,iB,cAAtBf,mBAAA,CAIM,OAJN4B,UAIM,GAHMjB,MAAA,CAAAkB,oBAAoB,I,cAA/B7B,mBAAA,CAA+D,OAA/D8B,UAA+D,KAC/CR,MAAA,CAAAS,KAAK,e,cAArB/B,mBAAA,CAAiE,OAAjEgC,UAAiE,M,cACjEhC,mBAAA,CAA2C,OAA3CiC,UAA2C,G,KAlC9C3B,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}