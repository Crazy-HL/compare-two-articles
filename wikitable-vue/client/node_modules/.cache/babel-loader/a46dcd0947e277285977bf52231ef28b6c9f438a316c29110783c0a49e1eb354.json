{"ast":null,"code":"import { ref } from \"vue\";\nimport * as d3 from \"d3\";\nimport { renderLineChart, renderBarChart, renderPieChart, renderNonVisualChart } from \"@/js/chartUtils\";\nexport default {\n  __name: 'PopupContent',\n  props: {\n    selectedText: String,\n    divId: String\n  },\n  emits: [\"close\"],\n  setup(__props, _ref) {\n    let {\n      expose: __expose,\n      emit: __emit\n    } = _ref;\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const currentView = ref(\"text\"); // 当前视图模式：text 或 visual\n    const visualizationLoading = ref(false); // 可视化图表加载状态\n\n    // 判断是否是表格内容\n    const isTable = content => {\n      return /<table.*?>.*?<\\/table>/s.test(content);\n    };\n\n    // 切换视图\n    const switchView = async view => {\n      currentView.value = view;\n      if (view === \"visual\") {\n        visualizationLoading.value = true;\n        await processText(); // 调用后端处理文本并渲染图表\n        visualizationLoading.value = false;\n      }\n    };\n\n    // 获取可视化 JSON 数据\n    async function processText() {\n      try {\n        api.post(\"process_text\", {\n          text: props.selectedText.toString().trim()\n        }, data => {\n          if (data.error) {\n            console.error(\"后端返回的错误:\", data.error);\n            alert(`处理文章内容时出错: ${data.message}`);\n            return;\n          }\n          const jsonData = data.json_data;\n          console.log(\"后端返回的数据:\", jsonData);\n\n          // 根据 divId 选择容器\n          const container = props.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\n          if (data.data_type === \"Non-Visual\") {\n            renderNonVisualChart(container, data, {\n              message: \"当前数据无法可视化\"\n            });\n          } else {\n            renderChart(jsonData);\n          }\n        });\n      } catch (error) {\n        console.error(\"处理文章内容时出错:\", error);\n        alert(\"处理文章内容时出错，请稍后重试\");\n      }\n    }\n\n    // 渲染图表\n    function renderChart(rawJsonData) {\n      if (!rawJsonData || typeof rawJsonData !== \"object\" || !rawJsonData.data) {\n        const container = props.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\n        renderNonVisualChart(container, rawJsonData, {\n          message: \"JSON 数据无效\"\n        });\n        console.error(\"JSON 数据无效:\", rawJsonData);\n        return;\n      }\n\n      // 根据 divId 选择容器\n      const container = props.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\n\n      // 清空之前的图表\n      d3.select(container).html(\"\");\n      const chartType = rawJsonData.type;\n      const data = rawJsonData.data;\n      const options = rawJsonData.options || {};\n\n      // 根据图表类型渲染\n      if (chartType === \"line\") {\n        renderLineChart(container, data, options);\n      } else if (chartType === \"bar\") {\n        renderBarChart(container, data, options);\n      } else if (chartType === \"pie\") {\n        renderPieChart(container, data, options);\n      } else {\n        console.error(\"未知的图表类型:\", chartType);\n      }\n    }\n\n    // 关闭弹出框\n    const closePopup = () => {\n      emit(\"close\");\n    };\n    const __returned__ = {\n      props,\n      emit,\n      currentView,\n      visualizationLoading,\n      isTable,\n      switchView,\n      processText,\n      renderChart,\n      closePopup,\n      ref,\n      get d3() {\n        return d3;\n      },\n      get renderLineChart() {\n        return renderLineChart;\n      },\n      get renderBarChart() {\n        return renderBarChart;\n      },\n      get renderPieChart() {\n        return renderPieChart;\n      },\n      get renderNonVisualChart() {\n        return renderNonVisualChart;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","d3","renderLineChart","renderBarChart","renderPieChart","renderNonVisualChart","props","__props","emit","__emit","currentView","visualizationLoading","isTable","content","test","switchView","view","value","processText","api","post","text","selectedText","toString","trim","data","error","console","alert","message","jsonData","json_data","log","container","divId","data_type","renderChart","rawJsonData","select","html","chartType","type","options","closePopup"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/PopupContent.vue"],"sourcesContent":["<template>\r\n\t<div class=\"text-popup\" @click=\"closePopup\">\r\n\t\t<!-- 切换视图按钮 -->\r\n\t\t<div class=\"view-switcher\">\r\n\t\t\t<button\r\n\t\t\t\t@click.prevent.stop=\"switchView('text')\"\r\n\t\t\t\t:class=\"{ active: currentView === 'text' }\"\r\n\t\t\t\ttitle=\"文本视图\">\r\n\t\t\t\t<font-awesome-icon :icon=\"['fas', 'align-left']\" />\r\n\t\t\t</button>\r\n\r\n\t\t\t<button\r\n\t\t\t\t@click.prevent.stop=\"switchView('visual')\"\r\n\t\t\t\t:class=\"{ active: currentView === 'visual' }\"\r\n\t\t\t\ttitle=\"可视化视图\">\r\n\t\t\t\t<font-awesome-icon :icon=\"['fas', 'chart-bar']\" />\r\n\t\t\t</button>\r\n\t\t</div>\r\n\r\n\t\t<!-- 文本视图 -->\r\n\t\t<div v-if=\"currentView === 'text'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"isTable(selectedText)\"\r\n\t\t\t\tclass=\"table-container\"\r\n\t\t\t\tv-html=\"selectedText\"></div>\r\n\t\t\t<div v-else>\r\n\t\t\t\t<p>{{ selectedText }}</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 可视化视图 -->\r\n\t\t<div v-if=\"currentView === 'visual'\" class=\"visualization-container\">\r\n\t\t\t<div v-if=\"visualizationLoading\" class=\"loading-spinner\"></div>\r\n\t\t\t<div v-else-if=\"divId === 'div1'\" class=\"chart-container1\"></div>\r\n\t\t\t<div v-else class=\"chart-container2\"></div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\timport {\r\n\t\trenderLineChart,\r\n\t\trenderBarChart,\r\n\t\trenderPieChart,\r\n\t\trenderNonVisualChart\r\n\t} from \"@/js/chartUtils\";\r\n\r\n\tconst props = defineProps({\r\n\t\tselectedText: String,\r\n\t\tdivId: String\r\n\t});\r\n\r\n\tconst emit = defineEmits([\"close\"]);\r\n\r\n\tconst currentView = ref(\"text\"); // 当前视图模式：text 或 visual\r\n\tconst visualizationLoading = ref(false); // 可视化图表加载状态\r\n\r\n\t// 判断是否是表格内容\r\n\tconst isTable = content => {\r\n\t\treturn /<table.*?>.*?<\\/table>/s.test(content);\r\n\t};\r\n\r\n\t// 切换视图\r\n\tconst switchView = async view => {\r\n\t\tcurrentView.value = view;\r\n\t\tif (view === \"visual\") {\r\n\t\t\tvisualizationLoading.value = true;\r\n\t\t\tawait processText(); // 调用后端处理文本并渲染图表\r\n\t\t\tvisualizationLoading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\t// 获取可视化 JSON 数据\r\n\tasync function processText() {\r\n\t\ttry {\r\n\t\t\tapi.post(\r\n\t\t\t\t\"process_text\",\r\n\t\t\t\t{ text: props.selectedText.toString().trim() },\r\n\t\t\t\tdata => {\r\n\t\t\t\t\tif (data.error) {\r\n\t\t\t\t\t\tconsole.error(\"后端返回的错误:\", data.error);\r\n\t\t\t\t\t\talert(`处理文章内容时出错: ${data.message}`);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst jsonData = data.json_data;\r\n\t\t\t\t\tconsole.log(\"后端返回的数据:\", jsonData);\r\n\r\n\t\t\t\t\t// 根据 divId 选择容器\r\n\t\t\t\t\tconst container =\r\n\t\t\t\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\r\n\t\t\t\t\tif (data.data_type === \"Non-Visual\") {\r\n\t\t\t\t\t\trenderNonVisualChart(container, data, {\r\n\t\t\t\t\t\t\tmessage: \"当前数据无法可视化\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderChart(jsonData);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"处理文章内容时出错:\", error);\r\n\t\t\talert(\"处理文章内容时出错，请稍后重试\");\r\n\t\t}\r\n\t}\r\n\r\n\t// 渲染图表\r\n\tfunction renderChart(rawJsonData) {\r\n\t\tif (!rawJsonData || typeof rawJsonData !== \"object\" || !rawJsonData.data) {\r\n\t\t\tconst container =\r\n\t\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\t\t\trenderNonVisualChart(container, rawJsonData, {\r\n\t\t\t\tmessage: \"JSON 数据无效\"\r\n\t\t\t});\r\n\t\t\tconsole.error(\"JSON 数据无效:\", rawJsonData);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 根据 divId 选择容器\r\n\t\tconst container =\r\n\t\t\tprops.divId === \"div1\" ? \".chart-container1\" : \".chart-container2\";\r\n\r\n\t\t// 清空之前的图表\r\n\t\td3.select(container).html(\"\");\r\n\r\n\t\tconst chartType = rawJsonData.type;\r\n\t\tconst data = rawJsonData.data;\r\n\t\tconst options = rawJsonData.options || {};\r\n\r\n\t\t// 根据图表类型渲染\r\n\t\tif (chartType === \"line\") {\r\n\t\t\trenderLineChart(container, data, options);\r\n\t\t} else if (chartType === \"bar\") {\r\n\t\t\trenderBarChart(container, data, options);\r\n\t\t} else if (chartType === \"pie\") {\r\n\t\t\trenderPieChart(container, data, options);\r\n\t\t} else {\r\n\t\t\tconsole.error(\"未知的图表类型:\", chartType);\r\n\t\t}\r\n\t}\r\n\r\n\t// 关闭弹出框\r\n\tconst closePopup = () => {\r\n\t\temit(\"close\");\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.text-popup {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: 90%;\r\n\t\tmax-height: 80vh;\r\n\t\toverflow: auto;\r\n\t\tbackground: rgba(255, 255, 255, 0.98);\r\n\t\tpadding: 25px;\r\n\t\tbox-shadow: 0px 10px 30px rgba(0, 0, 0, 0.4);\r\n\t\tborder-radius: 12px;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 0.8vw;\r\n\t\tfont-weight: 500;\r\n\t\tline-height: 1.6;\r\n\t\tcolor: #333;\r\n\t\tz-index: 100;\r\n\t\tcursor: pointer;\r\n\t\tbackdrop-filter: blur(20px);\r\n\t\tanimation: fadeIn 0.3s ease-in-out;\r\n\t\tborder: 1px solid rgba(255, 255, 255, 0.2);\r\n\t\tmargin: 0;\r\n\t}\r\n\r\n\t.view-switcher {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n\r\n\t.view-switcher button {\r\n\t\tpadding: 8px;\r\n\t\tmargin: 0 5px;\r\n\t\tborder: none;\r\n\t\tborder-radius: 50%;\r\n\t\tbackground-color: #f0f0f0;\r\n\t\tcursor: pointer;\r\n\t\ttransition: background-color 0.3s ease, transform 0.2s ease;\r\n\t\twidth: 36px;\r\n\t\theight: 36px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.view-switcher button:hover {\r\n\t\tbackground-color: #ddd;\r\n\t\ttransform: scale(1.1);\r\n\t}\r\n\r\n\t.view-switcher button.active {\r\n\t\tbackground-color: #0077b6;\r\n\t\tcolor: white;\r\n\t}\r\n\r\n\t.view-switcher button i {\r\n\t\tfont-size: 16px;\r\n\t\tcolor: inherit;\r\n\t}\r\n\r\n\t.visualization-container {\r\n\t\twidth: 100%;\r\n\t\theight: 300px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}