{"ast":null,"code":"import { ref, onMounted, watch, computed } from \"vue\";\nimport * as d3 from \"d3\";\nexport default {\n  __name: 'SparklineChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    width: {\n      type: Number,\n      default: 250\n    },\n    height: {\n      type: Number,\n      default: 80\n    },\n    color: {\n      type: String,\n      default: \"#4a90e2\"\n    },\n    showDots: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartContainer = ref(null);\n    const hasData = computed(() => props.data?.length > 0);\n    const noDataMessage = computed(() => \"无数据\");\n    const drawChart = () => {\n      if (!chartContainer.value || !hasData.value) return;\n      d3.select(chartContainer.value).selectAll(\"*\").remove();\n      const margin = {\n        top: 5,\n        right: 5,\n        bottom: 5,\n        left: 5\n      };\n      const width = props.width - margin.left - margin.right;\n      const height = props.height - margin.top - margin.bottom;\n      const svg = d3.select(chartContainer.value).append(\"svg\").attr(\"width\", props.width).attr(\"height\", props.height).append(\"g\").attr(\"transform\", `translate(${margin.left},${margin.top})`);\n      const data = props.data.sort((a, b) => a.year - b.year);\n      const x = d3.scaleLinear().domain(d3.extent(data, d => d.year)).range([0, width]);\n      const y = d3.scaleLinear().domain([0, d3.max(data, d => d.value) * 1.1]).range([height, 0]);\n      const line = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);\n      svg.append(\"path\").datum(data).attr(\"fill\", \"none\").attr(\"stroke\", props.color).attr(\"stroke-width\", 2).attr(\"d\", line);\n      if (props.showDots) {\n        svg.selectAll(\".dot\").data(data).enter().append(\"circle\").attr(\"class\", \"dot\").attr(\"cx\", d => x(d.year)).attr(\"cy\", d => y(d.value)).attr(\"r\", 3).attr(\"fill\", props.color);\n      }\n    };\n    watch(() => [props.data, props.width, props.height, props.color], drawChart);\n    onMounted(drawChart);\n    const __returned__ = {\n      props,\n      chartContainer,\n      hasData,\n      noDataMessage,\n      drawChart,\n      ref,\n      onMounted,\n      watch,\n      computed,\n      get d3() {\n        return d3;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","computed","d3","props","__props","chartContainer","hasData","data","length","noDataMessage","drawChart","value","select","selectAll","remove","margin","top","right","bottom","left","width","height","svg","append","attr","sort","a","b","year","x","scaleLinear","domain","extent","d","range","y","max","line","curve","curveMonotoneX","datum","color","showDots","enter"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/SparklineChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"sparkline-container\">\r\n\t\t<div v-if=\"!hasData\" class=\"no-data-message\">\r\n\t\t\t{{ noDataMessage }}\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 250\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 80\r\n\t\t},\r\n\t\tcolor: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"#4a90e2\"\r\n\t\t},\r\n\t\tshowDots: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartContainer = ref(null);\r\n\tconst hasData = computed(() => props.data?.length > 0);\r\n\tconst noDataMessage = computed(() => \"无数据\");\r\n\r\n\tconst drawChart = () => {\r\n\t\tif (!chartContainer.value || !hasData.value) return;\r\n\r\n\t\td3.select(chartContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\tconst margin = { top: 5, right: 5, bottom: 5, left: 5 };\r\n\t\tconst width = props.width - margin.left - margin.right;\r\n\t\tconst height = props.height - margin.top - margin.bottom;\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(chartContainer.value)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", props.width)\r\n\t\t\t.attr(\"height\", props.height)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n\t\tconst data = props.data.sort((a, b) => a.year - b.year);\r\n\r\n\t\tconst x = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain(d3.extent(data, d => d.year))\r\n\t\t\t.range([0, width]);\r\n\r\n\t\tconst y = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain([0, d3.max(data, d => d.value) * 1.1])\r\n\t\t\t.range([height, 0]);\r\n\r\n\t\tconst line = d3\r\n\t\t\t.line()\r\n\t\t\t.x(d => x(d.year))\r\n\t\t\t.y(d => y(d.value))\r\n\t\t\t.curve(d3.curveMonotoneX);\r\n\r\n\t\tsvg\r\n\t\t\t.append(\"path\")\r\n\t\t\t.datum(data)\r\n\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t.attr(\"stroke\", props.color)\r\n\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t.attr(\"d\", line);\r\n\r\n\t\tif (props.showDots) {\r\n\t\t\tsvg\r\n\t\t\t\t.selectAll(\".dot\")\r\n\t\t\t\t.data(data)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"circle\")\r\n\t\t\t\t.attr(\"class\", \"dot\")\r\n\t\t\t\t.attr(\"cx\", d => x(d.year))\r\n\t\t\t\t.attr(\"cy\", d => y(d.value))\r\n\t\t\t\t.attr(\"r\", 3)\r\n\t\t\t\t.attr(\"fill\", props.color);\r\n\t\t}\r\n\t};\r\n\r\n\twatch(() => [props.data, props.width, props.height, props.color], drawChart);\r\n\tonMounted(drawChart);\r\n</script>\r\n\r\n<style scoped>\r\n\t.sparkline-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.no-data-message {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\tcolor: #94a3b8;\r\n\t\tfont-size: 12px;\r\n\t\ttext-align: center;\r\n\t\twidth: 100%;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}