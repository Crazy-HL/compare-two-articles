{"ast":null,"code":"import { ref, onMounted, onUnmounted, nextTick } from \"vue\";\nimport bus from \"@/js/eventBus.js\";\nexport default {\n  __name: 'ParentComponent',\n  props: {\n    pageTitle: String,\n    divId: String,\n    selectContentClass: String,\n    linkedOutline: Array\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n\n    // 状态定义...\n    const debugMode = ref(true);\n\n    // 安全事件发射器\n    const emitEvent = (eventName, payload) => {\n      if (!bus || !bus.emit) {\n        console.error(`[${props.divId}] 事件总线不可用`);\n        return;\n      }\n      const fullPayload = {\n        ...payload,\n        _source: props.divId,\n        _timestamp: Date.now()\n      };\n      if (debugMode.value) {\n        console.groupCollapsed(`[${props.divId}] 发射事件 ${eventName}`);\n        console.log(\"载荷:\", fullPayload);\n        console.groupEnd();\n      }\n      bus.emit(eventName, fullPayload);\n    };\n\n    // 修改后的处理函数\n    const handleSelectionWithSourceId = (content, sourceId, isTable) => {\n      // 更新当前组件状态\n      selectedText.value[props.divId] = content;\n      showPopup.value[props.divId] = true;\n      nextTick(updatePopupPosition);\n\n      // 主事件（必须触发）\n      emitEvent(`${props.divId}Event`, {\n        type: \"primary\",\n        content,\n        sourceId,\n        isTable\n      });\n\n      // 表格关联处理\n      if (isTable && sourceId) {\n        const {\n          linkedItem,\n          chapterContent\n        } = extractLinkedChapterContent(sourceId, props.divId);\n        if (linkedItem && chapterContent) {\n          const otherContainerId = props.divId === \"div1\" ? \"div3\" : \"div1\";\n          emitEvent(`${otherContainerId}Event`, {\n            type: \"linked\",\n            content: chapterContent,\n            sourceId,\n            linkedItem\n          });\n\n          // 滚动到关联位置\n          const targetId = props.divId === \"div1\" ? linkedItem.rightId : linkedItem.leftId;\n          document.getElementById(targetId)?.scrollIntoView({\n            behavior: \"smooth\"\n          });\n        }\n      }\n    };\n\n    // 事件监听\n    const eventHandler = data => {\n      if (data?.type === \"linked\") {\n        selectedText.value[props.divId] = data.content;\n        showPopup.value[props.divId] = true;\n        nextTick(updatePopupPosition);\n      }\n    };\n    onMounted(() => {\n      // mitt特有写法：用 * 监听所有事件（调试用）\n      if (debugMode.value) {\n        bus.on(\"*\", (type, e) => console.log(`[全局监听] ${type}`, e));\n      }\n\n      // 监听当前组件事件\n      bus.on(`${props.divId}Event`, eventHandler);\n      bus.on(`${props.divId}_Event`, eventHandler); // 兼容旧版\n    });\n    onUnmounted(() => {\n      // mitt不需要指定处理函数即可移除\n      bus.off(`${props.divId}Event`);\n      bus.off(`${props.divId}_Event`);\n    });\n    const __returned__ = {\n      props,\n      debugMode,\n      emitEvent,\n      handleSelectionWithSourceId,\n      eventHandler,\n      ref,\n      onMounted,\n      onUnmounted,\n      nextTick,\n      get bus() {\n        return bus;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","nextTick","bus","props","__props","debugMode","emitEvent","eventName","payload","emit","console","error","divId","fullPayload","_source","_timestamp","Date","now","value","groupCollapsed","log","groupEnd","handleSelectionWithSourceId","content","sourceId","isTable","selectedText","showPopup","updatePopupPosition","type","linkedItem","chapterContent","extractLinkedChapterContent","otherContainerId","targetId","rightId","leftId","document","getElementById","scrollIntoView","behavior","eventHandler","data","on","e","off"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/ParentComponent.vue"],"sourcesContent":["<template>\r\n\t<div :class=\"['div0', selectContentClass]\" :id=\"divId\" ref=\"divRef\">\r\n\t\t<h1>{{ pageTitle }}</h1>\r\n\t\t<LoadingSpinner v-if=\"loading\" />\r\n\t\t<ErrorDisplay\r\n\t\t\tv-else-if=\"error\"\r\n\t\t\t:message=\"error\"\r\n\t\t\t@retry=\"fetchWikipediaContent\" />\r\n\t\t<WikipediaContent v-else :content=\"pageHtml\" @select=\"handleSelection\" />\r\n\t\t<TextPopup\r\n\t\t\t:visible=\"showPopup[divId]\"\r\n\t\t\t:content=\"selectedText[divId]\"\r\n\t\t\t:containerClass=\"\r\n\t\t\t\tdivId === 'div1' ? 'chart-container1' : 'chart-container2'\r\n\t\t\t\"\r\n\t\t\t:containerRef=\"divRef\"\r\n\t\t\t@close=\"closePopup\" />\r\n\t\t<ArticleOutline :content=\"pageHtml\" :divId=\"divId\" />\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted, nextTick } from \"vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\r\n\tconst props = defineProps({\r\n\t\tpageTitle: String,\r\n\t\tdivId: String,\r\n\t\tselectContentClass: String,\r\n\t\tlinkedOutline: Array\r\n\t});\r\n\r\n\t// 状态定义...\r\n\tconst debugMode = ref(true);\r\n\r\n\t// 安全事件发射器\r\n\tconst emitEvent = (eventName, payload) => {\r\n\t\tif (!bus || !bus.emit) {\r\n\t\t\tconsole.error(`[${props.divId}] 事件总线不可用`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fullPayload = {\r\n\t\t\t...payload,\r\n\t\t\t_source: props.divId,\r\n\t\t\t_timestamp: Date.now()\r\n\t\t};\r\n\r\n\t\tif (debugMode.value) {\r\n\t\t\tconsole.groupCollapsed(`[${props.divId}] 发射事件 ${eventName}`);\r\n\t\t\tconsole.log(\"载荷:\", fullPayload);\r\n\t\t\tconsole.groupEnd();\r\n\t\t}\r\n\r\n\t\tbus.emit(eventName, fullPayload);\r\n\t};\r\n\r\n\t// 修改后的处理函数\r\n\tconst handleSelectionWithSourceId = (content, sourceId, isTable) => {\r\n\t\t// 更新当前组件状态\r\n\t\tselectedText.value[props.divId] = content;\r\n\t\tshowPopup.value[props.divId] = true;\r\n\t\tnextTick(updatePopupPosition);\r\n\r\n\t\t// 主事件（必须触发）\r\n\t\temitEvent(`${props.divId}Event`, {\r\n\t\t\ttype: \"primary\",\r\n\t\t\tcontent,\r\n\t\t\tsourceId,\r\n\t\t\tisTable\r\n\t\t});\r\n\r\n\t\t// 表格关联处理\r\n\t\tif (isTable && sourceId) {\r\n\t\t\tconst { linkedItem, chapterContent } = extractLinkedChapterContent(\r\n\t\t\t\tsourceId,\r\n\t\t\t\tprops.divId\r\n\t\t\t);\r\n\t\t\tif (linkedItem && chapterContent) {\r\n\t\t\t\tconst otherContainerId = props.divId === \"div1\" ? \"div3\" : \"div1\";\r\n\t\t\t\temitEvent(`${otherContainerId}Event`, {\r\n\t\t\t\t\ttype: \"linked\",\r\n\t\t\t\t\tcontent: chapterContent,\r\n\t\t\t\t\tsourceId,\r\n\t\t\t\t\tlinkedItem\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 滚动到关联位置\r\n\t\t\t\tconst targetId =\r\n\t\t\t\t\tprops.divId === \"div1\" ? linkedItem.rightId : linkedItem.leftId;\r\n\t\t\t\tdocument\r\n\t\t\t\t\t.getElementById(targetId)\r\n\t\t\t\t\t?.scrollIntoView({ behavior: \"smooth\" });\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 事件监听\r\n\tconst eventHandler = data => {\r\n\t\tif (data?.type === \"linked\") {\r\n\t\t\tselectedText.value[props.divId] = data.content;\r\n\t\t\tshowPopup.value[props.divId] = true;\r\n\t\t\tnextTick(updatePopupPosition);\r\n\t\t}\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\t// mitt特有写法：用 * 监听所有事件（调试用）\r\n\t\tif (debugMode.value) {\r\n\t\t\tbus.on(\"*\", (type, e) => console.log(`[全局监听] ${type}`, e));\r\n\t\t}\r\n\r\n\t\t// 监听当前组件事件\r\n\t\tbus.on(`${props.divId}Event`, eventHandler);\r\n\t\tbus.on(`${props.divId}_Event`, eventHandler); // 兼容旧版\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\t// mitt不需要指定处理函数即可移除\r\n\t\tbus.off(`${props.divId}Event`);\r\n\t\tbus.off(`${props.divId}_Event`);\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\th1 {\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t/* 文章容器 */\r\n\t.div0 {\r\n\t\tposition: relative;\r\n\t\twidth: 55%;\r\n\t\tmax-width: 100%;\r\n\t\tmax-height: 100%;\r\n\t\toverflow: auto;\r\n\t\tpadding: 20px;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t#div1,\r\n\t#div3 {\r\n\t\twidth: 55%;\r\n\t\tmax-width: 100%;\r\n\t\tmax-height: 100%;\r\n\t\toverflow: auto;\r\n\t\tpadding: 20px;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.showHtml {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\toverflow: auto;\r\n\t}\r\n\r\n\t/* 选中文本的高亮样式 */\r\n\t::selection {\r\n\t\tbackground-color: yellow;\r\n\t\tcolor: black;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}