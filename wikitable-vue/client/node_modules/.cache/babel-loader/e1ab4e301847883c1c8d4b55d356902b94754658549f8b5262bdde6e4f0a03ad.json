{"ast":null,"code":"import { ref, onMounted, onUnmounted } from \"vue\"; // 导入 onUnmounted\nimport ParentComponent from \"@/components/compoents_base/ParentComponent.vue\";\nimport bus from \"@/js/eventBus.js\";\nexport default {\n  __name: 'Div1',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const outline = ref([]);\n    const activeChapter = ref(null);\n\n    // 提取大纲\n    const extractOutline = htmlContent => {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(htmlContent, \"text/html\");\n      const headings = doc.querySelectorAll(\"h1, h2, h3, h4, h5, h6\");\n      const chapters = Array.from(headings).map(heading => {\n        const id = heading.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g, \"-\").replace(/^-+|-+$/g, \"\");\n        if (!heading.id) {\n          heading.id = id;\n        }\n        return {\n          id: heading.id,\n          text: heading.textContent.trim(),\n          level: parseInt(heading.tagName.replace(\"H\", \"\"), 10)\n        };\n      });\n      return chapters;\n    };\n\n    // 滚动到指定章节\n    const scrollToChapter = chapterId => {\n      const escapedId = CSS.escape(chapterId);\n      const chapterElement = document.querySelector(`#${escapedId}`);\n      if (chapterElement) {\n        chapterElement.scrollIntoView({\n          behavior: \"smooth\"\n        });\n        activeChapter.value = chapterId;\n        bus.emit(\"syncOutline\", {\n          chapterId,\n          source: \"div1\"\n        });\n      }\n    };\n\n    // 监听文章内容加载完成\n    onMounted(() => {\n      bus.on(\"contentLoaded\", data => {\n        if (data.divId === \"div1\") {\n          outline.value = extractOutline(data.content);\n        }\n      });\n    });\n\n    // 监听大纲同步事件\n    onMounted(() => {\n      bus.on(\"syncOutline\", data => {\n        if (data.source !== \"div1\") {\n          scrollToChapter(data.chapterId);\n        }\n      });\n    });\n\n    // 组件卸载时解绑事件\n    onUnmounted(() => {\n      bus.off(\"contentLoaded\");\n      bus.off(\"syncOutline\");\n    });\n    const __returned__ = {\n      outline,\n      activeChapter,\n      extractOutline,\n      scrollToChapter,\n      ref,\n      onMounted,\n      onUnmounted,\n      ParentComponent,\n      get bus() {\n        return bus;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","ParentComponent","bus","outline","activeChapter","extractOutline","htmlContent","parser","DOMParser","doc","parseFromString","headings","querySelectorAll","chapters","Array","from","map","heading","id","textContent","trim","toLowerCase","replace","text","level","parseInt","tagName","scrollToChapter","chapterId","escapedId","CSS","escape","chapterElement","document","querySelector","scrollIntoView","behavior","value","emit","source","on","data","divId","content","off"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/Div1.vue"],"sourcesContent":["<script setup>\r\n\timport { ref, onMounted, onUnmounted } from \"vue\"; // 导入 onUnmounted\r\n\timport ParentComponent from \"@/components/compoents_base/ParentComponent.vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\r\n\tconst outline = ref([]);\r\n\tconst activeChapter = ref(null);\r\n\r\n\t// 提取大纲\r\n\tconst extractOutline = htmlContent => {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(htmlContent, \"text/html\");\r\n\t\tconst headings = doc.querySelectorAll(\"h1, h2, h3, h4, h5, h6\");\r\n\t\tconst chapters = Array.from(headings).map(heading => {\r\n\t\t\tconst id = heading.textContent\r\n\t\t\t\t.trim()\r\n\t\t\t\t.toLowerCase()\r\n\t\t\t\t.replace(/[^a-z0-9]+/g, \"-\")\r\n\t\t\t\t.replace(/^-+|-+$/g, \"\");\r\n\r\n\t\t\tif (!heading.id) {\r\n\t\t\t\theading.id = id;\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tid: heading.id,\r\n\t\t\t\ttext: heading.textContent.trim(),\r\n\t\t\t\tlevel: parseInt(heading.tagName.replace(\"H\", \"\"), 10)\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn chapters;\r\n\t};\r\n\r\n\t// 滚动到指定章节\r\n\tconst scrollToChapter = chapterId => {\r\n\t\tconst escapedId = CSS.escape(chapterId);\r\n\t\tconst chapterElement = document.querySelector(`#${escapedId}`);\r\n\t\tif (chapterElement) {\r\n\t\t\tchapterElement.scrollIntoView({ behavior: \"smooth\" });\r\n\t\t\tactiveChapter.value = chapterId;\r\n\t\t\tbus.emit(\"syncOutline\", { chapterId, source: \"div1\" });\r\n\t\t}\r\n\t};\r\n\r\n\t// 监听文章内容加载完成\r\n\tonMounted(() => {\r\n\t\tbus.on(\"contentLoaded\", data => {\r\n\t\t\tif (data.divId === \"div1\") {\r\n\t\t\t\toutline.value = extractOutline(data.content);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t// 监听大纲同步事件\r\n\tonMounted(() => {\r\n\t\tbus.on(\"syncOutline\", data => {\r\n\t\t\tif (data.source !== \"div1\") {\r\n\t\t\t\tscrollToChapter(data.chapterId);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t// 组件卸载时解绑事件\r\n\tonUnmounted(() => {\r\n\t\tbus.off(\"contentLoaded\");\r\n\t\tbus.off(\"syncOutline\");\r\n\t});\r\n</script>\r\n"],"mappings":"AACC,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAK,CAAC,CAAC;AACnD,OAAOC,eAAe,MAAM,iDAAiD;AAC7E,OAAOC,GAAG,MAAM,kBAAkB;;;;;;;;IAElC,MAAMC,OAAO,GAAGL,GAAG,CAAC,EAAE,CAAC;IACvB,MAAMM,aAAa,GAAGN,GAAG,CAAC,IAAI,CAAC;;IAE/B;IACA,MAAMO,cAAc,GAAGC,WAAW,IAAI;MACrC,MAAMC,MAAM,GAAG,IAAIC,SAAS,CAAC,CAAC;MAC9B,MAAMC,GAAG,GAAGF,MAAM,CAACG,eAAe,CAACJ,WAAW,EAAE,WAAW,CAAC;MAC5D,MAAMK,QAAQ,GAAGF,GAAG,CAACG,gBAAgB,CAAC,wBAAwB,CAAC;MAC/D,MAAMC,QAAQ,GAAGC,KAAK,CAACC,IAAI,CAACJ,QAAQ,CAAC,CAACK,GAAG,CAACC,OAAO,IAAI;QACpD,MAAMC,EAAE,GAAGD,OAAO,CAACE,WAAW,CAC5BC,IAAI,CAAC,CAAC,CACNC,WAAW,CAAC,CAAC,CACbC,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,CAC3BA,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;QAEzB,IAAI,CAACL,OAAO,CAACC,EAAE,EAAE;UAChBD,OAAO,CAACC,EAAE,GAAGA,EAAE;QAChB;QAEA,OAAO;UACNA,EAAE,EAAED,OAAO,CAACC,EAAE;UACdK,IAAI,EAAEN,OAAO,CAACE,WAAW,CAACC,IAAI,CAAC,CAAC;UAChCI,KAAK,EAAEC,QAAQ,CAACR,OAAO,CAACS,OAAO,CAACJ,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;QACrD,CAAC;MACF,CAAC,CAAC;MACF,OAAOT,QAAQ;IAChB,CAAC;;IAED;IACA,MAAMc,eAAe,GAAGC,SAAS,IAAI;MACpC,MAAMC,SAAS,GAAGC,GAAG,CAACC,MAAM,CAACH,SAAS,CAAC;MACvC,MAAMI,cAAc,GAAGC,QAAQ,CAACC,aAAa,CAAC,IAAIL,SAAS,EAAE,CAAC;MAC9D,IAAIG,cAAc,EAAE;QACnBA,cAAc,CAACG,cAAc,CAAC;UAAEC,QAAQ,EAAE;QAAS,CAAC,CAAC;QACrDhC,aAAa,CAACiC,KAAK,GAAGT,SAAS;QAC/B1B,GAAG,CAACoC,IAAI,CAAC,aAAa,EAAE;UAAEV,SAAS;UAAEW,MAAM,EAAE;QAAO,CAAC,CAAC;MACvD;IACD,CAAC;;IAED;IACAxC,SAAS,CAAC,MAAM;MACfG,GAAG,CAACsC,EAAE,CAAC,eAAe,EAAEC,IAAI,IAAI;QAC/B,IAAIA,IAAI,CAACC,KAAK,KAAK,MAAM,EAAE;UAC1BvC,OAAO,CAACkC,KAAK,GAAGhC,cAAc,CAACoC,IAAI,CAACE,OAAO,CAAC;QAC7C;MACD,CAAC,CAAC;IACH,CAAC,CAAC;;IAEF;IACA5C,SAAS,CAAC,MAAM;MACfG,GAAG,CAACsC,EAAE,CAAC,aAAa,EAAEC,IAAI,IAAI;QAC7B,IAAIA,IAAI,CAACF,MAAM,KAAK,MAAM,EAAE;UAC3BZ,eAAe,CAACc,IAAI,CAACb,SAAS,CAAC;QAChC;MACD,CAAC,CAAC;IACH,CAAC,CAAC;;IAEF;IACA5B,WAAW,CAAC,MAAM;MACjBE,GAAG,CAAC0C,GAAG,CAAC,eAAe,CAAC;MACxB1C,GAAG,CAAC0C,GAAG,CAAC,aAAa,CAAC;IACvB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}