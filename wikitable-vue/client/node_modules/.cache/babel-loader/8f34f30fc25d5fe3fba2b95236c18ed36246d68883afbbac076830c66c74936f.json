{"ast":null,"code":"import { computed, ref } from \"vue\";\nexport default {\n  __name: 'SparklineChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => [],\n      validator: value => {\n        if (!Array.isArray(value)) return false;\n        return value.every(item => item && typeof item.year !== \"undefined\" && typeof item.value !== \"undefined\");\n      }\n    },\n    width: {\n      type: Number,\n      default: 180\n    },\n    height: {\n      type: Number,\n      default: 80\n    },\n    showTooltip: {\n      type: Boolean,\n      default: true\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const hoverIndex = ref(null);\n    const showTooltipFlag = ref(false);\n    const tooltipX = ref(0);\n    const tooltipY = ref(0);\n\n    // 处理数据点，确保有效性\n    const dataPoints = computed(() => {\n      if (!Array.isArray(props.data)) return [];\n      return [...props.data].filter(item => item && !isNaN(item.year) && !isNaN(item.value)).sort((a, b) => a.year - b.year);\n    });\n    const timeLabels = computed(() => {\n      return dataPoints.value.map(item => item.year);\n    });\n    const values = computed(() => {\n      return dataPoints.value.map(item => item.value);\n    });\n    const formattedValue = value => {\n      if (value >= 1000000) {\n        return `$${(value / 1000000).toFixed(1)}M`;\n      }\n      if (value >= 1000) {\n        return `$${(value / 1000).toFixed(1)}K`;\n      }\n      return value.toLocaleString();\n    };\n    const xScale = computed(() => {\n      if (dataPoints.value.length < 2) return () => 0;\n      const years = dataPoints.value.map(item => item.year);\n      const minYear = Math.min(...years);\n      const maxYear = Math.max(...years);\n      const yearRange = maxYear - minYear;\n      return year => {\n        return (year - minYear) / yearRange * (props.width - 20) + 10;\n      };\n    });\n    const yScale = computed(() => {\n      if (values.value.length === 0) return () => 0;\n      const minValue = Math.min(...values.value);\n      const maxValue = Math.max(...values.value);\n      const valueRange = maxValue - minValue || 1;\n      return value => {\n        return props.height - 10 - (value - minValue) / valueRange * (props.height - 20);\n      };\n    });\n    const points = computed(() => {\n      return dataPoints.value.map((item, index) => ({\n        x: xScale.value(item.year),\n        y: yScale.value(item.value),\n        originalData: item\n      }));\n    });\n    const linePath = computed(() => {\n      if (points.value.length < 2) return \"\";\n      let path = `M${points.value[0].x},${points.value[0].y}`;\n      for (let i = 1; i < points.value.length; i++) {\n        const prev = points.value[i - 1];\n        const curr = points.value[i];\n        const controlX = (prev.x + curr.x) / 2;\n        path += ` C${controlX},${prev.y} ${controlX},${curr.y} ${curr.x},${curr.y}`;\n      }\n      return path;\n    });\n    const showTooltip = (event, point) => {\n      if (!props.showTooltip) return;\n      const svgRect = event.target.closest(\"svg\").getBoundingClientRect();\n      const mouseX = event.clientX - svgRect.left;\n      let closestIndex = 0;\n      let minDistance = Infinity;\n      points.value.forEach((p, index) => {\n        const distance = Math.abs(p.x - mouseX);\n        if (distance < minDistance) {\n          minDistance = distance;\n          closestIndex = index;\n        }\n      });\n      hoverIndex.value = closestIndex;\n      tooltipX.value = Math.min(points.value[closestIndex].x - 60, props.width - 120);\n      tooltipY.value = points.value[closestIndex].y - 70;\n      showTooltipFlag.value = true;\n    };\n    const hideTooltip = () => {\n      showTooltipFlag.value = false;\n      hoverIndex.value = null;\n    };\n    const __returned__ = {\n      props,\n      hoverIndex,\n      showTooltipFlag,\n      tooltipX,\n      tooltipY,\n      dataPoints,\n      timeLabels,\n      values,\n      formattedValue,\n      xScale,\n      yScale,\n      points,\n      linePath,\n      showTooltip,\n      hideTooltip,\n      computed,\n      ref\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","ref","props","__props","hoverIndex","showTooltipFlag","tooltipX","tooltipY","dataPoints","Array","isArray","data","filter","item","isNaN","year","value","sort","a","b","timeLabels","map","values","formattedValue","toFixed","toLocaleString","xScale","length","years","minYear","Math","min","maxYear","max","yearRange","width","yScale","minValue","maxValue","valueRange","height","points","index","x","y","originalData","linePath","path","i","prev","curr","controlX","showTooltip","event","point","svgRect","target","closest","getBoundingClientRect","mouseX","clientX","left","closestIndex","minDistance","Infinity","forEach","p","distance","abs","hideTooltip"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/SparklineChart.vue"],"sourcesContent":["<template>\r\n\t<svg :width=\"width\" :height=\"height\" class=\"sparkline-container\">\r\n\t\t<!-- 背景区域 -->\r\n\t\t<rect width=\"100%\" height=\"100%\" fill=\"#f8fafc\" />\r\n\r\n\t\t<!-- 折线路径 -->\r\n\t\t<path :d=\"linePath\" stroke=\"#4a90e2\" stroke-width=\"2\" fill=\"none\" />\r\n\r\n\t\t<!-- 数据点 -->\r\n\t\t<circle\r\n\t\t\tv-for=\"(point, index) in points\"\r\n\t\t\t:key=\"index\"\r\n\t\t\t:cx=\"point.x\"\r\n\t\t\t:cy=\"point.y\"\r\n\t\t\tr=\"3\"\r\n\t\t\tfill=\"#4a90e2\"\r\n\t\t\t@mouseover=\"showTooltip($event, point)\"\r\n\t\t\t@mouseout=\"hideTooltip\" />\r\n\r\n\t\t<!-- 鼠标悬停时的指示线 -->\r\n\t\t<line\r\n\t\t\tv-if=\"hoverIndex !== null\"\r\n\t\t\t:x1=\"points[hoverIndex].x\"\r\n\t\t\t:x2=\"points[hoverIndex].x\"\r\n\t\t\ty1=\"0\"\r\n\t\t\t:y2=\"height\"\r\n\t\t\tstroke=\"#64748b\"\r\n\t\t\tstroke-width=\"1\"\r\n\t\t\tstroke-dasharray=\"2,2\" />\r\n\r\n\t\t<!-- 工具提示 -->\r\n\t\t<foreignObject\r\n\t\t\tv-if=\"hoverIndex !== null && showTooltipFlag\"\r\n\t\t\t:x=\"tooltipX\"\r\n\t\t\t:y=\"tooltipY\"\r\n\t\t\twidth=\"120\"\r\n\t\t\theight=\"60\"\r\n\t\t\tclass=\"tooltip-container\">\r\n\t\t\t<div class=\"tooltip\">\r\n\t\t\t\t<div class=\"tooltip-year\">{{ timeLabels[hoverIndex] }}</div>\r\n\t\t\t\t<div class=\"tooltip-value\">\r\n\t\t\t\t\t{{ formattedValue(dataPoints[hoverIndex].value) }}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"dataPoints[hoverIndex].recordName\" class=\"tooltip-name\">\r\n\t\t\t\t\t{{ dataPoints[hoverIndex].recordName }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</foreignObject>\r\n\t</svg>\r\n</template>\r\n\r\n<script setup>\r\n\timport { computed, ref } from \"vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [],\r\n\t\t\tvalidator: value => {\r\n\t\t\t\tif (!Array.isArray(value)) return false;\r\n\t\t\t\treturn value.every(\r\n\t\t\t\t\titem =>\r\n\t\t\t\t\t\titem &&\r\n\t\t\t\t\t\ttypeof item.year !== \"undefined\" &&\r\n\t\t\t\t\t\ttypeof item.value !== \"undefined\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 180\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 80\r\n\t\t},\r\n\t\tshowTooltip: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t});\r\n\r\n\tconst hoverIndex = ref(null);\r\n\tconst showTooltipFlag = ref(false);\r\n\tconst tooltipX = ref(0);\r\n\tconst tooltipY = ref(0);\r\n\r\n\t// 处理数据点，确保有效性\r\n\tconst dataPoints = computed(() => {\r\n\t\tif (!Array.isArray(props.data)) return [];\r\n\r\n\t\treturn [...props.data]\r\n\t\t\t.filter(item => item && !isNaN(item.year) && !isNaN(item.value))\r\n\t\t\t.sort((a, b) => a.year - b.year);\r\n\t});\r\n\r\n\tconst timeLabels = computed(() => {\r\n\t\treturn dataPoints.value.map(item => item.year);\r\n\t});\r\n\r\n\tconst values = computed(() => {\r\n\t\treturn dataPoints.value.map(item => item.value);\r\n\t});\r\n\r\n\tconst formattedValue = value => {\r\n\t\tif (value >= 1000000) {\r\n\t\t\treturn `$${(value / 1000000).toFixed(1)}M`;\r\n\t\t}\r\n\t\tif (value >= 1000) {\r\n\t\t\treturn `$${(value / 1000).toFixed(1)}K`;\r\n\t\t}\r\n\t\treturn value.toLocaleString();\r\n\t};\r\n\r\n\tconst xScale = computed(() => {\r\n\t\tif (dataPoints.value.length < 2) return () => 0;\r\n\r\n\t\tconst years = dataPoints.value.map(item => item.year);\r\n\t\tconst minYear = Math.min(...years);\r\n\t\tconst maxYear = Math.max(...years);\r\n\t\tconst yearRange = maxYear - minYear;\r\n\r\n\t\treturn year => {\r\n\t\t\treturn ((year - minYear) / yearRange) * (props.width - 20) + 10;\r\n\t\t};\r\n\t});\r\n\r\n\tconst yScale = computed(() => {\r\n\t\tif (values.value.length === 0) return () => 0;\r\n\r\n\t\tconst minValue = Math.min(...values.value);\r\n\t\tconst maxValue = Math.max(...values.value);\r\n\t\tconst valueRange = maxValue - minValue || 1;\r\n\r\n\t\treturn value => {\r\n\t\t\treturn (\r\n\t\t\t\tprops.height -\r\n\t\t\t\t10 -\r\n\t\t\t\t((value - minValue) / valueRange) * (props.height - 20)\r\n\t\t\t);\r\n\t\t};\r\n\t});\r\n\r\n\tconst points = computed(() => {\r\n\t\treturn dataPoints.value.map((item, index) => ({\r\n\t\t\tx: xScale.value(item.year),\r\n\t\t\ty: yScale.value(item.value),\r\n\t\t\toriginalData: item\r\n\t\t}));\r\n\t});\r\n\r\n\tconst linePath = computed(() => {\r\n\t\tif (points.value.length < 2) return \"\";\r\n\r\n\t\tlet path = `M${points.value[0].x},${points.value[0].y}`;\r\n\r\n\t\tfor (let i = 1; i < points.value.length; i++) {\r\n\t\t\tconst prev = points.value[i - 1];\r\n\t\t\tconst curr = points.value[i];\r\n\t\t\tconst controlX = (prev.x + curr.x) / 2;\r\n\r\n\t\t\tpath += ` C${controlX},${prev.y} ${controlX},${curr.y} ${curr.x},${curr.y}`;\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t});\r\n\r\n\tconst showTooltip = (event, point) => {\r\n\t\tif (!props.showTooltip) return;\r\n\r\n\t\tconst svgRect = event.target.closest(\"svg\").getBoundingClientRect();\r\n\t\tconst mouseX = event.clientX - svgRect.left;\r\n\r\n\t\tlet closestIndex = 0;\r\n\t\tlet minDistance = Infinity;\r\n\r\n\t\tpoints.value.forEach((p, index) => {\r\n\t\t\tconst distance = Math.abs(p.x - mouseX);\r\n\t\t\tif (distance < minDistance) {\r\n\t\t\t\tminDistance = distance;\r\n\t\t\t\tclosestIndex = index;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\thoverIndex.value = closestIndex;\r\n\t\ttooltipX.value = Math.min(\r\n\t\t\tpoints.value[closestIndex].x - 60,\r\n\t\t\tprops.width - 120\r\n\t\t);\r\n\t\ttooltipY.value = points.value[closestIndex].y - 70;\r\n\t\tshowTooltipFlag.value = true;\r\n\t};\r\n\r\n\tconst hideTooltip = () => {\r\n\t\tshowTooltipFlag.value = false;\r\n\t\thoverIndex.value = null;\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.sparkline-container {\r\n\t\tfont-family: system-ui, -apple-system, sans-serif;\r\n\t}\r\n\r\n\t.tooltip-container {\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.tooltip {\r\n\t\tbackground: white;\r\n\t\tborder: 1px solid #e2e8f0;\r\n\t\tborder-radius: 4px;\r\n\t\tpadding: 8px;\r\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n\t\tfont-size: 12px;\r\n\t}\r\n\r\n\t.tooltip-year {\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #334155;\r\n\t\tmargin-bottom: 4px;\r\n\t}\r\n\r\n\t.tooltip-value {\r\n\t\tcolor: #1e40af;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.tooltip-name {\r\n\t\tcolor: #64748b;\r\n\t\tmargin-top: 4px;\r\n\t\tfont-size: 11px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}