{"ast":null,"code":"const MouseSelection = {\n  // 高亮样式类名\n  highlightClass: 'mouse-selection-highlight',\n  debounce(fn) {\n    let time = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;\n    let timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      clearTimeout(timeout);\n      timeout = setTimeout(() => fn.apply(this, args), time);\n    };\n  },\n  // 创建高亮元素\n  createHighlightNode() {\n    const span = document.createElement('span');\n    span.className = this.highlightClass;\n    return span;\n  },\n  // 高亮选中区域\n  highlightSelection() {\n    const selection = window.getSelection();\n    if (!selection.rangeCount) return;\n    const range = selection.getRangeAt(0);\n    const highlightNode = this.createHighlightNode();\n    try {\n      range.surroundContents(highlightNode);\n    } catch (e) {\n      // 处理无法包裹的情况（如跨元素选择）\n      const contents = range.extractContents();\n      highlightNode.appendChild(contents);\n      range.insertNode(highlightNode);\n    }\n    selection.removeAllRanges();\n  },\n  // 清除所有高亮\n  removeHighlights() {\n    document.querySelectorAll(`.${this.highlightClass}`).forEach(node => {\n      const parent = node.parentNode;\n      parent.replaceChild(document.createTextNode(node.textContent), node);\n      parent.normalize();\n    });\n  },\n  getSelectContent() {\n    let customId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    this.removeHighlights(); // 清除旧高亮\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return null;\n    const range = selection.getRangeAt(0);\n    let result = null;\n    try {\n      this.highlightSelection(); // 添加高亮\n\n      const content = selection.toString().trim();\n      const isHTML = range.cloneContents().childElementCount > 0;\n      result = {\n        type: isHTML ? 'html' : 'text',\n        content: isHTML ? range.cloneContents() : content,\n        customId,\n        rawSelection: selection,\n        range: range.cloneRange()\n      };\n    } catch (e) {\n      console.error('Error processing selection:', e);\n    }\n    return result;\n  },\n  getSpNode(parent) {\n    const nodeNameList = ['iframe', 'svg', 'img', 'audio', 'video'];\n    return Array.from(parent.children).some(node => {\n      if (nodeNameList.includes(node.nodeName.toLowerCase())) return true;\n      return node.children ? this.getSpNode(node) : false;\n    });\n  },\n  start() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      rangeSelector,\n      customId,\n      onSelect = console.log,\n      enableHighlight = true\n    } = options;\n    const rangeElement = rangeSelector ? document.querySelector(rangeSelector) : document;\n    if (!rangeElement) {\n      console.error('Invalid range selector');\n      return;\n    }\n    let isSelecting = false;\n    const handleSelection = this.debounce(() => {\n      if (!isSelecting) return;\n      const content = this.getSelectContent(customId);\n      if (content) {\n        onSelect({\n          ...content,\n          // 提供取消高亮的方法\n          removeHighlight: () => this.removeHighlights()\n        });\n      }\n      isSelecting = false;\n    }, 100);\n    rangeElement.addEventListener('mousedown', () => {\n      isSelecting = true;\n      if (!enableHighlight) this.removeHighlights();\n    });\n    rangeElement.addEventListener('mouseup', handleSelection);\n    rangeElement.addEventListener('selectionchange', handleSelection);\n\n    // 添加样式（建议在全局CSS中定义）\n    if (!document.querySelector(`.${this.highlightClass}`)) {\n      const style = document.createElement('style');\n      style.textContent = `\n        .${this.highlightClass} {\n          background-color: rgba(255,255,0,0.3);\n          cursor: pointer;\n          transition: background-color 0.3s;\n        }\n        .${this.highlightClass}:hover {\n          background-color: rgba(255,200,0,0.5);\n        }\n      `;\n      document.head.appendChild(style);\n    }\n  }\n};\nexport default MouseSelection;","map":{"version":3,"names":["MouseSelection","highlightClass","debounce","fn","time","arguments","length","undefined","timeout","_len","args","Array","_key","clearTimeout","setTimeout","apply","createHighlightNode","span","document","createElement","className","highlightSelection","selection","window","getSelection","rangeCount","range","getRangeAt","highlightNode","surroundContents","e","contents","extractContents","appendChild","insertNode","removeAllRanges","removeHighlights","querySelectorAll","forEach","node","parent","parentNode","replaceChild","createTextNode","textContent","normalize","getSelectContent","customId","isCollapsed","result","content","toString","trim","isHTML","cloneContents","childElementCount","type","rawSelection","cloneRange","console","error","getSpNode","nodeNameList","from","children","some","includes","nodeName","toLowerCase","start","options","rangeSelector","onSelect","log","enableHighlight","rangeElement","querySelector","isSelecting","handleSelection","removeHighlight","addEventListener","style","head"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/js/mouse_selection.js"],"sourcesContent":["const MouseSelection = {\r\n  // 高亮样式类名\r\n  highlightClass: 'mouse-selection-highlight',\r\n  \r\n  debounce(fn, time = 500) {\r\n    let timeout = null;\r\n    return function (...args) {\r\n      clearTimeout(timeout);\r\n      timeout = setTimeout(() => fn.apply(this, args), time);\r\n    };\r\n  },\r\n\r\n  // 创建高亮元素\r\n  createHighlightNode() {\r\n    const span = document.createElement('span');\r\n    span.className = this.highlightClass;\r\n    return span;\r\n  },\r\n\r\n  // 高亮选中区域\r\n  highlightSelection() {\r\n    const selection = window.getSelection();\r\n    if (!selection.rangeCount) return;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const highlightNode = this.createHighlightNode();\r\n    \r\n    try {\r\n      range.surroundContents(highlightNode);\r\n    } catch (e) {\r\n      // 处理无法包裹的情况（如跨元素选择）\r\n      const contents = range.extractContents();\r\n      highlightNode.appendChild(contents);\r\n      range.insertNode(highlightNode);\r\n    }\r\n    \r\n    selection.removeAllRanges();\r\n  },\r\n\r\n  // 清除所有高亮\r\n  removeHighlights() {\r\n    document.querySelectorAll(`.${this.highlightClass}`).forEach(node => {\r\n      const parent = node.parentNode;\r\n      parent.replaceChild(document.createTextNode(node.textContent), node);\r\n      parent.normalize();\r\n    });\r\n  },\r\n\r\n  getSelectContent(customId = null) {\r\n    this.removeHighlights(); // 清除旧高亮\r\n    const selection = window.getSelection();\r\n    \r\n    if (!selection || selection.isCollapsed) return null;\r\n\r\n    const range = selection.getRangeAt(0);\r\n    let result = null;\r\n\r\n    try {\r\n      this.highlightSelection(); // 添加高亮\r\n      \r\n      const content = selection.toString().trim();\r\n      const isHTML = range.cloneContents().childElementCount > 0;\r\n\r\n      result = {\r\n        type: isHTML ? 'html' : 'text',\r\n        content: isHTML ? range.cloneContents() : content,\r\n        customId,\r\n        rawSelection: selection,\r\n        range: range.cloneRange()\r\n      };\r\n    } catch (e) {\r\n      console.error('Error processing selection:', e);\r\n    }\r\n\r\n    return result;\r\n  },\r\n\r\n  getSpNode(parent) {\r\n    const nodeNameList = ['iframe', 'svg', 'img', 'audio', 'video'];\r\n    return Array.from(parent.children).some(node => {\r\n      if (nodeNameList.includes(node.nodeName.toLowerCase())) return true;\r\n      return node.children ? this.getSpNode(node) : false;\r\n    });\r\n  },\r\n\r\n  start(options = {}) {\r\n    const { \r\n      rangeSelector, \r\n      customId,\r\n      onSelect = console.log,\r\n      enableHighlight = true\r\n    } = options;\r\n\r\n    const rangeElement = rangeSelector \r\n      ? document.querySelector(rangeSelector) \r\n      : document;\r\n\r\n    if (!rangeElement) {\r\n      console.error('Invalid range selector');\r\n      return;\r\n    }\r\n\r\n    let isSelecting = false;\r\n\r\n    const handleSelection = this.debounce(() => {\r\n      if (!isSelecting) return;\r\n      \r\n      const content = this.getSelectContent(customId);\r\n      if (content) {\r\n        onSelect({\r\n          ...content,\r\n          // 提供取消高亮的方法\r\n          removeHighlight: () => this.removeHighlights()\r\n        });\r\n      }\r\n      isSelecting = false;\r\n    }, 100);\r\n\r\n    rangeElement.addEventListener('mousedown', () => {\r\n      isSelecting = true;\r\n      if (!enableHighlight) this.removeHighlights();\r\n    });\r\n\r\n    rangeElement.addEventListener('mouseup', handleSelection);\r\n    rangeElement.addEventListener('selectionchange', handleSelection);\r\n\r\n    // 添加样式（建议在全局CSS中定义）\r\n    if (!document.querySelector(`.${this.highlightClass}`)) {\r\n      const style = document.createElement('style');\r\n      style.textContent = `\r\n        .${this.highlightClass} {\r\n          background-color: rgba(255,255,0,0.3);\r\n          cursor: pointer;\r\n          transition: background-color 0.3s;\r\n        }\r\n        .${this.highlightClass}:hover {\r\n          background-color: rgba(255,200,0,0.5);\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n  }\r\n};\r\n\r\nexport default MouseSelection;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}