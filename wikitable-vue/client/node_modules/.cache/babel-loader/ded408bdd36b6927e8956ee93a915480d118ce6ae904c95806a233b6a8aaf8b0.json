{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-201e19b8\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"full-chart\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"full-text\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"chart-container\",\n  ref: \"chartContainer\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"no-data\"\n};\nconst _hoisted_5 = {\n  key: 0,\n  class: \"chart-container\",\n  ref: \"chartContainer\"\n};\nconst _hoisted_6 = {\n  key: 1,\n  class: \"no-data\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"chart-container\",\n  ref: \"chartContainer\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"no-data\"\n};\nconst _hoisted_9 = {\n  class: \"full-text\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" 文本显示 \"), $props.visualization === 'text-only' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.formattedText, (item, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"text-item\"\n    }, _toDisplayString(item), 1 /* TEXT */);\n  }), 128 /* KEYED_FRAGMENT */))])) : $props.visualization === 'pie-chart' ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 1\n  }, [_createCommentVNode(\" 完整饼图 \"), $setup.hasData ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, null, 512 /* NEED_PATCH */)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \"无可用数据\"))], 64 /* STABLE_FRAGMENT */)) : $props.visualization === 'bar-chart' ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 2\n  }, [_createCommentVNode(\" 完整柱状图 \"), $setup.hasData ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, null, 512 /* NEED_PATCH */)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_6, \"无可用数据\"))], 64 /* STABLE_FRAGMENT */)) : $props.visualization === 'line-chart' ? (_openBlock(), _createElementBlock(_Fragment, {\n    key: 3\n  }, [_createCommentVNode(\" 完整折线图 \"), $setup.hasData ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, null, 512 /* NEED_PATCH */)) : (_openBlock(), _createElementBlock(\"div\", _hoisted_8, \"无可用数据\"))], 64 /* STABLE_FRAGMENT */)) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 4\n  }, [_createCommentVNode(\" 默认显示 \"), _createElementVNode(\"div\", _hoisted_9, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.formattedText, (item, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"text-item\"\n    }, _toDisplayString(item), 1 /* TEXT */);\n  }), 128 /* KEYED_FRAGMENT */))])], 64 /* STABLE_FRAGMENT */))]);\n}","map":{"version":3,"names":["class","key","ref","_createElementBlock","_hoisted_1","_createCommentVNode","$props","visualization","_hoisted_2","_Fragment","_renderList","$setup","formattedText","item","index","hasData","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_createElementVNode","_hoisted_9"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\FullChart.vue"],"sourcesContent":["<template>\r\n\t<div class=\"full-chart\">\r\n\t\t<!-- 文本显示 -->\r\n\t\t<template v-if=\"visualization === 'text-only'\">\r\n\t\t\t<div class=\"full-text\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(item, index) in formattedText\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\tclass=\"text-item\">\r\n\t\t\t\t\t{{ item }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 完整饼图 -->\r\n\t\t<template v-else-if=\"visualization === 'pie-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"chart-container\" ref=\"chartContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">无可用数据</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 完整柱状图 -->\r\n\t\t<template v-else-if=\"visualization === 'bar-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"chart-container\" ref=\"chartContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">无可用数据</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 完整折线图 -->\r\n\t\t<template v-else-if=\"visualization === 'line-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"chart-container\" ref=\"chartContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">无可用数据</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 默认显示 -->\r\n\t\t<template v-else>\r\n\t\t\t<div class=\"full-text\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(item, index) in formattedText\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\tclass=\"text-item\">\r\n\t\t\t\t\t{{ item }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</template>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { computed, onMounted, ref, watch } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tfield: [Object, Array, String, Number],\r\n\t\ttype: String,\r\n\t\tvisualization: String,\r\n\t\tfieldKey: String\r\n\t});\r\n\r\n\tconst chartContainer = ref(null);\r\n\r\n\tconst renderChart = () => {\r\n\t\tconst container = chartContainer.value;\r\n\t\tconst width = container.clientWidth;\r\n\t\tconst height = container.clientHeight;\r\n\t\tconst margin = { top: 20, right: 30, bottom: 40, left: 40 };\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(container)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n\t\tif (props.visualization === \"bar-chart\") {\r\n\t\t\tconst data = barChartData();\r\n\t\t\tconst x = d3\r\n\t\t\t\t.scaleBand()\r\n\t\t\t\t.domain(data.map(d => d.name))\r\n\t\t\t\t.range([0, width - margin.left - margin.right])\r\n\t\t\t\t.padding(0.1);\r\n\r\n\t\t\tconst y = d3\r\n\t\t\t\t.scaleLinear()\r\n\t\t\t\t.domain([0, d3.max(data, d => d.value)])\r\n\t\t\t\t.nice()\r\n\t\t\t\t.range([height - margin.top - margin.bottom, 0]);\r\n\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"x-axis\")\r\n\t\t\t\t.attr(\r\n\t\t\t\t\t\"transform\",\r\n\t\t\t\t\t`translate(0,${height - margin.top - margin.bottom})`\r\n\t\t\t\t)\r\n\t\t\t\t.call(d3.axisBottom(x));\r\n\r\n\t\t\tsvg.append(\"g\").attr(\"class\", \"y-axis\").call(d3.axisLeft(y));\r\n\r\n\t\t\tsvg\r\n\t\t\t\t.selectAll(\".bar\")\r\n\t\t\t\t.data(data)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"rect\")\r\n\t\t\t\t.attr(\"class\", \"bar\")\r\n\t\t\t\t.attr(\"x\", d => x(d.name))\r\n\t\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t\t.attr(\"height\", d => y(0) - y(d.value))\r\n\t\t\t\t.attr(\"fill\", \"#3498db\")\r\n\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\td3.select(this).attr(\"fill\", \"#2980b9\");\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\t\td3.select(this).attr(\"fill\", \"#3498db\");\r\n\t\t\t\t});\r\n\r\n\t\t\t// 添加图注\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"x\", width / 2)\r\n\t\t\t\t.attr(\"y\", -10)\r\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t.style(\"font-size\", \"16px\")\r\n\t\t\t\t.text(\"柱状图\");\r\n\t\t} else if (props.visualization === \"pie-chart\") {\r\n\t\t\tconst data = pieChartData();\r\n\t\t\tconst radius = Math.min(width, height) / 2;\r\n\r\n\t\t\tconst pie = d3.pie().value(d => d.value);\r\n\t\t\tconst arc = d3.arc().innerRadius(0).outerRadius(radius);\r\n\r\n\t\t\tconst arcs = svg\r\n\t\t\t\t.selectAll(\".arc\")\r\n\t\t\t\t.data(pie(data))\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"arc\")\r\n\t\t\t\t.attr(\"transform\", `translate(${width / 2},${height / 2})`);\r\n\r\n\t\t\tarcs\r\n\t\t\t\t.append(\"path\")\r\n\t\t\t\t.attr(\"d\", arc)\r\n\t\t\t\t.attr(\"fill\", (d, i) => d3.schemeCategory10[i % 10])\r\n\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\td3.select(this).attr(\"opacity\", 0.7);\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\t\td3.select(this).attr(\"opacity\", 1);\r\n\t\t\t\t});\r\n\r\n\t\t\t// 添加图注\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"x\", width / 2)\r\n\t\t\t\t.attr(\"y\", -10)\r\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t.style(\"font-size\", \"16px\")\r\n\t\t\t\t.text(\"饼图\");\r\n\t\t} else if (props.visualization === \"line-chart\") {\r\n\t\t\tconst data = lineChartData();\r\n\t\t\tconst x = d3\r\n\t\t\t\t.scaleLinear()\r\n\t\t\t\t.domain([0, data.length - 1])\r\n\t\t\t\t.range([0, width - margin.left - margin.right]);\r\n\r\n\t\t\tconst y = d3\r\n\t\t\t\t.scaleLinear()\r\n\t\t\t\t.domain([d3.min(data, d => d.value), d3.max(data, d => d.value)])\r\n\t\t\t\t.nice()\r\n\t\t\t\t.range([height - margin.top - margin.bottom, 0]);\r\n\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"x-axis\")\r\n\t\t\t\t.attr(\r\n\t\t\t\t\t\"transform\",\r\n\t\t\t\t\t`translate(0,${height - margin.top - margin.bottom})`\r\n\t\t\t\t)\r\n\t\t\t\t.call(d3.axisBottom(x));\r\n\r\n\t\t\tsvg.append(\"g\").attr(\"class\", \"y-axis\").call(d3.axisLeft(y));\r\n\r\n\t\t\tconst line = d3\r\n\t\t\t\t.line()\r\n\t\t\t\t.x((d, i) => x(i))\r\n\t\t\t\t.y(d => y(d.value))\r\n\t\t\t\t.curve(d3.curveMonotoneX);\r\n\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"path\")\r\n\t\t\t\t.datum(data)\r\n\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t.attr(\"stroke\", \"#3498db\")\r\n\t\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t\t.attr(\"d\", line);\r\n\r\n\t\t\t// 添加图注\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"x\", width / 2)\r\n\t\t\t\t.attr(\"y\", -10)\r\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t.style(\"font-size\", \"16px\")\r\n\t\t\t\t.text(\"折线图\");\r\n\t\t}\r\n\t};\r\n\r\n\tconst barChartData = () => {\r\n\t\tif (!props.field) return [];\r\n\t\tif (Array.isArray(props.field)) {\r\n\t\t\treturn props.field.map((item, index) => ({\r\n\t\t\t\tname: item.raw || `项目${index + 1}`,\r\n\t\t\t\tvalue: safeToNumber(item.value || item.raw)\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: props.field.raw || \"项目\",\r\n\t\t\t\tvalue: safeToNumber(props.field.value || props.field.raw)\r\n\t\t\t}\r\n\t\t];\r\n\t};\r\n\r\n\tconst pieChartData = () => {\r\n\t\tif (!props.field) return [];\r\n\t\tif (Array.isArray(props.field)) {\r\n\t\t\treturn props.field.map((item, index) => ({\r\n\t\t\t\tname: item.raw || `项目${index + 1}`,\r\n\t\t\t\tvalue: safeToNumber(item.value || item.raw)\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tname: props.field.raw || \"项目\",\r\n\t\t\t\tvalue: safeToNumber(props.field.value || props.field.raw)\r\n\t\t\t}\r\n\t\t];\r\n\t};\r\n\r\n\tconst lineChartData = () => {\r\n\t\tif (!props.field) return [];\r\n\t\tif (Array.isArray(props.field)) {\r\n\t\t\treturn props.field.map((item, index) => ({\r\n\t\t\t\tvalue: safeToNumber(item.value || item.raw)\r\n\t\t\t}));\r\n\t\t}\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tvalue: safeToNumber(props.field.value || props.field.raw)\r\n\t\t\t}\r\n\t\t];\r\n\t};\r\n\r\n\tconst safeToNumber = value => {\r\n\t\tif (value === null || value === undefined) return 0;\r\n\t\tif (typeof value === \"number\") return value;\r\n\t\tif (typeof value === \"string\") {\r\n\t\t\tconst numStr = value.toString().replace(/[^0-9.-]/g, \"\");\r\n\t\t\tconst num = parseFloat(numStr);\r\n\t\t\treturn isNaN(num) ? 0 : num;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\r\n\t// 格式化文本\r\n\tconst formattedText = computed(() => {\r\n\t\tif (!props.field) return [\"-\"];\r\n\r\n\t\tif (Array.isArray(props.field)) {\r\n\t\t\treturn props.field.map(item => {\r\n\t\t\t\tif (typeof item === \"object\") {\r\n\t\t\t\t\tlet text = \"\";\r\n\t\t\t\t\tif (item.raw) text = item.raw;\r\n\t\t\t\t\telse if (item.value) text = item.value;\r\n\t\t\t\t\telse text = JSON.stringify(item);\r\n\r\n\t\t\t\t\tif (item.unit) text += ` ${item.unit}`;\r\n\t\t\t\t\tif (item.year) text += ` (${item.year})`;\r\n\t\t\t\t\treturn text;\r\n\t\t\t\t}\r\n\t\t\t\treturn item.toString();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (typeof props.field === \"object\") {\r\n\t\t\tlet text = \"\";\r\n\t\t\tif (props.field.raw) text = props.field.raw;\r\n\t\t\telse if (props.field.value) text = props.field.value;\r\n\t\t\telse text = JSON.stringify(props.field);\r\n\r\n\t\t\tif (props.field.unit) text += ` ${props.field.unit}`;\r\n\t\t\tif (props.field.year) text += ` (${props.field.year})`;\r\n\t\t\treturn [text];\r\n\t\t}\r\n\r\n\t\treturn [props.field.toString()];\r\n\t});\r\n\r\n\tconst hasData = computed(() => {\r\n\t\tif (!props.field) return false;\r\n\t\tif (Array.isArray(props.field)) return props.field.length > 0;\r\n\t\tif (typeof props.field === \"object\")\r\n\t\t\treturn Object.keys(props.field).length > 0;\r\n\t\treturn String(props.field).trim().length > 0;\r\n\t});\r\n\r\n\tonMounted(() => {\r\n\t\trenderChart();\r\n\t});\r\n\r\n\twatch(() => [props.field, props.visualization], renderChart);\r\n</script>\r\n\r\n<style scoped>\r\n\t.full-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.full-text {\r\n\t\tpadding: 10px;\r\n\t}\r\n\r\n\t.text-item {\r\n\t\tmargin-bottom: 8px;\r\n\t\tpadding: 5px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t}\r\n\r\n\t.chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 300px;\r\n\t}\r\n\r\n\t.no-data {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 100%;\r\n\t\tcolor: #999;\r\n\t\tfont-style: italic;\r\n\t}\r\n</style>\r\n"],"mappings":";;;EACMA,KAAK,EAAC;AAAY;;EADxBC,GAAA;EAIQD,KAAK,EAAC;;;EAJdC,GAAA;EAgBuBD,KAAK,EAAC,iBAAiB;EAACE,GAAG,EAAC;;;EAhBnDD,GAAA;EAiBeD,KAAK,EAAC;;;EAjBrBC,GAAA;EAsBuBD,KAAK,EAAC,iBAAiB;EAACE,GAAG,EAAC;;;EAtBnDD,GAAA;EAuBeD,KAAK,EAAC;;;EAvBrBC,GAAA;EA4BuBD,KAAK,EAAC,iBAAiB;EAACE,GAAG,EAAC;;;EA5BnDD,GAAA;EA6BeD,KAAK,EAAC;;;EAKbA,KAAK,EAAC;AAAW;;uBAjCxBG,mBAAA,CA0CM,OA1CNC,UA0CM,GAzCLC,mBAAA,UAAa,EACGC,MAAA,CAAAC,aAAa,oB,cAC5BJ,mBAAA,CAOM,OAPNK,UAOM,I,kBANLL,mBAAA,CAKMM,SAAA,QAVVC,WAAA,CAM6BC,MAAA,CAAAC,aAAa,EAN1C,CAMaC,IAAI,EAAEC,KAAK;yBADpBX,mBAAA,CAKM;MAHJF,GAAG,EAAEa,KAAK;MACXd,KAAK,EAAC;wBACHa,IAAI;sCAMWP,MAAA,CAAAC,aAAa,oB,cAAlCJ,mBAAA,CAGWM,SAAA;IAlBbR,GAAA;EAAA,IAcEI,mBAAA,UAAa,EAEDM,MAAA,CAAAI,OAAO,I,cAAlBZ,mBAAA,CAAuE,OAAvEa,UAAuE,kC,cACvEb,mBAAA,CAAuC,OAAvCc,UAAuC,EAAX,OAAK,G,+BAIbX,MAAA,CAAAC,aAAa,oB,cAAlCJ,mBAAA,CAGWM,SAAA;IAxBbR,GAAA;EAAA,IAoBEI,mBAAA,WAAc,EAEFM,MAAA,CAAAI,OAAO,I,cAAlBZ,mBAAA,CAAuE,OAAvEe,UAAuE,kC,cACvEf,mBAAA,CAAuC,OAAvCgB,UAAuC,EAAX,OAAK,G,+BAIbb,MAAA,CAAAC,aAAa,qB,cAAlCJ,mBAAA,CAGWM,SAAA;IA9BbR,GAAA;EAAA,IA0BEI,mBAAA,WAAc,EAEFM,MAAA,CAAAI,OAAO,I,cAAlBZ,mBAAA,CAAuE,OAAvEiB,UAAuE,kC,cACvEjB,mBAAA,CAAuC,OAAvCkB,UAAuC,EAAX,OAAK,G,8CAIlClB,mBAAA,CASWM,SAAA;IA1CbR,GAAA;EAAA,IAgCEI,mBAAA,UAAa,EAEZiB,mBAAA,CAOM,OAPNC,UAOM,I,kBANLpB,mBAAA,CAKMM,SAAA,QAxCVC,WAAA,CAoC6BC,MAAA,CAAAC,aAAa,EApC1C,CAoCaC,IAAI,EAAEC,KAAK;yBADpBX,mBAAA,CAKM;MAHJF,GAAG,EAAEa,KAAK;MACXd,KAAK,EAAC;wBACHa,IAAI","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}