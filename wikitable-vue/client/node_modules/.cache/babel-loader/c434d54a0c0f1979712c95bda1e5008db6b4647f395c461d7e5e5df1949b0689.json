{"ast":null,"code":"import { ref, onMounted, watch } from \"vue\";\nimport * as d3 from \"d3\";\n\n// 使用defineProps定义props\n\nexport default {\n  __name: 'DataVisualization',\n  props: {\n    data: Array,\n    type: String,\n    config: Object\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartContainer = ref(null);\n    const drawChart = () => {\n      const container = chartContainer.value;\n      if (!container) return;\n\n      // 清空容器\n      container.innerHTML = \"\";\n      const width = props.config.maxWidth || 250;\n      const height = props.config.maxHeight || 80;\n      const svg = d3.select(container).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n      if (props.type === \"bar\") {\n        drawBarChart(svg, width, height);\n      } else if (props.type === \"pie\") {\n        drawPieChart(svg, width, height);\n      }\n    };\n    const drawBarChart = (svg, width, height) => {\n      const x = d3.scaleBand().domain(props.data.map((d, i) => i)).range([0, width]).padding(0.1);\n      const y = d3.scaleLinear().domain([0, d3.max(props.data, d => d.value)]).range([height, 0]);\n      svg.selectAll(\"rect\").data(props.data).enter().append(\"rect\").attr(\"x\", (_, i) => x(i)).attr(\"y\", d => y(d.value)).attr(\"width\", x.bandwidth()).attr(\"height\", d => height - y(d.value)).attr(\"fill\", props.config.color || \"#4a90e2\");\n    };\n    const drawPieChart = (svg, width, height) => {\n      const radius = Math.min(width, height) / 2;\n      const arc = d3.arc().innerRadius(0).outerRadius(radius);\n      const pie = d3.pie().value(d => d.value);\n      const g = svg.append(\"g\").attr(\"transform\", `translate(${width / 2}, ${height / 2})`);\n      g.selectAll(\"path\").data(pie(props.data)).enter().append(\"path\").attr(\"d\", arc).attr(\"fill\", (d, i) => d3.schemeCategory10[i % 10]);\n    };\n    onMounted(drawChart);\n    watch(() => [props.data, props.type, props.config], drawChart, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartContainer,\n      drawChart,\n      drawBarChart,\n      drawPieChart,\n      ref,\n      onMounted,\n      watch,\n      get d3() {\n        return d3;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","d3","props","__props","chartContainer","drawChart","container","value","innerHTML","width","config","maxWidth","height","maxHeight","svg","select","append","attr","type","drawBarChart","drawPieChart","x","scaleBand","domain","data","map","d","i","range","padding","y","scaleLinear","max","selectAll","enter","_","bandwidth","color","radius","Math","min","arc","innerRadius","outerRadius","pie","g","schemeCategory10","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/DataVisualization.vue"],"sourcesContent":["<template>\r\n\t<div class=\"data-visualization\" ref=\"chartContainer\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\t// 使用defineProps定义props\r\n\tconst props = defineProps({\r\n\t\tdata: Array,\r\n\t\ttype: String,\r\n\t\tconfig: Object\r\n\t});\r\n\r\n\tconst chartContainer = ref(null);\r\n\r\n\tconst drawChart = () => {\r\n\t\tconst container = chartContainer.value;\r\n\t\tif (!container) return;\r\n\r\n\t\t// 清空容器\r\n\t\tcontainer.innerHTML = \"\";\r\n\r\n\t\tconst width = props.config.maxWidth || 250;\r\n\t\tconst height = props.config.maxHeight || 80;\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(container)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height);\r\n\r\n\t\tif (props.type === \"bar\") {\r\n\t\t\tdrawBarChart(svg, width, height);\r\n\t\t} else if (props.type === \"pie\") {\r\n\t\t\tdrawPieChart(svg, width, height);\r\n\t\t}\r\n\t};\r\n\r\n\tconst drawBarChart = (svg, width, height) => {\r\n\t\tconst x = d3\r\n\t\t\t.scaleBand()\r\n\t\t\t.domain(props.data.map((d, i) => i))\r\n\t\t\t.range([0, width])\r\n\t\t\t.padding(0.1);\r\n\r\n\t\tconst y = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain([0, d3.max(props.data, d => d.value)])\r\n\t\t\t.range([height, 0]);\r\n\r\n\t\tsvg\r\n\t\t\t.selectAll(\"rect\")\r\n\t\t\t.data(props.data)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"x\", (_, i) => x(i))\r\n\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t.attr(\"height\", d => height - y(d.value))\r\n\t\t\t.attr(\"fill\", props.config.color || \"#4a90e2\");\r\n\t};\r\n\r\n\tconst drawPieChart = (svg, width, height) => {\r\n\t\tconst radius = Math.min(width, height) / 2;\r\n\t\tconst arc = d3.arc().innerRadius(0).outerRadius(radius);\r\n\t\tconst pie = d3.pie().value(d => d.value);\r\n\r\n\t\tconst g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${width / 2}, ${height / 2})`);\r\n\r\n\t\tg.selectAll(\"path\")\r\n\t\t\t.data(pie(props.data))\r\n\t\t\t.enter()\r\n\t\t\t.append(\"path\")\r\n\t\t\t.attr(\"d\", arc)\r\n\t\t\t.attr(\"fill\", (d, i) => d3.schemeCategory10[i % 10]);\r\n\t};\r\n\r\n\tonMounted(drawChart);\r\n\twatch(() => [props.data, props.type, props.config], drawChart, {\r\n\t\tdeep: true\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.data-visualization {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}