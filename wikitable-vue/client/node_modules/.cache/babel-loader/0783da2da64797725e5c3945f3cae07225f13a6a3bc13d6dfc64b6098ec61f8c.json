{"ast":null,"code":"import \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, computed, watch, onMounted, onBeforeUnmount } from \"vue\";\nimport SparklineChart from \"./SparklineChart.vue\";\nimport FullChart from \"./FullChart.vue\";\nimport InfoboxField from \"./InfoboxField.vue\";\nimport { debounce } from \"lodash-es\";\nexport default {\n  __name: 'CompareTable',\n  props: {\n    div1RawData: String,\n    div3RawData: String,\n    div1InfoboxData: {\n      type: Object,\n      default: () => ({\n        title: \"\",\n        type: \"none\",\n        data: {}\n      })\n    },\n    div3InfoboxData: {\n      type: Object,\n      default: () => ({\n        title: \"\",\n        type: \"none\",\n        data: {}\n      })\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n\n    // 视图模式状态\n    const viewMode = ref(\"chart\");\n\n    // 信息框数据（使用默认值初始化）\n    const leftInfobox = ref({\n      title: \"加载中...\",\n      type: \"none\",\n      data: {}\n    });\n    const rightInfobox = ref({\n      title: \"加载中...\",\n      type: \"none\",\n      data: {}\n    });\n\n    // 安全访问方法\n    const safeInfoboxTitle = infobox => {\n      return infobox?.title || \"无标题\";\n    };\n    const getSafeInfoboxValue = (infobox, field) => {\n      if (!infobox?.data) return null;\n      return infobox.data[field] || null;\n    };\n    const getFieldDataType = (infobox, field) => {\n      const fieldData = getSafeInfoboxValue(infobox, field);\n      if (!fieldData) return \"\";\n      return fieldData.dataType || (fieldData.links?.length ? \"link\" : fieldData.image ? \"image\" : \"text\");\n    };\n\n    // 计算属性\n    const hasInfoboxData = computed(() => {\n      const leftHasData = leftInfobox.value.data && Object.keys(leftInfobox.value.data).length > 0;\n      const rightHasData = rightInfobox.value.data && Object.keys(rightInfobox.value.data).length > 0;\n      return leftHasData || rightHasData;\n    });\n    const commonInfoboxFields = computed(() => {\n      const leftFields = leftInfobox.value.data ? Object.keys(leftInfobox.value.data) : [];\n      const rightFields = rightInfobox.value.data ? Object.keys(rightInfobox.value.data) : [];\n      return [...new Set([...leftFields, ...rightFields])].filter(Boolean).sort();\n    });\n\n    // 监听props变化\n    watch(() => props.div1InfoboxData, newData => {\n      try {\n        leftInfobox.value = {\n          title: newData?.title || \"无标题\",\n          type: newData?.type || \"未知类型\",\n          data: newData?.data || {}\n        };\n      } catch (e) {\n        console.error(\"Failed to process left infobox:\", e);\n        leftInfobox.value = {\n          title: \"数据错误\",\n          type: \"error\",\n          data: {}\n        };\n      }\n    }, {\n      immediate: true,\n      deep: true\n    });\n    watch(() => props.div3InfoboxData, newData => {\n      try {\n        rightInfobox.value = {\n          title: newData?.title || \"无标题\",\n          type: newData?.type || \"未知类型\",\n          data: newData?.data || {}\n        };\n      } catch (e) {\n        console.error(\"Failed to process right infobox:\", e);\n        rightInfobox.value = {\n          title: \"数据错误\",\n          type: \"error\",\n          data: {}\n        };\n      }\n    }, {\n      immediate: true,\n      deep: true\n    });\n\n    // 调试方法\n    onMounted(() => {\n      window.debugCompareTable = {\n        leftInfobox,\n        rightInfobox,\n        props,\n        computed: {\n          hasInfoboxData,\n          commonInfoboxFields\n        }\n      };\n      console.log(\"Debug info available at window.debugCompareTable\");\n    });\n    const __returned__ = {\n      props,\n      viewMode,\n      leftInfobox,\n      rightInfobox,\n      safeInfoboxTitle,\n      getSafeInfoboxValue,\n      getFieldDataType,\n      hasInfoboxData,\n      commonInfoboxFields,\n      ref,\n      computed,\n      watch,\n      onMounted,\n      onBeforeUnmount,\n      SparklineChart,\n      FullChart,\n      InfoboxField,\n      get debounce() {\n        return debounce;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","watch","onMounted","onBeforeUnmount","SparklineChart","FullChart","InfoboxField","debounce","props","__props","viewMode","leftInfobox","title","type","data","rightInfobox","safeInfoboxTitle","infobox","getSafeInfoboxValue","field","getFieldDataType","fieldData","dataType","links","length","image","hasInfoboxData","leftHasData","value","Object","keys","rightHasData","commonInfoboxFields","leftFields","rightFields","Set","filter","Boolean","sort","div1InfoboxData","newData","e","console","error","immediate","deep","div3InfoboxData","window","debugCompareTable","log"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/CompareTable.vue"],"sourcesContent":["<template>\r\n\t<div class=\"compare-container\" ref=\"containerRef\">\r\n\t\t<div class=\"mode-toggle\">\r\n\t\t\t<button\r\n\t\t\t\t:class=\"{ active: viewMode === 'chart' }\"\r\n\t\t\t\t@click=\"viewMode = 'chart'\">\r\n\t\t\t\t图表对比模式\r\n\t\t\t</button>\r\n\t\t\t<button\r\n\t\t\t\t:class=\"{ active: viewMode === 'infobox' }\"\r\n\t\t\t\t@click=\"viewMode = 'infobox'\"\r\n\t\t\t\t:disabled=\"!hasInfoboxData\">\r\n\t\t\t\t信息框对比模式\r\n\t\t\t</button>\r\n\t\t</div>\r\n\r\n\t\t<div v-if=\"viewMode === 'chart'\" class=\"table-grid\">\r\n\t\t\t<!-- 图表对比模式内容保持不变 -->\r\n\t\t</div>\r\n\r\n\t\t<div v-else class=\"infobox-grid\">\r\n\t\t\t<div class=\"header left-column\">\r\n\t\t\t\t{{ safeInfoboxTitle(leftInfobox) }}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"header middle-column\">属性</div>\r\n\t\t\t<div class=\"header right-column\">\r\n\t\t\t\t{{ safeInfoboxTitle(rightInfobox) }}\r\n\t\t\t</div>\r\n\r\n\t\t\t<template v-if=\"hasInfoboxData\">\r\n\t\t\t\t<template v-for=\"field in commonInfoboxFields\" :key=\"field\">\r\n\t\t\t\t\t<div class=\"cell left-column\">\r\n\t\t\t\t\t\t<InfoboxField :value=\"getSafeInfoboxValue(leftInfobox, field)\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"cell middle-column\">\r\n\t\t\t\t\t\t<div class=\"attribute-name\">{{ field }}</div>\r\n\t\t\t\t\t\t<div class=\"data-type\">\r\n\t\t\t\t\t\t\t{{ getFieldDataType(leftInfobox, field) }}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"cell right-column\">\r\n\t\t\t\t\t\t<InfoboxField :value=\"getSafeInfoboxValue(rightInfobox, field)\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</template>\r\n\t\t\t<div v-else class=\"no-infobox-data\">\r\n\t\t\t\t<div class=\"no-data-message\">未找到可对比的信息框数据</div>\r\n\t\t\t\t<div class=\"suggestion\">请尝试其他页面或切换到图表对比模式</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 完整图表弹窗保持不变 -->\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, computed, watch, onMounted, onBeforeUnmount } from \"vue\";\r\n\timport SparklineChart from \"./SparklineChart.vue\";\r\n\timport FullChart from \"./FullChart.vue\";\r\n\timport InfoboxField from \"./InfoboxField.vue\";\r\n\timport { debounce } from \"lodash-es\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdiv1RawData: String,\r\n\t\tdiv3RawData: String,\r\n\t\tdiv1InfoboxData: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\ttype: \"none\",\r\n\t\t\t\tdata: {}\r\n\t\t\t})\r\n\t\t},\r\n\t\tdiv3InfoboxData: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({\r\n\t\t\t\ttitle: \"\",\r\n\t\t\t\ttype: \"none\",\r\n\t\t\t\tdata: {}\r\n\t\t\t})\r\n\t\t}\r\n\t});\r\n\r\n\t// 视图模式状态\r\n\tconst viewMode = ref(\"chart\");\r\n\r\n\t// 信息框数据（使用默认值初始化）\r\n\tconst leftInfobox = ref({\r\n\t\ttitle: \"加载中...\",\r\n\t\ttype: \"none\",\r\n\t\tdata: {}\r\n\t});\r\n\tconst rightInfobox = ref({\r\n\t\ttitle: \"加载中...\",\r\n\t\ttype: \"none\",\r\n\t\tdata: {}\r\n\t});\r\n\r\n\t// 安全访问方法\r\n\tconst safeInfoboxTitle = infobox => {\r\n\t\treturn infobox?.title || \"无标题\";\r\n\t};\r\n\r\n\tconst getSafeInfoboxValue = (infobox, field) => {\r\n\t\tif (!infobox?.data) return null;\r\n\t\treturn infobox.data[field] || null;\r\n\t};\r\n\r\n\tconst getFieldDataType = (infobox, field) => {\r\n\t\tconst fieldData = getSafeInfoboxValue(infobox, field);\r\n\t\tif (!fieldData) return \"\";\r\n\t\treturn (\r\n\t\t\tfieldData.dataType ||\r\n\t\t\t(fieldData.links?.length ? \"link\" : fieldData.image ? \"image\" : \"text\")\r\n\t\t);\r\n\t};\r\n\r\n\t// 计算属性\r\n\tconst hasInfoboxData = computed(() => {\r\n\t\tconst leftHasData =\r\n\t\t\tleftInfobox.value.data && Object.keys(leftInfobox.value.data).length > 0;\r\n\t\tconst rightHasData =\r\n\t\t\trightInfobox.value.data &&\r\n\t\t\tObject.keys(rightInfobox.value.data).length > 0;\r\n\t\treturn leftHasData || rightHasData;\r\n\t});\r\n\r\n\tconst commonInfoboxFields = computed(() => {\r\n\t\tconst leftFields = leftInfobox.value.data\r\n\t\t\t? Object.keys(leftInfobox.value.data)\r\n\t\t\t: [];\r\n\t\tconst rightFields = rightInfobox.value.data\r\n\t\t\t? Object.keys(rightInfobox.value.data)\r\n\t\t\t: [];\r\n\r\n\t\treturn [...new Set([...leftFields, ...rightFields])].filter(Boolean).sort();\r\n\t});\r\n\r\n\t// 监听props变化\r\n\twatch(\r\n\t\t() => props.div1InfoboxData,\r\n\t\tnewData => {\r\n\t\t\ttry {\r\n\t\t\t\tleftInfobox.value = {\r\n\t\t\t\t\ttitle: newData?.title || \"无标题\",\r\n\t\t\t\t\ttype: newData?.type || \"未知类型\",\r\n\t\t\t\t\tdata: newData?.data || {}\r\n\t\t\t\t};\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"Failed to process left infobox:\", e);\r\n\t\t\t\tleftInfobox.value = {\r\n\t\t\t\t\ttitle: \"数据错误\",\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\tdata: {}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ immediate: true, deep: true }\r\n\t);\r\n\r\n\twatch(\r\n\t\t() => props.div3InfoboxData,\r\n\t\tnewData => {\r\n\t\t\ttry {\r\n\t\t\t\trightInfobox.value = {\r\n\t\t\t\t\ttitle: newData?.title || \"无标题\",\r\n\t\t\t\t\ttype: newData?.type || \"未知类型\",\r\n\t\t\t\t\tdata: newData?.data || {}\r\n\t\t\t\t};\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"Failed to process right infobox:\", e);\r\n\t\t\t\trightInfobox.value = {\r\n\t\t\t\t\ttitle: \"数据错误\",\r\n\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\tdata: {}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ immediate: true, deep: true }\r\n\t);\r\n\r\n\t// 调试方法\r\n\tonMounted(() => {\r\n\t\twindow.debugCompareTable = {\r\n\t\t\tleftInfobox,\r\n\t\t\trightInfobox,\r\n\t\t\tprops,\r\n\t\t\tcomputed: {\r\n\t\t\t\thasInfoboxData,\r\n\t\t\t\tcommonInfoboxFields\r\n\t\t\t}\r\n\t\t};\r\n\t\tconsole.log(\"Debug info available at window.debugCompareTable\");\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 原有样式保持不变，新增以下样式 */\r\n\t.no-infobox-data {\r\n\t\tgrid-column: 1 / -1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 2rem;\r\n\t\ttext-align: center;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t.no-data-message {\r\n\t\tfont-size: 1.1rem;\r\n\t\tmargin-bottom: 0.5rem;\r\n\t}\r\n\r\n\t.suggestion {\r\n\t\tfont-size: 0.9rem;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.infobox-grid .cell {\r\n\t\tmin-height: 80px;\r\n\t\tpadding: 0.8rem;\r\n\t\talign-items: flex-start;\r\n\t}\r\n\r\n\t.attribute-name {\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #2d3748;\r\n\t}\r\n\r\n\t.data-type {\r\n\t\tfont-size: 0.75rem;\r\n\t\tcolor: #718096;\r\n\t\tfont-style: italic;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}