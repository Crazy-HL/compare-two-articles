{"ast":null,"code":"const MouseSelection = {\n  debounce(fn) {\n    let time = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;\n    let timeout = null;\n    return function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        fn.apply(this, arguments);\n      }, time);\n    };\n  },\n  // 获取选中的内容，仅限于特定范围\n  getSelectContent(rangeElement) {\n    let customId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    if (!(rangeElement instanceof HTMLElement)) return null; // **确保 rangeElement 有效**\n\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return null;\n    const anchorNode = selection.anchorNode;\n    if (!anchorNode || !rangeElement.contains(anchorNode)) return null; // **限制选区范围**\n\n    const range = selection.getRangeAt(0);\n    const rangeClone = range.cloneContents();\n    if (rangeClone.childElementCount > 0) {\n      const container = document.createElement('div');\n      container.appendChild(rangeClone);\n      return {\n        type: 'html',\n        content: container.innerHTML,\n        customId: customId\n      };\n    } else {\n      return {\n        type: 'text',\n        content: selection.toString().trim(),\n        customId: customId\n      };\n    }\n  },\n  // 处理选区变动后的回调\n  selectionChangeFun(rangeElement, callback, customId) {\n    const selectContent = MouseSelection.getSelectContent(rangeElement, customId);\n    callback(selectContent);\n    return selectContent;\n  },\n  // 启动选择功能，支持范围配置\n  start() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      rangeSelector,\n      customId\n    } = options;\n    const rangeElement = rangeSelector ? document.querySelector(rangeSelector) : document;\n    if (!(rangeElement instanceof HTMLElement)) {\n      console.error(`Invalid range selector: ${rangeSelector}`);\n      return;\n    }\n    let selectionchangeMouseTrack = false;\n\n    // 鼠标按下事件\n    rangeElement.addEventListener('mousedown', () => {\n      selectionchangeMouseTrack = true;\n    });\n\n    // 鼠标抬起事件\n    rangeElement.addEventListener('mouseup', MouseSelection.debounce(() => {\n      MouseSelection.selectionChangeFun(rangeElement, selectContent => {\n        if (selectContent) {\n          console.log(`选中的内容来自 ${customId}:`, selectContent);\n        } else {\n          console.log(\"没有选择内容\");\n        }\n      }, customId);\n    }, 100));\n\n    // 选择区域发生变化时\n    rangeElement.addEventListener('selectionchange', MouseSelection.debounce(() => {\n      if (selectionchangeMouseTrack) return;\n      MouseSelection.selectionChangeFun(rangeElement, selectContent => {\n        if (!selectContent) console.log(\"没有选择内容\");\n      }, customId);\n    }));\n  }\n};\nexport default MouseSelection;","map":{"version":3,"names":["MouseSelection","debounce","fn","time","arguments","length","undefined","timeout","clearTimeout","setTimeout","apply","getSelectContent","rangeElement","customId","HTMLElement","selection","window","getSelection","isCollapsed","anchorNode","contains","range","getRangeAt","rangeClone","cloneContents","childElementCount","container","document","createElement","appendChild","type","content","innerHTML","toString","trim","selectionChangeFun","callback","selectContent","start","options","rangeSelector","querySelector","console","error","selectionchangeMouseTrack","addEventListener","log"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/js/mouse_selection.js"],"sourcesContent":["const MouseSelection = {\r\n  debounce(fn, time = 500) {\r\n    let timeout = null;\r\n    return function () {\r\n      clearTimeout(timeout);\r\n      timeout = setTimeout(() => {\r\n        fn.apply(this, arguments);\r\n      }, time);\r\n    };\r\n  },\r\n\r\n  // 获取选中的内容，仅限于特定范围\r\n  getSelectContent(rangeElement, customId = null) {\r\n    if (!(rangeElement instanceof HTMLElement)) return null; // **确保 rangeElement 有效**\r\n\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.isCollapsed) return null;\r\n\r\n    const anchorNode = selection.anchorNode;\r\n    if (!anchorNode || !rangeElement.contains(anchorNode)) return null; // **限制选区范围**\r\n\r\n    const range = selection.getRangeAt(0);\r\n    const rangeClone = range.cloneContents();\r\n\r\n    if (rangeClone.childElementCount > 0) {\r\n      const container = document.createElement('div');\r\n      container.appendChild(rangeClone);\r\n      return {\r\n        type: 'html',\r\n        content: container.innerHTML,\r\n        customId: customId\r\n      };\r\n    } else {\r\n      return {\r\n        type: 'text',\r\n        content: selection.toString().trim(),\r\n        customId: customId\r\n      };\r\n    }\r\n  },\r\n\r\n  // 处理选区变动后的回调\r\n  selectionChangeFun(rangeElement, callback, customId) {\r\n    const selectContent = MouseSelection.getSelectContent(rangeElement, customId);\r\n    callback(selectContent);\r\n    return selectContent;\r\n  },\r\n\r\n  // 启动选择功能，支持范围配置\r\n  start(options = {}) {\r\n    const { rangeSelector, customId } = options;\r\n    const rangeElement = rangeSelector ? document.querySelector(rangeSelector) : document;\r\n\r\n    if (!(rangeElement instanceof HTMLElement)) {\r\n      console.error(`Invalid range selector: ${rangeSelector}`);\r\n      return;\r\n    }\r\n\r\n    let selectionchangeMouseTrack = false;\r\n\r\n    // 鼠标按下事件\r\n    rangeElement.addEventListener('mousedown', () => {\r\n      selectionchangeMouseTrack = true;\r\n    });\r\n\r\n    // 鼠标抬起事件\r\n    rangeElement.addEventListener('mouseup', MouseSelection.debounce(() => {\r\n      MouseSelection.selectionChangeFun(rangeElement, (selectContent) => {\r\n        if (selectContent) {\r\n          console.log(`选中的内容来自 ${customId}:`, selectContent);\r\n        } else {\r\n          console.log(\"没有选择内容\");\r\n        }\r\n      }, customId);\r\n    }, 100));\r\n\r\n    // 选择区域发生变化时\r\n    rangeElement.addEventListener('selectionchange', MouseSelection.debounce(() => {\r\n      if (selectionchangeMouseTrack) return;\r\n      MouseSelection.selectionChangeFun(rangeElement, (selectContent) => {\r\n        if (!selectContent) console.log(\"没有选择内容\");\r\n      }, customId);\r\n    }));\r\n  }\r\n};\r\n\r\nexport default MouseSelection;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}