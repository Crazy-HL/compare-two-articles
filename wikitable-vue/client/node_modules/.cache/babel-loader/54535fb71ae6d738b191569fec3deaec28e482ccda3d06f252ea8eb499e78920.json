{"ast":null,"code":"export default {\n  __name: 'FieldVisualization',\n  props: {\n    field: [Object, Array, String, Number],\n    type: String,\n    visualization: String,\n    fieldKey: String,\n    yRange: Array,\n    // 新增yRange prop\n    compareData: [Object, Array] // 新增compareData用于对比数据\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n\n    // 新增props接收yRange\n    const props = __props;\n\n    // 修改drawBarChart方法\n    const drawBarChart = () => {\n      const container = barChart.value;\n      if (!container || processedArray.value.length === 0) return;\n      container.innerHTML = \"\";\n      const width = container.clientWidth;\n      const height = container.clientHeight;\n      const margin = {\n        top: 10,\n        right: 10,\n        bottom: 20,\n        left: 10\n      };\n      const svg = d3.select(container).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n\n      // 使用传入的yRange或自动计算范围\n      const maxValue = props.yRange ? props.yRange[1] : d3.max(processedArray.value, d => d.value);\n      const minValue = props.yRange ? props.yRange[0] : 0;\n      const x = d3.scaleBand().domain(processedArray.value.map((_, i) => i)).range([margin.left, width - margin.right]).padding(0.5);\n      const y = d3.scaleLinear().domain([minValue, maxValue]).range([height - margin.bottom, margin.top]);\n\n      // 绘制柱子\n      svg.selectAll(\"rect\").data(processedArray.value).enter().append(\"rect\").attr(\"x\", (_, i) => x(i)).attr(\"y\", d => y(d.value)).attr(\"width\", x.bandwidth()).attr(\"height\", d => height - margin.bottom - y(d.value)).attr(\"fill\", \"#2196F3\");\n\n      // 绘制对比数据（如果有）\n      if (props.compareData) {\n        const compareArray = processCompareData(props.compareData);\n        if (compareArray.length > 0) {\n          svg.selectAll(\".compare-rect\").data(compareArray).enter().append(\"rect\").attr(\"x\", (_, i) => x(i)).attr(\"y\", d => y(d.value)).attr(\"width\", x.bandwidth()).attr(\"height\", d => height - margin.bottom - y(d.value)).attr(\"fill\", \"#FF9800\").attr(\"opacity\", 0.7);\n        }\n      }\n\n      // 数值标签\n      svg.selectAll(\".value-text\").data(processedArray.value).enter().append(\"text\").attr(\"x\", (_, i) => x(i) + x.bandwidth() / 2).attr(\"y\", d => y(d.value) - 5).attr(\"text-anchor\", \"middle\").text(d => props.type === \"percentage\" ? `${d.value}%` : d.value);\n    };\n\n    // 处理对比数据的方法\n    const processCompareData = data => {\n      if (!data) return [];\n      const rawArray = Array.isArray(data) ? data : [data];\n      return rawArray.map(item => ({\n        value: cleanValue(item.value ?? item),\n        year: item.year ? parseInt(item.year) : null\n      })).filter(item => item.value !== null && !isNaN(item.value));\n    };\n    const __returned__ = {\n      props,\n      drawBarChart,\n      processCompareData\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["props","__props","drawBarChart","container","barChart","value","processedArray","length","innerHTML","width","clientWidth","height","clientHeight","margin","top","right","bottom","left","svg","d3","select","append","attr","maxValue","yRange","max","d","minValue","x","scaleBand","domain","map","_","i","range","padding","y","scaleLinear","selectAll","data","enter","bandwidth","compareData","compareArray","processCompareData","text","type","rawArray","Array","isArray","item","cleanValue","year","parseInt","filter","isNaN"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/FieldVisualization.vue"],"sourcesContent":["<script setup>\r\n\t// 新增props接收yRange\r\n\tconst props = defineProps({\r\n\t\tfield: [Object, Array, String, Number],\r\n\t\ttype: String,\r\n\t\tvisualization: String,\r\n\t\tfieldKey: String,\r\n\t\tyRange: Array, // 新增yRange prop\r\n\t\tcompareData: [Object, Array] // 新增compareData用于对比数据\r\n\t});\r\n\r\n\t// 修改drawBarChart方法\r\n\tconst drawBarChart = () => {\r\n\t\tconst container = barChart.value;\r\n\t\tif (!container || processedArray.value.length === 0) return;\r\n\r\n\t\tcontainer.innerHTML = \"\";\r\n\r\n\t\tconst width = container.clientWidth;\r\n\t\tconst height = container.clientHeight;\r\n\t\tconst margin = { top: 10, right: 10, bottom: 20, left: 10 };\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(container)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height);\r\n\r\n\t\t// 使用传入的yRange或自动计算范围\r\n\t\tconst maxValue = props.yRange\r\n\t\t\t? props.yRange[1]\r\n\t\t\t: d3.max(processedArray.value, d => d.value);\r\n\r\n\t\tconst minValue = props.yRange ? props.yRange[0] : 0;\r\n\r\n\t\tconst x = d3\r\n\t\t\t.scaleBand()\r\n\t\t\t.domain(processedArray.value.map((_, i) => i))\r\n\t\t\t.range([margin.left, width - margin.right])\r\n\t\t\t.padding(0.5);\r\n\r\n\t\tconst y = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain([minValue, maxValue])\r\n\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t// 绘制柱子\r\n\t\tsvg\r\n\t\t\t.selectAll(\"rect\")\r\n\t\t\t.data(processedArray.value)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"x\", (_, i) => x(i))\r\n\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t.attr(\"height\", d => height - margin.bottom - y(d.value))\r\n\t\t\t.attr(\"fill\", \"#2196F3\");\r\n\r\n\t\t// 绘制对比数据（如果有）\r\n\t\tif (props.compareData) {\r\n\t\t\tconst compareArray = processCompareData(props.compareData);\r\n\t\t\tif (compareArray.length > 0) {\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".compare-rect\")\r\n\t\t\t\t\t.data(compareArray)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"x\", (_, i) => x(i))\r\n\t\t\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t\t\t.attr(\"height\", d => height - margin.bottom - y(d.value))\r\n\t\t\t\t\t.attr(\"fill\", \"#FF9800\")\r\n\t\t\t\t\t.attr(\"opacity\", 0.7);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 数值标签\r\n\t\tsvg\r\n\t\t\t.selectAll(\".value-text\")\r\n\t\t\t.data(processedArray.value)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", (_, i) => x(i) + x.bandwidth() / 2)\r\n\t\t\t.attr(\"y\", d => y(d.value) - 5)\r\n\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t.text(d => (props.type === \"percentage\" ? `${d.value}%` : d.value));\r\n\t};\r\n\r\n\t// 处理对比数据的方法\r\n\tconst processCompareData = data => {\r\n\t\tif (!data) return [];\r\n\r\n\t\tconst rawArray = Array.isArray(data) ? data : [data];\r\n\r\n\t\treturn rawArray\r\n\t\t\t.map(item => ({\r\n\t\t\t\tvalue: cleanValue(item.value ?? item),\r\n\t\t\t\tyear: item.year ? parseInt(item.year) : null\r\n\t\t\t}))\r\n\t\t\t.filter(item => item.value !== null && !isNaN(item.value));\r\n\t};\r\n</script>\r\n"],"mappings":";;;;;;;;;;;;;;;;;IACC;IACA,MAAMA,KAAK,GAAGC,OAOZ;;IAEF;IACA,MAAMC,YAAY,GAAGA,CAAA,KAAM;MAC1B,MAAMC,SAAS,GAAGC,QAAQ,CAACC,KAAK;MAChC,IAAI,CAACF,SAAS,IAAIG,cAAc,CAACD,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;MAErDJ,SAAS,CAACK,SAAS,GAAG,EAAE;MAExB,MAAMC,KAAK,GAAGN,SAAS,CAACO,WAAW;MACnC,MAAMC,MAAM,GAAGR,SAAS,CAACS,YAAY;MACrC,MAAMC,MAAM,GAAG;QAAEC,GAAG,EAAE,EAAE;QAAEC,KAAK,EAAE,EAAE;QAAEC,MAAM,EAAE,EAAE;QAAEC,IAAI,EAAE;MAAG,CAAC;MAE3D,MAAMC,GAAG,GAAGC,EAAE,CACZC,MAAM,CAACjB,SAAS,CAAC,CACjBkB,MAAM,CAAC,KAAK,CAAC,CACbC,IAAI,CAAC,OAAO,EAAEb,KAAK,CAAC,CACpBa,IAAI,CAAC,QAAQ,EAAEX,MAAM,CAAC;;MAExB;MACA,MAAMY,QAAQ,GAAGvB,KAAK,CAACwB,MAAM,GAC1BxB,KAAK,CAACwB,MAAM,CAAC,CAAC,CAAC,GACfL,EAAE,CAACM,GAAG,CAACnB,cAAc,CAACD,KAAK,EAAEqB,CAAC,IAAIA,CAAC,CAACrB,KAAK,CAAC;MAE7C,MAAMsB,QAAQ,GAAG3B,KAAK,CAACwB,MAAM,GAAGxB,KAAK,CAACwB,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC;MAEnD,MAAMI,CAAC,GAAGT,EAAE,CACVU,SAAS,CAAC,CAAC,CACXC,MAAM,CAACxB,cAAc,CAACD,KAAK,CAAC0B,GAAG,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAAC,CAAC,CAC7CC,KAAK,CAAC,CAACrB,MAAM,CAACI,IAAI,EAAER,KAAK,GAAGI,MAAM,CAACE,KAAK,CAAC,CAAC,CAC1CoB,OAAO,CAAC,GAAG,CAAC;MAEd,MAAMC,CAAC,GAAGjB,EAAE,CACVkB,WAAW,CAAC,CAAC,CACbP,MAAM,CAAC,CAACH,QAAQ,EAAEJ,QAAQ,CAAC,CAAC,CAC5BW,KAAK,CAAC,CAACvB,MAAM,GAAGE,MAAM,CAACG,MAAM,EAAEH,MAAM,CAACC,GAAG,CAAC,CAAC;;MAE7C;MACAI,GAAG,CACDoB,SAAS,CAAC,MAAM,CAAC,CACjBC,IAAI,CAACjC,cAAc,CAACD,KAAK,CAAC,CAC1BmC,KAAK,CAAC,CAAC,CACPnB,MAAM,CAAC,MAAM,CAAC,CACdC,IAAI,CAAC,GAAG,EAAE,CAACU,CAAC,EAAEC,CAAC,KAAKL,CAAC,CAACK,CAAC,CAAC,CAAC,CACzBX,IAAI,CAAC,GAAG,EAAEI,CAAC,IAAIU,CAAC,CAACV,CAAC,CAACrB,KAAK,CAAC,CAAC,CAC1BiB,IAAI,CAAC,OAAO,EAAEM,CAAC,CAACa,SAAS,CAAC,CAAC,CAAC,CAC5BnB,IAAI,CAAC,QAAQ,EAAEI,CAAC,IAAIf,MAAM,GAAGE,MAAM,CAACG,MAAM,GAAGoB,CAAC,CAACV,CAAC,CAACrB,KAAK,CAAC,CAAC,CACxDiB,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC;;MAEzB;MACA,IAAItB,KAAK,CAAC0C,WAAW,EAAE;QACtB,MAAMC,YAAY,GAAGC,kBAAkB,CAAC5C,KAAK,CAAC0C,WAAW,CAAC;QAC1D,IAAIC,YAAY,CAACpC,MAAM,GAAG,CAAC,EAAE;UAC5BW,GAAG,CACDoB,SAAS,CAAC,eAAe,CAAC,CAC1BC,IAAI,CAACI,YAAY,CAAC,CAClBH,KAAK,CAAC,CAAC,CACPnB,MAAM,CAAC,MAAM,CAAC,CACdC,IAAI,CAAC,GAAG,EAAE,CAACU,CAAC,EAAEC,CAAC,KAAKL,CAAC,CAACK,CAAC,CAAC,CAAC,CACzBX,IAAI,CAAC,GAAG,EAAEI,CAAC,IAAIU,CAAC,CAACV,CAAC,CAACrB,KAAK,CAAC,CAAC,CAC1BiB,IAAI,CAAC,OAAO,EAAEM,CAAC,CAACa,SAAS,CAAC,CAAC,CAAC,CAC5BnB,IAAI,CAAC,QAAQ,EAAEI,CAAC,IAAIf,MAAM,GAAGE,MAAM,CAACG,MAAM,GAAGoB,CAAC,CAACV,CAAC,CAACrB,KAAK,CAAC,CAAC,CACxDiB,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CACvBA,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC;QACvB;MACD;;MAEA;MACAJ,GAAG,CACDoB,SAAS,CAAC,aAAa,CAAC,CACxBC,IAAI,CAACjC,cAAc,CAACD,KAAK,CAAC,CAC1BmC,KAAK,CAAC,CAAC,CACPnB,MAAM,CAAC,MAAM,CAAC,CACdC,IAAI,CAAC,GAAG,EAAE,CAACU,CAAC,EAAEC,CAAC,KAAKL,CAAC,CAACK,CAAC,CAAC,GAAGL,CAAC,CAACa,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAC7CnB,IAAI,CAAC,GAAG,EAAEI,CAAC,IAAIU,CAAC,CAACV,CAAC,CAACrB,KAAK,CAAC,GAAG,CAAC,CAAC,CAC9BiB,IAAI,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC7BuB,IAAI,CAACnB,CAAC,IAAK1B,KAAK,CAAC8C,IAAI,KAAK,YAAY,GAAG,GAAGpB,CAAC,CAACrB,KAAK,GAAG,GAAGqB,CAAC,CAACrB,KAAM,CAAC;IACrE,CAAC;;IAED;IACA,MAAMuC,kBAAkB,GAAGL,IAAI,IAAI;MAClC,IAAI,CAACA,IAAI,EAAE,OAAO,EAAE;MAEpB,MAAMQ,QAAQ,GAAGC,KAAK,CAACC,OAAO,CAACV,IAAI,CAAC,GAAGA,IAAI,GAAG,CAACA,IAAI,CAAC;MAEpD,OAAOQ,QAAQ,CACbhB,GAAG,CAACmB,IAAI,KAAK;QACb7C,KAAK,EAAE8C,UAAU,CAACD,IAAI,CAAC7C,KAAK,IAAI6C,IAAI,CAAC;QACrCE,IAAI,EAAEF,IAAI,CAACE,IAAI,GAAGC,QAAQ,CAACH,IAAI,CAACE,IAAI,CAAC,GAAG;MACzC,CAAC,CAAC,CAAC,CACFE,MAAM,CAACJ,IAAI,IAAIA,IAAI,CAAC7C,KAAK,KAAK,IAAI,IAAI,CAACkD,KAAK,CAACL,IAAI,CAAC7C,KAAK,CAAC,CAAC;IAC5D,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}