{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, watch } from \"vue\";\nimport * as echarts from \"echarts\";\nexport default {\n  __name: 'PieChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartEl = ref(null);\n    let chartInstance = null;\n\n    // 格式化数值显示\n    const formatNumber = value => {\n      const num = Number(value);\n      return isNaN(num) ? \"0\" : num.toFixed(2);\n    };\n    const initChart = () => {\n      if (!chartEl.value) return;\n      chartInstance = echarts.init(chartEl.value);\n\n      // 处理单个数据点的情况\n      let chartData = [...props.data];\n      props.data.forEach(item => {\n        if (item._contrast) {\n          chartData.push(item._contrast);\n        }\n      });\n\n      // 生成颜色列表\n      const colors = [\"#5470c6\", \"#91cc75\", \"#fac858\", \"#ee6666\", \"#73c0de\", \"#3ba272\", \"#fc8452\", \"#9a60b4\"];\n      const option = {\n        tooltip: {\n          trigger: \"item\",\n          formatter: params => {\n            if (params.data?.isContrast) return \"\";\n            let tip = `${params.seriesName}<br/>${params.name}: ${formatNumber(params.value)}%`;\n            if (params.data.unit) tip += ` ${params.data.unit}`;\n            if (params.data.year) tip += ` (${params.data.year})`;\n            return tip;\n          }\n        },\n        legend: {\n          orient: \"vertical\",\n          right: 10,\n          top: \"center\",\n          data: props.data.map(item => item.name)\n        },\n        series: [{\n          name: \"比例\",\n          type: \"pie\",\n          radius: [\"50%\", \"70%\"],\n          avoidLabelOverlap: false,\n          itemStyle: {\n            borderRadius: 10,\n            borderColor: \"#fff\",\n            borderWidth: 2,\n            color: params => {\n              // 处理对比项\n              if (params.data?.isContrast) return \"#f0f0f0\";\n              return colors[params.dataIndex % colors.length];\n            }\n          },\n          label: {\n            show: true,\n            formatter: params => {\n              if (params.data?.isContrast) return \"\";\n              return `${params.name}: {b|${formatNumber(params.value)}%}`;\n            },\n            rich: {\n              b: {\n                fontWeight: \"bold\",\n                color: \"#333\"\n              }\n            }\n          },\n          emphasis: {\n            label: {\n              show: true,\n              fontSize: \"18\",\n              fontWeight: \"bold\"\n            }\n          },\n          labelLine: {\n            show: true\n          },\n          data: chartData.map(item => ({\n            ...item,\n            // 标记对比项\n            ...(item.name === \"对比\" ? {\n              isContrast: true\n            } : {})\n          }))\n        }]\n      };\n      chartInstance.setOption(option);\n    };\n    onMounted(() => {\n      initChart();\n      window.addEventListener(\"resize\", () => chartInstance?.resize());\n    });\n    watch(() => props.data, () => {\n      if (chartInstance) {\n        initChart();\n      }\n    }, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartEl,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      formatNumber,\n      initChart,\n      ref,\n      onMounted,\n      watch,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","echarts","props","__props","chartEl","chartInstance","formatNumber","value","num","Number","isNaN","toFixed","initChart","init","chartData","data","forEach","item","_contrast","push","colors","option","tooltip","trigger","formatter","params","isContrast","tip","seriesName","name","unit","year","legend","orient","right","top","map","series","type","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","color","dataIndex","length","label","show","rich","b","fontWeight","emphasis","fontSize","labelLine","setOption","window","addEventListener","resize","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartEl\" class=\"pie-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch } from \"vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartEl = ref(null);\r\n\tlet chartInstance = null;\r\n\r\n\t// 格式化数值显示\r\n\tconst formatNumber = value => {\r\n\t\tconst num = Number(value);\r\n\t\treturn isNaN(num) ? \"0\" : num.toFixed(2);\r\n\t};\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartEl.value) return;\r\n\r\n\t\tchartInstance = echarts.init(chartEl.value);\r\n\r\n\t\t// 处理单个数据点的情况\r\n\t\tlet chartData = [...props.data];\r\n\t\tprops.data.forEach(item => {\r\n\t\t\tif (item._contrast) {\r\n\t\t\t\tchartData.push(item._contrast);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// 生成颜色列表\r\n\t\tconst colors = [\r\n\t\t\t\"#5470c6\",\r\n\t\t\t\"#91cc75\",\r\n\t\t\t\"#fac858\",\r\n\t\t\t\"#ee6666\",\r\n\t\t\t\"#73c0de\",\r\n\t\t\t\"#3ba272\",\r\n\t\t\t\"#fc8452\",\r\n\t\t\t\"#9a60b4\"\r\n\t\t];\r\n\r\n\t\tconst option = {\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: \"item\",\r\n\t\t\t\tformatter: params => {\r\n\t\t\t\t\tif (params.data?.isContrast) return \"\";\r\n\t\t\t\t\tlet tip = `${params.seriesName}<br/>${params.name}: ${formatNumber(\r\n\t\t\t\t\t\tparams.value\r\n\t\t\t\t\t)}%`;\r\n\t\t\t\t\tif (params.data.unit) tip += ` ${params.data.unit}`;\r\n\t\t\t\t\tif (params.data.year) tip += ` (${params.data.year})`;\r\n\t\t\t\t\treturn tip;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t\torient: \"vertical\",\r\n\t\t\t\tright: 10,\r\n\t\t\t\ttop: \"center\",\r\n\t\t\t\tdata: props.data.map(item => item.name)\r\n\t\t\t},\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"比例\",\r\n\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\tradius: [\"50%\", \"70%\"],\r\n\t\t\t\t\tavoidLabelOverlap: false,\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tborderRadius: 10,\r\n\t\t\t\t\t\tborderColor: \"#fff\",\r\n\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\tcolor: params => {\r\n\t\t\t\t\t\t\t// 处理对比项\r\n\t\t\t\t\t\t\tif (params.data?.isContrast) return \"#f0f0f0\";\r\n\t\t\t\t\t\t\treturn colors[params.dataIndex % colors.length];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\tformatter: params => {\r\n\t\t\t\t\t\t\tif (params.data?.isContrast) return \"\";\r\n\t\t\t\t\t\t\treturn `${params.name}: {b|${formatNumber(params.value)}%}`;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\trich: {\r\n\t\t\t\t\t\t\tb: {\r\n\t\t\t\t\t\t\t\tfontWeight: \"bold\",\r\n\t\t\t\t\t\t\t\tcolor: \"#333\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\tfontSize: \"18\",\r\n\t\t\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabelLine: {\r\n\t\t\t\t\t\tshow: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: chartData.map(item => ({\r\n\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t// 标记对比项\r\n\t\t\t\t\t\t...(item.name === \"对比\" ? { isContrast: true } : {})\r\n\t\t\t\t\t}))\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\r\n\t\tchartInstance.setOption(option);\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", () => chartInstance?.resize());\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => props.data,\r\n\t\t() => {\r\n\t\t\tif (chartInstance) {\r\n\t\t\t\tinitChart();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n</script>\r\n\r\n<style scoped>\r\n\t.pie-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 300px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}