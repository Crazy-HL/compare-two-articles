{"ast":null,"code":"import { openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-3d881255\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  ref: \"chartContainer\",\n  class: \"pie-chart-container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, null, 512 /* NEED_PATCH */);\n}","map":{"version":3,"names":["ref","class","_createElementBlock","_hoisted_1"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\charts\\PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"pie-chart-container\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [],\r\n\t\t\tvalidator: value => value.every(item => \"name\" in item && \"value\" in item)\r\n\t\t},\r\n\t\tshowRemainder: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t});\r\n\r\n\tconst emit = defineEmits([\"itemClick\"]);\r\n\r\n\tconst chartContainer = ref(null);\r\n\tconst colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\r\n\tconst remainderColor = \"#f0f0f0\";\r\n\r\n\tconst processedData = computed(() => {\r\n\t\tif (!props.data.length) return [];\r\n\r\n\t\t// 单值添加剩余部分\r\n\t\tif (props.data.length === 1 && props.showRemainder) {\r\n\t\t\tconst mainValue = Math.min(100, Math.max(0, props.data[0].value));\r\n\t\t\treturn [\r\n\t\t\t\t{ ...props.data[0], value: mainValue, isMain: true, index: 0 },\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"剩余\",\r\n\t\t\t\t\tvalue: Math.max(0, 100 - mainValue),\r\n\t\t\t\t\tisRemainder: true,\r\n\t\t\t\t\tindex: 1\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn props.data.map((item, index) => ({\r\n\t\t\t...item,\r\n\t\t\tvalue: Math.min(100, Math.max(0, item.value)),\r\n\t\t\tindex\r\n\t\t}));\r\n\t});\r\n\r\n\tlet svg, arc, pie;\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartContainer.value || !processedData.value.length) return;\r\n\r\n\t\t// 清除旧图表\r\n\t\td3.select(chartContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\tconst container = d3.select(chartContainer.value);\r\n\t\tconst width = chartContainer.value.clientWidth;\r\n\t\tconst height = chartContainer.value.clientHeight;\r\n\t\tconst radius = Math.min(width, height) / 2;\r\n\r\n\t\tsvg = container\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${width / 2},${height / 2})`);\r\n\r\n\t\tpie = d3\r\n\t\t\t.pie()\r\n\t\t\t.value(d => d.value)\r\n\t\t\t.sort(null);\r\n\r\n\t\tarc = d3\r\n\t\t\t.arc()\r\n\t\t\t.innerRadius(0)\r\n\t\t\t.outerRadius(radius * 0.9)\r\n\t\t\t.cornerRadius(2);\r\n\r\n\t\tdrawChart();\r\n\t};\r\n\r\n\tconst drawChart = () => {\r\n\t\tconst arcs = svg\r\n\t\t\t.selectAll(\".arc\")\r\n\t\t\t.data(pie(processedData.value))\r\n\t\t\t.enter()\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"arc\");\r\n\r\n\t\t// 绘制扇形\r\n\t\tarcs\r\n\t\t\t.append(\"path\")\r\n\t\t\t.attr(\"d\", arc)\r\n\t\t\t.attr(\"fill\", d =>\r\n\t\t\t\td.data.isRemainder\r\n\t\t\t\t\t? remainderColor\r\n\t\t\t\t\t: colors[d.data.index % colors.length]\r\n\t\t\t)\r\n\t\t\t.style(\"opacity\", d => (d.data.isRemainder ? 0.6 : 0.8))\r\n\t\t\t.style(\"stroke\", \"#fff\")\r\n\t\t\t.style(\"stroke-width\", 1)\r\n\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\td3.select(this).transition().duration(200).style(\"opacity\", 1);\r\n\t\t\t})\r\n\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\td3.select(this).transition().duration(200).style(\"opacity\", 0.8);\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (event, d) => {\r\n\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\temit(\"itemClick\", d.data);\r\n\t\t\t});\r\n\r\n\t\t// 单值时添加中心文字\r\n\t\tif (props.data.length === 1) {\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t.attr(\"dy\", \".3em\")\r\n\t\t\t\t.text(`${props.data[0].value.toFixed(1)}%`)\r\n\t\t\t\t.style(\"font-size\", \"14px\")\r\n\t\t\t\t.style(\"fill\", \"#333\");\r\n\t\t}\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", initChart);\r\n\t});\r\n\r\n\twatch(() => props.data, initChart, { deep: true });\r\n\twatch(() => props.showRemainder, initChart);\r\n</script>\r\n\r\n<style scoped>\r\n\t.pie-chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 150px;\r\n\t}\r\n</style>\r\n"],"mappings":";;;EACMA,GAAG,EAAC,gBAAgB;EAACC,KAAK,EAAC;;;uBAAhCC,mBAAA,CAA4D,OAA5DC,UAA4D","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}