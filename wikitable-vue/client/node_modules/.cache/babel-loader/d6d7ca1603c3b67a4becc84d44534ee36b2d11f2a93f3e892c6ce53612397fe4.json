{"ast":null,"code":"import { ref, onMounted, watch, computed } from \"vue\";\nimport * as echarts from \"echarts\";\nexport default {\n  __name: 'PieChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    showRemainder: {\n      type: Boolean,\n      default: true\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartEl = ref(null);\n    let chartInstance = null;\n    const processedData = computed(() => {\n      if (!props.data.length) return [];\n\n      // 处理单值情况，添加剩余部分\n      if (props.data.length === 1 && props.showRemainder) {\n        const mainValue = Math.min(100, Math.max(0, Number(props.data[0].value) || 0));\n        return [{\n          name: props.data[0].name || \"数值\",\n          value: mainValue,\n          isMain: true\n        }, {\n          name: \"剩余\",\n          value: Math.max(0, 100 - mainValue),\n          isRemainder: true\n        }];\n      }\n      return props.data.map((item, index) => ({\n        name: item.name || `项目${index + 1}`,\n        value: Math.min(100, Math.max(0, Number(item.value) || 0))\n      }));\n    });\n    const colorPalette = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\", \"#1abc9c\", \"#d35400\", \"#34495e\"];\n    const initChart = () => {\n      if (!chartEl.value) return;\n      chartInstance = echarts.init(chartEl.value);\n      const option = {\n        tooltip: {\n          trigger: \"item\",\n          formatter: params => {\n            return `${params.name}: ${params.value}% (${params.percent}%)`;\n          }\n        },\n        legend: {\n          orient: \"horizontal\",\n          bottom: 0,\n          data: processedData.value.map(item => item.name)\n        },\n        series: [{\n          name: \"占比\",\n          type: \"pie\",\n          radius: [\"40%\", \"70%\"],\n          avoidLabelOverlap: false,\n          itemStyle: {\n            borderRadius: 5,\n            borderColor: \"#fff\",\n            borderWidth: 2\n          },\n          label: {\n            show: true,\n            formatter: params => {\n              return `${params.name}\\n${params.value}%`;\n            }\n          },\n          emphasis: {\n            label: {\n              show: true,\n              fontSize: \"16\",\n              fontWeight: \"bold\"\n            }\n          },\n          labelLine: {\n            show: true\n          },\n          data: processedData.value.map((item, index) => ({\n            ...item,\n            itemStyle: {\n              color: item.isRemainder ? \"#f0f0f0\" : colorPalette[index % colorPalette.length]\n            }\n          }))\n        }]\n      };\n\n      // 单值时添加中心文字\n      if (props.data.length === 1) {\n        option.graphic = {\n          type: \"text\",\n          left: \"center\",\n          top: \"center\",\n          style: {\n            text: `${processedData.value[0].value}%`,\n            fill: \"#333\",\n            fontSize: 24,\n            fontWeight: \"bold\"\n          }\n        };\n      }\n      chartInstance.setOption(option);\n    };\n    onMounted(() => {\n      initChart();\n      window.addEventListener(\"resize\", () => chartInstance?.resize());\n    });\n    watch(() => [props.data, props.showRemainder], () => {\n      if (chartInstance) {\n        initChart();\n      }\n    }, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartEl,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      processedData,\n      colorPalette,\n      initChart,\n      ref,\n      onMounted,\n      watch,\n      computed,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","computed","echarts","props","__props","chartEl","chartInstance","processedData","data","length","showRemainder","mainValue","Math","min","max","Number","value","name","isMain","isRemainder","map","item","index","colorPalette","initChart","init","option","tooltip","trigger","formatter","params","percent","legend","orient","bottom","series","type","radius","avoidLabelOverlap","itemStyle","borderRadius","borderColor","borderWidth","label","show","emphasis","fontSize","fontWeight","labelLine","color","graphic","left","top","style","text","fill","setOption","window","addEventListener","resize","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartEl\" class=\"pie-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tshowRemainder: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartEl = ref(null);\r\n\tlet chartInstance = null;\r\n\r\n\tconst processedData = computed(() => {\r\n\t\tif (!props.data.length) return [];\r\n\r\n\t\t// 处理单值情况，添加剩余部分\r\n\t\tif (props.data.length === 1 && props.showRemainder) {\r\n\t\t\tconst mainValue = Math.min(\r\n\t\t\t\t100,\r\n\t\t\t\tMath.max(0, Number(props.data[0].value) || 0)\r\n\t\t\t);\r\n\t\t\treturn [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: props.data[0].name || \"数值\",\r\n\t\t\t\t\tvalue: mainValue,\r\n\t\t\t\t\tisMain: true\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"剩余\",\r\n\t\t\t\t\tvalue: Math.max(0, 100 - mainValue),\r\n\t\t\t\t\tisRemainder: true\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn props.data.map((item, index) => ({\r\n\t\t\tname: item.name || `项目${index + 1}`,\r\n\t\t\tvalue: Math.min(100, Math.max(0, Number(item.value) || 0))\r\n\t\t}));\r\n\t});\r\n\r\n\tconst colorPalette = [\r\n\t\t\"#3498db\",\r\n\t\t\"#e74c3c\",\r\n\t\t\"#2ecc71\",\r\n\t\t\"#f39c12\",\r\n\t\t\"#9b59b6\",\r\n\t\t\"#1abc9c\",\r\n\t\t\"#d35400\",\r\n\t\t\"#34495e\"\r\n\t];\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartEl.value) return;\r\n\r\n\t\tchartInstance = echarts.init(chartEl.value);\r\n\r\n\t\tconst option = {\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: \"item\",\r\n\t\t\t\tformatter: params => {\r\n\t\t\t\t\treturn `${params.name}: ${params.value}% (${params.percent}%)`;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t\torient: \"horizontal\",\r\n\t\t\t\tbottom: 0,\r\n\t\t\t\tdata: processedData.value.map(item => item.name)\r\n\t\t\t},\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"占比\",\r\n\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\tradius: [\"40%\", \"70%\"],\r\n\t\t\t\t\tavoidLabelOverlap: false,\r\n\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\tborderRadius: 5,\r\n\t\t\t\t\t\tborderColor: \"#fff\",\r\n\t\t\t\t\t\tborderWidth: 2\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\tformatter: params => {\r\n\t\t\t\t\t\t\treturn `${params.name}\\n${params.value}%`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\tfontSize: \"16\",\r\n\t\t\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tlabelLine: {\r\n\t\t\t\t\t\tshow: true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdata: processedData.value.map((item, index) => ({\r\n\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\tcolor: item.isRemainder\r\n\t\t\t\t\t\t\t\t? \"#f0f0f0\"\r\n\t\t\t\t\t\t\t\t: colorPalette[index % colorPalette.length]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\r\n\t\t// 单值时添加中心文字\r\n\t\tif (props.data.length === 1) {\r\n\t\t\toption.graphic = {\r\n\t\t\t\ttype: \"text\",\r\n\t\t\t\tleft: \"center\",\r\n\t\t\t\ttop: \"center\",\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\ttext: `${processedData.value[0].value}%`,\r\n\t\t\t\t\tfill: \"#333\",\r\n\t\t\t\t\tfontSize: 24,\r\n\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tchartInstance.setOption(option);\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", () => chartInstance?.resize());\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => [props.data, props.showRemainder],\r\n\t\t() => {\r\n\t\t\tif (chartInstance) {\r\n\t\t\t\tinitChart();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n</script>\r\n\r\n<style scoped>\r\n\t.pie-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 400px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}