{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, onUnmounted, nextTick } from \"vue\";\nimport bus from \"@/js/eventBus.js\";\nimport * as d3 from \"d3\";\nimport { renderLineChart, renderBarChart, renderPieChart, renderNonVisualChart, renderRadarChart, renderStackedBarChart, renderScatterChart } from \"@/js/chartUtils\";\n\n// 响应式数据\n\nexport default {\n  __name: 'Div2',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const userQuestion = ref(\"\");\n    const chatHistory = ref([]);\n    const selectText2 = ref(null);\n    const selectText3 = ref(null);\n    const article1Data = ref(null);\n    const article2Data = ref(null);\n    const commonAttributes = ref([]);\n    const selectedAttribute = ref(null);\n    const chart1 = ref([]);\n    const chart2 = ref([]);\n\n    // 获取无属性时的提示信息\n    const getNoAttributesMessage = () => {\n      if (!selectText2.value && !selectText3.value) return \"请先选择两篇文章\";\n      if (!selectText2.value) return \"请先选择文章1\";\n      if (!selectText3.value) return \"请先选择文章2\";\n      return \"无公共属性\";\n    };\n\n    // 其他方法保持不变...\n    // (保持之前的 handleSelection, compareAttributes, renderAttributeCharts 等方法)\n    // 只需要调整渲染逻辑以适应新的多行结构\n\n    // 选择属性\n    const selectAttribute = attr => {\n      if (!attr || !commonAttributes.value.includes(attr)) {\n        console.warn(\"无效的属性选择:\", attr);\n        return;\n      }\n      selectedAttribute.value = attr;\n      nextTick(() => {\n        renderAttributeChart(attr);\n      });\n    };\n\n    // 渲染单个属性的图表\n    const renderAttributeChart = attr => {\n      if (!attr || !article1Data.value || !article2Data.value) {\n        console.warn(\"缺少必要的渲染数据\");\n        return;\n      }\n      try {\n        const attr1Data = article1Data.value[attr];\n        const attr2Data = article2Data.value[attr];\n        if (!attr1Data || !attr2Data) {\n          throw new Error(`找不到属性 ${attr} 的数据`);\n        }\n\n        // 获取对应属性的图表容器\n        const chart1El = document.querySelector(`.chart-box[data-attribute=\"${attr}\"]`);\n        const chart2El = document.querySelector(`.chart-box[data-attribute=\"${attr}\"]`);\n        if (chart1El) {\n          renderChart(chart1El, attr1Data, \"Line Chart\");\n        }\n        if (chart2El) {\n          renderChart(chart2El, attr2Data, \"Line Chart\");\n        }\n      } catch (error) {\n        console.error(\"渲染图表失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `渲染图表失败: ${error.message}`\n        });\n      }\n    };\n    const __returned__ = {\n      userQuestion,\n      chatHistory,\n      selectText2,\n      selectText3,\n      article1Data,\n      article2Data,\n      commonAttributes,\n      selectedAttribute,\n      chart1,\n      chart2,\n      getNoAttributesMessage,\n      selectAttribute,\n      renderAttributeChart,\n      ref,\n      onMounted,\n      onUnmounted,\n      nextTick,\n      get bus() {\n        return bus;\n      },\n      get d3() {\n        return d3;\n      },\n      get renderLineChart() {\n        return renderLineChart;\n      },\n      get renderBarChart() {\n        return renderBarChart;\n      },\n      get renderPieChart() {\n        return renderPieChart;\n      },\n      get renderNonVisualChart() {\n        return renderNonVisualChart;\n      },\n      get renderRadarChart() {\n        return renderRadarChart;\n      },\n      get renderStackedBarChart() {\n        return renderStackedBarChart;\n      },\n      get renderScatterChart() {\n        return renderScatterChart;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","nextTick","bus","d3","renderLineChart","renderBarChart","renderPieChart","renderNonVisualChart","renderRadarChart","renderStackedBarChart","renderScatterChart","userQuestion","chatHistory","selectText2","selectText3","article1Data","article2Data","commonAttributes","selectedAttribute","chart1","chart2","getNoAttributesMessage","value","selectAttribute","attr","includes","console","warn","renderAttributeChart","attr1Data","attr2Data","Error","chart1El","document","querySelector","chart2El","renderChart","error","push","role","content","message"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/Div2.vue"],"sourcesContent":["<template>\r\n\t<div class=\"main-container\">\r\n\t\t<!-- 聊天容器 -->\r\n\t\t<div class=\"chat-container\" @dragover.prevent @drop=\"handleDrop\">\r\n\t\t\t<!-- 历史对话记录 -->\r\n\t\t\t<div class=\"chat-history\">\r\n\t\t\t\t<template v-for=\"(message, index) in chatHistory\" :key=\"index\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tv-if=\"message && message.content\"\r\n\t\t\t\t\t\t:class=\"['message', message.role]\">\r\n\t\t\t\t\t\t<div class=\"message-content\">\r\n\t\t\t\t\t\t\t<strong>{{ message.role === \"user\" ? \"用户\" : \"GPT\" }}:</strong>\r\n\t\t\t\t\t\t\t<p v-html=\"message.content\"></p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 三列可视化对比容器 - 始终显示 -->\r\n\t\t<div class=\"compare-container\">\r\n\t\t\t<!-- 文章1图表列 -->\r\n\t\t\t<div class=\"chart-column\">\r\n\t\t\t\t<h3>文章1可视化</h3>\r\n\t\t\t\t<template v-if=\"commonAttributes.length > 0\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tv-for=\"(attr, index) in commonAttributes\"\r\n\t\t\t\t\t\t:key=\"'chart1-' + index\"\r\n\t\t\t\t\t\tclass=\"chart-box-wrapper\">\r\n\t\t\t\t\t\t<div class=\"attribute-title\">{{ attr }}</div>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tref=\"chart1\"\r\n\t\t\t\t\t\t\tclass=\"chart-box\"\r\n\t\t\t\t\t\t\t:data-attribute=\"attr\"\r\n\t\t\t\t\t\t\tv-if=\"selectedAttribute === attr\"></div>\r\n\t\t\t\t\t\t<div v-else class=\"empty-chart\">点击属性查看图表</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t\t<div v-else class=\"no-data-prompt\">\r\n\t\t\t\t\t{{ selectText2 ? \"无公共属性\" : \"请先选择文章1\" }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- 公共属性列 -->\r\n\t\t\t<div class=\"attributes-column\">\r\n\t\t\t\t<h3>公共属性</h3>\r\n\t\t\t\t<div class=\"attributes-list\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tv-for=\"(attr, index) in commonAttributes\"\r\n\t\t\t\t\t\t:key=\"'attr-' + index\"\r\n\t\t\t\t\t\tclass=\"attribute-item\"\r\n\t\t\t\t\t\t@click=\"selectAttribute(attr)\"\r\n\t\t\t\t\t\t:class=\"{ active: attr === selectedAttribute }\">\r\n\t\t\t\t\t\t{{ attr }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div v-if=\"commonAttributes.length === 0\" class=\"no-attributes\">\r\n\t\t\t\t\t\t{{ getNoAttributesMessage() }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- 文章2图表列 -->\r\n\t\t\t<div class=\"chart-column\">\r\n\t\t\t\t<h3>文章2可视化</h3>\r\n\t\t\t\t<template v-if=\"commonAttributes.length > 0\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tv-for=\"(attr, index) in commonAttributes\"\r\n\t\t\t\t\t\t:key=\"'chart2-' + index\"\r\n\t\t\t\t\t\tclass=\"chart-box-wrapper\">\r\n\t\t\t\t\t\t<div class=\"attribute-title\">{{ attr }}</div>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tref=\"chart2\"\r\n\t\t\t\t\t\t\tclass=\"chart-box\"\r\n\t\t\t\t\t\t\t:data-attribute=\"attr\"\r\n\t\t\t\t\t\t\tv-if=\"selectedAttribute === attr\"></div>\r\n\t\t\t\t\t\t<div v-else class=\"empty-chart\">点击属性查看图表</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t\t<div v-else class=\"no-data-prompt\">\r\n\t\t\t\t\t{{ selectText3 ? \"无公共属性\" : \"请先选择文章2\" }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 输入框和操作按钮 -->\r\n\t\t<div class=\"input-container\">\r\n\t\t\t<textarea\r\n\t\t\t\tv-model=\"userQuestion\"\r\n\t\t\t\trows=\"2\"\r\n\t\t\t\tplaceholder=\"请输入你想问的问题...\"></textarea>\r\n\t\t\t<div class=\"button-container\">\r\n\t\t\t\t<button @click=\"askQuestion\">发送</button>\r\n\t\t\t\t<button\r\n\t\t\t\t\t@click=\"compareAttributes\"\r\n\t\t\t\t\tclass=\"submit-btn\"\r\n\t\t\t\t\t:disabled=\"!selectText2 || !selectText3\">\r\n\t\t\t\t\t属性对比可视化\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted, nextTick } from \"vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\timport * as d3 from \"d3\";\r\n\timport {\r\n\t\trenderLineChart,\r\n\t\trenderBarChart,\r\n\t\trenderPieChart,\r\n\t\trenderNonVisualChart,\r\n\t\trenderRadarChart,\r\n\t\trenderStackedBarChart,\r\n\t\trenderScatterChart\r\n\t} from \"@/js/chartUtils\";\r\n\r\n\t// 响应式数据\r\n\tconst userQuestion = ref(\"\");\r\n\tconst chatHistory = ref([]);\r\n\tconst selectText2 = ref(null);\r\n\tconst selectText3 = ref(null);\r\n\tconst article1Data = ref(null);\r\n\tconst article2Data = ref(null);\r\n\tconst commonAttributes = ref([]);\r\n\tconst selectedAttribute = ref(null);\r\n\tconst chart1 = ref([]);\r\n\tconst chart2 = ref([]);\r\n\r\n\t// 获取无属性时的提示信息\r\n\tconst getNoAttributesMessage = () => {\r\n\t\tif (!selectText2.value && !selectText3.value) return \"请先选择两篇文章\";\r\n\t\tif (!selectText2.value) return \"请先选择文章1\";\r\n\t\tif (!selectText3.value) return \"请先选择文章2\";\r\n\t\treturn \"无公共属性\";\r\n\t};\r\n\r\n\t// 其他方法保持不变...\r\n\t// (保持之前的 handleSelection, compareAttributes, renderAttributeCharts 等方法)\r\n\t// 只需要调整渲染逻辑以适应新的多行结构\r\n\r\n\t// 选择属性\r\n\tconst selectAttribute = attr => {\r\n\t\tif (!attr || !commonAttributes.value.includes(attr)) {\r\n\t\t\tconsole.warn(\"无效的属性选择:\", attr);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tselectedAttribute.value = attr;\r\n\t\tnextTick(() => {\r\n\t\t\trenderAttributeChart(attr);\r\n\t\t});\r\n\t};\r\n\r\n\t// 渲染单个属性的图表\r\n\tconst renderAttributeChart = attr => {\r\n\t\tif (!attr || !article1Data.value || !article2Data.value) {\r\n\t\t\tconsole.warn(\"缺少必要的渲染数据\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst attr1Data = article1Data.value[attr];\r\n\t\t\tconst attr2Data = article2Data.value[attr];\r\n\r\n\t\t\tif (!attr1Data || !attr2Data) {\r\n\t\t\t\tthrow new Error(`找不到属性 ${attr} 的数据`);\r\n\t\t\t}\r\n\r\n\t\t\t// 获取对应属性的图表容器\r\n\t\t\tconst chart1El = document.querySelector(\r\n\t\t\t\t`.chart-box[data-attribute=\"${attr}\"]`\r\n\t\t\t);\r\n\t\t\tconst chart2El = document.querySelector(\r\n\t\t\t\t`.chart-box[data-attribute=\"${attr}\"]`\r\n\t\t\t);\r\n\r\n\t\t\tif (chart1El) {\r\n\t\t\t\trenderChart(chart1El, attr1Data, \"Line Chart\");\r\n\t\t\t}\r\n\r\n\t\t\tif (chart2El) {\r\n\t\t\t\trenderChart(chart2El, attr2Data, \"Line Chart\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"渲染图表失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `渲染图表失败: ${error.message}`\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 基础样式保持不变... */\r\n\r\n\t/* 新增或修改的样式 */\r\n\t.compare-container {\r\n\t\tflex: 0.6;\r\n\t\tdisplay: flex;\r\n\t\tgap: 15px;\r\n\t\tbackground-color: #ffffff;\r\n\t\tpadding: 20px;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n\t\tmin-height: 400px; /* 保证最小高度 */\r\n\t}\r\n\r\n\t.chart-column {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 20px;\r\n\t}\r\n\r\n\t.attributes-column {\r\n\t\tflex: 0.8;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tmin-width: 200px;\r\n\t}\r\n\r\n\t.chart-box-wrapper {\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t\tborder-radius: 8px;\r\n\t\tpadding: 10px;\r\n\t\tbackground-color: #f9f9f9;\r\n\t}\r\n\r\n\t.attribute-title {\r\n\t\tfont-weight: bold;\r\n\t\tmargin-bottom: 8px;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.chart-box {\r\n\t\twidth: 100%;\r\n\t\theight: 200px; /* 固定高度 */\r\n\t\tmin-height: 200px;\r\n\t}\r\n\r\n\t.empty-chart {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 200px;\r\n\t\tcolor: #666;\r\n\t\tbackground-color: #f0f0f0;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.no-data-prompt {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 100%;\r\n\t\tcolor: #666;\r\n\t\tfont-style: italic;\r\n\t}\r\n\r\n\t.no-attributes {\r\n\t\tpadding: 15px;\r\n\t\tcolor: #666;\r\n\t\ttext-align: center;\r\n\t\tfont-style: italic;\r\n\t}\r\n\r\n\t/* 响应式调整 */\r\n\t@media (max-width: 768px) {\r\n\t\t.compare-container {\r\n\t\t\tflex-direction: column;\r\n\t\t}\r\n\r\n\t\t.attributes-column {\r\n\t\t\torder: -1;\r\n\t\t\tmin-width: auto;\r\n\t\t}\r\n\r\n\t\t.chart-box {\r\n\t\t\theight: 150px;\r\n\t\t}\r\n\r\n\t\t.empty-chart {\r\n\t\t\theight: 150px;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":";AAwGC,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAW,EAAEC,QAAQ,QAAQ,KAAK;AAC3D,OAAOC,GAAG,MAAM,kBAAkB;AAClC,OAAO,KAAKC,EAAE,MAAM,IAAI;AACxB,SACCC,eAAe,EACfC,cAAc,EACdC,cAAc,EACdC,oBAAoB,EACpBC,gBAAgB,EAChBC,qBAAqB,EACrBC,kBAAkB,QACZ,iBAAiB;;AAExB;;;;;;;;;IACA,MAAMC,YAAY,GAAGb,GAAG,CAAC,EAAE,CAAC;IAC5B,MAAMc,WAAW,GAAGd,GAAG,CAAC,EAAE,CAAC;IAC3B,MAAMe,WAAW,GAAGf,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMgB,WAAW,GAAGhB,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAMiB,YAAY,GAAGjB,GAAG,CAAC,IAAI,CAAC;IAC9B,MAAMkB,YAAY,GAAGlB,GAAG,CAAC,IAAI,CAAC;IAC9B,MAAMmB,gBAAgB,GAAGnB,GAAG,CAAC,EAAE,CAAC;IAChC,MAAMoB,iBAAiB,GAAGpB,GAAG,CAAC,IAAI,CAAC;IACnC,MAAMqB,MAAM,GAAGrB,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMsB,MAAM,GAAGtB,GAAG,CAAC,EAAE,CAAC;;IAEtB;IACA,MAAMuB,sBAAsB,GAAGA,CAAA,KAAM;MACpC,IAAI,CAACR,WAAW,CAACS,KAAK,IAAI,CAACR,WAAW,CAACQ,KAAK,EAAE,OAAO,UAAU;MAC/D,IAAI,CAACT,WAAW,CAACS,KAAK,EAAE,OAAO,SAAS;MACxC,IAAI,CAACR,WAAW,CAACQ,KAAK,EAAE,OAAO,SAAS;MACxC,OAAO,OAAO;IACf,CAAC;;IAED;IACA;IACA;;IAEA;IACA,MAAMC,eAAe,GAAGC,IAAI,IAAI;MAC/B,IAAI,CAACA,IAAI,IAAI,CAACP,gBAAgB,CAACK,KAAK,CAACG,QAAQ,CAACD,IAAI,CAAC,EAAE;QACpDE,OAAO,CAACC,IAAI,CAAC,UAAU,EAAEH,IAAI,CAAC;QAC9B;MACD;MACAN,iBAAiB,CAACI,KAAK,GAAGE,IAAI;MAC9BvB,QAAQ,CAAC,MAAM;QACd2B,oBAAoB,CAACJ,IAAI,CAAC;MAC3B,CAAC,CAAC;IACH,CAAC;;IAED;IACA,MAAMI,oBAAoB,GAAGJ,IAAI,IAAI;MACpC,IAAI,CAACA,IAAI,IAAI,CAACT,YAAY,CAACO,KAAK,IAAI,CAACN,YAAY,CAACM,KAAK,EAAE;QACxDI,OAAO,CAACC,IAAI,CAAC,WAAW,CAAC;QACzB;MACD;MAEA,IAAI;QACH,MAAME,SAAS,GAAGd,YAAY,CAACO,KAAK,CAACE,IAAI,CAAC;QAC1C,MAAMM,SAAS,GAAGd,YAAY,CAACM,KAAK,CAACE,IAAI,CAAC;QAE1C,IAAI,CAACK,SAAS,IAAI,CAACC,SAAS,EAAE;UAC7B,MAAM,IAAIC,KAAK,CAAC,SAASP,IAAI,MAAM,CAAC;QACrC;;QAEA;QACA,MAAMQ,QAAQ,GAAGC,QAAQ,CAACC,aAAa,CACtC,8BAA8BV,IAAI,IACnC,CAAC;QACD,MAAMW,QAAQ,GAAGF,QAAQ,CAACC,aAAa,CACtC,8BAA8BV,IAAI,IACnC,CAAC;QAED,IAAIQ,QAAQ,EAAE;UACbI,WAAW,CAACJ,QAAQ,EAAEH,SAAS,EAAE,YAAY,CAAC;QAC/C;QAEA,IAAIM,QAAQ,EAAE;UACbC,WAAW,CAACD,QAAQ,EAAEL,SAAS,EAAE,YAAY,CAAC;QAC/C;MACD,CAAC,CAAC,OAAOO,KAAK,EAAE;QACfX,OAAO,CAACW,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/BzB,WAAW,CAACU,KAAK,CAACgB,IAAI,CAAC;UACtBC,IAAI,EAAE,WAAW;UACjBC,OAAO,EAAE,WAAWH,KAAK,CAACI,OAAO;QAClC,CAAC,CAAC;MACH;IACD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}