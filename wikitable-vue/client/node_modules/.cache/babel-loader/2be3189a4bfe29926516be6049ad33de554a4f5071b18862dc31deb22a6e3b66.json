{"ast":null,"code":"import { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0c150cb4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  ref: \"chartContainer\",\n  class: \"sparkline-container\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"no-data-message\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [!$setup.hasData ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _toDisplayString($setup.noDataMessage), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)], 512 /* NEED_PATCH */);\n}","map":{"version":3,"names":["ref","class","key","_createElementBlock","_hoisted_1","$setup","hasData","_hoisted_2","_toDisplayString","noDataMessage","_createCommentVNode"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\SparklineChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"sparkline-container\">\r\n\t\t<div v-if=\"!hasData\" class=\"no-data-message\">\r\n\t\t\t{{ noDataMessage }}\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 250\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 80\r\n\t\t},\r\n\t\tcolor: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: \"#4a90e2\"\r\n\t\t},\r\n\t\tshowDots: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tshowTooltip: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartContainer = ref(null);\r\n\tconst tooltip = ref(null);\r\n\tconst hasData = computed(() => props.data?.length > 0);\r\n\tconst noDataMessage = computed(() => \"无数据\");\r\n\r\n\tconst drawChart = () => {\r\n\t\tif (!chartContainer.value || !hasData.value) return;\r\n\r\n\t\td3.select(chartContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\tconst margin = { top: 5, right: 5, bottom: 5, left: 5 };\r\n\t\tconst width = props.width - margin.left - margin.right;\r\n\t\tconst height = props.height - margin.top - margin.bottom;\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(chartContainer.value)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", props.width)\r\n\t\t\t.attr(\"height\", props.height)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n\t\tconst data = props.data.sort((a, b) => a.year - b.year);\r\n\r\n\t\tconst x = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain(d3.extent(data, d => d.year))\r\n\t\t\t.range([0, width]);\r\n\r\n\t\tconst y = d3\r\n\t\t\t.scaleLinear()\r\n\t\t\t.domain([0, d3.max(data, d => d.value) * 1.1])\r\n\t\t\t.range([height, 0]);\r\n\r\n\t\tconst line = d3\r\n\t\t\t.line()\r\n\t\t\t.x(d => x(d.year))\r\n\t\t\t.y(d => y(d.value))\r\n\t\t\t.curve(d3.curveMonotoneX);\r\n\r\n\t\tsvg\r\n\t\t\t.append(\"path\")\r\n\t\t\t.datum(data)\r\n\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t.attr(\"stroke\", props.color)\r\n\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t.attr(\"d\", line);\r\n\r\n\t\tif (props.showDots) {\r\n\t\t\tsvg\r\n\t\t\t\t.selectAll(\".dot\")\r\n\t\t\t\t.data(data)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append(\"circle\")\r\n\t\t\t\t.attr(\"class\", \"dot\")\r\n\t\t\t\t.attr(\"cx\", d => x(d.year))\r\n\t\t\t\t.attr(\"cy\", d => y(d.value))\r\n\t\t\t\t.attr(\"r\", 3)\r\n\t\t\t\t.attr(\"fill\", props.color);\r\n\t\t}\r\n\r\n\t\tif (props.showTooltip) {\r\n\t\t\t// 添加工具提示\r\n\t\t\tconst tooltip = svg\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"tooltip\")\r\n\t\t\t\t.style(\"opacity\", 0);\r\n\r\n\t\t\ttooltip\r\n\t\t\t\t.append(\"rect\")\r\n\t\t\t\t.attr(\"class\", \"tooltip-box\")\r\n\t\t\t\t.attr(\"rx\", 4)\r\n\t\t\t\t.attr(\"ry\", 4);\r\n\r\n\t\t\ttooltip\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"class\", \"tooltip-text\")\r\n\t\t\t\t.attr(\"x\", 6)\r\n\t\t\t\t.attr(\"y\", 18);\r\n\r\n\t\t\tsvg\r\n\t\t\t\t.append(\"rect\")\r\n\t\t\t\t.attr(\"class\", \"overlay\")\r\n\t\t\t\t.attr(\"width\", width)\r\n\t\t\t\t.attr(\"height\", height)\r\n\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t.attr(\"pointer-events\", \"all\")\r\n\t\t\t\t.on(\"mouseover\", () => tooltip.style(\"opacity\", 1))\r\n\t\t\t\t.on(\"mouseout\", () => tooltip.style(\"opacity\", 0))\r\n\t\t\t\t.on(\"mousemove\", event => {\r\n\t\t\t\t\tconst [mouseX] = d3.pointer(event);\r\n\t\t\t\t\tconst year = x.invert(mouseX);\r\n\t\t\t\t\tconst closest = d3.least(data, d => Math.abs(x(d.year) - mouseX));\r\n\r\n\t\t\t\t\tif (closest) {\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.select(\".tooltip-text\")\r\n\t\t\t\t\t\t\t.text(`${closest.year}: ${closest.value.toLocaleString()}`);\r\n\r\n\t\t\t\t\t\tconst bbox = tooltip.select(\".tooltip-text\").node().getBBox();\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.select(\".tooltip-box\")\r\n\t\t\t\t\t\t\t.attr(\"x\", -5)\r\n\t\t\t\t\t\t\t.attr(\"y\", -5)\r\n\t\t\t\t\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t\t\t\t\t.attr(\"height\", bbox.height + 10);\r\n\r\n\t\t\t\t\t\ttooltip.attr(\r\n\t\t\t\t\t\t\t\"transform\",\r\n\t\t\t\t\t\t\t`translate(${Math.min(\r\n\t\t\t\t\t\t\t\twidth - bbox.width - 10,\r\n\t\t\t\t\t\t\t\tMath.max(10, x(closest.year) - bbox.width / 2)\r\n\t\t\t\t\t\t\t)},${y(closest.value) - 20})`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\twatch(() => [props.data, props.width, props.height, props.color], drawChart);\r\n\tonMounted(drawChart);\r\n</script>\r\n\r\n<style scoped>\r\n\t.sparkline-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.no-data-message {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\tcolor: #94a3b8;\r\n\t\tfont-size: 12px;\r\n\t\ttext-align: center;\r\n\t\twidth: 100%;\r\n\t}\r\n</style>\r\n\r\n<style>\r\n\t/* 工具提示样式 */\r\n\t.tooltip-box {\r\n\t\tfill: white;\r\n\t\tstroke: #e2e8f0;\r\n\t\tstroke-width: 1;\r\n\t\tfilter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));\r\n\t}\r\n\r\n\t.tooltip-text {\r\n\t\tfont-size: 12px;\r\n\t\tfont-weight: 500;\r\n\t\tfill: #334155;\r\n\t}\r\n</style>\r\n"],"mappings":";;;EACMA,GAAG,EAAC,gBAAgB;EAACC,KAAK,EAAC;;;EADjCC,GAAA;EAEuBD,KAAK,EAAC;;;uBAD5BE,mBAAA,CAIM,OAJNC,UAIM,G,CAHOC,MAAA,CAAAC,OAAO,I,cAAnBH,mBAAA,CAEM,OAFNI,UAEM,EAAAC,gBAAA,CADFH,MAAA,CAAAI,aAAa,oBAHnBC,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}