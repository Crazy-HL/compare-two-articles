{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nexport default {\n  name: \"App\",\n  data() {\n    return {\n      url: \"\",\n      content: \"\",\n      styles: \"\",\n      highlights: [],\n      extractedText: \"\"\n    };\n  },\n  methods: {\n    // 加载网页内容\n    async loadPage() {\n      if (!this.url) {\n        alert(\"请输入网址\");\n        return;\n      }\n      try {\n        const response = await axios.get(`http://localhost:5001/fetch?url=${encodeURIComponent(this.url)}`);\n        this.content = response.data.content;\n        this.styles = response.data.styles;\n\n        // 等待 Vue 渲染完成后再添加事件监听\n        this.$nextTick(() => {\n          const pageContent = document.getElementById(\"pageContent\");\n          pageContent.addEventListener(\"mouseup\", this.handleSelection);\n        });\n\n        // 动态添加页面样式\n        this.addStyles();\n      } catch (error) {\n        console.error(\"加载内容失败:\", error);\n        alert(\"加载内容失败\");\n      }\n    },\n    // 处理文本选中事件\n    handleSelection() {\n      const selection = window.getSelection();\n      const selectedText = selection.toString().trim();\n      if (selectedText) {\n        // 高亮选中的文本\n        const range = selection.getRangeAt(0);\n        this.highlightText(range);\n\n        // 提取选中的文本\n        this.extractedText = selectedText;\n\n        // 序列化选区信息\n        const serializedRange = this.serializeRange(range);\n        this.highlights.push(serializedRange);\n      }\n    },\n    // 高亮选中的文本\n    highlightText(range) {\n      const span = document.createElement(\"span\");\n      span.className = \"highlight\";\n      range.surroundContents(span);\n    },\n    // 序列化选区信息\n    serializeRange(range) {\n      return {\n        startContainer: range.startContainer.parentElement.outerHTML,\n        startOffset: range.startOffset,\n        endContainer: range.endContainer.parentElement.outerHTML,\n        endOffset: range.endOffset,\n        text: range.toString()\n      };\n    },\n    // 反序列化选区信息\n    deserializeRange(serialized) {\n      const pageContent = document.getElementById(\"pageContent\");\n      const walker = document.createTreeWalker(pageContent, NodeFilter.SHOW_TEXT);\n      let startNode, endNode;\n      while (walker.nextNode()) {\n        if (walker.currentNode.parentElement.outerHTML === serialized.startContainer) {\n          startNode = walker.currentNode;\n        }\n        if (walker.currentNode.parentElement.outerHTML === serialized.endContainer) {\n          endNode = walker.currentNode;\n        }\n      }\n      if (startNode && endNode) {\n        const range = document.createRange();\n        range.setStart(startNode, serialized.startOffset);\n        range.setEnd(endNode, serialized.endOffset);\n        return range;\n      }\n      return null;\n    },\n    // 保存高亮信息\n    saveHighlights() {\n      localStorage.setItem(\"highlights\", JSON.stringify(this.highlights));\n      alert(\"高亮已保存！\");\n    },\n    // 加载高亮信息\n    loadHighlights() {\n      const savedHighlights = JSON.parse(localStorage.getItem(\"highlights\") || \"[]\");\n      savedHighlights.forEach(serialized => {\n        const range = this.deserializeRange(serialized);\n        if (range) {\n          this.highlightText(range);\n        }\n      });\n      alert(\"高亮已加载！\");\n    },\n    // 动态插入样式\n    addStyles() {\n      const styleTag = document.createElement(\"style\");\n      styleTag.innerHTML = this.styles;\n      document.head.appendChild(styleTag);\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","url","content","styles","highlights","extractedText","methods","loadPage","alert","response","get","encodeURIComponent","$nextTick","pageContent","document","getElementById","addEventListener","handleSelection","addStyles","error","console","selection","window","getSelection","selectedText","toString","trim","range","getRangeAt","highlightText","serializedRange","serializeRange","push","span","createElement","className","surroundContents","startContainer","parentElement","outerHTML","startOffset","endContainer","endOffset","text","deserializeRange","serialized","walker","createTreeWalker","NodeFilter","SHOW_TEXT","startNode","endNode","nextNode","currentNode","createRange","setStart","setEnd","saveHighlights","localStorage","setItem","JSON","stringify","loadHighlights","savedHighlights","parse","getItem","forEach","styleTag","innerHTML","head","appendChild"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\test.vue"],"sourcesContent":["<template>\r\n\t<div id=\"app\">\r\n\t\t<h1>网页内容高亮工具</h1>\r\n\r\n\t\t<div>\r\n\t\t\t<label for=\"urlInput\">输入网页网址：</label>\r\n\t\t\t<input v-model=\"url\" placeholder=\"例如：http://example.com\" />\r\n\t\t\t<button @click=\"loadPage\">加载页面</button>\r\n\t\t</div>\r\n\r\n\t\t<div id=\"pageContent\" v-html=\"content\" @mouseup=\"handleSelection\"></div>\r\n\r\n\t\t<div>\r\n\t\t\t<button @click=\"saveHighlights\">保存高亮</button>\r\n\t\t\t<button @click=\"loadHighlights\">加载高亮</button>\r\n\t\t</div>\r\n\r\n\t\t<div>\r\n\t\t\t<h2>提取的文本：</h2>\r\n\t\t\t<pre>{{ extractedText }}</pre>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport axios from \"axios\";\r\n\r\n\texport default {\r\n\t\tname: \"App\",\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\turl: \"\",\r\n\t\t\t\tcontent: \"\",\r\n\t\t\t\tstyles: \"\",\r\n\t\t\t\thighlights: [],\r\n\t\t\t\textractedText: \"\"\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 加载网页内容\r\n\t\t\tasync loadPage() {\r\n\t\t\t\tif (!this.url) {\r\n\t\t\t\t\talert(\"请输入网址\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst response = await axios.get(\r\n\t\t\t\t\t\t`http://localhost:5001/fetch?url=${encodeURIComponent(this.url)}`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.content = response.data.content;\r\n\t\t\t\t\tthis.styles = response.data.styles;\r\n\r\n\t\t\t\t\t// 等待 Vue 渲染完成后再添加事件监听\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tconst pageContent = document.getElementById(\"pageContent\");\r\n\t\t\t\t\t\tpageContent.addEventListener(\"mouseup\", this.handleSelection);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 动态添加页面样式\r\n\t\t\t\t\tthis.addStyles();\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"加载内容失败:\", error);\r\n\t\t\t\t\talert(\"加载内容失败\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 处理文本选中事件\r\n\t\t\thandleSelection() {\r\n\t\t\t\tconst selection = window.getSelection();\r\n\t\t\t\tconst selectedText = selection.toString().trim();\r\n\r\n\t\t\t\tif (selectedText) {\r\n\t\t\t\t\t// 高亮选中的文本\r\n\t\t\t\t\tconst range = selection.getRangeAt(0);\r\n\t\t\t\t\tthis.highlightText(range);\r\n\r\n\t\t\t\t\t// 提取选中的文本\r\n\t\t\t\t\tthis.extractedText = selectedText;\r\n\r\n\t\t\t\t\t// 序列化选区信息\r\n\t\t\t\t\tconst serializedRange = this.serializeRange(range);\r\n\t\t\t\t\tthis.highlights.push(serializedRange);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t// 高亮选中的文本\r\n\t\t\thighlightText(range) {\r\n\t\t\t\tconst span = document.createElement(\"span\");\r\n\t\t\t\tspan.className = \"highlight\";\r\n\t\t\t\trange.surroundContents(span);\r\n\t\t\t},\r\n\r\n\t\t\t// 序列化选区信息\r\n\t\t\tserializeRange(range) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstartContainer: range.startContainer.parentElement.outerHTML,\r\n\t\t\t\t\tstartOffset: range.startOffset,\r\n\t\t\t\t\tendContainer: range.endContainer.parentElement.outerHTML,\r\n\t\t\t\t\tendOffset: range.endOffset,\r\n\t\t\t\t\ttext: range.toString()\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\t// 反序列化选区信息\r\n\t\t\tdeserializeRange(serialized) {\r\n\t\t\t\tconst pageContent = document.getElementById(\"pageContent\");\r\n\t\t\t\tconst walker = document.createTreeWalker(\r\n\t\t\t\t\tpageContent,\r\n\t\t\t\t\tNodeFilter.SHOW_TEXT\r\n\t\t\t\t);\r\n\r\n\t\t\t\tlet startNode, endNode;\r\n\t\t\t\twhile (walker.nextNode()) {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\twalker.currentNode.parentElement.outerHTML ===\r\n\t\t\t\t\t\tserialized.startContainer\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tstartNode = walker.currentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\twalker.currentNode.parentElement.outerHTML ===\r\n\t\t\t\t\t\tserialized.endContainer\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tendNode = walker.currentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (startNode && endNode) {\r\n\t\t\t\t\tconst range = document.createRange();\r\n\t\t\t\t\trange.setStart(startNode, serialized.startOffset);\r\n\t\t\t\t\trange.setEnd(endNode, serialized.endOffset);\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\r\n\t\t\t// 保存高亮信息\r\n\t\t\tsaveHighlights() {\r\n\t\t\t\tlocalStorage.setItem(\"highlights\", JSON.stringify(this.highlights));\r\n\t\t\t\talert(\"高亮已保存！\");\r\n\t\t\t},\r\n\r\n\t\t\t// 加载高亮信息\r\n\t\t\tloadHighlights() {\r\n\t\t\t\tconst savedHighlights = JSON.parse(\r\n\t\t\t\t\tlocalStorage.getItem(\"highlights\") || \"[]\"\r\n\t\t\t\t);\r\n\t\t\t\tsavedHighlights.forEach(serialized => {\r\n\t\t\t\t\tconst range = this.deserializeRange(serialized);\r\n\t\t\t\t\tif (range) {\r\n\t\t\t\t\t\tthis.highlightText(range);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\talert(\"高亮已加载！\");\r\n\t\t\t},\r\n\r\n\t\t\t// 动态插入样式\r\n\t\t\taddStyles() {\r\n\t\t\t\tconst styleTag = document.createElement(\"style\");\r\n\t\t\t\tstyleTag.innerHTML = this.styles;\r\n\t\t\t\tdocument.head.appendChild(styleTag);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 可以为页面添加一些自定义样式 */\r\n\t#pageContent img {\r\n\t\tmax-width: 100%;\r\n\t\theight: auto;\r\n\t}\r\n\r\n\t#pageContent p {\r\n\t\tline-height: 1.6;\r\n\t\tmargin-bottom: 10px;\r\n\t}\r\n\r\n\t.highlight {\r\n\t\tbackground-color: yellow;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}