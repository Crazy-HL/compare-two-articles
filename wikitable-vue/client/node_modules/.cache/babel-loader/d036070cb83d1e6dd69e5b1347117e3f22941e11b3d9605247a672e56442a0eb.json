{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, computed, onMounted, watch } from \"vue\";\nimport * as echarts from \"echarts\";\nexport default {\n  __name: 'BarChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => []\n    },\n    yRange: {\n      type: Array,\n      default: null\n    },\n    compareData: {\n      type: [Array, Object],\n      default: () => []\n    }\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartEl = ref(null);\n    let chartInstance = null;\n\n    // 确保compareData是数组\n    const normalizedCompareData = computed(() => {\n      if (Array.isArray(props.compareData)) return props.compareData;\n      if (props.compareData && typeof props.compareData === \"object\") return [props.compareData];\n      return [];\n    });\n    const initChart = () => {\n      if (!chartEl.value) return;\n      chartInstance = echarts.init(chartEl.value);\n\n      // 自动计算Y轴范围\n      const allValues = [...props.data.map(item => item.value), ...normalizedCompareData.value.map(item => item.value)].filter(v => !isNaN(v));\n      const maxValue = allValues.length ? Math.max(...allValues) : 100;\n      const minValue = allValues.length ? Math.min(0, ...allValues) : 0;\n      const series = [{\n        name: \"当前数据\",\n        type: \"bar\",\n        barWidth: \"40%\",\n        data: props.data.map(item => item.value),\n        itemStyle: {\n          color: \"#3498db\"\n        },\n        label: {\n          show: true,\n          position: \"top\",\n          formatter: params => {\n            const value = params.value;\n            if (value >= 1e12) return `${(value / 1e12).toFixed(2)}T`;\n            if (value >= 1e9) return `${(value / 1e9).toFixed(2)}B`;\n            if (value >= 1e6) return `${(value / 1e6).toFixed(2)}M`;\n            return value.toFixed(2);\n          }\n        }\n      }];\n\n      // 使用normalizedCompareData\n      if (normalizedCompareData.value.length > 0) {\n        series.push({\n          name: \"对比数据\",\n          type: \"bar\",\n          barWidth: \"40%\",\n          data: normalizedCompareData.value.map(item => item.value),\n          itemStyle: {\n            color: \"#e74c3c\"\n          },\n          label: {\n            show: true,\n            position: \"top\",\n            formatter: params => {\n              const value = params.value;\n              if (value >= 1e12) return `${(value / 1e12).toFixed(2)}T`;\n              if (value >= 1e9) return `${(value / 1e9).toFixed(2)}B`;\n              if (value >= 1e6) return `${(value / 1e6).toFixed(2)}M`;\n              return value.toFixed(2);\n            }\n          }\n        });\n      }\n      const option = {\n        tooltip: {\n          trigger: \"axis\",\n          axisPointer: {\n            type: \"shadow\"\n          },\n          formatter: params => {\n            return params.map(param => {\n              const value = param.value;\n              let displayValue;\n              if (value >= 1e12) displayValue = `${(value / 1e12).toFixed(2)} trillion`;else if (value >= 1e9) displayValue = `${(value / 1e9).toFixed(2)} billion`;else if (value >= 1e6) displayValue = `${(value / 1e6).toFixed(2)} million`;else displayValue = value.toFixed(2);\n              return `${param.seriesName}<br/>${param.name}: ${displayValue}`;\n            }).join(\"<br/>\");\n          }\n        },\n        grid: {\n          left: \"3%\",\n          right: \"4%\",\n          bottom: \"3%\",\n          containLabel: true\n        },\n        xAxis: {\n          type: \"category\",\n          data: props.data.map(item => item.name),\n          axisLabel: {\n            interval: 0,\n            rotate: props.data.length > 3 ? 30 : 0\n          }\n        },\n        yAxis: {\n          type: \"value\",\n          min: props.yRange?.[0] ?? minValue,\n          max: props.yRange?.[1] ?? maxValue * 1.1,\n          axisLabel: {\n            formatter: value => {\n              if (value >= 1e12) return `${(value / 1e12).toFixed(1)}T`;\n              if (value >= 1e9) return `${(value / 1e9).toFixed(1)}B`;\n              if (value >= 1e6) return `${(value / 1e6).toFixed(1)}M`;\n              return value;\n            }\n          }\n        },\n        series\n      };\n      chartInstance.setOption(option);\n    };\n    onMounted(() => {\n      initChart();\n      window.addEventListener(\"resize\", () => chartInstance?.resize());\n    });\n    watch(() => [props.data, normalizedCompareData.value, props.yRange], () => {\n      if (chartInstance) {\n        initChart();\n      }\n    }, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartEl,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      normalizedCompareData,\n      initChart,\n      ref,\n      computed,\n      onMounted,\n      watch,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","echarts","props","__props","chartEl","chartInstance","normalizedCompareData","Array","isArray","compareData","initChart","value","init","allValues","data","map","item","filter","v","isNaN","maxValue","length","Math","max","minValue","min","series","name","type","barWidth","itemStyle","color","label","show","position","formatter","params","toFixed","push","option","tooltip","trigger","axisPointer","param","displayValue","seriesName","join","grid","left","right","bottom","containLabel","xAxis","axisLabel","interval","rotate","yAxis","yRange","setOption","window","addEventListener","resize","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/BarChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartEl\" class=\"bar-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, computed, onMounted, watch } from \"vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => []\r\n\t\t},\r\n\t\tyRange: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: null\r\n\t\t},\r\n\t\tcompareData: {\r\n\t\t\ttype: [Array, Object],\r\n\t\t\tdefault: () => []\r\n\t\t}\r\n\t});\r\n\r\n\tconst chartEl = ref(null);\r\n\tlet chartInstance = null;\r\n\r\n\t// 确保compareData是数组\r\n\tconst normalizedCompareData = computed(() => {\r\n\t\tif (Array.isArray(props.compareData)) return props.compareData;\r\n\t\tif (props.compareData && typeof props.compareData === \"object\")\r\n\t\t\treturn [props.compareData];\r\n\t\treturn [];\r\n\t});\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartEl.value) return;\r\n\r\n\t\tchartInstance = echarts.init(chartEl.value);\r\n\r\n\t\t// 自动计算Y轴范围\r\n\t\tconst allValues = [\r\n\t\t\t...props.data.map(item => item.value),\r\n\t\t\t...normalizedCompareData.value.map(item => item.value)\r\n\t\t].filter(v => !isNaN(v));\r\n\r\n\t\tconst maxValue = allValues.length ? Math.max(...allValues) : 100;\r\n\t\tconst minValue = allValues.length ? Math.min(0, ...allValues) : 0;\r\n\r\n\t\tconst series = [\r\n\t\t\t{\r\n\t\t\t\tname: \"当前数据\",\r\n\t\t\t\ttype: \"bar\",\r\n\t\t\t\tbarWidth: \"40%\",\r\n\t\t\t\tdata: props.data.map(item => item.value),\r\n\t\t\t\titemStyle: {\r\n\t\t\t\t\tcolor: \"#3498db\"\r\n\t\t\t\t},\r\n\t\t\t\tlabel: {\r\n\t\t\t\t\tshow: true,\r\n\t\t\t\t\tposition: \"top\",\r\n\t\t\t\t\tformatter: params => {\r\n\t\t\t\t\t\tconst value = params.value;\r\n\t\t\t\t\t\tif (value >= 1e12) return `${(value / 1e12).toFixed(2)}T`;\r\n\t\t\t\t\t\tif (value >= 1e9) return `${(value / 1e9).toFixed(2)}B`;\r\n\t\t\t\t\t\tif (value >= 1e6) return `${(value / 1e6).toFixed(2)}M`;\r\n\t\t\t\t\t\treturn value.toFixed(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t];\r\n\r\n\t\t// 使用normalizedCompareData\r\n\t\tif (normalizedCompareData.value.length > 0) {\r\n\t\t\tseries.push({\r\n\t\t\t\tname: \"对比数据\",\r\n\t\t\t\ttype: \"bar\",\r\n\t\t\t\tbarWidth: \"40%\",\r\n\t\t\t\tdata: normalizedCompareData.value.map(item => item.value),\r\n\t\t\t\titemStyle: {\r\n\t\t\t\t\tcolor: \"#e74c3c\"\r\n\t\t\t\t},\r\n\t\t\t\tlabel: {\r\n\t\t\t\t\tshow: true,\r\n\t\t\t\t\tposition: \"top\",\r\n\t\t\t\t\tformatter: params => {\r\n\t\t\t\t\t\tconst value = params.value;\r\n\t\t\t\t\t\tif (value >= 1e12) return `${(value / 1e12).toFixed(2)}T`;\r\n\t\t\t\t\t\tif (value >= 1e9) return `${(value / 1e9).toFixed(2)}B`;\r\n\t\t\t\t\t\tif (value >= 1e6) return `${(value / 1e6).toFixed(2)}M`;\r\n\t\t\t\t\t\treturn value.toFixed(2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst option = {\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: \"axis\",\r\n\t\t\t\taxisPointer: {\r\n\t\t\t\t\ttype: \"shadow\"\r\n\t\t\t\t},\r\n\t\t\t\tformatter: params => {\r\n\t\t\t\t\treturn params\r\n\t\t\t\t\t\t.map(param => {\r\n\t\t\t\t\t\t\tconst value = param.value;\r\n\t\t\t\t\t\t\tlet displayValue;\r\n\t\t\t\t\t\t\tif (value >= 1e12)\r\n\t\t\t\t\t\t\t\tdisplayValue = `${(value / 1e12).toFixed(2)} trillion`;\r\n\t\t\t\t\t\t\telse if (value >= 1e9)\r\n\t\t\t\t\t\t\t\tdisplayValue = `${(value / 1e9).toFixed(2)} billion`;\r\n\t\t\t\t\t\t\telse if (value >= 1e6)\r\n\t\t\t\t\t\t\t\tdisplayValue = `${(value / 1e6).toFixed(2)} million`;\r\n\t\t\t\t\t\t\telse displayValue = value.toFixed(2);\r\n\r\n\t\t\t\t\t\t\treturn `${param.seriesName}<br/>${param.name}: ${displayValue}`;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.join(\"<br/>\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgrid: {\r\n\t\t\t\tleft: \"3%\",\r\n\t\t\t\tright: \"4%\",\r\n\t\t\t\tbottom: \"3%\",\r\n\t\t\t\tcontainLabel: true\r\n\t\t\t},\r\n\t\t\txAxis: {\r\n\t\t\t\ttype: \"category\",\r\n\t\t\t\tdata: props.data.map(item => item.name),\r\n\t\t\t\taxisLabel: {\r\n\t\t\t\t\tinterval: 0,\r\n\t\t\t\t\trotate: props.data.length > 3 ? 30 : 0\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tyAxis: {\r\n\t\t\t\ttype: \"value\",\r\n\t\t\t\tmin: props.yRange?.[0] ?? minValue,\r\n\t\t\t\tmax: props.yRange?.[1] ?? maxValue * 1.1,\r\n\t\t\t\taxisLabel: {\r\n\t\t\t\t\tformatter: value => {\r\n\t\t\t\t\t\tif (value >= 1e12) return `${(value / 1e12).toFixed(1)}T`;\r\n\t\t\t\t\t\tif (value >= 1e9) return `${(value / 1e9).toFixed(1)}B`;\r\n\t\t\t\t\t\tif (value >= 1e6) return `${(value / 1e6).toFixed(1)}M`;\r\n\t\t\t\t\t\treturn value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tseries\r\n\t\t};\r\n\r\n\t\tchartInstance.setOption(option);\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", () => chartInstance?.resize());\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => [props.data, normalizedCompareData.value, props.yRange],\r\n\t\t() => {\r\n\t\t\tif (chartInstance) {\r\n\t\t\t\tinitChart();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n</script>\r\n\r\n<style scoped>\r\n\t.bar-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 150px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}