{"ast":null,"code":"import { computed, ref, onMounted, watch, nextTick } from \"vue\";\nimport * as d3 from \"d3\";\nexport default {\n  props: {\n    field: {\n      type: [Object, Array, String, Number],\n      default: null\n    },\n    type: {\n      type: String,\n      default: \"\"\n    },\n    visualization: {\n      type: String,\n      default: \"\"\n    },\n    fieldKey: {\n      type: String,\n      default: \"\"\n    },\n    unifiedMax: {\n      type: Number,\n      default: null\n    }\n  },\n  emits: [\"chartClick\"],\n  setup(props, _ref) {\n    let {\n      emit\n    } = _ref;\n    const hoveredIndex = ref(null);\n    const activeIndex = ref(null);\n    const isTextHovered = ref(false);\n\n    // 容器引用\n    const pieContainer = ref(null);\n    const barContainer = ref(null);\n    const lineContainer = ref(null);\n    const stackedContainer = ref(null);\n\n    // 颜色定义\n    const colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\n    const remainderColor = \"#f0f0f0\";\n\n    // 处理后的字段数据\n    const processedField = computed(() => {\n      if (!props.field) return null;\n      if (Array.isArray(props.field)) {\n        return props.field.map(item => {\n          // 假设 item 从 CompareTable 传来时，已经有 name 和 value\n          if (typeof item === \"object\" && item !== null) {\n            return {\n              name: item.name || \"Unknown\",\n              // 确保 name 存在\n              value: item.value !== undefined ? item.value : 0,\n              // 确保 value 存在\n              raw: item.raw || JSON.stringify(item),\n              unit: item.unit,\n              type: item.type\n              // 其他需要的属性\n            };\n          }\n          // 对于非对象 item (理论上不应发生，因为 getField 会处理)\n          return {\n            name: String(item),\n            value: 0,\n            raw: String(item)\n          };\n        });\n      }\n\n      // 如果 props.field 是单个对象 (非数组)\n      if (typeof props.field === \"object\" && props.field !== null) {\n        return {\n          name: props.field.name || \"Unknown\",\n          value: props.field.value !== undefined ? props.field.value : 0,\n          raw: props.field.raw || JSON.stringify(props.field),\n          unit: props.field.unit,\n          type: props.field.type\n        };\n      }\n\n      // 如果 props.field 是原始值 (字符串/数字)\n      return {\n        name: String(props.field),\n        value: 0,\n        raw: String(props.field)\n      };\n    });\n\n    // 初始化图表\n    onMounted(() => {\n      watch(() => [processedField.value, props.visualization, props.unifiedMax], () => {\n        nextTick(() => {\n          if (props.visualization === \"pie-chart\" && hasData.value && isValidPieData.value) {\n            renderPieChart();\n          } else if (props.visualization === \"bar-chart\" && hasData.value) {\n            renderBarChart();\n          } else if (props.visualization === \"line-chart\" && hasData.value) {\n            renderLineChart();\n          } else if (props.visualization === \"stacked-chart\" && hasData.value) {\n            renderStackedChart();\n          }\n        });\n      }, {\n        immediate: true,\n        deep: true\n      });\n    });\n\n    // 渲染饼图（添加剩余比例）\n    const renderPieChart = () => {\n      if (!pieContainer.value) return;\n\n      // 清除旧图表\n      d3.select(pieContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(pieContainer.value);\n      const containerWidth = pieContainer.value.clientWidth;\n      const containerHeight = pieContainer.value.clientHeight;\n\n      // 使用高度作为基准尺寸，确保饼图大小不变\n      const size = containerHeight * 0.9; // 饼图大小基于高度\n      const radius = size / 2;\n\n      // 创建SVG，宽度100%，高度固定\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${containerWidth} ${containerHeight}`).append(\"g\").attr(\"transform\", `translate(${containerWidth / 2}, ${containerHeight / 2})`);\n\n      // 判断是否是单值饼图\n      const isSingleValue = props.fieldKey === \"Inflation (CPI)\";\n\n      // 处理数据 - 如果是单值，添加剩余部分\n      const processedData = isSingleValue ? [{\n        ...pieData.value[0],\n        color: colors[0],\n        isMainValue: true\n      }, {\n        value: Math.max(0, 100 - pieData.value[0].value),\n        name: \"剩余\",\n        color: remainderColor,\n        isRemainder: true,\n        index: 1\n      }] : pieData.value.map((d, i) => ({\n        ...d,\n        color: colors[i % colors.length],\n        isMainValue: true\n      }));\n      const pie = d3.pie().value(d => d.value).sort(null);\n      const arc = d3.arc().innerRadius(0).outerRadius(radius * 0.9).cornerRadius(2);\n      const arcs = svg.selectAll(\".arc\").data(pie(processedData)).enter().append(\"g\").attr(\"class\", \"arc\");\n\n      // 创建tooltip\n      const tooltip = container.append(\"div\").attr(\"class\", \"d3-tooltip\").style(\"position\", \"absolute\").style(\"visibility\", \"hidden\").style(\"background\", \"rgba(0,0,0,0.8)\").style(\"color\", \"white\").style(\"padding\", \"6px 12px\").style(\"border-radius\", \"4px\").style(\"font-size\", \"12px\");\n\n      // 绘制扇形\n      arcs.append(\"path\").attr(\"d\", arc).attr(\"fill\", d => d.data.color).style(\"opacity\", d => d.data.isRemainder ? 0.6 : 0.8).style(\"stroke\", \"#fff\").style(\"stroke-width\", 1).on(\"mouseover\", function (event, d) {\n        if (d.data.isRemainder) return;\n        hoveredIndex.value = d.data.index;\n        d3.select(this).transition().duration(200).style(\"opacity\", 1).attr(\"transform\", \"scale(1.05)\");\n        tooltip.style(\"visibility\", \"visible\").html(`${d.data.name}: ${d.data.value.toFixed(1)}${props.type === \"percentage\" ? \"%\" : \"\"}`);\n      }).on(\"mousemove\", function (event) {\n        tooltip.style(\"top\", event.offsetY + 10 + \"px\").style(\"left\", event.offsetX + 10 + \"px\");\n      }).on(\"mouseout\", function (event, d) {\n        if (d.data.isRemainder) return;\n        hoveredIndex.value = null;\n        d3.select(this).transition().duration(200).style(\"opacity\", d.data.isRemainder ? 0.6 : 0.8).attr(\"transform\", \"scale(1)\");\n        tooltip.style(\"visibility\", \"hidden\");\n      }).on(\"click\", function (event, d) {\n        if (d.data.isRemainder) return;\n        activeIndex.value = d.data.index;\n        emit(\"chartClick\", {\n          type: \"pie\",\n          index: d.data.index,\n          data: d.data,\n          value: d.data.value\n        });\n      });\n\n      // 单值饼图的中心文字\n      if (isSingleValue) {\n        svg.append(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \".3em\").text(`${pieData.value[0].value.toFixed(1)}${props.type === \"percentage\" ? \"%\" : \"\"}`).style(\"font-size\", \"14px\").style(\"fill\", \"#333\");\n      }\n\n      // 多值饼图的图例 - 修改为右上角放置\n      if (!isSingleValue && pieData.value.length > 1) {\n        const legend = svg.append(\"g\").attr(\"class\", \"legend\");\n        const legendItemSize = 12;\n        const legendSpacing = 4;\n        const legendStartX = containerWidth / 2 - 100; // 从中心向右偏移\n        const legendStartY = -containerHeight / 2 + 20; // 从顶部向下偏移\n\n        pieData.value.forEach((d, i) => {\n          const legendItem = legend.append(\"g\").attr(\"transform\", `translate(${legendStartX}, ${legendStartY + i * (legendItemSize + legendSpacing)})`);\n          legendItem.append(\"rect\").attr(\"width\", legendItemSize).attr(\"height\", legendItemSize).attr(\"fill\", colors[i % colors.length]);\n          legendItem.append(\"text\").attr(\"x\", legendItemSize + 4).attr(\"y\", legendItemSize - 2).text(`${d.name}: ${d.value.toFixed(1)}%`).style(\"font-size\", \"10px\").style(\"fill\", \"#333\");\n        });\n      }\n    };\n    const renderBarChart = () => {\n      if (!barContainer.value) return;\n      d3.select(barContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(barContainer.value);\n      const width = barContainer.value.clientWidth;\n      const height = barContainer.value.clientHeight;\n      const margin = {\n        top: 10,\n        right: 10,\n        bottom: 30,\n        left: 10\n      }; // 减少左侧边距，因为我们不需要Y轴了\n\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${width} ${height}`);\n\n      // 使用统一的最大值或计算最大值\n      const maxYValue = props.unifiedMax !== null ? props.unifiedMax : d3.max(simpleBarData.value, d => d.value) * 1.1 || 1; // 增加10%缓冲\n\n      // 确保最小值至少为0\n      const minYValue = Math.min(0, d3.min(simpleBarData.value, d => d.value) || 0);\n\n      // 创建Y轴比例尺（但不绘制Y轴）\n      const y = d3.scaleLinear().domain([minYValue, maxYValue]).range([height - margin.bottom, margin.top]);\n\n      // 设定柱子最大宽度和最小间距\n      const maxBarWidth = 60;\n      const minSpacing = 10;\n      const availableWidth = width - margin.left - margin.right;\n      const barCount = simpleBarData.value.length;\n      const barWidth = Math.min(maxBarWidth, Math.max(20, availableWidth / barCount - minSpacing));\n\n      // 计算起始位置使柱子居中\n      const totalBarsWidth = barWidth * barCount + minSpacing * (barCount - 1);\n      const startX = margin.left + (availableWidth - totalBarsWidth) / 2;\n\n      // 绘制柱子\n      svg.selectAll(\".bar\").data(simpleBarData.value).enter().append(\"rect\").attr(\"class\", \"bar\").attr(\"x\", (d, i) => startX + i * (barWidth + minSpacing)).attr(\"y\", d => y(Math.max(0, d.value))) // 确保柱子不会超出底部\n      .attr(\"width\", barWidth).attr(\"height\", d => Math.abs(y(d.value) - y(0))) // 计算绝对高度\n      .attr(\"fill\", (d, i) => colors[i % colors.length]).style(\"opacity\", 0.8);\n\n      // 在每个柱子下方添加数值标签\n      svg.selectAll(\".bar-label\").data(simpleBarData.value).enter().append(\"text\").attr(\"class\", \"bar-label\").attr(\"x\", (d, i) => startX + i * (barWidth + minSpacing) + barWidth / 2).attr(\"y\", height - 5).attr(\"text-anchor\", \"middle\").attr(\"font-size\", \"10px\").attr(\"fill\", \"#666\").text(d => formatNumber(d.value, props.fieldKey));\n    };\n\n    // 修改后的 renderLineChart 函数\n    const renderLineChart = () => {\n      if (!lineContainer.value) return;\n      d3.select(lineContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(lineContainer.value);\n      const width = lineContainer.value.clientWidth;\n      const height = lineContainer.value.clientHeight;\n      const margin = {\n        top: 10,\n        right: 10,\n        bottom: 30,\n        left: 10\n      };\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${width} ${height}`);\n      const x = d3.scaleLinear().domain([0, lineData.value.length - 1]).range([margin.left, width - margin.right]);\n      const y = d3.scaleLinear().domain([d3.min(lineData.value, d => d.y), d3.max(lineData.value, d => d.y)]).range([height - margin.bottom, margin.top]);\n\n      // 绘制折线\n      const line = d3.line().x((d, i) => x(i)).y(d => y(d.y)).curve(d3.curveMonotoneX);\n      svg.append(\"path\").datum(lineData.value).attr(\"fill\", \"none\").attr(\"stroke\", \"#3498db\").attr(\"stroke-width\", 2).attr(\"d\", line);\n\n      // 绘制数据点\n      svg.selectAll(\".dot\").data(lineData.value).enter().append(\"circle\").attr(\"class\", \"dot\").attr(\"cx\", (d, i) => x(i)).attr(\"cy\", d => y(d.y)).attr(\"r\", 3).attr(\"fill\", \"#3498db\");\n\n      // 在每个数据点下方添加数值标签\n      svg.selectAll(\".line-label\").data(lineData.value).enter().append(\"text\").attr(\"class\", \"line-label\").attr(\"x\", (d, i) => x(i)).attr(\"y\", height - 5).attr(\"text-anchor\", \"middle\").attr(\"font-size\", \"10px\").attr(\"fill\", \"#666\").text(d => formatNumber(d.y, props.fieldKey));\n    };\n    const renderStackedChart = () => {\n      if (!stackedContainer.value) return;\n      console.log(\"RENDER STACKED CHART - processedField.value:\", JSON.parse(JSON.stringify(processedField.value))); // 应该能看到正确的数据了\n\n      d3.select(stackedContainer.value).selectAll(\"*\").remove();\n      const dataForChart = processedField.value; // 直接使用 processedField，它应该是正确的数组了\n\n      // 确保 dataForChart 是数组并且有内容\n      if (!Array.isArray(dataForChart) || dataForChart.length === 0) {\n        console.warn(\"renderStackedChart: No valid data to render.\");\n        // 可以在这里显示 \"No data\" 提示\n        d3.select(stackedContainer.value).append(\"div\").attr(\"class\", \"no-data\").text(\"- (No data for stacked chart)\");\n        return;\n      }\n      const container = d3.select(stackedContainer.value);\n      const width = stackedContainer.value.clientWidth;\n      const height = stackedContainer.value.clientHeight;\n      // 调整 margin 以便容纳图例和标签\n      const margin = {\n        top: 20,\n        right: 120,\n        bottom: 40,\n        left: 40\n      };\n      const chartWidth = width - margin.left - margin.right;\n      const chartHeight = height - margin.top - margin.bottom;\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\") // SVG 宽度占满容器\n      .attr(\"height\", \"100%\") // SVG 高度占满容器\n      .attr(\"viewBox\", `0 0 ${width} ${height}`) // viewBox 保持容器尺寸\n      .append(\"g\").attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n      // 准备堆叠数据\n      // 对于百分比堆叠条形图，我们通常只有一个类别（例如“总计”）\n      // 然后每个商品是这个总类别中的一个堆叠部分。\n      // 这里你的数据已经是各个商品的百分比了，所以我们是水平排列这些独立的百分比条，而不是真正的“堆叠”在一个条上。\n      // 如果是要做一个显示各部分构成的“100%堆叠条形图”的“一个条”，那数据结构和D3的stack()用法会不同。\n      // 你当前的实现看起来是想为每个商品画一个独立的条。\n\n      const stackData = dataForChart.map(item => ({\n        name: String(item.name),\n        // 确保是字符串\n        value: safeToNumber(item.value, props.fieldKey) // 使用已有的 safeToNumber\n      }));\n\n      // 创建比例尺\n      // X 轴：类别名称 (商品名称)\n      const x = d3.scaleBand().domain(stackData.map(d => d.name)).range([0, chartWidth]).padding(0.2); // 条之间的间距\n\n      // Y 轴：百分比值\n      const y = d3.scaleLinear().domain([0, d3.max(stackData, d => d.value) || 100]) // Y轴最大值基于数据最大值，或者至少是100\n      .nice().range([chartHeight, 0]); // D3中Y轴通常是反的 (0在顶部)\n\n      // 绘制X轴\n      svg.append(\"g\").attr(\"transform\", `translate(0,${chartHeight})`).call(d3.axisBottom(x)).selectAll(\"text\").style(\"text-anchor\", \"end\").attr(\"dx\", \"-.8em\").attr(\"dy\", \".15em\").attr(\"transform\", \"rotate(-35)\"); // 旋转标签以防重叠\n\n      // 绘制Y轴\n      svg.append(\"g\").call(d3.axisLeft(y).ticks(5).tickFormat(d => `${d}%`)); // Y轴标签带百分号\n\n      // 绘制条形\n      svg.selectAll(\".stack-bar\").data(stackData).enter().append(\"rect\").attr(\"class\", \"stack-bar\").attr(\"x\", d => x(d.name)).attr(\"y\", d => y(d.value)).attr(\"width\", x.bandwidth()).attr(\"height\", d => chartHeight - y(d.value)) // 高度从Y值到底部\n      .attr(\"fill\", (d, i) => colors[i % colors.length]).style(\"opacity\", 0.8).on(\"mouseover\", function (event, d) {\n        d3.select(this).style(\"opacity\", 1);\n        // Tooltip logic can be added here\n      }).on(\"mouseout\", function (event, d) {\n        d3.select(this).style(\"opacity\", 0.8);\n      });\n\n      // （可选）在条形顶部添加数值标签\n      svg.selectAll(\".stack-value-label\").data(stackData).enter().append(\"text\").attr(\"class\", \"stack-value-label\").attr(\"x\", d => x(d.name) + x.bandwidth() / 2).attr(\"y\", d => y(d.value) - 5) // 在条形上方一点\n      .attr(\"text-anchor\", \"middle\").style(\"font-size\", \"10px\").style(\"fill\", \"#333\").text(d => `${d.value.toFixed(1)}%`);\n\n      // （可选）添加图例 (如果颜色代表不同类别，但这里颜色是按顺序分配的)\n      // 如果每个条形都代表一个独立的商品，图例可能就是X轴的标签。\n      // 如果你有更复杂的堆叠 (比如每个商品内部还细分)，图例会更有意义。\n      // 这里我们简单地在图表右侧列出商品及其颜色。\n      const legend = svg.append(\"g\").attr(\"class\", \"legend-stacked\").attr(\"transform\", `translate(${chartWidth + 20}, 0)`); // 图例放在图表区域右侧\n\n      stackData.forEach((d, i) => {\n        const legendItem = legend.append(\"g\").attr(\"transform\", `translate(0, ${i * 20})`);\n        legendItem.append(\"rect\").attr(\"width\", 15).attr(\"height\", 15).attr(\"fill\", colors[i % colors.length]);\n        legendItem.append(\"text\").attr(\"x\", 20).attr(\"y\", 12) // 垂直居中\n        .text(d.name).style(\"font-size\", \"10px\").style(\"fill\", \"#333\");\n      });\n    };\n    // 交互处理函数\n    const handleTextHover = () => {\n      isTextHovered.value = true;\n    };\n    const resetHover = () => {\n      hoveredIndex.value = null;\n      isTextHovered.value = false;\n    };\n    const handleTextClick = () => {\n      emit(\"chartClick\", {\n        type: \"text\",\n        data: processedField.value,\n        value: processedField.value\n      });\n    };\n    const formatNumber = (value, fieldKey) => {\n      const num = Number(value);\n      if (isNaN(num)) return \"0\";\n\n      // 百分比特殊处理\n      if (props.type === \"percentage\") {\n        return num.toFixed(1) + \"%\";\n      }\n\n      // 统一中文单位显示规则\n      if (num >= 100000000) {\n        // 1亿以上\n        return (num / 100000000).toFixed(2) + \"亿\";\n      } else if (num >= 10000) {\n        // 1万以上\n        return (num / 10000).toFixed(1) + \"万\";\n      } else if (num >= 1000) {\n        // 1千以上\n        return (num / 1000).toFixed(1) + \"千\";\n      } else {\n        // 小于1千\n        return num.toFixed(0);\n      }\n    };\n\n    // 数据处理函数\n    const isYearEntry = value => {\n      if (typeof value !== \"string\") return false;\n      const trimmedValue = value.trim();\n      return /^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) || /^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) || /^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) || /^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue);\n    };\n    const isValidPieData = computed(() => {\n      if (!pieData.value.length) return false;\n      return pieData.value.every(item => !isYearEntry(item.name) && !isYearEntry(item.value));\n    });\n    const pieData = computed(() => {\n      if (!processedField.value) return [];\n      const processItem = (item, index) => {\n        // 获取原始值，处理各种可能的数据结构\n        let rawValue;\n        if (typeof item === \"object\" && item !== null) {\n          rawValue = item.raw || item.value || item;\n        } else {\n          rawValue = item;\n        }\n\n        // 如果是年份条目则跳过\n        if (isYearEntry(rawValue)) return null;\n\n        // 转换为数值\n        const value = safeToNumber(rawValue, props.fieldKey);\n        if (value === null) return null;\n\n        // 获取名称，处理各种可能的数据结构\n        let name = \"项目\";\n        if (typeof item === \"object\" && item !== null) {\n          // 确保 raw 是字符串才调用 replace\n          const rawText = typeof item.raw === \"string\" ? item.raw : typeof item.value === \"string\" ? item.value : JSON.stringify(item);\n          name = rawText.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\n        } else if (typeof item === \"string\") {\n          name = item.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\n        }\n\n        // 如果是年份条目则跳过\n        if (isYearEntry(name)) return null;\n        return {\n          value: Math.min(100, Math.max(0, value)),\n          name: name || \"项目\",\n          index: index\n        };\n      };\n      if (Array.isArray(processedField.value)) {\n        return processedField.value.map((item, index) => processItem(item, index)).filter(item => item !== null && !isYearEntry(item.name));\n      }\n      const result = processItem(processedField.value, 0);\n      return result ? [result] : [];\n    });\n    const safeToNumber = (value, fieldKey) => {\n      if (value === null || value === undefined) return 0;\n      if (typeof value === \"number\") return value;\n      if (typeof value === \"string\") {\n        // 处理中文单位\n        const yiMatch = value.match(/(-?[\\d.]+)亿/);\n        if (yiMatch) return parseFloat(yiMatch[1]) * 100000000;\n        const wanMatch = value.match(/(-?[\\d.]+)万/);\n        if (wanMatch) return parseFloat(wanMatch[1]) * 10000;\n        const qianMatch = value.match(/(-?[\\d.]+)千/);\n        if (qianMatch) return parseFloat(qianMatch[1]) * 1000;\n\n        // 处理百分比\n        const percentMatch = value.match(/(-?\\d+\\.?\\d*)%/);\n        if (percentMatch) return parseFloat(percentMatch[1]);\n\n        // 默认数字\n        const num = parseFloat(value.replace(/[^\\d.-]/g, \"\"));\n        return isNaN(num) ? 0 : num;\n      }\n      if (typeof value === \"object\") {\n        return safeToNumber(value.value || value.raw, fieldKey);\n      }\n      return 0;\n    };\n    const formatSimpleText = value => {\n      if (!value) return \"-\";\n\n      // 处理数组\n      if (Array.isArray(value)) {\n        const items = value.map(item => {\n          if (typeof item === \"object\" && item !== null) {\n            let text = item.raw || item.value || JSON.stringify(item);\n            if (item.unit) text += ` ${item.unit}`;\n            if (item.year) text += ` (${item.year})`;\n            return text;\n          }\n          return item;\n        });\n        return items.length > 2 ? items.slice(0, 2).join(\"; \") + \"...\" : items.join(\"; \");\n      }\n\n      // 处理对象\n      if (typeof value === \"object\" && value !== null) {\n        let text = value.raw || value.value || \"-\";\n        if (value.unit) text += ` ${value.unit}`;\n        if (value.year) text += ` (${value.year})`;\n        return text;\n      }\n\n      // 处理原始值\n      return value.toString().length > 50 ? value.toString().substring(0, 50) + \"...\" : value.toString();\n    };\n    const simpleBarData = computed(() => {\n      if (!processedField.value) return [];\n      let values = [];\n      if (Array.isArray(processedField.value)) {\n        values = processedField.value.filter(item => {\n          const value = item?.value || item?.raw;\n          return value !== undefined && value !== null && !isYearEntry(value);\n        }).map(item => safeToNumber(item.value || item.raw, props.fieldKey));\n      } else {\n        values = [safeToNumber(processedField.value.value || processedField.value.raw, props.fieldKey)].filter(v => v !== null);\n      }\n      if (values.length === 0) return [];\n      return values.map((v, index) => ({\n        value: v,\n        height: v,\n        color: colors[index % colors.length],\n        index: index\n      }));\n    });\n    const lineData = computed(() => {\n      if (!processedField.value) return [];\n      if (Array.isArray(processedField.value)) {\n        return processedField.value.filter(item => {\n          const value = item?.value || item?.raw;\n          return value !== undefined && value !== null && !isYearEntry(value);\n        }).map((item, index) => {\n          const value = safeToNumber(item.value || item.raw, props.fieldKey);\n          return {\n            x: index,\n            y: value,\n            raw: item.raw || item.value,\n            index: index\n          };\n        });\n      }\n      const value = safeToNumber(processedField.value.value || processedField.value.raw, props.fieldKey);\n      return value !== null ? [{\n        x: 0,\n        y: value,\n        raw: processedField.value.raw || processedField.value.value,\n        index: 0\n      }] : [];\n    });\n    const hasData = computed(() => {\n      if (!processedField.value) return false;\n      if (Array.isArray(processedField.value)) return processedField.value.length > 0;\n      if (typeof processedField.value === \"object\") return Object.keys(processedField.value).length > 0;\n      return String(processedField.value).trim().length > 0;\n    });\n    return {\n      hoveredIndex,\n      activeIndex,\n      isTextHovered,\n      pieContainer,\n      barContainer,\n      lineContainer,\n      handleTextHover,\n      resetHover,\n      handleTextClick,\n      formatSimpleText,\n      hasData,\n      isValidPieData,\n      pieData,\n      simpleBarData,\n      lineData,\n      formatNumber,\n      processedField\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","onMounted","watch","nextTick","d3","props","field","type","Object","Array","String","Number","default","visualization","fieldKey","unifiedMax","emits","setup","_ref","emit","hoveredIndex","activeIndex","isTextHovered","pieContainer","barContainer","lineContainer","stackedContainer","colors","remainderColor","processedField","isArray","map","item","name","value","undefined","raw","JSON","stringify","unit","hasData","isValidPieData","renderPieChart","renderBarChart","renderLineChart","renderStackedChart","immediate","deep","select","selectAll","remove","container","containerWidth","clientWidth","containerHeight","clientHeight","size","radius","svg","append","attr","isSingleValue","processedData","pieData","color","isMainValue","Math","max","isRemainder","index","d","i","length","pie","sort","arc","innerRadius","outerRadius","cornerRadius","arcs","data","enter","tooltip","style","on","event","transition","duration","html","toFixed","offsetY","offsetX","text","legend","legendItemSize","legendSpacing","legendStartX","legendStartY","forEach","legendItem","width","height","margin","top","right","bottom","left","maxYValue","simpleBarData","minYValue","min","y","scaleLinear","domain","range","maxBarWidth","minSpacing","availableWidth","barCount","barWidth","totalBarsWidth","startX","abs","formatNumber","x","lineData","line","curve","curveMonotoneX","datum","console","log","parse","dataForChart","warn","chartWidth","chartHeight","stackData","safeToNumber","scaleBand","padding","nice","call","axisBottom","axisLeft","ticks","tickFormat","bandwidth","handleTextHover","resetHover","handleTextClick","num","isNaN","isYearEntry","trimmedValue","trim","test","every","processItem","rawValue","rawText","replace","filter","result","yiMatch","match","parseFloat","wanMatch","qianMatch","percentMatch","formatSimpleText","items","year","slice","join","toString","substring","values","v","keys"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\SimpleChart.vue"],"sourcesContent":["<template>\r\n\t<div class=\"simple-chart\">\r\n\t\t<!-- 文本显示 -->\r\n\t\t<template v-if=\"visualization === 'text-only'\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(processedField) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 饼图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'pie-chart'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"hasData && isValidPieData\"\r\n\t\t\t\tclass=\"d3-chart-container\"\r\n\t\t\t\tref=\"pieContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 柱状图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'bar-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"barContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 折线图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'line-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"lineContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 堆叠图 -->\r\n\t\t<template v-else-if=\"visualization === 'stacked-chart'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"hasData\"\r\n\t\t\t\tclass=\"d3-chart-container\"\r\n\t\t\t\tref=\"stackedContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\t\t<!-- 默认显示 -->\r\n\t\t<template v-else>\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(processedField) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport { computed, ref, onMounted, watch, nextTick } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tfield: {\r\n\t\t\t\ttype: [Object, Array, String, Number],\r\n\t\t\t\tdefault: null\r\n\t\t\t},\r\n\t\t\ttype: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tvisualization: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tfieldKey: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tunifiedMax: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: null\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\temits: [\"chartClick\"],\r\n\r\n\t\tsetup(props, { emit }) {\r\n\t\t\tconst hoveredIndex = ref(null);\r\n\t\t\tconst activeIndex = ref(null);\r\n\t\t\tconst isTextHovered = ref(false);\r\n\r\n\t\t\t// 容器引用\r\n\t\t\tconst pieContainer = ref(null);\r\n\t\t\tconst barContainer = ref(null);\r\n\t\t\tconst lineContainer = ref(null);\r\n\t\t\tconst stackedContainer = ref(null);\r\n\r\n\t\t\t// 颜色定义\r\n\t\t\tconst colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\r\n\t\t\tconst remainderColor = \"#f0f0f0\";\r\n\r\n\t\t\t// 处理后的字段数据\r\n\t\t\tconst processedField = computed(() => {\r\n\t\t\t\tif (!props.field) return null;\r\n\r\n\t\t\t\tif (Array.isArray(props.field)) {\r\n\t\t\t\t\treturn props.field.map(item => {\r\n\t\t\t\t\t\t// 假设 item 从 CompareTable 传来时，已经有 name 和 value\r\n\t\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tname: item.name || \"Unknown\", // 确保 name 存在\r\n\t\t\t\t\t\t\t\tvalue: item.value !== undefined ? item.value : 0, // 确保 value 存在\r\n\t\t\t\t\t\t\t\traw: item.raw || JSON.stringify(item),\r\n\t\t\t\t\t\t\t\tunit: item.unit,\r\n\t\t\t\t\t\t\t\ttype: item.type\r\n\t\t\t\t\t\t\t\t// 其他需要的属性\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 对于非对象 item (理论上不应发生，因为 getField 会处理)\r\n\t\t\t\t\t\treturn { name: String(item), value: 0, raw: String(item) };\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 如果 props.field 是单个对象 (非数组)\r\n\t\t\t\tif (typeof props.field === \"object\" && props.field !== null) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname: props.field.name || \"Unknown\",\r\n\t\t\t\t\t\tvalue: props.field.value !== undefined ? props.field.value : 0,\r\n\t\t\t\t\t\traw: props.field.raw || JSON.stringify(props.field),\r\n\t\t\t\t\t\tunit: props.field.unit,\r\n\t\t\t\t\t\ttype: props.field.type\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 如果 props.field 是原始值 (字符串/数字)\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: String(props.field),\r\n\t\t\t\t\tvalue: 0,\r\n\t\t\t\t\traw: String(props.field)\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t// 初始化图表\r\n\t\t\tonMounted(() => {\r\n\t\t\t\twatch(\r\n\t\t\t\t\t() => [processedField.value, props.visualization, props.unifiedMax],\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"pie-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value &&\r\n\t\t\t\t\t\t\t\tisValidPieData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderPieChart();\r\n\t\t\t\t\t\t\t} else if (props.visualization === \"bar-chart\" && hasData.value) {\r\n\t\t\t\t\t\t\t\trenderBarChart();\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"line-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderLineChart();\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"stacked-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderStackedChart();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ immediate: true, deep: true }\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\t// 渲染饼图（添加剩余比例）\r\n\t\t\tconst renderPieChart = () => {\r\n\t\t\t\tif (!pieContainer.value) return;\r\n\r\n\t\t\t\t// 清除旧图表\r\n\t\t\t\td3.select(pieContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(pieContainer.value);\r\n\t\t\t\tconst containerWidth = pieContainer.value.clientWidth;\r\n\t\t\t\tconst containerHeight = pieContainer.value.clientHeight;\r\n\r\n\t\t\t\t// 使用高度作为基准尺寸，确保饼图大小不变\r\n\t\t\t\tconst size = containerHeight * 0.9; // 饼图大小基于高度\r\n\t\t\t\tconst radius = size / 2;\r\n\r\n\t\t\t\t// 创建SVG，宽度100%，高度固定\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${containerWidth} ${containerHeight}`)\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\r\n\t\t\t\t\t\t\"transform\",\r\n\t\t\t\t\t\t`translate(${containerWidth / 2}, ${containerHeight / 2})`\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t// 判断是否是单值饼图\r\n\t\t\t\tconst isSingleValue = props.fieldKey === \"Inflation (CPI)\";\r\n\r\n\t\t\t\t// 处理数据 - 如果是单值，添加剩余部分\r\n\t\t\t\tconst processedData = isSingleValue\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t...pieData.value[0],\r\n\t\t\t\t\t\t\t\tcolor: colors[0],\r\n\t\t\t\t\t\t\t\tisMainValue: true\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvalue: Math.max(0, 100 - pieData.value[0].value),\r\n\t\t\t\t\t\t\t\tname: \"剩余\",\r\n\t\t\t\t\t\t\t\tcolor: remainderColor,\r\n\t\t\t\t\t\t\t\tisRemainder: true,\r\n\t\t\t\t\t\t\t\tindex: 1\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: pieData.value.map((d, i) => ({\r\n\t\t\t\t\t\t\t...d,\r\n\t\t\t\t\t\t\tcolor: colors[i % colors.length],\r\n\t\t\t\t\t\t\tisMainValue: true\r\n\t\t\t\t\t  }));\r\n\r\n\t\t\t\tconst pie = d3\r\n\t\t\t\t\t.pie()\r\n\t\t\t\t\t.value(d => d.value)\r\n\t\t\t\t\t.sort(null);\r\n\r\n\t\t\t\tconst arc = d3\r\n\t\t\t\t\t.arc()\r\n\t\t\t\t\t.innerRadius(0)\r\n\t\t\t\t\t.outerRadius(radius * 0.9)\r\n\t\t\t\t\t.cornerRadius(2);\r\n\r\n\t\t\t\tconst arcs = svg\r\n\t\t\t\t\t.selectAll(\".arc\")\r\n\t\t\t\t\t.data(pie(processedData))\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"class\", \"arc\");\r\n\r\n\t\t\t\t// 创建tooltip\r\n\t\t\t\tconst tooltip = container\r\n\t\t\t\t\t.append(\"div\")\r\n\t\t\t\t\t.attr(\"class\", \"d3-tooltip\")\r\n\t\t\t\t\t.style(\"position\", \"absolute\")\r\n\t\t\t\t\t.style(\"visibility\", \"hidden\")\r\n\t\t\t\t\t.style(\"background\", \"rgba(0,0,0,0.8)\")\r\n\t\t\t\t\t.style(\"color\", \"white\")\r\n\t\t\t\t\t.style(\"padding\", \"6px 12px\")\r\n\t\t\t\t\t.style(\"border-radius\", \"4px\")\r\n\t\t\t\t\t.style(\"font-size\", \"12px\");\r\n\r\n\t\t\t\t// 绘制扇形\r\n\t\t\t\tarcs\r\n\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t.attr(\"d\", arc)\r\n\t\t\t\t\t.attr(\"fill\", d => d.data.color)\r\n\t\t\t\t\t.style(\"opacity\", d => (d.data.isRemainder ? 0.6 : 0.8))\r\n\t\t\t\t\t.style(\"stroke\", \"#fff\")\r\n\t\t\t\t\t.style(\"stroke-width\", 1)\r\n\t\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\r\n\t\t\t\t\t\thoveredIndex.value = d.data.index;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(200)\r\n\t\t\t\t\t\t\t.style(\"opacity\", 1)\r\n\t\t\t\t\t\t\t.attr(\"transform\", \"scale(1.05)\");\r\n\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.style(\"visibility\", \"visible\")\r\n\t\t\t\t\t\t\t.html(\r\n\t\t\t\t\t\t\t\t`${d.data.name}: ${d.data.value.toFixed(1)}${\r\n\t\t\t\t\t\t\t\t\tprops.type === \"percentage\" ? \"%\" : \"\"\r\n\t\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mousemove\", function (event) {\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.style(\"top\", event.offsetY + 10 + \"px\")\r\n\t\t\t\t\t\t\t.style(\"left\", event.offsetX + 10 + \"px\");\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\r\n\t\t\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(200)\r\n\t\t\t\t\t\t\t.style(\"opacity\", d.data.isRemainder ? 0.6 : 0.8)\r\n\t\t\t\t\t\t\t.attr(\"transform\", \"scale(1)\");\r\n\r\n\t\t\t\t\t\ttooltip.style(\"visibility\", \"hidden\");\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"click\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\r\n\t\t\t\t\t\tactiveIndex.value = d.data.index;\r\n\t\t\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\t\t\tindex: d.data.index,\r\n\t\t\t\t\t\t\tdata: d.data,\r\n\t\t\t\t\t\t\tvalue: d.data.value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t// 单值饼图的中心文字\r\n\t\t\t\tif (isSingleValue) {\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"dy\", \".3em\")\r\n\t\t\t\t\t\t.text(\r\n\t\t\t\t\t\t\t`${pieData.value[0].value.toFixed(1)}${\r\n\t\t\t\t\t\t\t\tprops.type === \"percentage\" ? \"%\" : \"\"\r\n\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.style(\"font-size\", \"14px\")\r\n\t\t\t\t\t\t.style(\"fill\", \"#333\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 多值饼图的图例 - 修改为右上角放置\r\n\t\t\t\tif (!isSingleValue && pieData.value.length > 1) {\r\n\t\t\t\t\tconst legend = svg.append(\"g\").attr(\"class\", \"legend\");\r\n\t\t\t\t\tconst legendItemSize = 12;\r\n\t\t\t\t\tconst legendSpacing = 4;\r\n\t\t\t\t\tconst legendStartX = containerWidth / 2 - 100; // 从中心向右偏移\r\n\t\t\t\t\tconst legendStartY = -containerHeight / 2 + 20; // 从顶部向下偏移\r\n\r\n\t\t\t\t\tpieData.value.forEach((d, i) => {\r\n\t\t\t\t\t\tconst legendItem = legend\r\n\t\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t\t.attr(\r\n\t\t\t\t\t\t\t\t\"transform\",\r\n\t\t\t\t\t\t\t\t`translate(${legendStartX}, ${\r\n\t\t\t\t\t\t\t\t\tlegendStartY + i * (legendItemSize + legendSpacing)\r\n\t\t\t\t\t\t\t\t})`\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tlegendItem\r\n\t\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t.attr(\"width\", legendItemSize)\r\n\t\t\t\t\t\t\t.attr(\"height\", legendItemSize)\r\n\t\t\t\t\t\t\t.attr(\"fill\", colors[i % colors.length]);\r\n\r\n\t\t\t\t\t\tlegendItem\r\n\t\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t\t.attr(\"x\", legendItemSize + 4)\r\n\t\t\t\t\t\t\t.attr(\"y\", legendItemSize - 2)\r\n\t\t\t\t\t\t\t.text(`${d.name}: ${d.value.toFixed(1)}%`)\r\n\t\t\t\t\t\t\t.style(\"font-size\", \"10px\")\r\n\t\t\t\t\t\t\t.style(\"fill\", \"#333\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst renderBarChart = () => {\r\n\t\t\t\tif (!barContainer.value) return;\r\n\r\n\t\t\t\td3.select(barContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(barContainer.value);\r\n\t\t\t\tconst width = barContainer.value.clientWidth;\r\n\t\t\t\tconst height = barContainer.value.clientHeight;\r\n\t\t\t\tconst margin = { top: 10, right: 10, bottom: 30, left: 10 }; // 减少左侧边距，因为我们不需要Y轴了\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`);\r\n\r\n\t\t\t\t// 使用统一的最大值或计算最大值\r\n\t\t\t\tconst maxYValue =\r\n\t\t\t\t\tprops.unifiedMax !== null\r\n\t\t\t\t\t\t? props.unifiedMax\r\n\t\t\t\t\t\t: d3.max(simpleBarData.value, d => d.value) * 1.1 || 1; // 增加10%缓冲\r\n\r\n\t\t\t\t// 确保最小值至少为0\r\n\t\t\t\tconst minYValue = Math.min(\r\n\t\t\t\t\t0,\r\n\t\t\t\t\td3.min(simpleBarData.value, d => d.value) || 0\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// 创建Y轴比例尺（但不绘制Y轴）\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([minYValue, maxYValue])\r\n\t\t\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t\t\t// 设定柱子最大宽度和最小间距\r\n\t\t\t\tconst maxBarWidth = 60;\r\n\t\t\t\tconst minSpacing = 10;\r\n\t\t\t\tconst availableWidth = width - margin.left - margin.right;\r\n\t\t\t\tconst barCount = simpleBarData.value.length;\r\n\t\t\t\tconst barWidth = Math.min(\r\n\t\t\t\t\tmaxBarWidth,\r\n\t\t\t\t\tMath.max(20, availableWidth / barCount - minSpacing)\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// 计算起始位置使柱子居中\r\n\t\t\t\tconst totalBarsWidth =\r\n\t\t\t\t\tbarWidth * barCount + minSpacing * (barCount - 1);\r\n\t\t\t\tconst startX = margin.left + (availableWidth - totalBarsWidth) / 2;\r\n\r\n\t\t\t\t// 绘制柱子\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".bar\")\r\n\t\t\t\t\t.data(simpleBarData.value)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"bar\")\r\n\t\t\t\t\t.attr(\"x\", (d, i) => startX + i * (barWidth + minSpacing))\r\n\t\t\t\t\t.attr(\"y\", d => y(Math.max(0, d.value))) // 确保柱子不会超出底部\r\n\t\t\t\t\t.attr(\"width\", barWidth)\r\n\t\t\t\t\t.attr(\"height\", d => Math.abs(y(d.value) - y(0))) // 计算绝对高度\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => colors[i % colors.length])\r\n\t\t\t\t\t.style(\"opacity\", 0.8);\r\n\r\n\t\t\t\t// 在每个柱子下方添加数值标签\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".bar-label\")\r\n\t\t\t\t\t.data(simpleBarData.value)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t.attr(\"class\", \"bar-label\")\r\n\t\t\t\t\t.attr(\r\n\t\t\t\t\t\t\"x\",\r\n\t\t\t\t\t\t(d, i) => startX + i * (barWidth + minSpacing) + barWidth / 2\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.attr(\"y\", height - 5)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"font-size\", \"10px\")\r\n\t\t\t\t\t.attr(\"fill\", \"#666\")\r\n\t\t\t\t\t.text(d => formatNumber(d.value, props.fieldKey));\r\n\t\t\t};\r\n\r\n\t\t\t// 修改后的 renderLineChart 函数\r\n\t\t\tconst renderLineChart = () => {\r\n\t\t\t\tif (!lineContainer.value) return;\r\n\r\n\t\t\t\td3.select(lineContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(lineContainer.value);\r\n\t\t\t\tconst width = lineContainer.value.clientWidth;\r\n\t\t\t\tconst height = lineContainer.value.clientHeight;\r\n\t\t\t\tconst margin = { top: 10, right: 10, bottom: 30, left: 10 };\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`);\r\n\r\n\t\t\t\tconst x = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([0, lineData.value.length - 1])\r\n\t\t\t\t\t.range([margin.left, width - margin.right]);\r\n\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([\r\n\t\t\t\t\t\td3.min(lineData.value, d => d.y),\r\n\t\t\t\t\t\td3.max(lineData.value, d => d.y)\r\n\t\t\t\t\t])\r\n\t\t\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t\t\t// 绘制折线\r\n\t\t\t\tconst line = d3\r\n\t\t\t\t\t.line()\r\n\t\t\t\t\t.x((d, i) => x(i))\r\n\t\t\t\t\t.y(d => y(d.y))\r\n\t\t\t\t\t.curve(d3.curveMonotoneX);\r\n\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t.datum(lineData.value)\r\n\t\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t\t.attr(\"stroke\", \"#3498db\")\r\n\t\t\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t\t\t.attr(\"d\", line);\r\n\r\n\t\t\t\t// 绘制数据点\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".dot\")\r\n\t\t\t\t\t.data(lineData.value)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"circle\")\r\n\t\t\t\t\t.attr(\"class\", \"dot\")\r\n\t\t\t\t\t.attr(\"cx\", (d, i) => x(i))\r\n\t\t\t\t\t.attr(\"cy\", d => y(d.y))\r\n\t\t\t\t\t.attr(\"r\", 3)\r\n\t\t\t\t\t.attr(\"fill\", \"#3498db\");\r\n\r\n\t\t\t\t// 在每个数据点下方添加数值标签\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".line-label\")\r\n\t\t\t\t\t.data(lineData.value)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t.attr(\"class\", \"line-label\")\r\n\t\t\t\t\t.attr(\"x\", (d, i) => x(i))\r\n\t\t\t\t\t.attr(\"y\", height - 5)\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"font-size\", \"10px\")\r\n\t\t\t\t\t.attr(\"fill\", \"#666\")\r\n\t\t\t\t\t.text(d => formatNumber(d.y, props.fieldKey));\r\n\t\t\t};\r\n\r\n\t\t\tconst renderStackedChart = () => {\r\n\t\t\t\tif (!stackedContainer.value) return;\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t\"RENDER STACKED CHART - processedField.value:\",\r\n\t\t\t\t\tJSON.parse(JSON.stringify(processedField.value))\r\n\t\t\t\t); // 应该能看到正确的数据了\r\n\r\n\t\t\t\td3.select(stackedContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst dataForChart = processedField.value; // 直接使用 processedField，它应该是正确的数组了\r\n\r\n\t\t\t\t// 确保 dataForChart 是数组并且有内容\r\n\t\t\t\tif (!Array.isArray(dataForChart) || dataForChart.length === 0) {\r\n\t\t\t\t\tconsole.warn(\"renderStackedChart: No valid data to render.\");\r\n\t\t\t\t\t// 可以在这里显示 \"No data\" 提示\r\n\t\t\t\t\td3.select(stackedContainer.value)\r\n\t\t\t\t\t\t.append(\"div\")\r\n\t\t\t\t\t\t.attr(\"class\", \"no-data\")\r\n\t\t\t\t\t\t.text(\"- (No data for stacked chart)\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst container = d3.select(stackedContainer.value);\r\n\t\t\t\tconst width = stackedContainer.value.clientWidth;\r\n\t\t\t\tconst height = stackedContainer.value.clientHeight;\r\n\t\t\t\t// 调整 margin 以便容纳图例和标签\r\n\t\t\t\tconst margin = { top: 20, right: 120, bottom: 40, left: 40 };\r\n\t\t\t\tconst chartWidth = width - margin.left - margin.right;\r\n\t\t\t\tconst chartHeight = height - margin.top - margin.bottom;\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\") // SVG 宽度占满容器\r\n\t\t\t\t\t.attr(\"height\", \"100%\") // SVG 高度占满容器\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`) // viewBox 保持容器尺寸\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(${margin.left},${margin.top})`);\r\n\r\n\t\t\t\t// 准备堆叠数据\r\n\t\t\t\t// 对于百分比堆叠条形图，我们通常只有一个类别（例如“总计”）\r\n\t\t\t\t// 然后每个商品是这个总类别中的一个堆叠部分。\r\n\t\t\t\t// 这里你的数据已经是各个商品的百分比了，所以我们是水平排列这些独立的百分比条，而不是真正的“堆叠”在一个条上。\r\n\t\t\t\t// 如果是要做一个显示各部分构成的“100%堆叠条形图”的“一个条”，那数据结构和D3的stack()用法会不同。\r\n\t\t\t\t// 你当前的实现看起来是想为每个商品画一个独立的条。\r\n\r\n\t\t\t\tconst stackData = dataForChart.map(item => ({\r\n\t\t\t\t\tname: String(item.name), // 确保是字符串\r\n\t\t\t\t\tvalue: safeToNumber(item.value, props.fieldKey) // 使用已有的 safeToNumber\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t// 创建比例尺\r\n\t\t\t\t// X 轴：类别名称 (商品名称)\r\n\t\t\t\tconst x = d3\r\n\t\t\t\t\t.scaleBand()\r\n\t\t\t\t\t.domain(stackData.map(d => d.name))\r\n\t\t\t\t\t.range([0, chartWidth])\r\n\t\t\t\t\t.padding(0.2); // 条之间的间距\r\n\r\n\t\t\t\t// Y 轴：百分比值\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([0, d3.max(stackData, d => d.value) || 100]) // Y轴最大值基于数据最大值，或者至少是100\r\n\t\t\t\t\t.nice()\r\n\t\t\t\t\t.range([chartHeight, 0]); // D3中Y轴通常是反的 (0在顶部)\r\n\r\n\t\t\t\t// 绘制X轴\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(0,${chartHeight})`)\r\n\t\t\t\t\t.call(d3.axisBottom(x))\r\n\t\t\t\t\t.selectAll(\"text\")\r\n\t\t\t\t\t.style(\"text-anchor\", \"end\")\r\n\t\t\t\t\t.attr(\"dx\", \"-.8em\")\r\n\t\t\t\t\t.attr(\"dy\", \".15em\")\r\n\t\t\t\t\t.attr(\"transform\", \"rotate(-35)\"); // 旋转标签以防重叠\r\n\r\n\t\t\t\t// 绘制Y轴\r\n\t\t\t\tsvg.append(\"g\").call(\r\n\t\t\t\t\td3\r\n\t\t\t\t\t\t.axisLeft(y)\r\n\t\t\t\t\t\t.ticks(5)\r\n\t\t\t\t\t\t.tickFormat(d => `${d}%`)\r\n\t\t\t\t); // Y轴标签带百分号\r\n\r\n\t\t\t\t// 绘制条形\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".stack-bar\")\r\n\t\t\t\t\t.data(stackData)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"stack-bar\")\r\n\t\t\t\t\t.attr(\"x\", d => x(d.name))\r\n\t\t\t\t\t.attr(\"y\", d => y(d.value))\r\n\t\t\t\t\t.attr(\"width\", x.bandwidth())\r\n\t\t\t\t\t.attr(\"height\", d => chartHeight - y(d.value)) // 高度从Y值到底部\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => colors[i % colors.length])\r\n\t\t\t\t\t.style(\"opacity\", 0.8)\r\n\t\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\t\td3.select(this).style(\"opacity\", 1);\r\n\t\t\t\t\t\t// Tooltip logic can be added here\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\t\t\td3.select(this).style(\"opacity\", 0.8);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t// （可选）在条形顶部添加数值标签\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".stack-value-label\")\r\n\t\t\t\t\t.data(stackData)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t.attr(\"class\", \"stack-value-label\")\r\n\t\t\t\t\t.attr(\"x\", d => x(d.name) + x.bandwidth() / 2)\r\n\t\t\t\t\t.attr(\"y\", d => y(d.value) - 5) // 在条形上方一点\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.style(\"font-size\", \"10px\")\r\n\t\t\t\t\t.style(\"fill\", \"#333\")\r\n\t\t\t\t\t.text(d => `${d.value.toFixed(1)}%`);\r\n\r\n\t\t\t\t// （可选）添加图例 (如果颜色代表不同类别，但这里颜色是按顺序分配的)\r\n\t\t\t\t// 如果每个条形都代表一个独立的商品，图例可能就是X轴的标签。\r\n\t\t\t\t// 如果你有更复杂的堆叠 (比如每个商品内部还细分)，图例会更有意义。\r\n\t\t\t\t// 这里我们简单地在图表右侧列出商品及其颜色。\r\n\t\t\t\tconst legend = svg\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"class\", \"legend-stacked\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(${chartWidth + 20}, 0)`); // 图例放在图表区域右侧\r\n\r\n\t\t\t\tstackData.forEach((d, i) => {\r\n\t\t\t\t\tconst legendItem = legend\r\n\t\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t\t.attr(\"transform\", `translate(0, ${i * 20})`);\r\n\r\n\t\t\t\t\tlegendItem\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"width\", 15)\r\n\t\t\t\t\t\t.attr(\"height\", 15)\r\n\t\t\t\t\t\t.attr(\"fill\", colors[i % colors.length]);\r\n\r\n\t\t\t\t\tlegendItem\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"x\", 20)\r\n\t\t\t\t\t\t.attr(\"y\", 12) // 垂直居中\r\n\t\t\t\t\t\t.text(d.name)\r\n\t\t\t\t\t\t.style(\"font-size\", \"10px\")\r\n\t\t\t\t\t\t.style(\"fill\", \"#333\");\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// 交互处理函数\r\n\t\t\tconst handleTextHover = () => {\r\n\t\t\t\tisTextHovered.value = true;\r\n\t\t\t};\r\n\r\n\t\t\tconst resetHover = () => {\r\n\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\tisTextHovered.value = false;\r\n\t\t\t};\r\n\r\n\t\t\tconst handleTextClick = () => {\r\n\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tdata: processedField.value,\r\n\t\t\t\t\tvalue: processedField.value\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tconst formatNumber = (value, fieldKey) => {\r\n\t\t\t\tconst num = Number(value);\r\n\t\t\t\tif (isNaN(num)) return \"0\";\r\n\r\n\t\t\t\t// 百分比特殊处理\r\n\t\t\t\tif (props.type === \"percentage\") {\r\n\t\t\t\t\treturn num.toFixed(1) + \"%\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 统一中文单位显示规则\r\n\t\t\t\tif (num >= 100000000) {\r\n\t\t\t\t\t// 1亿以上\r\n\t\t\t\t\treturn (num / 100000000).toFixed(2) + \"亿\";\r\n\t\t\t\t} else if (num >= 10000) {\r\n\t\t\t\t\t// 1万以上\r\n\t\t\t\t\treturn (num / 10000).toFixed(1) + \"万\";\r\n\t\t\t\t} else if (num >= 1000) {\r\n\t\t\t\t\t// 1千以上\r\n\t\t\t\t\treturn (num / 1000).toFixed(1) + \"千\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 小于1千\r\n\t\t\t\t\treturn num.toFixed(0);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 数据处理函数\r\n\t\t\tconst isYearEntry = value => {\r\n\t\t\t\tif (typeof value !== \"string\") return false;\r\n\t\t\t\tconst trimmedValue = value.trim();\r\n\t\t\t\treturn (\r\n\t\t\t\t\t/^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) ||\r\n\t\t\t\t\t/^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue)\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\tconst isValidPieData = computed(() => {\r\n\t\t\t\tif (!pieData.value.length) return false;\r\n\t\t\t\treturn pieData.value.every(\r\n\t\t\t\t\titem => !isYearEntry(item.name) && !isYearEntry(item.value)\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tconst pieData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\r\n\t\t\t\tconst processItem = (item, index) => {\r\n\t\t\t\t\t// 获取原始值，处理各种可能的数据结构\r\n\t\t\t\t\tlet rawValue;\r\n\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\trawValue = item.raw || item.value || item;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trawValue = item;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 如果是年份条目则跳过\r\n\t\t\t\t\tif (isYearEntry(rawValue)) return null;\r\n\r\n\t\t\t\t\t// 转换为数值\r\n\t\t\t\t\tconst value = safeToNumber(rawValue, props.fieldKey);\r\n\t\t\t\t\tif (value === null) return null;\r\n\r\n\t\t\t\t\t// 获取名称，处理各种可能的数据结构\r\n\t\t\t\t\tlet name = \"项目\";\r\n\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\t// 确保 raw 是字符串才调用 replace\r\n\t\t\t\t\t\tconst rawText =\r\n\t\t\t\t\t\t\ttypeof item.raw === \"string\"\r\n\t\t\t\t\t\t\t\t? item.raw\r\n\t\t\t\t\t\t\t\t: typeof item.value === \"string\"\r\n\t\t\t\t\t\t\t\t? item.value\r\n\t\t\t\t\t\t\t\t: JSON.stringify(item);\r\n\t\t\t\t\t\tname = rawText.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\r\n\t\t\t\t\t} else if (typeof item === \"string\") {\r\n\t\t\t\t\t\tname = item.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 如果是年份条目则跳过\r\n\t\t\t\t\tif (isYearEntry(name)) return null;\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: Math.min(100, Math.max(0, value)),\r\n\t\t\t\t\t\tname: name || \"项目\",\r\n\t\t\t\t\t\tindex: index\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\treturn processedField.value\r\n\t\t\t\t\t\t.map((item, index) => processItem(item, index))\r\n\t\t\t\t\t\t.filter(item => item !== null && !isYearEntry(item.name));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst result = processItem(processedField.value, 0);\r\n\t\t\t\treturn result ? [result] : [];\r\n\t\t\t});\r\n\r\n\t\t\tconst safeToNumber = (value, fieldKey) => {\r\n\t\t\t\tif (value === null || value === undefined) return 0;\r\n\t\t\t\tif (typeof value === \"number\") return value;\r\n\r\n\t\t\t\tif (typeof value === \"string\") {\r\n\t\t\t\t\t// 处理中文单位\r\n\t\t\t\t\tconst yiMatch = value.match(/(-?[\\d.]+)亿/);\r\n\t\t\t\t\tif (yiMatch) return parseFloat(yiMatch[1]) * 100000000;\r\n\r\n\t\t\t\t\tconst wanMatch = value.match(/(-?[\\d.]+)万/);\r\n\t\t\t\t\tif (wanMatch) return parseFloat(wanMatch[1]) * 10000;\r\n\r\n\t\t\t\t\tconst qianMatch = value.match(/(-?[\\d.]+)千/);\r\n\t\t\t\t\tif (qianMatch) return parseFloat(qianMatch[1]) * 1000;\r\n\r\n\t\t\t\t\t// 处理百分比\r\n\t\t\t\t\tconst percentMatch = value.match(/(-?\\d+\\.?\\d*)%/);\r\n\t\t\t\t\tif (percentMatch) return parseFloat(percentMatch[1]);\r\n\r\n\t\t\t\t\t// 默认数字\r\n\t\t\t\t\tconst num = parseFloat(value.replace(/[^\\d.-]/g, \"\"));\r\n\t\t\t\t\treturn isNaN(num) ? 0 : num;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (typeof value === \"object\") {\r\n\t\t\t\t\treturn safeToNumber(value.value || value.raw, fieldKey);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn 0;\r\n\t\t\t};\r\n\r\n\t\t\tconst formatSimpleText = value => {\r\n\t\t\t\tif (!value) return \"-\";\r\n\r\n\t\t\t\t// 处理数组\r\n\t\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\t\tconst items = value.map(item => {\r\n\t\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\t\tlet text = item.raw || item.value || JSON.stringify(item);\r\n\t\t\t\t\t\t\tif (item.unit) text += ` ${item.unit}`;\r\n\t\t\t\t\t\t\tif (item.year) text += ` (${item.year})`;\r\n\t\t\t\t\t\t\treturn text;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn items.length > 2\r\n\t\t\t\t\t\t? items.slice(0, 2).join(\"; \") + \"...\"\r\n\t\t\t\t\t\t: items.join(\"; \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 处理对象\r\n\t\t\t\tif (typeof value === \"object\" && value !== null) {\r\n\t\t\t\t\tlet text = value.raw || value.value || \"-\";\r\n\t\t\t\t\tif (value.unit) text += ` ${value.unit}`;\r\n\t\t\t\t\tif (value.year) text += ` (${value.year})`;\r\n\t\t\t\t\treturn text;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 处理原始值\r\n\t\t\t\treturn value.toString().length > 50\r\n\t\t\t\t\t? value.toString().substring(0, 50) + \"...\"\r\n\t\t\t\t\t: value.toString();\r\n\t\t\t};\r\n\r\n\t\t\tconst simpleBarData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\r\n\t\t\t\tlet values = [];\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\tvalues = processedField.value\r\n\t\t\t\t\t\t.filter(item => {\r\n\t\t\t\t\t\t\tconst value = item?.value || item?.raw;\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\tvalue !== undefined && value !== null && !isYearEntry(value)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.map(item => safeToNumber(item.value || item.raw, props.fieldKey));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalues = [\r\n\t\t\t\t\t\tsafeToNumber(\r\n\t\t\t\t\t\t\tprocessedField.value.value || processedField.value.raw,\r\n\t\t\t\t\t\t\tprops.fieldKey\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t].filter(v => v !== null);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (values.length === 0) return [];\r\n\r\n\t\t\t\treturn values.map((v, index) => ({\r\n\t\t\t\t\tvalue: v,\r\n\t\t\t\t\theight: v,\r\n\t\t\t\t\tcolor: colors[index % colors.length],\r\n\t\t\t\t\tindex: index\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\r\n\t\t\tconst lineData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\treturn processedField.value\r\n\t\t\t\t\t\t.filter(item => {\r\n\t\t\t\t\t\t\tconst value = item?.value || item?.raw;\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\tvalue !== undefined && value !== null && !isYearEntry(value)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.map((item, index) => {\r\n\t\t\t\t\t\t\tconst value = safeToNumber(\r\n\t\t\t\t\t\t\t\titem.value || item.raw,\r\n\t\t\t\t\t\t\t\tprops.fieldKey\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\tx: index,\r\n\t\t\t\t\t\t\t\ty: value,\r\n\t\t\t\t\t\t\t\traw: item.raw || item.value,\r\n\t\t\t\t\t\t\t\tindex: index\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst value = safeToNumber(\r\n\t\t\t\t\tprocessedField.value.value || processedField.value.raw,\r\n\t\t\t\t\tprops.fieldKey\r\n\t\t\t\t);\r\n\t\t\t\treturn value !== null\r\n\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\t\t\ty: value,\r\n\t\t\t\t\t\t\t\traw: processedField.value.raw || processedField.value.value,\r\n\t\t\t\t\t\t\t\tindex: 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t  ]\r\n\t\t\t\t\t: [];\r\n\t\t\t});\r\n\r\n\t\t\tconst hasData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return false;\r\n\t\t\t\tif (Array.isArray(processedField.value))\r\n\t\t\t\t\treturn processedField.value.length > 0;\r\n\t\t\t\tif (typeof processedField.value === \"object\")\r\n\t\t\t\t\treturn Object.keys(processedField.value).length > 0;\r\n\t\t\t\treturn String(processedField.value).trim().length > 0;\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\thoveredIndex,\r\n\t\t\t\tactiveIndex,\r\n\t\t\t\tisTextHovered,\r\n\t\t\t\tpieContainer,\r\n\t\t\t\tbarContainer,\r\n\t\t\t\tlineContainer,\r\n\t\t\t\thandleTextHover,\r\n\t\t\t\tresetHover,\r\n\t\t\t\thandleTextClick,\r\n\t\t\t\tformatSimpleText,\r\n\t\t\t\thasData,\r\n\t\t\t\tisValidPieData,\r\n\t\t\t\tpieData,\r\n\t\t\t\tsimpleBarData,\r\n\t\t\t\tlineData,\r\n\t\t\t\tformatNumber,\r\n\t\t\t\tprocessedField\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.simple-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t\tfont-family: Arial, sans-serif;\r\n\t}\r\n\r\n\t/* 文本样式 */\r\n\t.simple-text {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 14px;\r\n\t\tword-break: break-word;\r\n\t\tpadding: 8px;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.2s ease;\r\n\t\tborder-radius: 4px;\r\n\t\tbackground-color: #f8f9fa;\r\n\t\tmax-width: 100%;\r\n\t}\r\n\r\n\t.simple-text:hover {\r\n\t\tbackground-color: #e9ecef;\r\n\t\ttransform: translateY(-2px);\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.text-tooltip {\r\n\t\tposition: absolute;\r\n\t\ttop: -25px;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\tbackground-color: rgba(0, 0, 0, 0.8);\r\n\t\tcolor: white;\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-size: 12px;\r\n\t\tpointer-events: none;\r\n\t\twhite-space: nowrap;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t/* D3图表容器 */\r\n\t.d3-chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 120px; /* 固定高度 */\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t/* D3 tooltip样式 */\r\n\t.d3-tooltip {\r\n\t\tz-index: 10;\r\n\t\twhite-space: nowrap;\r\n\t\tpointer-events: none;\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);\r\n\t}\r\n\r\n\t/* 无数据样式 */\r\n\t.no-data {\r\n\t\tcolor: #999;\r\n\t\tfont-style: italic;\r\n\t\tpadding: 10px;\r\n\t}\r\n\r\n\t/* Y轴样式 */\r\n\t.y-axis line {\r\n\t\tstroke: #e0e0e0;\r\n\t\tstroke-dasharray: 2, 2;\r\n\t}\r\n\r\n\t.y-axis text {\r\n\t\tfont-size: 10px;\r\n\t\tfill: #666;\r\n\t}\r\n\r\n\t/* 响应式调整 */\r\n\t@media (max-width: 768px) {\r\n\t\t.simple-text {\r\n\t\t\tfont-size: 12px;\r\n\t\t}\r\n\r\n\t\t.d3-chart-container {\r\n\t\t\tmin-height: 60px;\r\n\t\t}\r\n\t}\r\n\r\n\t/* 添加在style部分的末尾 */\r\n\t.bar-label,\r\n\t.line-label {\r\n\t\tfont-family: Arial, sans-serif;\r\n\t\tpointer-events: none;\r\n\t\tuser-select: none;\r\n\t}\r\n\r\n\t@media (max-width: 768px) {\r\n\t\t.bar-label,\r\n\t\t.line-label {\r\n\t\t\tfont-size: 8px;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}