{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\nimport bus from \"@/js/eventBus.js\";\nimport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\nexport default {\n  __name: 'Div2',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const userQuestion = ref(\"\");\n    const chatHistory = ref([]);\n    const selectText2 = ref(\"\");\n    const selectText3 = ref(\"\");\n    const currentChartData = ref(null);\n    const currentChartType = ref(null);\n    const div1RawData = ref(null);\n    const div3RawData = ref(null);\n    const isLoading = ref(false);\n    const div1InfoboxData = ref(null);\n    const div3InfoboxData = ref(null);\n    const leftData = ref(null);\n    const rightData = ref(null);\n\n    // 加载聊天历史\n    const loadChatHistory = () => {\n      const saved = localStorage.getItem(\"chatHistory\");\n      if (saved) {\n        try {\n          chatHistory.value = JSON.parse(saved);\n        } catch (e) {\n          console.error(\"加载聊天记录失败:\", e);\n        }\n      }\n    };\n\n    // 保存聊天历史\n    watch(chatHistory, newVal => {\n      localStorage.removeItem(\"chatHistory\");\n      localStorage.setItem(\"chatHistory\", JSON.stringify(newVal));\n      localStorage.removeItem(\"chatHistory\");\n    }, {\n      deep: true\n    });\n\n    // 滚动到底部\n    const scrollToBottom = () => {\n      nextTick(() => {\n        const container = document.querySelector(\".chat-history\");\n        if (container) {\n          container.scrollTop = container.scrollHeight;\n        }\n      });\n    };\n    const handleDiv1Event = data => handleSelection(data, \"div1\");\n    const handleDiv3Event = data => handleSelection(data, \"div3\");\n    onMounted(() => {\n      loadChatHistory();\n      bus.on(\"div1_Event\", handleDiv1Event);\n      bus.on(\"div3_Event\", handleDiv3Event);\n      bus.on(\"div1_InfoboxData\", data => {\n        div1InfoboxData.value = data;\n        console.log(\"Received div1 infobox:\", data);\n      });\n      bus.on(\"div3_InfoboxData\", data => {\n        div3InfoboxData.value = data;\n        console.log(\"Received div3 infobox:\", data);\n      });\n    });\n    onUnmounted(() => {\n      bus.off(\"div1_Event\", handleDiv1Event);\n      bus.off(\"div3_Event\", handleDiv3Event);\n      bus.off(\"div1_InfoboxData\");\n      bus.off(\"div3_InfoboxData\");\n    });\n    function handleSelection(data, source) {\n      const plainText = getPlainTextFromSelection(data.content);\n      if (source === \"div1\") {\n        selectText2.value = plainText;\n        div1RawData.value = data.content;\n      } else if (source === \"div3\") {\n        selectText3.value = plainText;\n        div3RawData.value = data.content;\n      }\n    }\n    function getPlainTextFromSelection(htmlContent) {\n      const container = document.createElement(\"div\");\n      container.innerHTML = htmlContent;\n      return container.innerText || container.textContent || \"\";\n    }\n    const formatAnalysisResult = text => {\n      if (!text) return \"\";\n\n      // 增强的Markdown转换\n      text = text.replace(/^# (.*$)/gm, \"<h1>$1</h1>\").replace(/^## (.*$)/gm, \"<h2>$1</h2>\").replace(/^### (.*$)/gm, \"<h3>$1</h3>\").replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\").replace(/\\*(.*?)\\*/g, \"<em>$1</em>\").replace(/`(.*?)`/g, \"<code>$1</code>\").replace(/!\\[(.*?)\\]\\((.*?)\\)/g, '<img alt=\"$1\" src=\"$2\">').replace(/\\[(.*?)\\]\\((.*?)\\)/g, '<a href=\"$2\">$1</a>').replace(/(?:^|\\n)\\d+\\.\\s+(.*)/g, \"<li>$1</li>\").replace(/(?:^|\\n)-\\s+(.*)/g, \"<li>$1</li>\").replace(/(?:^|\\n)\\>\\s+(.*)/g, \"<blockquote>$1</blockquote>\").replace(/(<li>.*<\\/li>)/gs, \"<ul>$1</ul>\").replace(/\\n\\n/g, \"<br><br>\").replace(/\\n/g, \"<br>\");\n      return `<div class=\"markdown-content\">${text}</div>`;\n    };\n    const askQuestion = async () => {\n      if (!userQuestion.value.trim()) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"问题不能为空\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n      const question = userQuestion.value;\n      chatHistory.value.push({\n        role: \"user\",\n        content: question,\n        timestamp: new Date().toLocaleString()\n      });\n      userQuestion.value = \"\";\n      isLoading.value = true;\n      try {\n        await api.post(\"gpt_ask_chart\", {\n          question: question,\n          chartData: currentChartData.value,\n          chartType: currentChartType.value\n        }, response => {\n          const formattedAnswer = formatAnalysisResult(response.answer);\n          chatHistory.value.push({\n            role: \"assistant\",\n            content: formattedAnswer,\n            timestamp: new Date().toLocaleString()\n          });\n          scrollToBottom();\n        }, error => {\n          throw error;\n        });\n      } catch (error) {\n        console.error(\"请求失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `请求失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n      } finally {\n        isLoading.value = false;\n        scrollToBottom();\n      }\n    };\n    const simplifyInfobox = infobox => {\n      if (!infobox) return {};\n      const simpleData = {};\n      const fieldsToKeep = [\"score\", \"rate\", \"value\", \"amount\", \"size\", \"level\"]; // 关键数值字段\n\n      Object.entries(infobox).forEach(_ref2 => {\n        let [key, value] = _ref2;\n        // 保留数值型字段和短文本\n        if (fieldsToKeep.includes(key) || typeof value === \"number\" || typeof value === \"string\" && value.length < 30) {\n          simpleData[key] = value;\n        }\n      });\n      return simpleData;\n    };\n    const getSummary = htmlContent => {\n      const div = document.createElement(\"div\");\n      div.innerHTML = htmlContent;\n      const text = div.textContent || \"\";\n      const maxLength = 200;\n      if (text.length <= maxLength) return text;\n\n      // 提取开头和结论部分\n      const start = text.substring(0, maxLength);\n      const conclusionIndex = text.lastIndexOf(\"结论\") > -1 ? text.lastIndexOf(\"结论\") : text.lastIndexOf(\"因此\");\n      const end = conclusionIndex > -1 ? text.substring(conclusionIndex) : text.substring(text.length - 100);\n      return `${start}...\\n[关键结论]: ${end}`;\n    };\n    const handleAttributeComparison = async _ref3 => {\n      let {\n        fieldKey,\n        leftData: incomingLeftData,\n        rightData: incomingRightData,\n        leftTitle,\n        rightTitle,\n        fieldType,\n        fieldLabel\n      } = _ref3;\n      // 检查数据是否存在\n      if (!incomingLeftData || !incomingRightData) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"请先选择要对比的数据\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n\n      // 保存数据到全局变量\n      leftData.value = incomingLeftData;\n      rightData.value = incomingRightData;\n      isLoading.value = true;\n      try {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `正在对比分析<strong>${fieldKey}</strong>属性...`,\n          timestamp: new Date().toLocaleString()\n        });\n        const requestPayload = {\n          chartData: {\n            leftData: leftData.value,\n            // 使用全局状态的数据\n            rightData: rightData.value,\n            // 使用全局状态的数据\n            leftTitle,\n            rightTitle,\n            fieldKey,\n            fieldType,\n            allFields: Object.keys({\n              ...div1InfoboxData.value,\n              ...div3InfoboxData.value\n            }),\n            leftInfobox: simplifyInfobox(div1InfoboxData.value),\n            rightInfobox: simplifyInfobox(div3InfoboxData.value)\n          },\n          chartType: \"comparison\"\n        };\n        await api.post(\"compare_attributes\", requestPayload, response => {\n          const formattedAnalysis = formatAnalysisResult(response.analysis);\n          chatHistory.value.push({\n            role: \"assistant\",\n            content: formattedAnalysis,\n            timestamp: new Date().toLocaleString(),\n            showFollowup: true,\n            fieldKey: fieldKey\n          });\n        }, error => {\n          throw error;\n        });\n      } catch (error) {\n        console.error(\"对比分析失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `对比分析失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n      } finally {\n        isLoading.value = false;\n        scrollToBottom();\n      }\n    };\n    const handleFollowupQuestion = async fieldKey => {\n      isLoading.value = true;\n      try {\n        const payload = {\n          chartData: {\n            fieldKey,\n            leftData: leftData.value,\n            // 使用全局状态的数据\n            rightData: rightData.value,\n            // 使用全局状态的数据\n            leftInfobox: simplifyInfobox(div1InfoboxData.value),\n            rightInfobox: simplifyInfobox(div3InfoboxData.value),\n            previousAnalysis: getSummary(chatHistory.value[chatHistory.value.length - 2].content)\n          },\n          chartType: \"comparison\",\n          followUp: true\n        };\n\n        // 检查数据大小\n        const payloadSize = JSON.stringify(payload).length;\n        if (payloadSize > 20000) {\n          payload.chartData.leftInfobox = furtherSimplify(payload.chartData.leftInfobox);\n          payload.chartData.rightInfobox = furtherSimplify(payload.chartData.rightInfobox);\n        }\n        await api.post(\"compare_attributes\", payload, response => {\n          const formattedAnalysis = formatAnalysisResult(response.analysis);\n          chatHistory.value.push({\n            role: \"assistant\",\n            content: formattedAnalysis,\n            timestamp: new Date().toLocaleString()\n          });\n        }, error => {\n          throw error;\n        });\n      } catch (error) {\n        console.error(\"深入分析失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `深入分析失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n      } finally {\n        isLoading.value = false;\n        scrollToBottom();\n      }\n    };\n\n    // 进一步精简数据\n    const furtherSimplify = data => {\n      const result = {};\n      const priorityFields = [\"score\", \"value\", \"rate\", \"average\"];\n      priorityFields.forEach(field => {\n        if (data[field] !== undefined) {\n          result[field] = data[field];\n        }\n      });\n\n      // 最多保留5个字段\n      const otherFields = Object.keys(data).filter(k => !priorityFields.includes(k)).slice(0, 5 - priorityFields.length);\n      otherFields.forEach(field => {\n        result[field] = data[field];\n      });\n      return result;\n    };\n    const __returned__ = {\n      userQuestion,\n      chatHistory,\n      selectText2,\n      selectText3,\n      currentChartData,\n      currentChartType,\n      div1RawData,\n      div3RawData,\n      isLoading,\n      div1InfoboxData,\n      div3InfoboxData,\n      leftData,\n      rightData,\n      loadChatHistory,\n      scrollToBottom,\n      handleDiv1Event,\n      handleDiv3Event,\n      handleSelection,\n      getPlainTextFromSelection,\n      formatAnalysisResult,\n      askQuestion,\n      simplifyInfobox,\n      getSummary,\n      handleAttributeComparison,\n      handleFollowupQuestion,\n      furtherSimplify,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch,\n      nextTick,\n      get bus() {\n        return bus;\n      },\n      CompareTable\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","nextTick","bus","CompareTable","userQuestion","chatHistory","selectText2","selectText3","currentChartData","currentChartType","div1RawData","div3RawData","isLoading","div1InfoboxData","div3InfoboxData","leftData","rightData","loadChatHistory","saved","localStorage","getItem","value","JSON","parse","e","console","error","newVal","removeItem","setItem","stringify","deep","scrollToBottom","container","document","querySelector","scrollTop","scrollHeight","handleDiv1Event","data","handleSelection","handleDiv3Event","on","log","off","source","plainText","getPlainTextFromSelection","content","htmlContent","createElement","innerHTML","innerText","textContent","formatAnalysisResult","text","replace","askQuestion","trim","push","role","timestamp","Date","toLocaleString","question","api","post","chartData","chartType","response","formattedAnswer","answer","message","simplifyInfobox","infobox","simpleData","fieldsToKeep","Object","entries","forEach","_ref2","key","includes","length","getSummary","div","maxLength","start","substring","conclusionIndex","lastIndexOf","end","handleAttributeComparison","_ref3","fieldKey","incomingLeftData","incomingRightData","leftTitle","rightTitle","fieldType","fieldLabel","requestPayload","allFields","keys","leftInfobox","rightInfobox","formattedAnalysis","analysis","showFollowup","handleFollowupQuestion","payload","previousAnalysis","followUp","payloadSize","furtherSimplify","result","priorityFields","field","undefined","otherFields","filter","k","slice"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/Div2.vue"],"sourcesContent":["<template>\r\n\t<div class=\"main-container\">\r\n\t\t<div class=\"chat-container\">\r\n\t\t\t<div class=\"chat-history\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(message, index) in chatHistory\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:class=\"['message', message.role, { error: message.error }]\">\r\n\t\t\t\t\t<div class=\"message-content\" v-html=\"message.content\"></div>\r\n\t\t\t\t\t<div v-if=\"message.showFollowup\" class=\"followup-section\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tclass=\"followup-btn\"\r\n\t\t\t\t\t\t\t@click=\"handleFollowupQuestion(message.fieldKey)\">\r\n\t\t\t\t\t\t\t结合其他属性深入分析原因\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"isLoading\" class=\"loading-indicator\">\r\n\t\t\t\t\t<div class=\"loading-spinner\"></div>\r\n\t\t\t\t\t正在处理中...\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"vis-container\">\r\n\t\t\t<CompareTable\r\n\t\t\t\tclass=\"compare-table\"\r\n\t\t\t\t:div1-raw-data=\"div1RawData\"\r\n\t\t\t\t:div3-raw-data=\"div3RawData\"\r\n\t\t\t\t@compareAttribute=\"handleAttributeComparison\" />\r\n\t\t</div>\r\n\t\t<div class=\"input\">\r\n\t\t\t<div class=\"input-container\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tv-model=\"userQuestion\"\r\n\t\t\t\t\trows=\"2\"\r\n\t\t\t\t\tplaceholder=\"请输入你想问的问题...\"\r\n\t\t\t\t\t:disabled=\"isLoading\"></textarea>\r\n\t\t\t\t<div class=\"button-container\">\r\n\t\t\t\t\t<button @click=\"askQuestion\" :disabled=\"isLoading\">\r\n\t\t\t\t\t\t{{ isLoading ? \"处理中...\" : \"发送\" }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\timport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\r\n\r\n\tconst userQuestion = ref(\"\");\r\n\tconst chatHistory = ref([]);\r\n\tconst selectText2 = ref(\"\");\r\n\tconst selectText3 = ref(\"\");\r\n\tconst currentChartData = ref(null);\r\n\tconst currentChartType = ref(null);\r\n\tconst div1RawData = ref(null);\r\n\tconst div3RawData = ref(null);\r\n\tconst isLoading = ref(false);\r\n\tconst div1InfoboxData = ref(null);\r\n\tconst div3InfoboxData = ref(null);\r\n\r\n\tconst leftData = ref(null);\r\n\tconst rightData = ref(null);\r\n\r\n\t// 加载聊天历史\r\n\tconst loadChatHistory = () => {\r\n\t\tconst saved = localStorage.getItem(\"chatHistory\");\r\n\t\tif (saved) {\r\n\t\t\ttry {\r\n\t\t\t\tchatHistory.value = JSON.parse(saved);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"加载聊天记录失败:\", e);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 保存聊天历史\r\n\twatch(\r\n\t\tchatHistory,\r\n\t\tnewVal => {\r\n\t\t\tlocalStorage.removeItem(\"chatHistory\");\r\n\t\t\tlocalStorage.setItem(\"chatHistory\", JSON.stringify(newVal));\r\n\t\t\tlocalStorage.removeItem(\"chatHistory\");\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n\r\n\t// 滚动到底部\r\n\tconst scrollToBottom = () => {\r\n\t\tnextTick(() => {\r\n\t\t\tconst container = document.querySelector(\".chat-history\");\r\n\t\t\tif (container) {\r\n\t\t\t\tcontainer.scrollTop = container.scrollHeight;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleDiv1Event = data => handleSelection(data, \"div1\");\r\n\tconst handleDiv3Event = data => handleSelection(data, \"div3\");\r\n\r\n\tonMounted(() => {\r\n\t\tloadChatHistory();\r\n\t\tbus.on(\"div1_Event\", handleDiv1Event);\r\n\t\tbus.on(\"div3_Event\", handleDiv3Event);\r\n\t\tbus.on(\"div1_InfoboxData\", data => {\r\n\t\t\tdiv1InfoboxData.value = data;\r\n\t\t\tconsole.log(\"Received div1 infobox:\", data);\r\n\t\t});\r\n\t\tbus.on(\"div3_InfoboxData\", data => {\r\n\t\t\tdiv3InfoboxData.value = data;\r\n\t\t\tconsole.log(\"Received div3 infobox:\", data);\r\n\t\t});\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tbus.off(\"div1_Event\", handleDiv1Event);\r\n\t\tbus.off(\"div3_Event\", handleDiv3Event);\r\n\t\tbus.off(\"div1_InfoboxData\");\r\n\t\tbus.off(\"div3_InfoboxData\");\r\n\t});\r\n\r\n\tfunction handleSelection(data, source) {\r\n\t\tconst plainText = getPlainTextFromSelection(data.content);\r\n\t\tif (source === \"div1\") {\r\n\t\t\tselectText2.value = plainText;\r\n\t\t\tdiv1RawData.value = data.content;\r\n\t\t} else if (source === \"div3\") {\r\n\t\t\tselectText3.value = plainText;\r\n\t\t\tdiv3RawData.value = data.content;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getPlainTextFromSelection(htmlContent) {\r\n\t\tconst container = document.createElement(\"div\");\r\n\t\tcontainer.innerHTML = htmlContent;\r\n\t\treturn container.innerText || container.textContent || \"\";\r\n\t}\r\n\r\n\tconst formatAnalysisResult = text => {\r\n\t\tif (!text) return \"\";\r\n\r\n\t\t// 增强的Markdown转换\r\n\t\ttext = text\r\n\t\t\t.replace(/^# (.*$)/gm, \"<h1>$1</h1>\")\r\n\t\t\t.replace(/^## (.*$)/gm, \"<h2>$1</h2>\")\r\n\t\t\t.replace(/^### (.*$)/gm, \"<h3>$1</h3>\")\r\n\t\t\t.replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\")\r\n\t\t\t.replace(/\\*(.*?)\\*/g, \"<em>$1</em>\")\r\n\t\t\t.replace(/`(.*?)`/g, \"<code>$1</code>\")\r\n\t\t\t.replace(/!\\[(.*?)\\]\\((.*?)\\)/g, '<img alt=\"$1\" src=\"$2\">')\r\n\t\t\t.replace(/\\[(.*?)\\]\\((.*?)\\)/g, '<a href=\"$2\">$1</a>')\r\n\t\t\t.replace(/(?:^|\\n)\\d+\\.\\s+(.*)/g, \"<li>$1</li>\")\r\n\t\t\t.replace(/(?:^|\\n)-\\s+(.*)/g, \"<li>$1</li>\")\r\n\t\t\t.replace(/(?:^|\\n)\\>\\s+(.*)/g, \"<blockquote>$1</blockquote>\")\r\n\t\t\t.replace(/(<li>.*<\\/li>)/gs, \"<ul>$1</ul>\")\r\n\t\t\t.replace(/\\n\\n/g, \"<br><br>\")\r\n\t\t\t.replace(/\\n/g, \"<br>\");\r\n\r\n\t\treturn `<div class=\"markdown-content\">${text}</div>`;\r\n\t};\r\n\r\n\tconst askQuestion = async () => {\r\n\t\tif (!userQuestion.value.trim()) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"问题不能为空\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst question = userQuestion.value;\r\n\t\tchatHistory.value.push({\r\n\t\t\trole: \"user\",\r\n\t\t\tcontent: question,\r\n\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t});\r\n\t\tuserQuestion.value = \"\";\r\n\r\n\t\tisLoading.value = true;\r\n\r\n\t\ttry {\r\n\t\t\tawait api.post(\r\n\t\t\t\t\"gpt_ask_chart\",\r\n\t\t\t\t{\r\n\t\t\t\t\tquestion: question,\r\n\t\t\t\t\tchartData: currentChartData.value,\r\n\t\t\t\t\tchartType: currentChartType.value\r\n\t\t\t\t},\r\n\t\t\t\tresponse => {\r\n\t\t\t\t\tconst formattedAnswer = formatAnalysisResult(response.answer);\r\n\t\t\t\t\tchatHistory.value.push({\r\n\t\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\t\tcontent: formattedAnswer,\r\n\t\t\t\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t\t\t\t});\r\n\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t},\r\n\t\t\t\terror => {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"请求失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `请求失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\t};\r\n\r\n\tconst simplifyInfobox = infobox => {\r\n\t\tif (!infobox) return {};\r\n\t\tconst simpleData = {};\r\n\t\tconst fieldsToKeep = [\"score\", \"rate\", \"value\", \"amount\", \"size\", \"level\"]; // 关键数值字段\r\n\r\n\t\tObject.entries(infobox).forEach(([key, value]) => {\r\n\t\t\t// 保留数值型字段和短文本\r\n\t\t\tif (\r\n\t\t\t\tfieldsToKeep.includes(key) ||\r\n\t\t\t\ttypeof value === \"number\" ||\r\n\t\t\t\t(typeof value === \"string\" && value.length < 30)\r\n\t\t\t) {\r\n\t\t\t\tsimpleData[key] = value;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn simpleData;\r\n\t};\r\n\r\n\tconst getSummary = htmlContent => {\r\n\t\tconst div = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = htmlContent;\r\n\t\tconst text = div.textContent || \"\";\r\n\t\tconst maxLength = 200;\r\n\r\n\t\tif (text.length <= maxLength) return text;\r\n\r\n\t\t// 提取开头和结论部分\r\n\t\tconst start = text.substring(0, maxLength);\r\n\t\tconst conclusionIndex =\r\n\t\t\ttext.lastIndexOf(\"结论\") > -1\r\n\t\t\t\t? text.lastIndexOf(\"结论\")\r\n\t\t\t\t: text.lastIndexOf(\"因此\");\r\n\r\n\t\tconst end =\r\n\t\t\tconclusionIndex > -1\r\n\t\t\t\t? text.substring(conclusionIndex)\r\n\t\t\t\t: text.substring(text.length - 100);\r\n\r\n\t\treturn `${start}...\\n[关键结论]: ${end}`;\r\n\t};\r\n\r\n\tconst handleAttributeComparison = async ({\r\n\t\tfieldKey,\r\n\t\tleftData: incomingLeftData,\r\n\t\trightData: incomingRightData,\r\n\t\tleftTitle,\r\n\t\trightTitle,\r\n\t\tfieldType,\r\n\t\tfieldLabel\r\n\t}) => {\r\n\t\t// 检查数据是否存在\r\n\t\tif (!incomingLeftData || !incomingRightData) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"请先选择要对比的数据\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 保存数据到全局变量\r\n\t\tleftData.value = incomingLeftData;\r\n\t\trightData.value = incomingRightData;\r\n\r\n\t\tisLoading.value = true;\r\n\r\n\t\ttry {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `正在对比分析<strong>${fieldKey}</strong>属性...`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t\t});\r\n\r\n\t\t\tconst requestPayload = {\r\n\t\t\t\tchartData: {\r\n\t\t\t\t\tleftData: leftData.value, // 使用全局状态的数据\r\n\t\t\t\t\trightData: rightData.value, // 使用全局状态的数据\r\n\t\t\t\t\tleftTitle,\r\n\t\t\t\t\trightTitle,\r\n\t\t\t\t\tfieldKey,\r\n\t\t\t\t\tfieldType,\r\n\t\t\t\t\tallFields: Object.keys({\r\n\t\t\t\t\t\t...div1InfoboxData.value,\r\n\t\t\t\t\t\t...div3InfoboxData.value\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tleftInfobox: simplifyInfobox(div1InfoboxData.value),\r\n\t\t\t\t\trightInfobox: simplifyInfobox(div3InfoboxData.value)\r\n\t\t\t\t},\r\n\t\t\t\tchartType: \"comparison\"\r\n\t\t\t};\r\n\r\n\t\t\tawait api.post(\r\n\t\t\t\t\"compare_attributes\",\r\n\t\t\t\trequestPayload,\r\n\t\t\t\tresponse => {\r\n\t\t\t\t\tconst formattedAnalysis = formatAnalysisResult(response.analysis);\r\n\t\t\t\t\tchatHistory.value.push({\r\n\t\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\t\tcontent: formattedAnalysis,\r\n\t\t\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\t\t\tshowFollowup: true,\r\n\t\t\t\t\t\tfieldKey: fieldKey\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\terror => {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"对比分析失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `对比分析失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleFollowupQuestion = async fieldKey => {\r\n\t\tisLoading.value = true;\r\n\r\n\t\ttry {\r\n\t\t\tconst payload = {\r\n\t\t\t\tchartData: {\r\n\t\t\t\t\tfieldKey,\r\n\t\t\t\t\tleftData: leftData.value, // 使用全局状态的数据\r\n\t\t\t\t\trightData: rightData.value, // 使用全局状态的数据\r\n\t\t\t\t\tleftInfobox: simplifyInfobox(div1InfoboxData.value),\r\n\t\t\t\t\trightInfobox: simplifyInfobox(div3InfoboxData.value),\r\n\t\t\t\t\tpreviousAnalysis: getSummary(\r\n\t\t\t\t\t\tchatHistory.value[chatHistory.value.length - 2].content\r\n\t\t\t\t\t)\r\n\t\t\t\t},\r\n\t\t\t\tchartType: \"comparison\",\r\n\t\t\t\tfollowUp: true\r\n\t\t\t};\r\n\r\n\t\t\t// 检查数据大小\r\n\t\t\tconst payloadSize = JSON.stringify(payload).length;\r\n\t\t\tif (payloadSize > 20000) {\r\n\t\t\t\tpayload.chartData.leftInfobox = furtherSimplify(\r\n\t\t\t\t\tpayload.chartData.leftInfobox\r\n\t\t\t\t);\r\n\t\t\t\tpayload.chartData.rightInfobox = furtherSimplify(\r\n\t\t\t\t\tpayload.chartData.rightInfobox\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tawait api.post(\r\n\t\t\t\t\"compare_attributes\",\r\n\t\t\t\tpayload,\r\n\t\t\t\tresponse => {\r\n\t\t\t\t\tconst formattedAnalysis = formatAnalysisResult(response.analysis);\r\n\t\t\t\t\tchatHistory.value.push({\r\n\t\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\t\tcontent: formattedAnalysis,\r\n\t\t\t\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\terror => {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"深入分析失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `深入分析失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\t};\r\n\r\n\t// 进一步精简数据\r\n\tconst furtherSimplify = data => {\r\n\t\tconst result = {};\r\n\t\tconst priorityFields = [\"score\", \"value\", \"rate\", \"average\"];\r\n\r\n\t\tpriorityFields.forEach(field => {\r\n\t\t\tif (data[field] !== undefined) {\r\n\t\t\t\tresult[field] = data[field];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// 最多保留5个字段\r\n\t\tconst otherFields = Object.keys(data)\r\n\t\t\t.filter(k => !priorityFields.includes(k))\r\n\t\t\t.slice(0, 5 - priorityFields.length);\r\n\r\n\t\totherFields.forEach(field => {\r\n\t\t\tresult[field] = data[field];\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.main-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tbackground: #f5f7fa;\r\n\t}\r\n\r\n\t.chat-container {\r\n\t\tflex: 1;\r\n\t\toverflow: hidden;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.chat-history {\r\n\t\tflex: 1;\r\n\t\toverflow-y: auto;\r\n\t\tpadding: 20px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t\tmargin: 10px;\r\n\t\tscroll-behavior: smooth;\r\n\t}\r\n\r\n\t.message {\r\n\t\tmargin-bottom: 20px;\r\n\t\tpadding: 15px 20px;\r\n\t\tborder-radius: 12px;\r\n\t\tline-height: 1.6;\r\n\t\tposition: relative;\r\n\t\tmax-width: 85%;\r\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.message.user {\r\n\t\tbackground: #e3f2fd;\r\n\t\tmargin-left: auto;\r\n\t\tborder-bottom-right-radius: 4px;\r\n\t}\r\n\r\n\t.message.assistant {\r\n\t\tbackground: #f8f9fa;\r\n\t\tmargin-right: auto;\r\n\t\tborder-bottom-left-radius: 4px;\r\n\t}\r\n\r\n\t.message.error {\r\n\t\tbackground: #ffebee;\r\n\t\tborder-left: 4px solid #f44336;\r\n\t}\r\n\r\n\t.message-content {\r\n\t\tword-wrap: break-word;\r\n\t}\r\n\r\n\t.input {\r\n\t\tpadding: 15px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-top: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.input-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.input-container textarea {\r\n\t\twidth: 100%;\r\n\t\tpadding: 12px 16px;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t\tborder-radius: 12px;\r\n\t\tresize: none;\r\n\t\tfont-size: 14px;\r\n\t\toutline: none;\r\n\t\ttransition: border 0.3s ease;\r\n\t\tbackground: #f9f9f9;\r\n\t}\r\n\r\n\t.input-container textarea:focus {\r\n\t\tborder-color: #4285f4;\r\n\t\tbackground: #ffffff;\r\n\t\tbox-shadow: 0 0 0 2px rgba(66, 133, 244, 0.1);\r\n\t}\r\n\r\n\t.button-container {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-end;\r\n\t\tpadding: 8px;\r\n\t}\r\n\r\n\t.button-container button {\r\n\t\tbackground: #4285f4;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 8px 20px;\r\n\t\tborder-radius: 8px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 14px;\r\n\t\tfont-weight: 500;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\r\n\t.button-container button:hover {\r\n\t\tbackground: #3367d6;\r\n\t\ttransform: translateY(-1px);\r\n\t}\r\n\r\n\t.button-container button:disabled {\r\n\t\tbackground: #b3c6e0;\r\n\t\tcursor: not-allowed;\r\n\t\ttransform: none;\r\n\t}\r\n\r\n\t.loading-indicator {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 15px;\r\n\t\tcolor: #666;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\t.loading-spinner {\r\n\t\tborder: 3px solid rgba(66, 133, 244, 0.2);\r\n\t\tborder-radius: 50%;\r\n\t\tborder-top: 3px solid #4285f4;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tanimation: spin 1s linear infinite;\r\n\t\tmargin-right: 10px;\r\n\t}\r\n\r\n\t@keyframes spin {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\r\n\t/* Enhanced Markdown styling */\r\n\t.markdown-content {\r\n\t\tline-height: 1.7;\r\n\t\tfont-size: 15px;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.markdown-content h1 {\r\n\t\tfont-size: 1.5em;\r\n\t\tmargin: 20px 0 15px;\r\n\t\tpadding-bottom: 5px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\tcolor: #2c3e50;\r\n\t}\r\n\r\n\t.markdown-content h2 {\r\n\t\tfont-size: 1.3em;\r\n\t\tmargin: 18px 0 12px;\r\n\t\tcolor: #34495e;\r\n\t}\r\n\r\n\t.markdown-content h3 {\r\n\t\tfont-size: 1.1em;\r\n\t\tmargin: 15px 0 10px;\r\n\t\tcolor: #4285f4;\r\n\t}\r\n\r\n\t.markdown-content ul,\r\n\t.markdown-content ol {\r\n\t\tpadding-left: 25px;\r\n\t\tmargin: 12px 0;\r\n\t}\r\n\r\n\t.markdown-content li {\r\n\t\tmargin-bottom: 8px;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.markdown-content ul li::before {\r\n\t\tcontent: \"•\";\r\n\t\tcolor: #4285f4;\r\n\t\tposition: absolute;\r\n\t\tleft: -15px;\r\n\t}\r\n\r\n\t.markdown-content strong {\r\n\t\tcolor: #2c3e50;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.markdown-content em {\r\n\t\tcolor: #666;\r\n\t\tfont-style: italic;\r\n\t}\r\n\r\n\t.markdown-content code {\r\n\t\tbackground: rgba(66, 133, 244, 0.1);\r\n\t\tpadding: 2px 6px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, monospace;\r\n\t\tfont-size: 0.9em;\r\n\t\tcolor: #d63384;\r\n\t}\r\n\r\n\t.markdown-content blockquote {\r\n\t\tborder-left: 3px solid #4285f4;\r\n\t\tpadding: 10px 15px;\r\n\t\tmargin: 15px 0;\r\n\t\tbackground: rgba(66, 133, 244, 0.05);\r\n\t\tcolor: #555;\r\n\t}\r\n\r\n\t.markdown-content a {\r\n\t\tcolor: #4285f4;\r\n\t\ttext-decoration: none;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.markdown-content a:hover {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\r\n\t/* Enhanced followup button */\r\n\t.followup-section {\r\n\t\tmargin-top: 18px;\r\n\t\tpadding-top: 12px;\r\n\t\tborder-top: 1px dashed #e0e0e0;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.followup-btn {\r\n\t\tbackground: linear-gradient(to right, #4285f4, #34a853);\r\n\t\tborder: none;\r\n\t\tcolor: white;\r\n\t\tpadding: 8px 20px;\r\n\t\tborder-radius: 20px;\r\n\t\tfont-size: 13px;\r\n\t\tfont-weight: 500;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.3s ease;\r\n\t\tbox-shadow: 0 2px 5px rgba(66, 133, 244, 0.2);\r\n\t}\r\n\r\n\t.followup-btn:hover {\r\n\t\tbackground: linear-gradient(to right, #3367d6, #2d8e47);\r\n\t\ttransform: translateY(-2px);\r\n\t\tbox-shadow: 0 4px 8px rgba(66, 133, 244, 0.3);\r\n\t}\r\n\r\n\t.followup-btn:active {\r\n\t\ttransform: translateY(0);\r\n\t}\r\n\r\n\t/* Vis container styling */\r\n\t.vis-container {\r\n\t\tpadding: 10px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tmargin: 10px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.compare-table {\r\n\t\twidth: 100%;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}