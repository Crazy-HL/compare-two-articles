{"ast":null,"code":"import { computed, ref, onMounted, watch, nextTick } from \"vue\";\nimport * as d3 from \"d3\";\nexport default {\n  props: {\n    field: {\n      type: [Object, Array, String, Number],\n      default: null\n    },\n    type: {\n      type: String,\n      default: \"\"\n    },\n    visualization: {\n      type: String,\n      default: \"\"\n    },\n    fieldKey: {\n      // Added for context in formatting/parsing if needed\n      type: String,\n      default: \"\"\n    },\n    yAxisMax: {\n      // For unified Y-axis in bar charts\n      type: Number,\n      default: null\n    }\n  },\n  emits: [\"chartClick\"],\n  setup(props, _ref) {\n    let {\n      emit\n    } = _ref;\n    const hoveredIndex = ref(null);\n    const activeIndex = ref(null);\n    const isTextHovered = ref(false);\n\n    // 容器引用\n    const pieContainer = ref(null);\n    const barContainer = ref(null);\n    const lineContainer = ref(null);\n\n    // 颜色定义\n    const colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\n    const remainderColor = \"#f0f0f0\"; // Color for the \"remainder\" part of a single-value pie chart\n\n    // 处理后的字段数据\n    const processedField = computed(() => {\n      if (!props.field) return null;\n      const processItem = item => {\n        if (typeof item === \"object\" && item !== null) {\n          return {\n            value: item.value ?? item.raw,\n            raw: item.raw,\n            ...(item.unit && {\n              unit: item.unit\n            }),\n            ...(item.currency && {\n              currency: item.currency\n            }),\n            ...(item.year && {\n              year: item.year\n            }),\n            ...item // spread other properties\n          };\n        }\n        return {\n          value: item,\n          raw: item\n        }; // Wrap primitive for consistency\n      };\n      if (Array.isArray(props.field)) {\n        return props.field.map(processItem);\n      }\n      return processItem(props.field);\n    });\n\n    // 初始化图表\n    onMounted(() => {\n      watch(() => [processedField.value, props.visualization, props.yAxisMax],\n      // Watch yAxisMax for bar charts\n      () => {\n        nextTick(() => {\n          if (props.visualization === \"pie-chart\" && hasData.value && isValidPieData.value) {\n            renderPieChart();\n          } else if (props.visualization === \"bar-chart\" && hasData.value) {\n            renderBarChart();\n          } else if (props.visualization === \"line-chart\" && hasData.value) {\n            renderLineChart();\n          }\n        });\n      }, {\n        immediate: true,\n        deep: true\n      });\n    });\n\n    // 渲染饼图（添加剩余比例）\n    const renderPieChart = () => {\n      if (!pieContainer.value) return;\n      d3.select(pieContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(pieContainer.value);\n      const containerWidth = pieContainer.value.clientWidth;\n      const containerHeight = pieContainer.value.clientHeight;\n      const size = Math.min(containerWidth, containerHeight) * 0.9; // Slightly smaller for padding\n      const radius = size / 2;\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${size} ${size}`).append(\"g\").attr(\"transform\", `translate(${radius},${radius})`);\n      const currentPieData = pieData.value; // Use the computed pieData\n\n      // Process data for pie chart (single value vs multiple)\n      const processedPieChartData = currentPieData.length === 1 && currentPieData[0].value < 100 // Only add remainder if not 100%\n      ? [{\n        ...currentPieData[0],\n        color: colors[0],\n        isMainValue: true\n      }, {\n        value: Math.max(0, 100 - currentPieData[0].value),\n        name: \"剩余\",\n        color: remainderColor,\n        isRemainder: true,\n        index: 1 // Different index for the remainder\n      }] : currentPieData.map((d, i) => ({\n        ...d,\n        color: colors[i % colors.length],\n        isMainValue: true\n      }));\n      const pie = d3.pie().value(d => d.value).sort(null);\n      const arc = d3.arc().innerRadius(0) // For a pie chart, not a donut\n      .outerRadius(radius * 0.95) // Slightly smaller than radius\n      .cornerRadius(2);\n      const arcs = svg.selectAll(\".arc\").data(pie(processedPieChartData)).enter().append(\"g\").attr(\"class\", \"arc\");\n      arcs.append(\"path\").attr(\"d\", arc).attr(\"fill\", d => d.data.color).style(\"opacity\", d => d.data.isRemainder ? 0.5 : 0.9).style(\"stroke\", \"#fff\").style(\"stroke-width\", 1).on(\"mouseover\", function (event, d) {\n        if (d.data.isRemainder) return;\n        hoveredIndex.value = d.data.index;\n        d3.select(this).transition().duration(150).style(\"opacity\", 1).attr(\"transform\", \"scale(1.03)\");\n        tooltip.style(\"visibility\", \"visible\").html(`${d.data.name}: ${d.data.value.toFixed(1)}${props.type === \"percentage\" ? \"%\" : \"\"}`);\n      }).on(\"mouseout\", function (event, d) {\n        if (d.data.isRemainder) return;\n        hoveredIndex.value = null;\n        d3.select(this).transition().duration(150).style(\"opacity\", d.data.isRemainder ? 0.5 : 0.9).attr(\"transform\", \"scale(1)\");\n        tooltip.style(\"visibility\", \"hidden\");\n      }).on(\"click\", function (event, d) {\n        if (d.data.isRemainder) return;\n        activeIndex.value = d.data.index;\n        emit(\"chartClick\", {\n          type: \"pie\",\n          index: d.data.index,\n          data: d.data,\n          value: d.data.value\n        });\n      });\n      if (currentPieData.length === 1) {\n        svg.append(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \".3em\").text(`${currentPieData[0].value.toFixed(1)}${props.type === \"percentage\" ? \"%\" : \"\"}`).style(\"font-size\", `${Math.max(10, radius / 4)}px`) // Responsive font size\n        .style(\"fill\", \"#333\");\n      }\n      const tooltip = container.append(\"div\").attr(\"class\", \"d3-tooltip\").style(\"position\", \"absolute\").style(\"visibility\", \"hidden\").style(\"background\", \"rgba(0,0,0,0.75)\").style(\"color\", \"white\").style(\"padding\", \"5px 10px\").style(\"border-radius\", \"4px\").style(\"font-size\", \"12px\");\n    };\n    const renderBarChart = () => {\n      if (!barContainer.value || !simpleBarData.value.length) return;\n      d3.select(barContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(barContainer.value);\n      const width = barContainer.value.clientWidth;\n      const height = barContainer.value.clientHeight;\n      const margin = {\n        top: 10,\n        right: 5,\n        bottom: 25,\n        left: 5\n      }; // Adjusted margins for labels\n\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${width} ${height}`);\n      let yDomainMaxValue;\n      if (props.yAxisMax !== null && props.yAxisMax !== undefined && props.yAxisMax >= 0) {\n        yDomainMaxValue = props.yAxisMax;\n      } else {\n        const localMax = d3.max(simpleBarData.value, d => d.value);\n        yDomainMaxValue = localMax > 0 ? localMax : 1;\n      }\n      if (yDomainMaxValue === 0) yDomainMaxValue = 1; // Ensure y-axis is not [0,0]\n\n      const y = d3.scaleLinear().domain([0, yDomainMaxValue]).range([height - margin.bottom, margin.top]);\n      const maxBarWidth = 50;\n      const minSpacing = 8;\n      const barData = simpleBarData.value;\n      const barCount = barData.length;\n      const availableWidthForBars = width - margin.left - margin.right - (barCount > 1 ? minSpacing * (barCount - 1) : 0);\n      let barWidth = Math.min(maxBarWidth, availableWidthForBars / barCount);\n      barWidth = Math.max(15, barWidth); // Minimum bar width\n\n      const totalBarsWidth = barWidth * barCount + (barCount > 1 ? minSpacing * (barCount - 1) : 0);\n      const startX = margin.left + (width - margin.left - margin.right - totalBarsWidth) / 2;\n      svg.selectAll(\".bar\").data(barData).enter().append(\"rect\").attr(\"class\", \"bar\").attr(\"x\", (d, i) => startX + i * (barWidth + (barCount > 1 ? minSpacing : 0))).attr(\"y\", d => d.value >= 0 ? y(d.value) : y(0)).attr(\"width\", barWidth).attr(\"height\", d => Math.max(0, d.value >= 0 ? height - margin.bottom - y(d.value) : y(d.value) - y(0))).attr(\"fill\", (d, i) => colors[i % colors.length]).style(\"opacity\", 0.85).attr(\"rx\", 2) // Rounded corners for bars\n      .attr(\"ry\", 2);\n      svg.selectAll(\".bar-label\").data(barData).enter().append(\"text\").attr(\"class\", \"bar-label\").attr(\"x\", (d, i) => startX + i * (barWidth + (barCount > 1 ? minSpacing : 0)) + barWidth / 2).attr(\"y\", height - margin.bottom + 15) // Position below the bar\n      .attr(\"text-anchor\", \"middle\").attr(\"font-size\", \"10px\").attr(\"fill\", \"#555\").text(d => formatNumber(d.value, props.fieldKey));\n    };\n    const renderLineChart = () => {\n      if (!lineContainer.value || !lineData.value.length) return;\n      d3.select(lineContainer.value).selectAll(\"*\").remove();\n      const container = d3.select(lineContainer.value);\n      const width = lineContainer.value.clientWidth;\n      const height = lineContainer.value.clientHeight;\n      const margin = {\n        top: 10,\n        right: 10,\n        bottom: 25,\n        left: 10\n      }; // Adjusted for labels\n\n      const svg = container.append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", \"100%\").attr(\"viewBox\", `0 0 ${width} ${height}`);\n      const currentLineData = lineData.value;\n      const x = d3.scaleLinear().domain([0, Math.max(0, currentLineData.length - 1)]) // Handle empty or single point data\n      .range([margin.left + 5, width - margin.right - 5]); // Add padding for points\n\n      const yMin = d3.min(currentLineData, d => d.y);\n      const yMax = d3.max(currentLineData, d => d.y);\n      const yPadding = (yMax - yMin) * 0.1 || 0.1; // Add padding, ensure not 0\n\n      const y = d3.scaleLinear().domain([yMin - yPadding, yMax + yPadding]).range([height - margin.bottom, margin.top]);\n      const line = d3.line().x((d, i) => x(i)).y(d => y(d.y)).curve(d3.curveMonotoneX); // Smoother line\n\n      if (currentLineData.length > 0) {\n        svg.append(\"path\").datum(currentLineData).attr(\"fill\", \"none\").attr(\"stroke\", colors[0]).attr(\"stroke-width\", 2).attr(\"d\", line);\n        svg.selectAll(\".dot\").data(currentLineData).enter().append(\"circle\").attr(\"class\", \"dot\").attr(\"cx\", (d, i) => x(i)).attr(\"cy\", d => y(d.y)).attr(\"r\", 3.5) // Slightly larger dots\n        .attr(\"fill\", colors[0]).style(\"stroke\", \"#fff\").style(\"stroke-width\", 1);\n        svg.selectAll(\".line-label\").data(currentLineData).enter().append(\"text\").attr(\"class\", \"line-label\").attr(\"x\", (d, i) => x(i)).attr(\"y\", height - margin.bottom + 15) // Position below the line/points\n        .attr(\"text-anchor\", \"middle\").attr(\"font-size\", \"10px\").attr(\"fill\", \"#555\").text(d => formatNumber(d.y, props.fieldKey));\n      }\n    };\n\n    // 交互处理函数\n    const handleTextHover = () => {\n      isTextHovered.value = true;\n    };\n    const resetHover = () => {\n      hoveredIndex.value = null;\n      isTextHovered.value = false;\n    };\n    const handleTextClick = () => {\n      emit(\"chartClick\", {\n        type: \"text\",\n        data: processedField.value,\n        value: processedField.value?.value\n      });\n    };\n    const formatNumber = (value, fieldKey) => {\n      const num = Number(value);\n      if (isNaN(num)) return value?.toString() || \"0\"; // Return original string if not a number\n\n      if (props.type === \"percentage\") {\n        return num.toFixed(1) + \"%\";\n      }\n      if (num >= 100000000) return (num / 100000000).toFixed(2) + \"亿\";\n      if (num >= 10000) return (num / 10000).toFixed(1) + \"万\";\n      // if (num >= 1000) return (num / 1000).toFixed(1) + \"千\"; //千 usually not needed for small charts\n      return num.toLocaleString(undefined, {\n        maximumFractionDigits: 1\n      }); // Use locale string for better formatting\n    };\n\n    // 数据处理函数 & computed properties\n    const isYearEntry = value => {\n      if (typeof value !== \"string\") return false;\n      const trimmedValue = value.trim();\n      return /^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) || /^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) || /^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) || /^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue);\n    };\n    const safeToNumber = function (value) {\n      let fieldKeyForContext = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : props.fieldKey;\n      if (value === null || value === undefined) return 0; // Default to 0 for null/undefined\n      if (typeof value === \"number\") return value;\n      if (typeof value === \"string\") {\n        const sVal = value.trim();\n        const yiMatch = sVal.match(/(-?[\\d.]+)\\s*亿/);\n        if (yiMatch) return parseFloat(yiMatch[1]) * 100000000;\n        const wanMatch = sVal.match(/(-?[\\d.]+)\\s*万/);\n        if (wanMatch) return parseFloat(wanMatch[1]) * 10000;\n        const qianMatch = sVal.match(/(-?[\\d.]+)\\s*千/);\n        if (qianMatch) return parseFloat(qianMatch[1]) * 1000;\n\n        // More robust percentage check, allowing space\n        const percentMatch = sVal.match(/(-?\\d+\\.?\\d*)\\s*%/);\n        if (percentMatch) return parseFloat(percentMatch[1]);\n\n        // Clean common currency symbols and other non-numeric chars for general numbers\n        const num = parseFloat(sVal.replace(/[^\\d.-]/g, \"\"));\n        return isNaN(num) ? 0 : num; // Default to 0 if parsing fails\n      }\n\n      // If it's an object, try to get 'value' or 'raw'\n      if (typeof value === \"object\" && value !== null) {\n        return safeToNumber(value.value ?? value.raw, fieldKeyForContext);\n      }\n      return 0; // Default for unhandled types\n    };\n    const isValidPieData = computed(() => {\n      if (!pieData.value.length) return false;\n      return pieData.value.every(item => !isYearEntry(item.name) && !isYearEntry(item.value?.toString()));\n    });\n    const pieData = computed(() => {\n      if (!processedField.value) return [];\n      const processItemForPie = (item, index) => {\n        let rawValueForPie = item?.raw ?? item?.value ?? item;\n        if (isYearEntry(rawValueForPie?.toString())) return null;\n        const valueNum = safeToNumber(rawValueForPie);\n        if (valueNum === null || valueNum < 0) return null; // Pie charts usually don't handle negative\n\n        let name = \"项目\";\n        if (typeof item === \"object\" && item !== null) {\n          const rawText = item.raw?.toString() || item.value?.toString() || JSON.stringify(item);\n          name = rawText.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\n        } else if (typeof item === \"string\") {\n          name = item.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\n        }\n        if (isYearEntry(name)) return null;\n        return {\n          value: Math.min(100, valueNum),\n          name: name || `项 ${index + 1}`,\n          index\n        };\n      };\n      if (Array.isArray(processedField.value)) {\n        return processedField.value.map(processItemForPie).filter(item => item !== null && item.value > 0); // Ensure positive value for pie slices\n      }\n      const result = processItemForPie(processedField.value, 0);\n      return result && result.value > 0 ? [result] : [];\n    });\n    const formatSimpleText = fieldValue => {\n      if (!fieldValue) return \"-\";\n      const formatSingleItem = item => {\n        if (typeof item === \"object\" && item !== null) {\n          let text = item.raw?.toString() ?? item.value?.toString() ?? \"-\";\n          // if (item.unit) text += ` ${item.unit}`; // Units might make it too long for simple text\n          // if (item.year) text += ` (${item.year})`;\n          return text;\n        }\n        return item?.toString() ?? \"-\";\n      };\n      if (Array.isArray(fieldValue)) {\n        const items = fieldValue.map(formatSingleItem);\n        const joined = items.join(\"; \");\n        return joined.length > 40 ? joined.substring(0, 37) + \"...\" : joined;\n      }\n      const text = formatSingleItem(fieldValue);\n      return text.length > 50 ? text.substring(0, 47) + \"...\" : text;\n    };\n    const simpleBarData = computed(() => {\n      if (!processedField.value) return [];\n      let values = [];\n      const processItemForBar = item => {\n        const val = item?.value ?? item?.raw;\n        if (val === undefined || val === null || isYearEntry(val?.toString())) return null;\n        return safeToNumber(val);\n      };\n      if (Array.isArray(processedField.value)) {\n        values = processedField.value.map(processItemForBar).filter(v => v !== null);\n      } else {\n        const singleVal = processItemForBar(processedField.value);\n        if (singleVal !== null) values = [singleVal];\n      }\n      if (values.length === 0) return [];\n      return values.map((v, index) => ({\n        value: v,\n        index\n      }));\n    });\n    const lineData = computed(() => {\n      if (!processedField.value) return [];\n      let itemsToProcess = [];\n      if (Array.isArray(processedField.value)) {\n        itemsToProcess = processedField.value;\n      } else if (processedField.value !== null) {\n        itemsToProcess = [processedField.value];\n      }\n      return itemsToProcess.map((item, index) => {\n        const rawVal = item?.raw ?? item?.value;\n        if (rawVal === undefined || rawVal === null || isYearEntry(rawVal?.toString())) return null;\n        const valueNum = safeToNumber(rawVal);\n        if (valueNum === null) return null;\n        return {\n          x: index,\n          y: valueNum,\n          raw: rawVal,\n          index\n        };\n      }).filter(item => item !== null);\n    });\n    const hasData = computed(() => {\n      if (!processedField.value) return false;\n      if (props.visualization === \"bar-chart\") return simpleBarData.value.length > 0;\n      if (props.visualization === \"line-chart\") return lineData.value.length > 0;\n      if (props.visualization === \"pie-chart\") return pieData.value.length > 0 && isValidPieData.value;\n\n      // For text or default\n      if (Array.isArray(processedField.value)) return processedField.value.length > 0;\n      if (typeof processedField.value === \"object\") return Object.keys(processedField.value).length > 0 && processedField.value.value !== undefined;\n      return String(processedField.value?.value ?? processedField.value?.raw ?? processedField.value).trim().length > 0;\n    });\n    return {\n      hoveredIndex,\n      activeIndex,\n      isTextHovered,\n      pieContainer,\n      barContainer,\n      lineContainer,\n      handleTextHover,\n      resetHover,\n      handleTextClick,\n      formatSimpleText,\n      hasData,\n      isValidPieData,\n      pieData,\n      simpleBarData,\n      lineData,\n      // Expose for direct use in render functions\n      formatNumber,\n      processedField\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","onMounted","watch","nextTick","d3","props","field","type","Object","Array","String","Number","default","visualization","fieldKey","yAxisMax","emits","setup","_ref","emit","hoveredIndex","activeIndex","isTextHovered","pieContainer","barContainer","lineContainer","colors","remainderColor","processedField","processItem","item","value","raw","unit","currency","year","isArray","map","hasData","isValidPieData","renderPieChart","renderBarChart","renderLineChart","immediate","deep","select","selectAll","remove","container","containerWidth","clientWidth","containerHeight","clientHeight","size","Math","min","radius","svg","append","attr","currentPieData","pieData","processedPieChartData","length","color","isMainValue","max","name","isRemainder","index","d","i","pie","sort","arc","innerRadius","outerRadius","cornerRadius","arcs","data","enter","style","on","event","transition","duration","tooltip","html","toFixed","text","simpleBarData","width","height","margin","top","right","bottom","left","yDomainMaxValue","undefined","localMax","y","scaleLinear","domain","range","maxBarWidth","minSpacing","barData","barCount","availableWidthForBars","barWidth","totalBarsWidth","startX","formatNumber","lineData","currentLineData","x","yMin","yMax","yPadding","line","curve","curveMonotoneX","datum","handleTextHover","resetHover","handleTextClick","num","isNaN","toString","toLocaleString","maximumFractionDigits","isYearEntry","trimmedValue","trim","test","safeToNumber","fieldKeyForContext","arguments","sVal","yiMatch","match","parseFloat","wanMatch","qianMatch","percentMatch","replace","every","processItemForPie","rawValueForPie","valueNum","rawText","JSON","stringify","filter","result","formatSimpleText","fieldValue","formatSingleItem","items","joined","join","substring","values","processItemForBar","val","v","singleVal","itemsToProcess","rawVal","keys"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\SimpleChart.vue"],"sourcesContent":["<template>\r\n\t<div class=\"simple-chart\">\r\n\t\t<!-- 文本显示 -->\r\n\t\t<template v-if=\"visualization === 'text-only'\">\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(processedField) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 饼图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'pie-chart'\">\r\n\t\t\t<div\r\n\t\t\t\tv-if=\"hasData && isValidPieData\"\r\n\t\t\t\tclass=\"d3-chart-container\"\r\n\t\t\t\tref=\"pieContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 柱状图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'bar-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"barContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 折线图 (D3实现) -->\r\n\t\t<template v-else-if=\"visualization === 'line-chart'\">\r\n\t\t\t<div v-if=\"hasData\" class=\"d3-chart-container\" ref=\"lineContainer\"></div>\r\n\t\t\t<div v-else class=\"no-data\">-</div>\r\n\t\t</template>\r\n\r\n\t\t<!-- 默认显示 -->\r\n\t\t<template v-else>\r\n\t\t\t<div\r\n\t\t\t\tclass=\"simple-text\"\r\n\t\t\t\t@click=\"handleTextClick\"\r\n\t\t\t\t@mouseenter=\"handleTextHover\"\r\n\t\t\t\t@mouseleave=\"resetHover\">\r\n\t\t\t\t{{ formatSimpleText(processedField) }}\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"isTextHovered\" class=\"text-tooltip\">点击查看详情</div>\r\n\t\t</template>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport { computed, ref, onMounted, watch, nextTick } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tfield: {\r\n\t\t\t\ttype: [Object, Array, String, Number],\r\n\t\t\t\tdefault: null\r\n\t\t\t},\r\n\t\t\ttype: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tvisualization: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tfieldKey: {\r\n\t\t\t\t// Added for context in formatting/parsing if needed\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tyAxisMax: {\r\n\t\t\t\t// For unified Y-axis in bar charts\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: null\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\temits: [\"chartClick\"],\r\n\r\n\t\tsetup(props, { emit }) {\r\n\t\t\tconst hoveredIndex = ref(null);\r\n\t\t\tconst activeIndex = ref(null);\r\n\t\t\tconst isTextHovered = ref(false);\r\n\r\n\t\t\t// 容器引用\r\n\t\t\tconst pieContainer = ref(null);\r\n\t\t\tconst barContainer = ref(null);\r\n\t\t\tconst lineContainer = ref(null);\r\n\r\n\t\t\t// 颜色定义\r\n\t\t\tconst colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\r\n\t\t\tconst remainderColor = \"#f0f0f0\"; // Color for the \"remainder\" part of a single-value pie chart\r\n\r\n\t\t\t// 处理后的字段数据\r\n\t\t\tconst processedField = computed(() => {\r\n\t\t\t\tif (!props.field) return null;\r\n\r\n\t\t\t\tconst processItem = item => {\r\n\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tvalue: item.value ?? item.raw,\r\n\t\t\t\t\t\t\traw: item.raw,\r\n\t\t\t\t\t\t\t...(item.unit && { unit: item.unit }),\r\n\t\t\t\t\t\t\t...(item.currency && { currency: item.currency }),\r\n\t\t\t\t\t\t\t...(item.year && { year: item.year }),\r\n\t\t\t\t\t\t\t...item // spread other properties\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn { value: item, raw: item }; // Wrap primitive for consistency\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (Array.isArray(props.field)) {\r\n\t\t\t\t\treturn props.field.map(processItem);\r\n\t\t\t\t}\r\n\t\t\t\treturn processItem(props.field);\r\n\t\t\t});\r\n\r\n\t\t\t// 初始化图表\r\n\t\t\tonMounted(() => {\r\n\t\t\t\twatch(\r\n\t\t\t\t\t() => [processedField.value, props.visualization, props.yAxisMax], // Watch yAxisMax for bar charts\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"pie-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value &&\r\n\t\t\t\t\t\t\t\tisValidPieData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderPieChart();\r\n\t\t\t\t\t\t\t} else if (props.visualization === \"bar-chart\" && hasData.value) {\r\n\t\t\t\t\t\t\t\trenderBarChart();\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tprops.visualization === \"line-chart\" &&\r\n\t\t\t\t\t\t\t\thasData.value\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\trenderLineChart();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ immediate: true, deep: true }\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\t// 渲染饼图（添加剩余比例）\r\n\t\t\tconst renderPieChart = () => {\r\n\t\t\t\tif (!pieContainer.value) return;\r\n\t\t\t\td3.select(pieContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(pieContainer.value);\r\n\t\t\t\tconst containerWidth = pieContainer.value.clientWidth;\r\n\t\t\t\tconst containerHeight = pieContainer.value.clientHeight;\r\n\t\t\t\tconst size = Math.min(containerWidth, containerHeight) * 0.9; // Slightly smaller for padding\r\n\t\t\t\tconst radius = size / 2;\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${size} ${size}`)\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(${radius},${radius})`);\r\n\r\n\t\t\t\tconst currentPieData = pieData.value; // Use the computed pieData\r\n\r\n\t\t\t\t// Process data for pie chart (single value vs multiple)\r\n\t\t\t\tconst processedPieChartData =\r\n\t\t\t\t\tcurrentPieData.length === 1 && currentPieData[0].value < 100 // Only add remainder if not 100%\r\n\t\t\t\t\t\t? [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t...currentPieData[0],\r\n\t\t\t\t\t\t\t\t\tcolor: colors[0],\r\n\t\t\t\t\t\t\t\t\tisMainValue: true\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tvalue: Math.max(0, 100 - currentPieData[0].value),\r\n\t\t\t\t\t\t\t\t\tname: \"剩余\",\r\n\t\t\t\t\t\t\t\t\tcolor: remainderColor,\r\n\t\t\t\t\t\t\t\t\tisRemainder: true,\r\n\t\t\t\t\t\t\t\t\tindex: 1 // Different index for the remainder\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t  ]\r\n\t\t\t\t\t\t: currentPieData.map((d, i) => ({\r\n\t\t\t\t\t\t\t\t...d,\r\n\t\t\t\t\t\t\t\tcolor: colors[i % colors.length],\r\n\t\t\t\t\t\t\t\tisMainValue: true\r\n\t\t\t\t\t\t  }));\r\n\r\n\t\t\t\tconst pie = d3\r\n\t\t\t\t\t.pie()\r\n\t\t\t\t\t.value(d => d.value)\r\n\t\t\t\t\t.sort(null);\r\n\r\n\t\t\t\tconst arc = d3\r\n\t\t\t\t\t.arc()\r\n\t\t\t\t\t.innerRadius(0) // For a pie chart, not a donut\r\n\t\t\t\t\t.outerRadius(radius * 0.95) // Slightly smaller than radius\r\n\t\t\t\t\t.cornerRadius(2);\r\n\r\n\t\t\t\tconst arcs = svg\r\n\t\t\t\t\t.selectAll(\".arc\")\r\n\t\t\t\t\t.data(pie(processedPieChartData))\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"class\", \"arc\");\r\n\r\n\t\t\t\tarcs\r\n\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t.attr(\"d\", arc)\r\n\t\t\t\t\t.attr(\"fill\", d => d.data.color)\r\n\t\t\t\t\t.style(\"opacity\", d => (d.data.isRemainder ? 0.5 : 0.9))\r\n\t\t\t\t\t.style(\"stroke\", \"#fff\")\r\n\t\t\t\t\t.style(\"stroke-width\", 1)\r\n\t\t\t\t\t.on(\"mouseover\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\t\t\thoveredIndex.value = d.data.index;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(150)\r\n\t\t\t\t\t\t\t.style(\"opacity\", 1)\r\n\t\t\t\t\t\t\t.attr(\"transform\", \"scale(1.03)\");\r\n\t\t\t\t\t\ttooltip\r\n\t\t\t\t\t\t\t.style(\"visibility\", \"visible\")\r\n\t\t\t\t\t\t\t.html(\r\n\t\t\t\t\t\t\t\t`${d.data.name}: ${d.data.value.toFixed(1)}${\r\n\t\t\t\t\t\t\t\t\tprops.type === \"percentage\" ? \"%\" : \"\"\r\n\t\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"mouseout\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t\t.duration(150)\r\n\t\t\t\t\t\t\t.style(\"opacity\", d.data.isRemainder ? 0.5 : 0.9)\r\n\t\t\t\t\t\t\t.attr(\"transform\", \"scale(1)\");\r\n\t\t\t\t\t\ttooltip.style(\"visibility\", \"hidden\");\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on(\"click\", function (event, d) {\r\n\t\t\t\t\t\tif (d.data.isRemainder) return;\r\n\t\t\t\t\t\tactiveIndex.value = d.data.index;\r\n\t\t\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\t\t\tindex: d.data.index,\r\n\t\t\t\t\t\t\tdata: d.data,\r\n\t\t\t\t\t\t\tvalue: d.data.value\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tif (currentPieData.length === 1) {\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"dy\", \".3em\")\r\n\t\t\t\t\t\t.text(\r\n\t\t\t\t\t\t\t`${currentPieData[0].value.toFixed(1)}${\r\n\t\t\t\t\t\t\t\tprops.type === \"percentage\" ? \"%\" : \"\"\r\n\t\t\t\t\t\t\t}`\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.style(\"font-size\", `${Math.max(10, radius / 4)}px`) // Responsive font size\r\n\t\t\t\t\t\t.style(\"fill\", \"#333\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst tooltip = container\r\n\t\t\t\t\t.append(\"div\")\r\n\t\t\t\t\t.attr(\"class\", \"d3-tooltip\")\r\n\t\t\t\t\t.style(\"position\", \"absolute\")\r\n\t\t\t\t\t.style(\"visibility\", \"hidden\")\r\n\t\t\t\t\t.style(\"background\", \"rgba(0,0,0,0.75)\")\r\n\t\t\t\t\t.style(\"color\", \"white\")\r\n\t\t\t\t\t.style(\"padding\", \"5px 10px\")\r\n\t\t\t\t\t.style(\"border-radius\", \"4px\")\r\n\t\t\t\t\t.style(\"font-size\", \"12px\");\r\n\t\t\t};\r\n\r\n\t\t\tconst renderBarChart = () => {\r\n\t\t\t\tif (!barContainer.value || !simpleBarData.value.length) return;\r\n\r\n\t\t\t\td3.select(barContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(barContainer.value);\r\n\t\t\t\tconst width = barContainer.value.clientWidth;\r\n\t\t\t\tconst height = barContainer.value.clientHeight;\r\n\t\t\t\tconst margin = { top: 10, right: 5, bottom: 25, left: 5 }; // Adjusted margins for labels\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`);\r\n\r\n\t\t\t\tlet yDomainMaxValue;\r\n\t\t\t\tif (\r\n\t\t\t\t\tprops.yAxisMax !== null &&\r\n\t\t\t\t\tprops.yAxisMax !== undefined &&\r\n\t\t\t\t\tprops.yAxisMax >= 0\r\n\t\t\t\t) {\r\n\t\t\t\t\tyDomainMaxValue = props.yAxisMax;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst localMax = d3.max(simpleBarData.value, d => d.value);\r\n\t\t\t\t\tyDomainMaxValue = localMax > 0 ? localMax : 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (yDomainMaxValue === 0) yDomainMaxValue = 1; // Ensure y-axis is not [0,0]\r\n\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([0, yDomainMaxValue])\r\n\t\t\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t\t\tconst maxBarWidth = 50;\r\n\t\t\t\tconst minSpacing = 8;\r\n\t\t\t\tconst barData = simpleBarData.value;\r\n\t\t\t\tconst barCount = barData.length;\r\n\r\n\t\t\t\tconst availableWidthForBars =\r\n\t\t\t\t\twidth -\r\n\t\t\t\t\tmargin.left -\r\n\t\t\t\t\tmargin.right -\r\n\t\t\t\t\t(barCount > 1 ? minSpacing * (barCount - 1) : 0);\r\n\t\t\t\tlet barWidth = Math.min(maxBarWidth, availableWidthForBars / barCount);\r\n\t\t\t\tbarWidth = Math.max(15, barWidth); // Minimum bar width\r\n\r\n\t\t\t\tconst totalBarsWidth =\r\n\t\t\t\t\tbarWidth * barCount +\r\n\t\t\t\t\t(barCount > 1 ? minSpacing * (barCount - 1) : 0);\r\n\t\t\t\tconst startX =\r\n\t\t\t\t\tmargin.left +\r\n\t\t\t\t\t(width - margin.left - margin.right - totalBarsWidth) / 2;\r\n\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".bar\")\r\n\t\t\t\t\t.data(barData)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", \"bar\")\r\n\t\t\t\t\t.attr(\r\n\t\t\t\t\t\t\"x\",\r\n\t\t\t\t\t\t(d, i) => startX + i * (barWidth + (barCount > 1 ? minSpacing : 0))\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.attr(\"y\", d => (d.value >= 0 ? y(d.value) : y(0)))\r\n\t\t\t\t\t.attr(\"width\", barWidth)\r\n\t\t\t\t\t.attr(\"height\", d =>\r\n\t\t\t\t\t\tMath.max(\r\n\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\td.value >= 0\r\n\t\t\t\t\t\t\t\t? height - margin.bottom - y(d.value)\r\n\t\t\t\t\t\t\t\t: y(d.value) - y(0)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => colors[i % colors.length])\r\n\t\t\t\t\t.style(\"opacity\", 0.85)\r\n\t\t\t\t\t.attr(\"rx\", 2) // Rounded corners for bars\r\n\t\t\t\t\t.attr(\"ry\", 2);\r\n\r\n\t\t\t\tsvg\r\n\t\t\t\t\t.selectAll(\".bar-label\")\r\n\t\t\t\t\t.data(barData)\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t.attr(\"class\", \"bar-label\")\r\n\t\t\t\t\t.attr(\r\n\t\t\t\t\t\t\"x\",\r\n\t\t\t\t\t\t(d, i) =>\r\n\t\t\t\t\t\t\tstartX +\r\n\t\t\t\t\t\t\ti * (barWidth + (barCount > 1 ? minSpacing : 0)) +\r\n\t\t\t\t\t\t\tbarWidth / 2\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.attr(\"y\", height - margin.bottom + 15) // Position below the bar\r\n\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t.attr(\"font-size\", \"10px\")\r\n\t\t\t\t\t.attr(\"fill\", \"#555\")\r\n\t\t\t\t\t.text(d => formatNumber(d.value, props.fieldKey));\r\n\t\t\t};\r\n\r\n\t\t\tconst renderLineChart = () => {\r\n\t\t\t\tif (!lineContainer.value || !lineData.value.length) return;\r\n\r\n\t\t\t\td3.select(lineContainer.value).selectAll(\"*\").remove();\r\n\r\n\t\t\t\tconst container = d3.select(lineContainer.value);\r\n\t\t\t\tconst width = lineContainer.value.clientWidth;\r\n\t\t\t\tconst height = lineContainer.value.clientHeight;\r\n\t\t\t\tconst margin = { top: 10, right: 10, bottom: 25, left: 10 }; // Adjusted for labels\r\n\r\n\t\t\t\tconst svg = container\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", \"100%\")\r\n\t\t\t\t\t.attr(\"height\", \"100%\")\r\n\t\t\t\t\t.attr(\"viewBox\", `0 0 ${width} ${height}`);\r\n\r\n\t\t\t\tconst currentLineData = lineData.value;\r\n\r\n\t\t\t\tconst x = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([0, Math.max(0, currentLineData.length - 1)]) // Handle empty or single point data\r\n\t\t\t\t\t.range([margin.left + 5, width - margin.right - 5]); // Add padding for points\r\n\r\n\t\t\t\tconst yMin = d3.min(currentLineData, d => d.y);\r\n\t\t\t\tconst yMax = d3.max(currentLineData, d => d.y);\r\n\t\t\t\tconst yPadding = (yMax - yMin) * 0.1 || 0.1; // Add padding, ensure not 0\r\n\r\n\t\t\t\tconst y = d3\r\n\t\t\t\t\t.scaleLinear()\r\n\t\t\t\t\t.domain([yMin - yPadding, yMax + yPadding])\r\n\t\t\t\t\t.range([height - margin.bottom, margin.top]);\r\n\r\n\t\t\t\tconst line = d3\r\n\t\t\t\t\t.line()\r\n\t\t\t\t\t.x((d, i) => x(i))\r\n\t\t\t\t\t.y(d => y(d.y))\r\n\t\t\t\t\t.curve(d3.curveMonotoneX); // Smoother line\r\n\r\n\t\t\t\tif (currentLineData.length > 0) {\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t\t.datum(currentLineData)\r\n\t\t\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t\t\t.attr(\"stroke\", colors[0])\r\n\t\t\t\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t\t\t\t.attr(\"d\", line);\r\n\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.selectAll(\".dot\")\r\n\t\t\t\t\t\t.data(currentLineData)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"circle\")\r\n\t\t\t\t\t\t.attr(\"class\", \"dot\")\r\n\t\t\t\t\t\t.attr(\"cx\", (d, i) => x(i))\r\n\t\t\t\t\t\t.attr(\"cy\", d => y(d.y))\r\n\t\t\t\t\t\t.attr(\"r\", 3.5) // Slightly larger dots\r\n\t\t\t\t\t\t.attr(\"fill\", colors[0])\r\n\t\t\t\t\t\t.style(\"stroke\", \"#fff\")\r\n\t\t\t\t\t\t.style(\"stroke-width\", 1);\r\n\r\n\t\t\t\t\tsvg\r\n\t\t\t\t\t\t.selectAll(\".line-label\")\r\n\t\t\t\t\t\t.data(currentLineData)\r\n\t\t\t\t\t\t.enter()\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"class\", \"line-label\")\r\n\t\t\t\t\t\t.attr(\"x\", (d, i) => x(i))\r\n\t\t\t\t\t\t.attr(\"y\", height - margin.bottom + 15) // Position below the line/points\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"font-size\", \"10px\")\r\n\t\t\t\t\t\t.attr(\"fill\", \"#555\")\r\n\t\t\t\t\t\t.text(d => formatNumber(d.y, props.fieldKey));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 交互处理函数\r\n\t\t\tconst handleTextHover = () => {\r\n\t\t\t\tisTextHovered.value = true;\r\n\t\t\t};\r\n\t\t\tconst resetHover = () => {\r\n\t\t\t\thoveredIndex.value = null;\r\n\t\t\t\tisTextHovered.value = false;\r\n\t\t\t};\r\n\t\t\tconst handleTextClick = () => {\r\n\t\t\t\temit(\"chartClick\", {\r\n\t\t\t\t\ttype: \"text\",\r\n\t\t\t\t\tdata: processedField.value,\r\n\t\t\t\t\tvalue: processedField.value?.value\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tconst formatNumber = (value, fieldKey) => {\r\n\t\t\t\tconst num = Number(value);\r\n\t\t\t\tif (isNaN(num)) return value?.toString() || \"0\"; // Return original string if not a number\r\n\r\n\t\t\t\tif (props.type === \"percentage\") {\r\n\t\t\t\t\treturn num.toFixed(1) + \"%\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (num >= 100000000) return (num / 100000000).toFixed(2) + \"亿\";\r\n\t\t\t\tif (num >= 10000) return (num / 10000).toFixed(1) + \"万\";\r\n\t\t\t\t// if (num >= 1000) return (num / 1000).toFixed(1) + \"千\"; //千 usually not needed for small charts\r\n\t\t\t\treturn num.toLocaleString(undefined, { maximumFractionDigits: 1 }); // Use locale string for better formatting\r\n\t\t\t};\r\n\r\n\t\t\t// 数据处理函数 & computed properties\r\n\t\t\tconst isYearEntry = value => {\r\n\t\t\t\tif (typeof value !== \"string\") return false;\r\n\t\t\t\tconst trimmedValue = value.trim();\r\n\t\t\t\treturn (\r\n\t\t\t\t\t/^(\\()?\\d{4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^\\(?FY\\s*\\d{4}\\)?\\s*:?/i.test(trimmedValue) ||\r\n\t\t\t\t\t/^(\\()?\\d{4}\\s*[-–]\\s*\\d{2,4}(\\))?\\s*:?/.test(trimmedValue) ||\r\n\t\t\t\t\t/^(Year|Yr|Annual)\\s*\\d{4}/i.test(trimmedValue)\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\tconst safeToNumber = (value, fieldKeyForContext = props.fieldKey) => {\r\n\t\t\t\tif (value === null || value === undefined) return 0; // Default to 0 for null/undefined\r\n\t\t\t\tif (typeof value === \"number\") return value;\r\n\r\n\t\t\t\tif (typeof value === \"string\") {\r\n\t\t\t\t\tconst sVal = value.trim();\r\n\t\t\t\t\tconst yiMatch = sVal.match(/(-?[\\d.]+)\\s*亿/);\r\n\t\t\t\t\tif (yiMatch) return parseFloat(yiMatch[1]) * 100000000;\r\n\r\n\t\t\t\t\tconst wanMatch = sVal.match(/(-?[\\d.]+)\\s*万/);\r\n\t\t\t\t\tif (wanMatch) return parseFloat(wanMatch[1]) * 10000;\r\n\r\n\t\t\t\t\tconst qianMatch = sVal.match(/(-?[\\d.]+)\\s*千/);\r\n\t\t\t\t\tif (qianMatch) return parseFloat(qianMatch[1]) * 1000;\r\n\r\n\t\t\t\t\t// More robust percentage check, allowing space\r\n\t\t\t\t\tconst percentMatch = sVal.match(/(-?\\d+\\.?\\d*)\\s*%/);\r\n\t\t\t\t\tif (percentMatch) return parseFloat(percentMatch[1]);\r\n\r\n\t\t\t\t\t// Clean common currency symbols and other non-numeric chars for general numbers\r\n\t\t\t\t\tconst num = parseFloat(sVal.replace(/[^\\d.-]/g, \"\"));\r\n\t\t\t\t\treturn isNaN(num) ? 0 : num; // Default to 0 if parsing fails\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If it's an object, try to get 'value' or 'raw'\r\n\t\t\t\tif (typeof value === \"object\" && value !== null) {\r\n\t\t\t\t\treturn safeToNumber(value.value ?? value.raw, fieldKeyForContext);\r\n\t\t\t\t}\r\n\t\t\t\treturn 0; // Default for unhandled types\r\n\t\t\t};\r\n\r\n\t\t\tconst isValidPieData = computed(() => {\r\n\t\t\t\tif (!pieData.value.length) return false;\r\n\t\t\t\treturn pieData.value.every(\r\n\t\t\t\t\titem =>\r\n\t\t\t\t\t\t!isYearEntry(item.name) && !isYearEntry(item.value?.toString())\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tconst pieData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\r\n\t\t\t\tconst processItemForPie = (item, index) => {\r\n\t\t\t\t\tlet rawValueForPie = item?.raw ?? item?.value ?? item;\r\n\t\t\t\t\tif (isYearEntry(rawValueForPie?.toString())) return null;\r\n\r\n\t\t\t\t\tconst valueNum = safeToNumber(rawValueForPie);\r\n\t\t\t\t\tif (valueNum === null || valueNum < 0) return null; // Pie charts usually don't handle negative\r\n\r\n\t\t\t\t\tlet name = \"项目\";\r\n\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\tconst rawText =\r\n\t\t\t\t\t\t\titem.raw?.toString() ||\r\n\t\t\t\t\t\t\titem.value?.toString() ||\r\n\t\t\t\t\t\t\tJSON.stringify(item);\r\n\t\t\t\t\t\tname = rawText.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\r\n\t\t\t\t\t} else if (typeof item === \"string\") {\r\n\t\t\t\t\t\tname = item.replace(/:\\s*\\d+\\.?\\d*%?/g, \"\").trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isYearEntry(name)) return null;\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: Math.min(100, valueNum),\r\n\t\t\t\t\t\tname: name || `项 ${index + 1}`,\r\n\t\t\t\t\t\tindex\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\treturn processedField.value\r\n\t\t\t\t\t\t.map(processItemForPie)\r\n\t\t\t\t\t\t.filter(item => item !== null && item.value > 0); // Ensure positive value for pie slices\r\n\t\t\t\t}\r\n\t\t\t\tconst result = processItemForPie(processedField.value, 0);\r\n\t\t\t\treturn result && result.value > 0 ? [result] : [];\r\n\t\t\t});\r\n\r\n\t\t\tconst formatSimpleText = fieldValue => {\r\n\t\t\t\tif (!fieldValue) return \"-\";\r\n\r\n\t\t\t\tconst formatSingleItem = item => {\r\n\t\t\t\t\tif (typeof item === \"object\" && item !== null) {\r\n\t\t\t\t\t\tlet text = item.raw?.toString() ?? item.value?.toString() ?? \"-\";\r\n\t\t\t\t\t\t// if (item.unit) text += ` ${item.unit}`; // Units might make it too long for simple text\r\n\t\t\t\t\t\t// if (item.year) text += ` (${item.year})`;\r\n\t\t\t\t\t\treturn text;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn item?.toString() ?? \"-\";\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (Array.isArray(fieldValue)) {\r\n\t\t\t\t\tconst items = fieldValue.map(formatSingleItem);\r\n\t\t\t\t\tconst joined = items.join(\"; \");\r\n\t\t\t\t\treturn joined.length > 40 ? joined.substring(0, 37) + \"...\" : joined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst text = formatSingleItem(fieldValue);\r\n\t\t\t\treturn text.length > 50 ? text.substring(0, 47) + \"...\" : text;\r\n\t\t\t};\r\n\r\n\t\t\tconst simpleBarData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\t\t\t\tlet values = [];\r\n\r\n\t\t\t\tconst processItemForBar = item => {\r\n\t\t\t\t\tconst val = item?.value ?? item?.raw;\r\n\t\t\t\t\tif (val === undefined || val === null || isYearEntry(val?.toString()))\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\treturn safeToNumber(val);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\tvalues = processedField.value\r\n\t\t\t\t\t\t.map(processItemForBar)\r\n\t\t\t\t\t\t.filter(v => v !== null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst singleVal = processItemForBar(processedField.value);\r\n\t\t\t\t\tif (singleVal !== null) values = [singleVal];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (values.length === 0) return [];\r\n\t\t\t\treturn values.map((v, index) => ({ value: v, index }));\r\n\t\t\t});\r\n\r\n\t\t\tconst lineData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return [];\r\n\t\t\t\tlet itemsToProcess = [];\r\n\r\n\t\t\t\tif (Array.isArray(processedField.value)) {\r\n\t\t\t\t\titemsToProcess = processedField.value;\r\n\t\t\t\t} else if (processedField.value !== null) {\r\n\t\t\t\t\titemsToProcess = [processedField.value];\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn itemsToProcess\r\n\t\t\t\t\t.map((item, index) => {\r\n\t\t\t\t\t\tconst rawVal = item?.raw ?? item?.value;\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\trawVal === undefined ||\r\n\t\t\t\t\t\t\trawVal === null ||\r\n\t\t\t\t\t\t\tisYearEntry(rawVal?.toString())\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\tconst valueNum = safeToNumber(rawVal);\r\n\t\t\t\t\t\tif (valueNum === null) return null;\r\n\t\t\t\t\t\treturn { x: index, y: valueNum, raw: rawVal, index };\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.filter(item => item !== null);\r\n\t\t\t});\r\n\r\n\t\t\tconst hasData = computed(() => {\r\n\t\t\t\tif (!processedField.value) return false;\r\n\t\t\t\tif (props.visualization === \"bar-chart\")\r\n\t\t\t\t\treturn simpleBarData.value.length > 0;\r\n\t\t\t\tif (props.visualization === \"line-chart\")\r\n\t\t\t\t\treturn lineData.value.length > 0;\r\n\t\t\t\tif (props.visualization === \"pie-chart\")\r\n\t\t\t\t\treturn pieData.value.length > 0 && isValidPieData.value;\r\n\r\n\t\t\t\t// For text or default\r\n\t\t\t\tif (Array.isArray(processedField.value))\r\n\t\t\t\t\treturn processedField.value.length > 0;\r\n\t\t\t\tif (typeof processedField.value === \"object\")\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\tObject.keys(processedField.value).length > 0 &&\r\n\t\t\t\t\t\tprocessedField.value.value !== undefined\r\n\t\t\t\t\t);\r\n\t\t\t\treturn (\r\n\t\t\t\t\tString(\r\n\t\t\t\t\t\tprocessedField.value?.value ??\r\n\t\t\t\t\t\t\tprocessedField.value?.raw ??\r\n\t\t\t\t\t\t\tprocessedField.value\r\n\t\t\t\t\t).trim().length > 0\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\thoveredIndex,\r\n\t\t\t\tactiveIndex,\r\n\t\t\t\tisTextHovered,\r\n\t\t\t\tpieContainer,\r\n\t\t\t\tbarContainer,\r\n\t\t\t\tlineContainer,\r\n\t\t\t\thandleTextHover,\r\n\t\t\t\tresetHover,\r\n\t\t\t\thandleTextClick,\r\n\t\t\t\tformatSimpleText,\r\n\t\t\t\thasData,\r\n\t\t\t\tisValidPieData,\r\n\t\t\t\tpieData,\r\n\t\t\t\tsimpleBarData,\r\n\t\t\t\tlineData, // Expose for direct use in render functions\r\n\t\t\t\tformatNumber,\r\n\t\t\t\tprocessedField\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.simple-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t\tfont-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto,\r\n\t\t\tHelvetica, Arial, sans-serif;\r\n\t\toverflow: hidden; /* Prevent tooltips from making scrollbars appear on the cell */\r\n\t}\r\n\r\n\t/* 文本样式 */\r\n\t.simple-text {\r\n\t\ttext-align: center;\r\n\t\tfont-size: 13px; /* Slightly smaller */\r\n\t\tword-break: break-word;\r\n\t\tpadding: 6px;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.2s ease;\r\n\t\tborder-radius: 4px;\r\n\t\tbackground-color: #f8f9fa;\r\n\t\tmax-width: 100%;\r\n\t\tcolor: #333;\r\n\t\tline-height: 1.4;\r\n\t}\r\n\r\n\t.simple-text:hover {\r\n\t\tbackground-color: #e9ecef;\r\n\t\ttransform: translateY(-1px);\r\n\t\tbox-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\r\n\t}\r\n\r\n\t.text-tooltip {\r\n\t\tposition: absolute;\r\n\t\tbottom: 105%; /* Position above the text */\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\tbackground-color: rgba(0, 0, 0, 0.75);\r\n\t\tcolor: white;\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-size: 11px;\r\n\t\tpointer-events: none;\r\n\t\twhite-space: nowrap;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t/* D3图表容器 */\r\n\t.d3-chart-container {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 70px; /* Ensure a minimum drawing area */\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t/* D3 tooltip样式 (defined inline in JS for dynamic positioning) */\r\n\t/* .d3-tooltip {} */\r\n\r\n\t/* 无数据样式 */\r\n\t.no-data {\r\n\t\tcolor: #aaa;\r\n\t\tfont-style: italic;\r\n\t\tpadding: 10px;\r\n\t\tfont-size: 13px;\r\n\t}\r\n\r\n\t/* Bar/Line labels - ensure they are not selectable */\r\n\t:deep(.bar-label),\r\n\t:deep(.line-label) {\r\n\t\tfont-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto,\r\n\t\t\tHelvetica, Arial, sans-serif;\r\n\t\tpointer-events: none;\r\n\t\tuser-select: none;\r\n\t}\r\n\r\n\t@media (max-width: 768px) {\r\n\t\t.simple-text {\r\n\t\t\tfont-size: 12px;\r\n\t\t}\r\n\t\t.d3-chart-container {\r\n\t\t\tmin-height: 60px;\r\n\t\t}\r\n\t\t:deep(.bar-label),\r\n\t\t:deep(.line-label) {\r\n\t\t\tfont-size: 9px;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}