{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\nimport bus from \"@/js/eventBus.js\";\nimport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\nimport * as echarts from \"echarts\";\n\n// 数据状态\n\nexport default {\n  __name: 'Div2',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const userQuestion = ref(\"\");\n    const chatHistory = ref([]);\n    const selectText2 = ref(\"\");\n    const selectText3 = ref(\"\");\n    const div1RawData = ref(null);\n    const div3RawData = ref(null);\n    const isLoading = ref(false);\n    const div1InfoboxData = ref(null);\n    const div3InfoboxData = ref(null);\n    const showSuggestedQuestion = ref(false);\n    const suggestedQuestion = ref(\"\");\n    const currentFieldKey = ref(\"\");\n    const leftData = ref(null);\n    const rightData = ref(null);\n\n    // 图表相关状态\n    const showCausalGraph = ref(false);\n    let causalChart = null;\n\n    // 定义需要保留的关键字段\n    const PRESERVED_FIELDS_BY_SECTION = {\n      Statistics: [\"Population\", \"GDP\", \"GDP rank\", \"GDP growth\", \"GDP per capita\", \"GDP per capita rank\", \"GDP by sector\", \"Inflation (CPI)\", \"Population below poverty line\", \"Gini coefficient\", \"Human Development Index\", \"Corruption Perceptions Index\", \"Labor force\", \"Labor force by occupation\", \"Unemployment\", \"Average gross salary\", \"Average net salary\", \"Main industries\"],\n      \"Public finances\": [\"Government debt\", \"Foreign reserves\", \"Budget balance\", \"Revenues\", \"Expenses\", \"Economic aid\", \"Credit rating\"]\n    };\n\n    // 方法定义\n    const loadChatHistory = () => {\n      const saved = localStorage.getItem(\"chatHistory\");\n      if (saved) {\n        try {\n          chatHistory.value = JSON.parse(saved);\n        } catch (e) {\n          console.error(\"加载聊天记录失败:\", e);\n        }\n      }\n    };\n    const saveChatHistory = () => {\n      localStorage.setItem(\"chatHistory\", JSON.stringify(chatHistory.value));\n    };\n    const scrollToBottom = () => {\n      nextTick(() => {\n        const container = document.querySelector(\".chat-history\");\n        if (container) {\n          container.scrollTop = container.scrollHeight;\n        }\n      });\n    };\n    const getLastAnalysis = () => {\n      const reversed = [...chatHistory.value].reverse();\n      const lastAssistantMsg = reversed.find(msg => msg.role === \"assistant\" && !msg.error);\n      return lastAssistantMsg ? lastAssistantMsg.content : \"\";\n    };\n    const handleDiv1Event = data => handleSelection(data, \"div1\");\n    const handleDiv3Event = data => handleSelection(data, \"div3\");\n    const handleSelection = (data, source) => {\n      const plainText = getPlainTextFromSelection(data.content);\n      if (source === \"div1\") {\n        selectText2.value = plainText;\n        div1RawData.value = data.content;\n      } else if (source === \"div3\") {\n        selectText3.value = plainText;\n        div3RawData.value = data.content;\n      }\n    };\n    const getPlainTextFromSelection = htmlContent => {\n      const container = document.createElement(\"div\");\n      container.innerHTML = htmlContent;\n      return container.innerText || container.textContent || \"\";\n    };\n    const formatAnalysisResult = function (text) {\n      let isGraph = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (isGraph) {\n        try {\n          const graphData = JSON.parse(text);\n          return {\n            role: \"assistant\",\n            content: generateGraphHTML(graphData),\n            graphData: graphData,\n            timestamp: new Date().toLocaleString()\n          };\n        } catch (e) {\n          return {\n            role: \"assistant\",\n            content: \"图形数据解析失败，显示原始分析结果\",\n            timestamp: new Date().toLocaleString(),\n            error: true\n          };\n        }\n      }\n      text = text.replace(/^# (.*$)/gm, \"<h1>$1</h1>\").replace(/^## (.*$)/gm, \"<h2>$1</h2>\").replace(/^### (.*$)/gm, \"<h3>$1</h3>\").replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\").replace(/\\*(.*?)\\*/g, \"<em>$1</em>\").replace(/`(.*?)`/g, \"<code>$1</code>\").replace(/!\\[(.*?)\\]\\((.*?)\\)/g, '<img alt=\"$1\" src=\"$2\">').replace(/\\[(.*?)\\]\\((.*?)\\)/g, '<a href=\"$2\">$1</a>').replace(/(?:^|\\n)\\d+\\.\\s+(.*)/g, \"<li>$1</li>\").replace(/(?:^|\\n)-\\s+(.*)/g, \"<li>$1</li>\").replace(/(?:^|\\n)\\>\\s+(.*)/g, \"<blockquote>$1</blockquote>\").replace(/(<li>.*<\\/li>)/gs, \"<ul>$1</ul>\").replace(/\\n\\n/g, \"<br><br>\").replace(/\\n/g, \"<br>\");\n      return `<div class=\"markdown-content\">${text}</div>`;\n    };\n    const generateGraphHTML = graphData => {\n      return `\n    <div class=\"graph-summary\">\n      <h4>已生成因果关系网络图</h4>\n      <p>包含 ${graphData.nodes.length} 个关键因素和 ${graphData.links.length} 条因果关系链</p>\n      <p>点击节点查看详细信息，拖动可调整布局</p>\n    </div>\n  `;\n    };\n    const initChart = () => {\n      nextTick(() => {\n        const container = document.getElementById(\"causal-graph-container\");\n        if (container && !causalChart) {\n          causalChart = echarts.init(container);\n          window.addEventListener(\"resize\", () => {\n            if (causalChart) {\n              causalChart.resize();\n            }\n          });\n        }\n      });\n    };\n    const renderCausalGraph = graphData => {\n      nextTick(() => {\n        if (!causalChart) {\n          initChart();\n        }\n        if (!causalChart) return;\n        const option = {\n          title: {\n            text: \"经济指标因果关系网络\",\n            subtext: \"节点大小表示因素重要性\",\n            left: \"center\",\n            textStyle: {\n              color: \"#2c3e50\",\n              fontSize: 18\n            },\n            subtextStyle: {\n              color: \"#666\",\n              fontSize: 12\n            }\n          },\n          tooltip: {\n            trigger: \"item\",\n            formatter: _ref2 => {\n              let {\n                data\n              } = _ref2;\n              return `\n          <div style=\"padding: 10px; background: white; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #eee\">\n            <strong style=\"color:#4285f4; font-size:14px\">${data.name}</strong>\n            ${data.detail ? `<div style=\"margin-top:5px; color:#666\">${data.detail}</div>` : \"\"}\n            ${data.note ? `<div style=\"margin-top:5px; color:#888; font-size:12px\">${data.note}</div>` : \"\"}\n          </div>\n        `;\n            }\n          },\n          animationDuration: 2000,\n          series: [{\n            type: \"graph\",\n            layout: \"force\",\n            force: {\n              repulsion: 150,\n              edgeLength: [80, 150],\n              gravity: 0.1\n            },\n            roam: true,\n            draggable: true,\n            focusNodeAdjacency: true,\n            data: graphData.nodes.map(node => ({\n              ...node,\n              symbolSize: node.level * 15 + 30,\n              itemStyle: {\n                color: node.type === \"cause\" ? \"#5470c6\" : \"#91cc75\",\n                borderColor: \"#fff\",\n                borderWidth: 2,\n                shadowColor: \"rgba(0, 0, 0, 0.1)\",\n                shadowBlur: 5\n              },\n              label: {\n                show: true,\n                position: \"inside\",\n                formatter: _ref3 => {\n                  let {\n                    name\n                  } = _ref3;\n                  return name.length > 6 ? name.substring(0, 5) + \"...\" : name;\n                },\n                fontSize: 12,\n                color: \"#fff\"\n              },\n              emphasis: {\n                label: {\n                  show: true,\n                  position: \"top\",\n                  color: \"#2c3e50\",\n                  fontSize: 14,\n                  backgroundColor: \"rgba(255,255,255,0.9)\",\n                  padding: [4, 8],\n                  borderRadius: 4\n                }\n              }\n            })),\n            edges: graphData.links.map(link => ({\n              ...link,\n              lineStyle: {\n                color: link.type === \"main\" ? \"#666\" : \"#999\",\n                width: link.type === \"main\" ? 2 : 1,\n                curveness: 0.2,\n                opacity: 0.8\n              },\n              label: {\n                show: true,\n                formatter: link.label,\n                fontSize: 10,\n                backgroundColor: \"rgba(255,255,255,0.8)\",\n                padding: [2, 4],\n                borderRadius: 3\n              }\n            })),\n            categories: [{\n              name: \"原因因素\"\n            }, {\n              name: \"结果影响\"\n            }]\n          }]\n        };\n        try {\n          causalChart.setOption(option);\n        } catch (e) {\n          console.error(\"图表渲染失败:\", e);\n        }\n      });\n    };\n    const extractEssentialData = fieldData => {\n      if (!fieldData) return null;\n      const essential = {\n        value: fieldData.value,\n        type: fieldData.type\n      };\n      if (fieldData.unit) essential.unit = fieldData.unit;\n      if (fieldData.currency) essential.currency = fieldData.currency;\n      if (fieldData.extracted) {\n        essential.raw = fieldData.raw;\n      }\n      return essential;\n    };\n    const simplifyInfobox = infobox => {\n      if (!infobox) return {};\n      const result = {\n        title: infobox.title,\n        type: infobox.type\n      };\n      if (infobox.sections) {\n        result.sections = {};\n        Object.entries(infobox.sections).forEach(_ref4 => {\n          let [sectionName, sectionData] = _ref4;\n          if (PRESERVED_FIELDS_BY_SECTION[sectionName]) {\n            result.sections[sectionName] = {};\n            PRESERVED_FIELDS_BY_SECTION[sectionName].forEach(fieldName => {\n              if (sectionData[fieldName]) {\n                if (Array.isArray(sectionData[fieldName])) {\n                  result.sections[sectionName][fieldName] = sectionData[fieldName].map(item => {\n                    return extractEssentialData(item);\n                  });\n                } else {\n                  result.sections[sectionName][fieldName] = extractEssentialData(sectionData[fieldName]);\n                }\n              }\n            });\n          }\n        });\n      }\n      return result;\n    };\n    const askQuestion = async () => {\n      if (!userQuestion.value.trim()) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"问题不能为空\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n      const question = userQuestion.value;\n      chatHistory.value.push({\n        role: \"user\",\n        content: question,\n        timestamp: new Date().toLocaleString()\n      });\n      userQuestion.value = \"\";\n      showSuggestedQuestion.value = false;\n      showCausalGraph.value = false;\n      isLoading.value = true;\n      try {\n        if (currentFieldKey.value && question.includes(\"分析\") && question.includes(\"原因\")) {\n          await api.post(\"compare_attributes\", {\n            chartData: {\n              leftData: leftData.value,\n              rightData: rightData.value,\n              leftTitle: \"当前选择\",\n              rightTitle: \"对比选择\",\n              fieldKey: currentFieldKey.value,\n              leftInfobox: simplifyInfobox(div1InfoboxData.value),\n              rightInfobox: simplifyInfobox(div3InfoboxData.value)\n            },\n            chartType: \"comparison\",\n            followUp: true,\n            previousAnalysis: getLastAnalysis()\n          }, response => {\n            const formattedAnswer = formatAnalysisResult(response.analysis, !!response.graphData);\n            chatHistory.value.push(formattedAnswer);\n            scrollToBottom();\n          }, error => {\n            throw error;\n          });\n        } else if (currentFieldKey.value && !question.includes(\"分析\")) {\n          await api.post(\"compare_attributes\", {\n            chartData: {\n              leftData: leftData.value,\n              rightData: rightData.value,\n              leftTitle: \"当前选择\",\n              rightTitle: \"对比选择\",\n              fieldKey: currentFieldKey.value\n            },\n            chartType: \"comparison\",\n            followUp: false\n          }, response => {\n            const formattedAnswer = formatAnalysisResult(response.analysis, !!response.graphData);\n            chatHistory.value.push(formattedAnswer);\n            suggestedQuestion.value = `请结合其他属性深入分析${currentFieldKey.value}差异的原因`;\n            showSuggestedQuestion.value = true;\n            scrollToBottom();\n          }, error => {\n            throw error;\n          });\n        } else {\n          await api.post(\"ask_infobox\", {\n            question: question,\n            leftInfobox: simplifyInfobox(div1InfoboxData.value),\n            rightInfobox: simplifyInfobox(div3InfoboxData.value)\n          }, response => {\n            const formattedAnswer = formatAnalysisResult(response.answer);\n            chatHistory.value.push(formattedAnswer);\n            scrollToBottom();\n          }, error => {\n            throw error;\n          });\n        }\n      } catch (error) {\n        console.error(\"请求失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `请求失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        showCausalGraph.value = false;\n        if (causalChart) {\n          causalChart.dispose();\n          causalChart = null;\n        }\n      } finally {\n        isLoading.value = false;\n        scrollToBottom();\n      }\n    };\n    const useSuggestedQuestion = () => {\n      userQuestion.value = suggestedQuestion.value;\n      showSuggestedQuestion.value = false;\n      nextTick(() => {\n        const textarea = document.querySelector(\".input-container textarea\");\n        if (textarea) {\n          textarea.focus();\n        }\n      });\n    };\n    const handleAttributeComparison = async _ref5 => {\n      let {\n        fieldKey,\n        leftData: incomingLeftData,\n        rightData: incomingRightData,\n        leftTitle,\n        rightTitle,\n        fieldType,\n        fieldLabel\n      } = _ref5;\n      if (!incomingLeftData || !incomingRightData) {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: \"请先选择要对比的数据\",\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        return;\n      }\n      leftData.value = incomingLeftData;\n      rightData.value = incomingRightData;\n      currentFieldKey.value = fieldKey;\n      isLoading.value = true;\n      try {\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `正在对比分析<strong>${fieldKey}</strong>属性...`,\n          timestamp: new Date().toLocaleString()\n        });\n        const requestPayload = {\n          chartData: {\n            leftData: leftData.value,\n            rightData: rightData.value,\n            leftTitle,\n            rightTitle,\n            fieldKey,\n            fieldType,\n            allFields: Object.keys({\n              ...div1InfoboxData.value,\n              ...div3InfoboxData.value\n            }),\n            leftInfobox: simplifyInfobox(div1InfoboxData.value),\n            rightInfobox: simplifyInfobox(div3InfoboxData.value)\n          },\n          chartType: \"comparison\"\n        };\n        await api.post(\"compare_attributes\", requestPayload, response => {\n          const formattedAnalysis = formatAnalysisResult(response.analysis, !!response.graphData);\n          chatHistory.value.push(formattedAnalysis);\n          suggestedQuestion.value = `请结合其他属性深入分析得出上述结论的原因`;\n          showSuggestedQuestion.value = true;\n          scrollToBottom();\n        }, error => {\n          throw error;\n        });\n      } catch (error) {\n        console.error(\"对比分析失败:\", error);\n        chatHistory.value.push({\n          role: \"assistant\",\n          content: `对比分析失败: ${error.message || \"未知错误\"}`,\n          timestamp: new Date().toLocaleString(),\n          error: true\n        });\n        showCausalGraph.value = false;\n        if (causalChart) {\n          causalChart.dispose();\n          causalChart = null;\n        }\n      } finally {\n        isLoading.value = false;\n        scrollToBottom();\n      }\n    };\n\n    // 监听聊天记录变化\n    watch(chatHistory, newVal => {\n      const lastMessage = newVal[newVal.length - 1];\n      if (lastMessage?.graphData) {\n        showCausalGraph.value = true;\n        nextTick(() => {\n          renderCausalGraph(lastMessage.graphData);\n        });\n      } else {\n        showCausalGraph.value = false;\n      }\n    }, {\n      deep: true\n    });\n\n    // 组件生命周期\n    onMounted(() => {\n      loadChatHistory();\n      bus.on(\"div1_Event\", handleDiv1Event);\n      bus.on(\"div3_Event\", handleDiv3Event);\n      bus.on(\"div1_InfoboxData\", data => {\n        div1InfoboxData.value = data;\n      });\n      bus.on(\"div3_InfoboxData\", data => {\n        div3InfoboxData.value = data;\n      });\n    });\n    onUnmounted(() => {\n      bus.off(\"div1_Event\", handleDiv1Event);\n      bus.off(\"div3_Event\", handleDiv3Event);\n      bus.off(\"div1_InfoboxData\");\n      bus.off(\"div3_InfoboxData\");\n      if (causalChart) {\n        causalChart.dispose();\n        causalChart = null;\n      }\n      window.removeEventListener(\"resize\", () => {\n        if (causalChart) {\n          causalChart.resize();\n        }\n      });\n    });\n    const __returned__ = {\n      userQuestion,\n      chatHistory,\n      selectText2,\n      selectText3,\n      div1RawData,\n      div3RawData,\n      isLoading,\n      div1InfoboxData,\n      div3InfoboxData,\n      showSuggestedQuestion,\n      suggestedQuestion,\n      currentFieldKey,\n      leftData,\n      rightData,\n      showCausalGraph,\n      get causalChart() {\n        return causalChart;\n      },\n      set causalChart(v) {\n        causalChart = v;\n      },\n      PRESERVED_FIELDS_BY_SECTION,\n      loadChatHistory,\n      saveChatHistory,\n      scrollToBottom,\n      getLastAnalysis,\n      handleDiv1Event,\n      handleDiv3Event,\n      handleSelection,\n      getPlainTextFromSelection,\n      formatAnalysisResult,\n      generateGraphHTML,\n      initChart,\n      renderCausalGraph,\n      extractEssentialData,\n      simplifyInfobox,\n      askQuestion,\n      useSuggestedQuestion,\n      handleAttributeComparison,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch,\n      nextTick,\n      get bus() {\n        return bus;\n      },\n      CompareTable,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","nextTick","bus","CompareTable","echarts","userQuestion","chatHistory","selectText2","selectText3","div1RawData","div3RawData","isLoading","div1InfoboxData","div3InfoboxData","showSuggestedQuestion","suggestedQuestion","currentFieldKey","leftData","rightData","showCausalGraph","causalChart","PRESERVED_FIELDS_BY_SECTION","Statistics","loadChatHistory","saved","localStorage","getItem","value","JSON","parse","e","console","error","saveChatHistory","setItem","stringify","scrollToBottom","container","document","querySelector","scrollTop","scrollHeight","getLastAnalysis","reversed","reverse","lastAssistantMsg","find","msg","role","content","handleDiv1Event","data","handleSelection","handleDiv3Event","source","plainText","getPlainTextFromSelection","htmlContent","createElement","innerHTML","innerText","textContent","formatAnalysisResult","text","isGraph","arguments","length","undefined","graphData","generateGraphHTML","timestamp","Date","toLocaleString","replace","nodes","links","initChart","getElementById","init","window","addEventListener","resize","renderCausalGraph","option","title","subtext","left","textStyle","color","fontSize","subtextStyle","tooltip","trigger","formatter","_ref2","name","detail","note","animationDuration","series","type","layout","force","repulsion","edgeLength","gravity","roam","draggable","focusNodeAdjacency","map","node","symbolSize","level","itemStyle","borderColor","borderWidth","shadowColor","shadowBlur","label","show","position","_ref3","substring","emphasis","backgroundColor","padding","borderRadius","edges","link","lineStyle","width","curveness","opacity","categories","setOption","extractEssentialData","fieldData","essential","unit","currency","extracted","raw","simplifyInfobox","infobox","result","sections","Object","entries","forEach","_ref4","sectionName","sectionData","fieldName","Array","isArray","item","askQuestion","trim","push","question","includes","api","post","chartData","leftTitle","rightTitle","fieldKey","leftInfobox","rightInfobox","chartType","followUp","previousAnalysis","response","formattedAnswer","analysis","answer","message","dispose","useSuggestedQuestion","textarea","focus","handleAttributeComparison","_ref5","incomingLeftData","incomingRightData","fieldType","fieldLabel","requestPayload","allFields","keys","formattedAnalysis","newVal","lastMessage","deep","on","off","removeEventListener"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/Div2.vue"],"sourcesContent":["<!-- Div2.vue -->\r\n<template>\r\n\t<div class=\"main-container\">\r\n\t\t<div class=\"chat-container\">\r\n\t\t\t<div class=\"chat-history\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(message, index) in chatHistory\"\r\n\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t:class=\"['message', message.role, { error: message.error }]\">\r\n\t\t\t\t\t<div class=\"message-content\" v-html=\"message.content\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"isLoading\" class=\"loading-indicator\">\r\n\t\t\t\t\t<div class=\"loading-spinner\"></div>\r\n\t\t\t\t\t正在处理中...\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"showSuggestedQuestion\" class=\"suggested-question\">\r\n\t\t\t\t\t<div class=\"suggestion-text\">建议深入分析的问题：</div>\r\n\t\t\t\t\t<div class=\"suggestion-content\" @click=\"useSuggestedQuestion\">\r\n\t\t\t\t\t\t{{ suggestedQuestion }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"showCausalGraph\" class=\"causal-graph\">\r\n\t\t\t\t\t<div class=\"graph-title\">因果关系可视化分析</div>\r\n\t\t\t\t\t<div id=\"causal-graph-container\" style=\"height: 500px\"></div>\r\n\t\t\t\t\t<div class=\"graph-legend\">\r\n\t\t\t\t\t\t<div><span class=\"legend-node cause-node\"></span> 原因因素</div>\r\n\t\t\t\t\t\t<div><span class=\"legend-node effect-node\"></span> 结果影响</div>\r\n\t\t\t\t\t\t<div><span class=\"legend-link main-link\"></span> 主要因果关系</div>\r\n\t\t\t\t\t\t<div><span class=\"legend-link secondary-link\"></span> 次要关联</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"vis-container\">\r\n\t\t\t<CompareTable\r\n\t\t\t\tclass=\"compare-table\"\r\n\t\t\t\t:div1-raw-data=\"div1RawData\"\r\n\t\t\t\t:div3-raw-data=\"div3RawData\"\r\n\t\t\t\t@compareAttribute=\"handleAttributeComparison\" />\r\n\t\t</div>\r\n\t\t<div class=\"input-area\">\r\n\t\t\t<div class=\"input-container\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tv-model=\"userQuestion\"\r\n\t\t\t\t\trows=\"2\"\r\n\t\t\t\t\tplaceholder=\"请输入你想问的问题...\"\r\n\t\t\t\t\t:disabled=\"isLoading\"></textarea>\r\n\t\t\t\t<div class=\"button-container\">\r\n\t\t\t\t\t<button @click=\"askQuestion\" :disabled=\"isLoading\">\r\n\t\t\t\t\t\t{{ isLoading ? \"处理中...\" : \"发送\" }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, onUnmounted, watch, nextTick } from \"vue\";\r\n\timport bus from \"@/js/eventBus.js\";\r\n\timport CompareTable from \"@/components/compoents_base/CompareTable.vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\t// 数据状态\r\n\tconst userQuestion = ref(\"\");\r\n\tconst chatHistory = ref([]);\r\n\tconst selectText2 = ref(\"\");\r\n\tconst selectText3 = ref(\"\");\r\n\tconst div1RawData = ref(null);\r\n\tconst div3RawData = ref(null);\r\n\tconst isLoading = ref(false);\r\n\tconst div1InfoboxData = ref(null);\r\n\tconst div3InfoboxData = ref(null);\r\n\tconst showSuggestedQuestion = ref(false);\r\n\tconst suggestedQuestion = ref(\"\");\r\n\tconst currentFieldKey = ref(\"\");\r\n\tconst leftData = ref(null);\r\n\tconst rightData = ref(null);\r\n\r\n\t// 图表相关状态\r\n\tconst showCausalGraph = ref(false);\r\n\tlet causalChart = null;\r\n\r\n\t// 定义需要保留的关键字段\r\n\tconst PRESERVED_FIELDS_BY_SECTION = {\r\n\t\tStatistics: [\r\n\t\t\t\"Population\",\r\n\t\t\t\"GDP\",\r\n\t\t\t\"GDP rank\",\r\n\t\t\t\"GDP growth\",\r\n\t\t\t\"GDP per capita\",\r\n\t\t\t\"GDP per capita rank\",\r\n\t\t\t\"GDP by sector\",\r\n\t\t\t\"Inflation (CPI)\",\r\n\t\t\t\"Population below poverty line\",\r\n\t\t\t\"Gini coefficient\",\r\n\t\t\t\"Human Development Index\",\r\n\t\t\t\"Corruption Perceptions Index\",\r\n\t\t\t\"Labor force\",\r\n\t\t\t\"Labor force by occupation\",\r\n\t\t\t\"Unemployment\",\r\n\t\t\t\"Average gross salary\",\r\n\t\t\t\"Average net salary\",\r\n\t\t\t\"Main industries\"\r\n\t\t],\r\n\t\t\"Public finances\": [\r\n\t\t\t\"Government debt\",\r\n\t\t\t\"Foreign reserves\",\r\n\t\t\t\"Budget balance\",\r\n\t\t\t\"Revenues\",\r\n\t\t\t\"Expenses\",\r\n\t\t\t\"Economic aid\",\r\n\t\t\t\"Credit rating\"\r\n\t\t]\r\n\t};\r\n\r\n\t// 方法定义\r\n\tconst loadChatHistory = () => {\r\n\t\tconst saved = localStorage.getItem(\"chatHistory\");\r\n\t\tif (saved) {\r\n\t\t\ttry {\r\n\t\t\t\tchatHistory.value = JSON.parse(saved);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"加载聊天记录失败:\", e);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst saveChatHistory = () => {\r\n\t\tlocalStorage.setItem(\"chatHistory\", JSON.stringify(chatHistory.value));\r\n\t};\r\n\r\n\tconst scrollToBottom = () => {\r\n\t\tnextTick(() => {\r\n\t\t\tconst container = document.querySelector(\".chat-history\");\r\n\t\t\tif (container) {\r\n\t\t\t\tcontainer.scrollTop = container.scrollHeight;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst getLastAnalysis = () => {\r\n\t\tconst reversed = [...chatHistory.value].reverse();\r\n\t\tconst lastAssistantMsg = reversed.find(\r\n\t\t\tmsg => msg.role === \"assistant\" && !msg.error\r\n\t\t);\r\n\t\treturn lastAssistantMsg ? lastAssistantMsg.content : \"\";\r\n\t};\r\n\r\n\tconst handleDiv1Event = data => handleSelection(data, \"div1\");\r\n\tconst handleDiv3Event = data => handleSelection(data, \"div3\");\r\n\r\n\tconst handleSelection = (data, source) => {\r\n\t\tconst plainText = getPlainTextFromSelection(data.content);\r\n\t\tif (source === \"div1\") {\r\n\t\t\tselectText2.value = plainText;\r\n\t\t\tdiv1RawData.value = data.content;\r\n\t\t} else if (source === \"div3\") {\r\n\t\t\tselectText3.value = plainText;\r\n\t\t\tdiv3RawData.value = data.content;\r\n\t\t}\r\n\t};\r\n\r\n\tconst getPlainTextFromSelection = htmlContent => {\r\n\t\tconst container = document.createElement(\"div\");\r\n\t\tcontainer.innerHTML = htmlContent;\r\n\t\treturn container.innerText || container.textContent || \"\";\r\n\t};\r\n\r\n\tconst formatAnalysisResult = (text, isGraph = false) => {\r\n\t\tif (isGraph) {\r\n\t\t\ttry {\r\n\t\t\t\tconst graphData = JSON.parse(text);\r\n\t\t\t\treturn {\r\n\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\tcontent: generateGraphHTML(graphData),\r\n\t\t\t\t\tgraphData: graphData,\r\n\t\t\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t\t\t};\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\trole: \"assistant\",\r\n\t\t\t\t\tcontent: \"图形数据解析失败，显示原始分析结果\",\r\n\t\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\t\terror: true\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext = text\r\n\t\t\t.replace(/^# (.*$)/gm, \"<h1>$1</h1>\")\r\n\t\t\t.replace(/^## (.*$)/gm, \"<h2>$1</h2>\")\r\n\t\t\t.replace(/^### (.*$)/gm, \"<h3>$1</h3>\")\r\n\t\t\t.replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\")\r\n\t\t\t.replace(/\\*(.*?)\\*/g, \"<em>$1</em>\")\r\n\t\t\t.replace(/`(.*?)`/g, \"<code>$1</code>\")\r\n\t\t\t.replace(/!\\[(.*?)\\]\\((.*?)\\)/g, '<img alt=\"$1\" src=\"$2\">')\r\n\t\t\t.replace(/\\[(.*?)\\]\\((.*?)\\)/g, '<a href=\"$2\">$1</a>')\r\n\t\t\t.replace(/(?:^|\\n)\\d+\\.\\s+(.*)/g, \"<li>$1</li>\")\r\n\t\t\t.replace(/(?:^|\\n)-\\s+(.*)/g, \"<li>$1</li>\")\r\n\t\t\t.replace(/(?:^|\\n)\\>\\s+(.*)/g, \"<blockquote>$1</blockquote>\")\r\n\t\t\t.replace(/(<li>.*<\\/li>)/gs, \"<ul>$1</ul>\")\r\n\t\t\t.replace(/\\n\\n/g, \"<br><br>\")\r\n\t\t\t.replace(/\\n/g, \"<br>\");\r\n\r\n\t\treturn `<div class=\"markdown-content\">${text}</div>`;\r\n\t};\r\n\r\n\tconst generateGraphHTML = graphData => {\r\n\t\treturn `\r\n    <div class=\"graph-summary\">\r\n      <h4>已生成因果关系网络图</h4>\r\n      <p>包含 ${graphData.nodes.length} 个关键因素和 ${graphData.links.length} 条因果关系链</p>\r\n      <p>点击节点查看详细信息，拖动可调整布局</p>\r\n    </div>\r\n  `;\r\n\t};\r\n\r\n\tconst initChart = () => {\r\n\t\tnextTick(() => {\r\n\t\t\tconst container = document.getElementById(\"causal-graph-container\");\r\n\t\t\tif (container && !causalChart) {\r\n\t\t\t\tcausalChart = echarts.init(container);\r\n\t\t\t\twindow.addEventListener(\"resize\", () => {\r\n\t\t\t\t\tif (causalChart) {\r\n\t\t\t\t\t\tcausalChart.resize();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst renderCausalGraph = graphData => {\r\n\t\tnextTick(() => {\r\n\t\t\tif (!causalChart) {\r\n\t\t\t\tinitChart();\r\n\t\t\t}\r\n\r\n\t\t\tif (!causalChart) return;\r\n\r\n\t\t\tconst option = {\r\n\t\t\t\ttitle: {\r\n\t\t\t\t\ttext: \"经济指标因果关系网络\",\r\n\t\t\t\t\tsubtext: \"节点大小表示因素重要性\",\r\n\t\t\t\t\tleft: \"center\",\r\n\t\t\t\t\ttextStyle: {\r\n\t\t\t\t\t\tcolor: \"#2c3e50\",\r\n\t\t\t\t\t\tfontSize: 18\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsubtextStyle: {\r\n\t\t\t\t\t\tcolor: \"#666\",\r\n\t\t\t\t\t\tfontSize: 12\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\ttooltip: {\r\n\t\t\t\t\ttrigger: \"item\",\r\n\t\t\t\t\tformatter: ({ data }) => `\r\n          <div style=\"padding: 10px; background: white; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #eee\">\r\n            <strong style=\"color:#4285f4; font-size:14px\">${data.name}</strong>\r\n            ${\r\n\t\t\t\t\t\t\tdata.detail\r\n\t\t\t\t\t\t\t\t? `<div style=\"margin-top:5px; color:#666\">${data.detail}</div>`\r\n\t\t\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\t\t}\r\n            ${\r\n\t\t\t\t\t\t\tdata.note\r\n\t\t\t\t\t\t\t\t? `<div style=\"margin-top:5px; color:#888; font-size:12px\">${data.note}</div>`\r\n\t\t\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\t\t}\r\n          </div>\r\n        `\r\n\t\t\t\t},\r\n\t\t\t\tanimationDuration: 2000,\r\n\t\t\t\tseries: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttype: \"graph\",\r\n\t\t\t\t\t\tlayout: \"force\",\r\n\t\t\t\t\t\tforce: {\r\n\t\t\t\t\t\t\trepulsion: 150,\r\n\t\t\t\t\t\t\tedgeLength: [80, 150],\r\n\t\t\t\t\t\t\tgravity: 0.1\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\troam: true,\r\n\t\t\t\t\t\tdraggable: true,\r\n\t\t\t\t\t\tfocusNodeAdjacency: true,\r\n\t\t\t\t\t\tdata: graphData.nodes.map(node => ({\r\n\t\t\t\t\t\t\t...node,\r\n\t\t\t\t\t\t\tsymbolSize: node.level * 15 + 30,\r\n\t\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\t\tcolor: node.type === \"cause\" ? \"#5470c6\" : \"#91cc75\",\r\n\t\t\t\t\t\t\t\tborderColor: \"#fff\",\r\n\t\t\t\t\t\t\t\tborderWidth: 2,\r\n\t\t\t\t\t\t\t\tshadowColor: \"rgba(0, 0, 0, 0.1)\",\r\n\t\t\t\t\t\t\t\tshadowBlur: 5\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\t\tposition: \"inside\",\r\n\t\t\t\t\t\t\t\tformatter: ({ name }) =>\r\n\t\t\t\t\t\t\t\t\tname.length > 6 ? name.substring(0, 5) + \"...\" : name,\r\n\t\t\t\t\t\t\t\tfontSize: 12,\r\n\t\t\t\t\t\t\t\tcolor: \"#fff\"\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\t\t\tposition: \"top\",\r\n\t\t\t\t\t\t\t\t\tcolor: \"#2c3e50\",\r\n\t\t\t\t\t\t\t\t\tfontSize: 14,\r\n\t\t\t\t\t\t\t\t\tbackgroundColor: \"rgba(255,255,255,0.9)\",\r\n\t\t\t\t\t\t\t\t\tpadding: [4, 8],\r\n\t\t\t\t\t\t\t\t\tborderRadius: 4\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\t\tedges: graphData.links.map(link => ({\r\n\t\t\t\t\t\t\t...link,\r\n\t\t\t\t\t\t\tlineStyle: {\r\n\t\t\t\t\t\t\t\tcolor: link.type === \"main\" ? \"#666\" : \"#999\",\r\n\t\t\t\t\t\t\t\twidth: link.type === \"main\" ? 2 : 1,\r\n\t\t\t\t\t\t\t\tcurveness: 0.2,\r\n\t\t\t\t\t\t\t\topacity: 0.8\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\t\tformatter: link.label,\r\n\t\t\t\t\t\t\t\tfontSize: 10,\r\n\t\t\t\t\t\t\t\tbackgroundColor: \"rgba(255,255,255,0.8)\",\r\n\t\t\t\t\t\t\t\tpadding: [2, 4],\r\n\t\t\t\t\t\t\t\tborderRadius: 3\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\t\tcategories: [{ name: \"原因因素\" }, { name: \"结果影响\" }]\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t};\r\n\r\n\t\t\ttry {\r\n\t\t\t\tcausalChart.setOption(option);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"图表渲染失败:\", e);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst extractEssentialData = fieldData => {\r\n\t\tif (!fieldData) return null;\r\n\r\n\t\tconst essential = {\r\n\t\t\tvalue: fieldData.value,\r\n\t\t\ttype: fieldData.type\r\n\t\t};\r\n\r\n\t\tif (fieldData.unit) essential.unit = fieldData.unit;\r\n\t\tif (fieldData.currency) essential.currency = fieldData.currency;\r\n\t\tif (fieldData.extracted) {\r\n\t\t\tessential.raw = fieldData.raw;\r\n\t\t}\r\n\r\n\t\treturn essential;\r\n\t};\r\n\r\n\tconst simplifyInfobox = infobox => {\r\n\t\tif (!infobox) return {};\r\n\r\n\t\tconst result = {\r\n\t\t\ttitle: infobox.title,\r\n\t\t\ttype: infobox.type\r\n\t\t};\r\n\r\n\t\tif (infobox.sections) {\r\n\t\t\tresult.sections = {};\r\n\r\n\t\t\tObject.entries(infobox.sections).forEach(([sectionName, sectionData]) => {\r\n\t\t\t\tif (PRESERVED_FIELDS_BY_SECTION[sectionName]) {\r\n\t\t\t\t\tresult.sections[sectionName] = {};\r\n\r\n\t\t\t\t\tPRESERVED_FIELDS_BY_SECTION[sectionName].forEach(fieldName => {\r\n\t\t\t\t\t\tif (sectionData[fieldName]) {\r\n\t\t\t\t\t\t\tif (Array.isArray(sectionData[fieldName])) {\r\n\t\t\t\t\t\t\t\tresult.sections[sectionName][fieldName] = sectionData[\r\n\t\t\t\t\t\t\t\t\tfieldName\r\n\t\t\t\t\t\t\t\t].map(item => {\r\n\t\t\t\t\t\t\t\t\treturn extractEssentialData(item);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresult.sections[sectionName][fieldName] = extractEssentialData(\r\n\t\t\t\t\t\t\t\t\tsectionData[fieldName]\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\r\n\tconst askQuestion = async () => {\r\n\t\tif (!userQuestion.value.trim()) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"问题不能为空\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst question = userQuestion.value;\r\n\t\tchatHistory.value.push({\r\n\t\t\trole: \"user\",\r\n\t\t\tcontent: question,\r\n\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t});\r\n\t\tuserQuestion.value = \"\";\r\n\t\tshowSuggestedQuestion.value = false;\r\n\t\tshowCausalGraph.value = false;\r\n\r\n\t\tisLoading.value = true;\r\n\r\n\t\ttry {\r\n\t\t\tif (\r\n\t\t\t\tcurrentFieldKey.value &&\r\n\t\t\t\tquestion.includes(\"分析\") &&\r\n\t\t\t\tquestion.includes(\"原因\")\r\n\t\t\t) {\r\n\t\t\t\tawait api.post(\r\n\t\t\t\t\t\"compare_attributes\",\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchartData: {\r\n\t\t\t\t\t\t\tleftData: leftData.value,\r\n\t\t\t\t\t\t\trightData: rightData.value,\r\n\t\t\t\t\t\t\tleftTitle: \"当前选择\",\r\n\t\t\t\t\t\t\trightTitle: \"对比选择\",\r\n\t\t\t\t\t\t\tfieldKey: currentFieldKey.value,\r\n\t\t\t\t\t\t\tleftInfobox: simplifyInfobox(div1InfoboxData.value),\r\n\t\t\t\t\t\t\trightInfobox: simplifyInfobox(div3InfoboxData.value)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tchartType: \"comparison\",\r\n\t\t\t\t\t\tfollowUp: true,\r\n\t\t\t\t\t\tpreviousAnalysis: getLastAnalysis()\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresponse => {\r\n\t\t\t\t\t\tconst formattedAnswer = formatAnalysisResult(\r\n\t\t\t\t\t\t\tresponse.analysis,\r\n\t\t\t\t\t\t\t!!response.graphData\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tchatHistory.value.push(formattedAnswer);\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror => {\r\n\t\t\t\t\t\tthrow error;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else if (currentFieldKey.value && !question.includes(\"分析\")) {\r\n\t\t\t\tawait api.post(\r\n\t\t\t\t\t\"compare_attributes\",\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchartData: {\r\n\t\t\t\t\t\t\tleftData: leftData.value,\r\n\t\t\t\t\t\t\trightData: rightData.value,\r\n\t\t\t\t\t\t\tleftTitle: \"当前选择\",\r\n\t\t\t\t\t\t\trightTitle: \"对比选择\",\r\n\t\t\t\t\t\t\tfieldKey: currentFieldKey.value\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tchartType: \"comparison\",\r\n\t\t\t\t\t\tfollowUp: false\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresponse => {\r\n\t\t\t\t\t\tconst formattedAnswer = formatAnalysisResult(\r\n\t\t\t\t\t\t\tresponse.analysis,\r\n\t\t\t\t\t\t\t!!response.graphData\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tchatHistory.value.push(formattedAnswer);\r\n\t\t\t\t\t\tsuggestedQuestion.value = `请结合其他属性深入分析${currentFieldKey.value}差异的原因`;\r\n\t\t\t\t\t\tshowSuggestedQuestion.value = true;\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror => {\r\n\t\t\t\t\t\tthrow error;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tawait api.post(\r\n\t\t\t\t\t\"ask_infobox\",\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tquestion: question,\r\n\t\t\t\t\t\tleftInfobox: simplifyInfobox(div1InfoboxData.value),\r\n\t\t\t\t\t\trightInfobox: simplifyInfobox(div3InfoboxData.value)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresponse => {\r\n\t\t\t\t\t\tconst formattedAnswer = formatAnalysisResult(response.answer);\r\n\t\t\t\t\t\tchatHistory.value.push(formattedAnswer);\r\n\t\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror => {\r\n\t\t\t\t\t\tthrow error;\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"请求失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `请求失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\r\n\t\t\tshowCausalGraph.value = false;\r\n\t\t\tif (causalChart) {\r\n\t\t\t\tcausalChart.dispose();\r\n\t\t\t\tcausalChart = null;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\t};\r\n\r\n\tconst useSuggestedQuestion = () => {\r\n\t\tuserQuestion.value = suggestedQuestion.value;\r\n\t\tshowSuggestedQuestion.value = false;\r\n\t\tnextTick(() => {\r\n\t\t\tconst textarea = document.querySelector(\".input-container textarea\");\r\n\t\t\tif (textarea) {\r\n\t\t\t\ttextarea.focus();\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst handleAttributeComparison = async ({\r\n\t\tfieldKey,\r\n\t\tleftData: incomingLeftData,\r\n\t\trightData: incomingRightData,\r\n\t\tleftTitle,\r\n\t\trightTitle,\r\n\t\tfieldType,\r\n\t\tfieldLabel\r\n\t}) => {\r\n\t\tif (!incomingLeftData || !incomingRightData) {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: \"请先选择要对比的数据\",\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tleftData.value = incomingLeftData;\r\n\t\trightData.value = incomingRightData;\r\n\t\tcurrentFieldKey.value = fieldKey;\r\n\r\n\t\tisLoading.value = true;\r\n\r\n\t\ttry {\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `正在对比分析<strong>${fieldKey}</strong>属性...`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString()\r\n\t\t\t});\r\n\r\n\t\t\tconst requestPayload = {\r\n\t\t\t\tchartData: {\r\n\t\t\t\t\tleftData: leftData.value,\r\n\t\t\t\t\trightData: rightData.value,\r\n\t\t\t\t\tleftTitle,\r\n\t\t\t\t\trightTitle,\r\n\t\t\t\t\tfieldKey,\r\n\t\t\t\t\tfieldType,\r\n\t\t\t\t\tallFields: Object.keys({\r\n\t\t\t\t\t\t...div1InfoboxData.value,\r\n\t\t\t\t\t\t...div3InfoboxData.value\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tleftInfobox: simplifyInfobox(div1InfoboxData.value),\r\n\t\t\t\t\trightInfobox: simplifyInfobox(div3InfoboxData.value)\r\n\t\t\t\t},\r\n\t\t\t\tchartType: \"comparison\"\r\n\t\t\t};\r\n\r\n\t\t\tawait api.post(\r\n\t\t\t\t\"compare_attributes\",\r\n\t\t\t\trequestPayload,\r\n\t\t\t\tresponse => {\r\n\t\t\t\t\tconst formattedAnalysis = formatAnalysisResult(\r\n\t\t\t\t\t\tresponse.analysis,\r\n\t\t\t\t\t\t!!response.graphData\r\n\t\t\t\t\t);\r\n\t\t\t\t\tchatHistory.value.push(formattedAnalysis);\r\n\r\n\t\t\t\t\tsuggestedQuestion.value = `请结合其他属性深入分析得出上述结论的原因`;\r\n\t\t\t\t\tshowSuggestedQuestion.value = true;\r\n\t\t\t\t\tscrollToBottom();\r\n\t\t\t\t},\r\n\t\t\t\terror => {\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"对比分析失败:\", error);\r\n\t\t\tchatHistory.value.push({\r\n\t\t\t\trole: \"assistant\",\r\n\t\t\t\tcontent: `对比分析失败: ${error.message || \"未知错误\"}`,\r\n\t\t\t\ttimestamp: new Date().toLocaleString(),\r\n\t\t\t\terror: true\r\n\t\t\t});\r\n\r\n\t\t\tshowCausalGraph.value = false;\r\n\t\t\tif (causalChart) {\r\n\t\t\t\tcausalChart.dispose();\r\n\t\t\t\tcausalChart = null;\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t\tscrollToBottom();\r\n\t\t}\r\n\t};\r\n\r\n\t// 监听聊天记录变化\r\n\twatch(\r\n\t\tchatHistory,\r\n\t\tnewVal => {\r\n\t\t\tconst lastMessage = newVal[newVal.length - 1];\r\n\t\t\tif (lastMessage?.graphData) {\r\n\t\t\t\tshowCausalGraph.value = true;\r\n\t\t\t\tnextTick(() => {\r\n\t\t\t\t\trenderCausalGraph(lastMessage.graphData);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tshowCausalGraph.value = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n\r\n\t// 组件生命周期\r\n\tonMounted(() => {\r\n\t\tloadChatHistory();\r\n\t\tbus.on(\"div1_Event\", handleDiv1Event);\r\n\t\tbus.on(\"div3_Event\", handleDiv3Event);\r\n\t\tbus.on(\"div1_InfoboxData\", data => {\r\n\t\t\tdiv1InfoboxData.value = data;\r\n\t\t});\r\n\t\tbus.on(\"div3_InfoboxData\", data => {\r\n\t\t\tdiv3InfoboxData.value = data;\r\n\t\t});\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tbus.off(\"div1_Event\", handleDiv1Event);\r\n\t\tbus.off(\"div3_Event\", handleDiv3Event);\r\n\t\tbus.off(\"div1_InfoboxData\");\r\n\t\tbus.off(\"div3_InfoboxData\");\r\n\t\tif (causalChart) {\r\n\t\t\tcausalChart.dispose();\r\n\t\t\tcausalChart = null;\r\n\t\t}\r\n\t\twindow.removeEventListener(\"resize\", () => {\r\n\t\t\tif (causalChart) {\r\n\t\t\t\tcausalChart.resize();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.main-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tbackground: #f5f7fa;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.chat-container {\r\n\t\theight: 50vh;\r\n\t\tmin-height: 50vh;\r\n\t\toverflow: hidden;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tmargin: 10px;\r\n\t}\r\n\r\n\t.chat-history {\r\n\t\tflex: 1;\r\n\t\toverflow-y: auto;\r\n\t\tpadding: 20px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t\tscroll-behavior: smooth;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.vis-container {\r\n\t\theight: 30vh;\r\n\t\tmin-height: 30vh;\r\n\t\tpadding: 10px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tmargin: 0 10px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n\t\toverflow: auto;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.compare-table {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.input-area {\r\n\t\theight: 15vh;\r\n\t\tmin-height: 15vh;\r\n\t\tpadding: 15px;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-top: 1px solid #e0e0e0;\r\n\t\tflex-shrink: 0;\r\n\t}\r\n\r\n\t.message {\r\n\t\tmargin-bottom: 20px;\r\n\t\tpadding: 15px 20px;\r\n\t\tborder-radius: 12px;\r\n\t\tline-height: 1.6;\r\n\t\tposition: relative;\r\n\t\tmax-width: 85%;\r\n\t\tbox-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\r\n\t}\r\n\r\n\t.message.user {\r\n\t\tbackground: #e3f2fd;\r\n\t\tmargin-left: auto;\r\n\t\tborder-bottom-right-radius: 4px;\r\n\t\tborder: 1px solid #bbdefb;\r\n\t}\r\n\r\n\t.message.assistant {\r\n\t\tbackground: #f8f9fa;\r\n\t\tmargin-right: auto;\r\n\t\tborder-bottom-left-radius: 4px;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.message.error {\r\n\t\tbackground: #ffebee;\r\n\t\tborder-left: 4px solid #f44336;\r\n\t}\r\n\r\n\t.message-content {\r\n\t\tword-wrap: break-word;\r\n\t}\r\n\r\n\t.input-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\t\theight: 100%;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.input-container textarea {\r\n\t\twidth: 100%;\r\n\t\tpadding: 12px 16px;\r\n\t\tborder: none;\r\n\t\tborder-radius: 12px;\r\n\t\tresize: none;\r\n\t\tfont-size: 14px;\r\n\t\toutline: none;\r\n\t\tbackground: #f9f9f9;\r\n\t}\r\n\r\n\t.input-container textarea:focus {\r\n\t\tbackground: #ffffff;\r\n\t}\r\n\r\n\t.button-container {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: flex-end;\r\n\t\tpadding: 8px;\r\n\t}\r\n\r\n\t.button-container button {\r\n\t\tbackground: #4285f4;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 8px 20px;\r\n\t\tborder-radius: 8px;\r\n\t\tcursor: pointer;\r\n\t\tfont-size: 14px;\r\n\t\tfont-weight: 500;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\r\n\t.button-container button:hover {\r\n\t\tbackground: #3367d6;\r\n\t\ttransform: translateY(-1px);\r\n\t}\r\n\r\n\t.button-container button:disabled {\r\n\t\tbackground: #b3c6e0;\r\n\t\tcursor: not-allowed;\r\n\t\ttransform: none;\r\n\t}\r\n\r\n\t.loading-indicator {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tpadding: 15px;\r\n\t\tcolor: #666;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\t.loading-spinner {\r\n\t\tborder: 3px solid rgba(66, 133, 244, 0.2);\r\n\t\tborder-radius: 50%;\r\n\t\tborder-top: 3px solid #4285f4;\r\n\t\twidth: 20px;\r\n\t\theight: 20px;\r\n\t\tanimation: spin 1s linear infinite;\r\n\t\tmargin-right: 10px;\r\n\t}\r\n\r\n\t@keyframes spin {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\r\n\t.markdown-content {\r\n\t\tline-height: 1.7;\r\n\t\tfont-size: 15px;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.markdown-content h1 {\r\n\t\tfont-size: 1.5em;\r\n\t\tmargin: 20px 0 15px;\r\n\t\tpadding-bottom: 5px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t\tcolor: #2c3e50;\r\n\t}\r\n\r\n\t.markdown-content h2 {\r\n\t\tfont-size: 1.3em;\r\n\t\tmargin: 18px 0 12px;\r\n\t\tcolor: #34495e;\r\n\t}\r\n\r\n\t.markdown-content h3 {\r\n\t\tfont-size: 1.1em;\r\n\t\tmargin: 15px 0 10px;\r\n\t\tcolor: #4285f4;\r\n\t}\r\n\r\n\t.markdown-content ul,\r\n\t.markdown-content ol {\r\n\t\tpadding-left: 25px;\r\n\t\tmargin: 12px 0;\r\n\t}\r\n\r\n\t.markdown-content li {\r\n\t\tmargin-bottom: 8px;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.markdown-content ul li::before {\r\n\t\tcontent: \"•\";\r\n\t\tcolor: #4285f4;\r\n\t\tposition: absolute;\r\n\t\tleft: -15px;\r\n\t}\r\n\r\n\t.markdown-content strong {\r\n\t\tcolor: #2c3e50;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.markdown-content em {\r\n\t\tcolor: #666;\r\n\t\tfont-style: italic;\r\n\t}\r\n\r\n\t.markdown-content code {\r\n\t\tbackground: rgba(66, 133, 244, 0.1);\r\n\t\tpadding: 2px 6px;\r\n\t\tborder-radius: 4px;\r\n\t\tfont-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, monospace;\r\n\t\tfont-size: 0.9em;\r\n\t\tcolor: #d63384;\r\n\t}\r\n\r\n\t.markdown-content blockquote {\r\n\t\tborder-left: 3px solid #4285f4;\r\n\t\tpadding: 10px 15px;\r\n\t\tmargin: 15px 0;\r\n\t\tbackground: rgba(66, 133, 244, 0.05);\r\n\t\tcolor: #555;\r\n\t}\r\n\r\n\t.markdown-content a {\r\n\t\tcolor: #4285f4;\r\n\t\ttext-decoration: none;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.markdown-content a:hover {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\r\n\t.suggested-question {\r\n\t\tmargin: 15px 0;\r\n\t\tpadding: 12px;\r\n\t\tbackground-color: #f5f7fa;\r\n\t\tborder-radius: 8px;\r\n\t\tborder: 1px dashed #4285f4;\r\n\t\tcursor: pointer;\r\n\t\ttransition: all 0.2s;\r\n\t}\r\n\r\n\t.suggested-question:hover {\r\n\t\tbackground-color: #e8f0fe;\r\n\t}\r\n\r\n\t.suggestion-text {\r\n\t\tfont-size: 12px;\r\n\t\tcolor: #666;\r\n\t\tmargin-bottom: 5px;\r\n\t}\r\n\r\n\t.suggestion-content {\r\n\t\tcolor: #4285f4;\r\n\t\tfont-weight: 500;\r\n\t\tpadding: 5px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.causal-graph {\r\n\t\tmargin: 20px 0;\r\n\t\tpadding: 20px;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 12px;\r\n\t\tbox-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.graph-title {\r\n\t\tfont-size: 16px;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #2c3e50;\r\n\t\tmargin-bottom: 15px;\r\n\t\tpadding-bottom: 10px;\r\n\t\tborder-bottom: 2px solid #eee;\r\n\t}\r\n\r\n\t.graph-summary {\r\n\t\tpadding: 15px;\r\n\t\tbackground: #f8f9fa;\r\n\t\tborder-radius: 8px;\r\n\t\tmargin: 10px 0;\r\n\t\ttext-align: center;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t#causal-graph-container {\r\n\t\twidth: 100%;\r\n\t\tmin-height: 500px;\r\n\t\ttransition: height 0.3s ease;\r\n\t}\r\n\r\n\t.graph-legend {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tgap: 15px;\r\n\t\tmargin-top: 15px;\r\n\t\tpadding: 10px;\r\n\t\tbackground: #f9f9f9;\r\n\t\tborder-radius: 6px;\r\n\t\tfont-size: 12px;\r\n\t}\r\n\r\n\t.legend-node {\r\n\t\tdisplay: inline-block;\r\n\t\twidth: 12px;\r\n\t\theight: 12px;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 5px;\r\n\t\tborder: 1px solid #fff;\r\n\t}\r\n\r\n\t.cause-node {\r\n\t\tbackground: #5470c6;\r\n\t}\r\n\r\n\t.effect-node {\r\n\t\tbackground: #91cc75;\r\n\t}\r\n\r\n\t.legend-link {\r\n\t\tdisplay: inline-block;\r\n\t\twidth: 20px;\r\n\t\theight: 2px;\r\n\t\tmargin: 5px 5px 0 0;\r\n\t\tvertical-align: middle;\r\n\t}\r\n\r\n\t.main-link {\r\n\t\tbackground: #666;\r\n\t}\r\n\r\n\t.secondary-link {\r\n\t\tbackground: #999;\r\n\t\tborder-style: dashed;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}