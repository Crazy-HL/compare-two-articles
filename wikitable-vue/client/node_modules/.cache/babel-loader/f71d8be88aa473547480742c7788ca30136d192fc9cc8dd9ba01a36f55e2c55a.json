{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0c150cb4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = [\"width\", \"height\"];\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"rect\", {\n  width: \"100%\",\n  height: \"100%\",\n  fill: \"#f8fafc\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_3 = [\"d\"];\nconst _hoisted_4 = [\"cx\", \"cy\", \"onMouseover\"];\nconst _hoisted_5 = [\"x1\", \"x2\", \"y2\"];\nconst _hoisted_6 = [\"x\", \"y\"];\nconst _hoisted_7 = {\n  class: \"tooltip\"\n};\nconst _hoisted_8 = {\n  class: \"tooltip-year\"\n};\nconst _hoisted_9 = {\n  class: \"tooltip-value\"\n};\nconst _hoisted_10 = {\n  key: 0,\n  class: \"tooltip-name\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"svg\", {\n    width: $props.width,\n    height: $props.height,\n    class: \"sparkline-container\"\n  }, [_createCommentVNode(\" 背景区域 \"), _hoisted_2, _createCommentVNode(\" 折线路径 \"), _createElementVNode(\"path\", {\n    d: $setup.linePath,\n    stroke: \"#4a90e2\",\n    \"stroke-width\": \"2\",\n    fill: \"none\"\n  }, null, 8 /* PROPS */, _hoisted_3), _createCommentVNode(\" 数据点 \"), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.points, (point, index) => {\n    return _openBlock(), _createElementBlock(\"circle\", {\n      key: index,\n      cx: point.x,\n      cy: point.y,\n      r: \"3\",\n      fill: \"#4a90e2\",\n      onMouseover: $event => $setup.showTooltip($event, point),\n      onMouseout: $setup.hideTooltip\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_4);\n  }), 128 /* KEYED_FRAGMENT */)), _createCommentVNode(\" 鼠标悬停时的指示线 \"), $setup.hoverIndex !== null ? (_openBlock(), _createElementBlock(\"line\", {\n    key: 0,\n    x1: $setup.points[$setup.hoverIndex].x,\n    x2: $setup.points[$setup.hoverIndex].x,\n    y1: \"0\",\n    y2: $props.height,\n    stroke: \"#64748b\",\n    \"stroke-width\": \"1\",\n    \"stroke-dasharray\": \"2,2\"\n  }, null, 8 /* PROPS */, _hoisted_5)) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 工具提示 \"), $setup.hoverIndex !== null && $setup.showTooltipFlag ? (_openBlock(), _createElementBlock(\"foreignObject\", {\n    key: 1,\n    x: $setup.tooltipX,\n    y: $setup.tooltipY,\n    width: \"120\",\n    height: \"60\",\n    class: \"tooltip-container\"\n  }, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, _toDisplayString($setup.timeLabels[$setup.hoverIndex]), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, _toDisplayString($setup.formattedValue($setup.dataPoints[$setup.hoverIndex].value)), 1 /* TEXT */), $setup.dataPoints[$setup.hoverIndex].recordName ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, _toDisplayString($setup.dataPoints[$setup.hoverIndex].recordName), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])], 8 /* PROPS */, _hoisted_6)) : _createCommentVNode(\"v-if\", true)], 8 /* PROPS */, _hoisted_1);\n}","map":{"version":3,"names":["_createElementVNode","width","height","fill","class","key","_createElementBlock","$props","_createCommentVNode","_hoisted_2","d","$setup","linePath","stroke","_hoisted_3","_Fragment","_renderList","points","point","index","cx","x","cy","y","r","onMouseover","$event","showTooltip","onMouseout","hideTooltip","_hoisted_4","hoverIndex","x1","x2","y1","y2","_hoisted_5","showTooltipFlag","tooltipX","tooltipY","_hoisted_7","_hoisted_8","_toDisplayString","timeLabels","_hoisted_9","formattedValue","dataPoints","value","recordName","_hoisted_10","_hoisted_6","_hoisted_1"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\SparklineChart.vue"],"sourcesContent":["<template>\r\n\t<svg :width=\"width\" :height=\"height\" class=\"sparkline-container\">\r\n\t\t<!-- 背景区域 -->\r\n\t\t<rect width=\"100%\" height=\"100%\" fill=\"#f8fafc\" />\r\n\r\n\t\t<!-- 折线路径 -->\r\n\t\t<path :d=\"linePath\" stroke=\"#4a90e2\" stroke-width=\"2\" fill=\"none\" />\r\n\r\n\t\t<!-- 数据点 -->\r\n\t\t<circle\r\n\t\t\tv-for=\"(point, index) in points\"\r\n\t\t\t:key=\"index\"\r\n\t\t\t:cx=\"point.x\"\r\n\t\t\t:cy=\"point.y\"\r\n\t\t\tr=\"3\"\r\n\t\t\tfill=\"#4a90e2\"\r\n\t\t\t@mouseover=\"showTooltip($event, point)\"\r\n\t\t\t@mouseout=\"hideTooltip\" />\r\n\r\n\t\t<!-- 鼠标悬停时的指示线 -->\r\n\t\t<line\r\n\t\t\tv-if=\"hoverIndex !== null\"\r\n\t\t\t:x1=\"points[hoverIndex].x\"\r\n\t\t\t:x2=\"points[hoverIndex].x\"\r\n\t\t\ty1=\"0\"\r\n\t\t\t:y2=\"height\"\r\n\t\t\tstroke=\"#64748b\"\r\n\t\t\tstroke-width=\"1\"\r\n\t\t\tstroke-dasharray=\"2,2\" />\r\n\r\n\t\t<!-- 工具提示 -->\r\n\t\t<foreignObject\r\n\t\t\tv-if=\"hoverIndex !== null && showTooltipFlag\"\r\n\t\t\t:x=\"tooltipX\"\r\n\t\t\t:y=\"tooltipY\"\r\n\t\t\twidth=\"120\"\r\n\t\t\theight=\"60\"\r\n\t\t\tclass=\"tooltip-container\">\r\n\t\t\t<div class=\"tooltip\">\r\n\t\t\t\t<div class=\"tooltip-year\">{{ timeLabels[hoverIndex] }}</div>\r\n\t\t\t\t<div class=\"tooltip-value\">\r\n\t\t\t\t\t{{ formattedValue(dataPoints[hoverIndex].value) }}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div v-if=\"dataPoints[hoverIndex].recordName\" class=\"tooltip-name\">\r\n\t\t\t\t\t{{ dataPoints[hoverIndex].recordName }}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</foreignObject>\r\n\t</svg>\r\n</template>\r\n\r\n<script setup>\r\n\timport { computed, ref } from \"vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [] // 现在接收timeSeriesData中的一个属性数组\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 180\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 80\r\n\t\t},\r\n\t\t// 新增：是否显示工具提示\r\n\t\tshowTooltip: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t});\r\n\r\n\tconst hoverIndex = ref(null);\r\n\tconst showTooltipFlag = ref(false);\r\n\tconst tooltipX = ref(0);\r\n\tconst tooltipY = ref(0);\r\n\r\n\t// 对数据进行排序以确保时间顺序正确\r\n\tconst dataPoints = computed(() => {\r\n\t\treturn [...props.data].sort((a, b) => a.year - b.year);\r\n\t});\r\n\r\n\t// 提取时间标签（年份）\r\n\tconst timeLabels = computed(() => {\r\n\t\treturn dataPoints.value.map(item => item.year);\r\n\t});\r\n\r\n\t// 提取数值\r\n\tconst values = computed(() => {\r\n\t\treturn dataPoints.value.map(item => item.value);\r\n\t});\r\n\r\n\t// 格式化显示值\r\n\tconst formattedValue = value => {\r\n\t\tif (value >= 1000000) {\r\n\t\t\treturn `$${(value / 1000000).toFixed(1)}M`;\r\n\t\t}\r\n\t\tif (value >= 1000) {\r\n\t\t\treturn `$${(value / 1000).toFixed(1)}K`;\r\n\t\t}\r\n\t\treturn value.toLocaleString();\r\n\t};\r\n\r\n\t// 计算x轴比例尺（考虑年份间隔不均匀）\r\n\tconst xScale = computed(() => {\r\n\t\tif (dataPoints.value.length < 2) return () => 0;\r\n\r\n\t\tconst years = dataPoints.value.map(item => item.year);\r\n\t\tconst minYear = Math.min(...years);\r\n\t\tconst maxYear = Math.max(...years);\r\n\t\tconst yearRange = maxYear - minYear;\r\n\r\n\t\treturn year => {\r\n\t\t\treturn ((year - minYear) / yearRange) * (props.width - 20) + 10;\r\n\t\t};\r\n\t});\r\n\r\n\t// 计算y轴比例尺\r\n\tconst yScale = computed(() => {\r\n\t\tif (values.value.length === 0) return () => 0;\r\n\r\n\t\tconst minValue = Math.min(...values.value);\r\n\t\tconst maxValue = Math.max(...values.value);\r\n\t\tconst valueRange = maxValue - minValue || 1; // 避免除以0\r\n\r\n\t\treturn value => {\r\n\t\t\treturn (\r\n\t\t\t\tprops.height -\r\n\t\t\t\t10 -\r\n\t\t\t\t((value - minValue) / valueRange) * (props.height - 20)\r\n\t\t\t);\r\n\t\t};\r\n\t});\r\n\r\n\t// 计算数据点坐标\r\n\tconst points = computed(() => {\r\n\t\treturn dataPoints.value.map((item, index) => ({\r\n\t\t\tx: xScale.value(item.year),\r\n\t\t\ty: yScale.value(item.value),\r\n\t\t\toriginalData: item\r\n\t\t}));\r\n\t});\r\n\r\n\t// 生成折线路径\r\n\tconst linePath = computed(() => {\r\n\t\tif (points.value.length < 2) return \"\";\r\n\r\n\t\tlet path = `M${points.value[0].x},${points.value[0].y}`;\r\n\r\n\t\t// 使用平滑的贝塞尔曲线\r\n\t\tfor (let i = 1; i < points.value.length; i++) {\r\n\t\t\tconst prev = points.value[i - 1];\r\n\t\t\tconst curr = points.value[i];\r\n\t\t\tconst controlX = (prev.x + curr.x) / 2;\r\n\r\n\t\t\tpath += ` C${controlX},${prev.y} ${controlX},${curr.y} ${curr.x},${curr.y}`;\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t});\r\n\r\n\t// 工具提示相关函数\r\n\tconst showTooltip = (event, point) => {\r\n\t\tif (!props.showTooltip) return;\r\n\r\n\t\tconst svgRect = event.target.closest(\"svg\").getBoundingClientRect();\r\n\t\tconst mouseX = event.clientX - svgRect.left;\r\n\t\tconst mouseY = event.clientY - svgRect.top;\r\n\r\n\t\t// 找到最近的数据点\r\n\t\tlet closestIndex = 0;\r\n\t\tlet minDistance = Infinity;\r\n\r\n\t\tpoints.value.forEach((p, index) => {\r\n\t\t\tconst distance = Math.abs(p.x - mouseX);\r\n\t\t\tif (distance < minDistance) {\r\n\t\t\t\tminDistance = distance;\r\n\t\t\t\tclosestIndex = index;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\thoverIndex.value = closestIndex;\r\n\r\n\t\t// 定位工具提示\r\n\t\ttooltipX.value = Math.min(\r\n\t\t\tpoints.value[closestIndex].x - 60,\r\n\t\t\tprops.width - 120\r\n\t\t);\r\n\t\ttooltipY.value = points.value[closestIndex].y - 70;\r\n\r\n\t\tshowTooltipFlag.value = true;\r\n\t};\r\n\r\n\tconst hideTooltip = () => {\r\n\t\tshowTooltipFlag.value = false;\r\n\t\thoverIndex.value = null;\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.sparkline-container {\r\n\t\tfont-family: system-ui, -apple-system, sans-serif;\r\n\t}\r\n\r\n\t.tooltip-container {\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.tooltip {\r\n\t\tbackground: white;\r\n\t\tborder: 1px solid #e2e8f0;\r\n\t\tborder-radius: 4px;\r\n\t\tpadding: 8px;\r\n\t\tbox-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n\t\tfont-size: 12px;\r\n\t}\r\n\r\n\t.tooltip-year {\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #334155;\r\n\t\tmargin-bottom: 4px;\r\n\t}\r\n\r\n\t.tooltip-value {\r\n\t\tcolor: #1e40af;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.tooltip-name {\r\n\t\tcolor: #64748b;\r\n\t\tmargin-top: 4px;\r\n\t\tfont-size: 11px;\r\n\t}\r\n</style>\r\n"],"mappings":";;mBAAA;gEAGEA,mBAAA,CAAkD;EAA5CC,KAAK,EAAC,MAAM;EAACC,MAAM,EAAC,MAAM;EAACC,IAAI,EAAC;;mBAHxC;mBAAA;mBAAA;mBAAA;;EAsCQC,KAAK,EAAC;AAAS;;EACdA,KAAK,EAAC;AAAc;;EACpBA,KAAK,EAAC;AAAe;;EAxC9BC,GAAA;EA2CkDD,KAAK,EAAC;;;uBA1CvDE,mBAAA,CA+CM;IA/CAL,KAAK,EAAEM,MAAA,CAAAN,KAAK;IAAGC,MAAM,EAAEK,MAAA,CAAAL,MAAM;IAAEE,KAAK,EAAC;MAC1CI,mBAAA,UAAa,EACbC,UAAkD,EAElDD,mBAAA,UAAa,EACbR,mBAAA,CAAoE;IAA7DU,CAAC,EAAEC,MAAA,CAAAC,QAAQ;IAAEC,MAAM,EAAC,SAAS;IAAC,cAAY,EAAC,GAAG;IAACV,IAAI,EAAC;0BAN7DW,UAAA,GAQEN,mBAAA,SAAY,G,kBACZF,mBAAA,CAQ2BS,SAAA,QAjB7BC,WAAA,CAU4BL,MAAA,CAAAM,MAAM,EAVlC,CAUWC,KAAK,EAAEC,KAAK;yBADrBb,mBAAA,CAQ2B;MANzBD,GAAG,EAAEc,KAAK;MACVC,EAAE,EAAEF,KAAK,CAACG,CAAC;MACXC,EAAE,EAAEJ,KAAK,CAACK,CAAC;MACZC,CAAC,EAAC,GAAG;MACLrB,IAAI,EAAC,SAAS;MACbsB,WAAS,EAAAC,MAAA,IAAEf,MAAA,CAAAgB,WAAW,CAACD,MAAM,EAAER,KAAK;MACpCU,UAAQ,EAAEjB,MAAA,CAAAkB;6CAjBdC,UAAA;kCAmBEtB,mBAAA,eAAkB,EAEXG,MAAA,CAAAoB,UAAU,a,cADjBzB,mBAAA,CAQ0B;IA5B5BD,GAAA;IAsBI2B,EAAE,EAAErB,MAAA,CAAAM,MAAM,CAACN,MAAA,CAAAoB,UAAU,EAAEV,CAAC;IACxBY,EAAE,EAAEtB,MAAA,CAAAM,MAAM,CAACN,MAAA,CAAAoB,UAAU,EAAEV,CAAC;IACzBa,EAAE,EAAC,GAAG;IACLC,EAAE,EAAE5B,MAAA,CAAAL,MAAM;IACXW,MAAM,EAAC,SAAS;IAChB,cAAY,EAAC,GAAG;IAChB,kBAAgB,EAAC;0BA5BpBuB,UAAA,KAAA5B,mBAAA,gBA8BEA,mBAAA,UAAa,EAENG,MAAA,CAAAoB,UAAU,aAAapB,MAAA,CAAA0B,eAAe,I,cAD7C/B,mBAAA,CAgBgB;IA/ClBD,GAAA;IAiCIgB,CAAC,EAAEV,MAAA,CAAA2B,QAAQ;IACXf,CAAC,EAAEZ,MAAA,CAAA4B,QAAQ;IACZtC,KAAK,EAAC,KAAK;IACXC,MAAM,EAAC,IAAI;IACXE,KAAK,EAAC;MACNJ,mBAAA,CAQM,OARNwC,UAQM,GAPLxC,mBAAA,CAA4D,OAA5DyC,UAA4D,EAAAC,gBAAA,CAA/B/B,MAAA,CAAAgC,UAAU,CAAChC,MAAA,CAAAoB,UAAU,mBAClD/B,mBAAA,CAEM,OAFN4C,UAEM,EAAAF,gBAAA,CADF/B,MAAA,CAAAkC,cAAc,CAAClC,MAAA,CAAAmC,UAAU,CAACnC,MAAA,CAAAoB,UAAU,EAAEgB,KAAK,mBAEpCpC,MAAA,CAAAmC,UAAU,CAACnC,MAAA,CAAAoB,UAAU,EAAEiB,UAAU,I,cAA5C1C,mBAAA,CAEM,OAFN2C,WAEM,EAAAP,gBAAA,CADF/B,MAAA,CAAAmC,UAAU,CAACnC,MAAA,CAAAoB,UAAU,EAAEiB,UAAU,oBA5CzCxC,mBAAA,e,mBAAA0C,UAAA,KAAA1C,mBAAA,e,iBAAA2C,UAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}