{"ast":null,"code":"import { ref, computed, onMounted, watch } from \"vue\";\nimport * as d3 from \"d3\";\nconst remainderColor = \"#f0f0f0\";\nexport default {\n  __name: 'PieChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => [],\n      validator: value => value.every(item => \"name\" in item && \"value\" in item)\n    },\n    showRemainder: {\n      type: Boolean,\n      default: true\n    }\n  },\n  emits: [\"itemClick\"],\n  setup(__props, _ref) {\n    let {\n      expose: __expose,\n      emit: __emit\n    } = _ref;\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const chartContainer = ref(null);\n    const colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\n    const hasValidData = computed(() => props.data.length > 0);\n    onMounted(() => {\n      if (chartContainer.value) {\n        initChart();\n      }\n    });\n    watch(() => props.data, () => {\n      if (chartContainer.value) {\n        initChart();\n      }\n    }, {\n      deep: true\n    });\n    const initChart = () => {\n      const width = chartContainer.value.clientWidth;\n      const height = chartContainer.value.clientHeight;\n      const radius = Math.min(width, height) / 2;\n      d3.select(chartContainer.value).select(\"svg\").remove();\n      const svg = d3.select(chartContainer.value).append(\"svg\").attr(\"width\", width).attr(\"height\", height).append(\"g\").attr(\"transform\", `translate(${width / 2},${height / 2})`);\n      const pie = d3.pie().value(d => d.value).sort(null);\n      const arc = d3.arc().innerRadius(0).outerRadius(radius);\n      const processedData = computed(() => {\n        const total = d3.sum(props.data, d => d.value);\n        const remainder = props.showRemainder ? 1 - d3.sum(props.data, d => d.value / total) : 0;\n        return [...props.data, {\n          name: \"其他\",\n          value: remainder * total\n        }];\n      });\n      const path = svg.selectAll(\"path\").data(pie(processedData.value)).enter().append(\"path\").attr(\"fill\", (d, i) => i < colors.length ? colors[i] : remainderColor).attr(\"d\", arc).on(\"mouseover\", (event, d) => {\n        showTooltip(event, d.data.name, d.data.value);\n      }).on(\"mouseout\", () => {\n        hideTooltip();\n      }).on(\"click\", (event, d) => {\n        emit(\"itemClick\", d.data);\n      });\n      const legendWidth = 120;\n      const legendGroup = svg.append(\"g\").attr(\"class\", \"legend\").attr(\"transform\", `translate(${width / 2 - radius - legendWidth - 20},${-height / 2 + radius})`);\n      const legendItem = legendGroup.selectAll(\".legend-item\").data(processedData.value).enter().append(\"g\").attr(\"class\", \"legend-item\").attr(\"transform\", (d, i) => `translate(0, ${i * 24})`).on(\"click\", (event, d) => {\n        emit(\"itemClick\", d);\n      });\n      legendItem.append(\"rect\").attr(\"width\", 14).attr(\"height\", 14).attr(\"rx\", 3).attr(\"ry\", 3).attr(\"fill\", (d, i) => i < colors.length ? colors[i] : remainderColor);\n      legendItem.append(\"text\").attr(\"x\", 18).attr(\"y\", 12).text(d => d.name);\n      const tooltip = d3.select(chartContainer.value).append(\"div\").attr(\"class\", \"chart-tooltip\").style(\"opacity\", 0);\n      const showTooltip = (event, name, value) => {\n        tooltip.html(`\n      <div class=\"tooltip-title\">${name}</div>\n      <div class=\"tooltip-value\">${value}</div>\n    `).style(\"left\", `${event.pageX + 10}px`).style(\"top\", `${event.pageY + 10}px`).style(\"opacity\", 1);\n      };\n      const hideTooltip = () => {\n        tooltip.style(\"opacity\", 0);\n      };\n    };\n    const __returned__ = {\n      props,\n      emit,\n      chartContainer,\n      colors,\n      remainderColor,\n      hasValidData,\n      initChart,\n      ref,\n      computed,\n      onMounted,\n      watch,\n      get d3() {\n        return d3;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","watch","d3","remainderColor","props","__props","emit","__emit","chartContainer","colors","hasValidData","data","length","value","initChart","deep","width","clientWidth","height","clientHeight","radius","Math","min","select","remove","svg","append","attr","pie","d","sort","arc","innerRadius","outerRadius","processedData","total","sum","remainder","showRemainder","name","path","selectAll","enter","i","on","event","showTooltip","hideTooltip","legendWidth","legendGroup","legendItem","text","tooltip","style","html","pageX","pageY"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"pie-chart-container\">\r\n\t\t<div v-if=\"!hasValidData\" class=\"no-data\">无数据</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, computed, onMounted, watch } from \"vue\";\r\n\timport * as d3 from \"d3\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [],\r\n\t\t\tvalidator: value => value.every(item => \"name\" in item && \"value\" in item)\r\n\t\t},\r\n\t\tshowRemainder: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t}\r\n\t});\r\n\r\n\tconst emit = defineEmits([\"itemClick\"]);\r\n\r\n\tconst chartContainer = ref(null);\r\n\tconst colors = [\"#3498db\", \"#e74c3c\", \"#2ecc71\", \"#f39c12\", \"#9b59b6\"];\r\n\tconst remainderColor = \"#f0f0f0\";\r\n\r\n\tconst hasValidData = computed(() => props.data.length > 0);\r\n\r\n\tonMounted(() => {\r\n\t\tif (chartContainer.value) {\r\n\t\t\tinitChart();\r\n\t\t}\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => props.data,\r\n\t\t() => {\r\n\t\t\tif (chartContainer.value) {\r\n\t\t\t\tinitChart();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{ deep: true }\r\n\t);\r\n\r\n\tconst initChart = () => {\r\n\t\tconst width = chartContainer.value.clientWidth;\r\n\t\tconst height = chartContainer.value.clientHeight;\r\n\t\tconst radius = Math.min(width, height) / 2;\r\n\r\n\t\td3.select(chartContainer.value).select(\"svg\").remove();\r\n\r\n\t\tconst svg = d3\r\n\t\t\t.select(chartContainer.value)\r\n\t\t\t.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", `translate(${width / 2},${height / 2})`);\r\n\r\n\t\tconst pie = d3\r\n\t\t\t.pie()\r\n\t\t\t.value(d => d.value)\r\n\t\t\t.sort(null);\r\n\r\n\t\tconst arc = d3.arc().innerRadius(0).outerRadius(radius);\r\n\r\n\t\tconst processedData = computed(() => {\r\n\t\t\tconst total = d3.sum(props.data, d => d.value);\r\n\t\t\tconst remainder = props.showRemainder\r\n\t\t\t\t? 1 - d3.sum(props.data, d => d.value / total)\r\n\t\t\t\t: 0;\r\n\t\t\treturn [...props.data, { name: \"其他\", value: remainder * total }];\r\n\t\t});\r\n\r\n\t\tconst path = svg\r\n\t\t\t.selectAll(\"path\")\r\n\t\t\t.data(pie(processedData.value))\r\n\t\t\t.enter()\r\n\t\t\t.append(\"path\")\r\n\t\t\t.attr(\"fill\", (d, i) => (i < colors.length ? colors[i] : remainderColor))\r\n\t\t\t.attr(\"d\", arc)\r\n\t\t\t.on(\"mouseover\", (event, d) => {\r\n\t\t\t\tshowTooltip(event, d.data.name, d.data.value);\r\n\t\t\t})\r\n\t\t\t.on(\"mouseout\", () => {\r\n\t\t\t\thideTooltip();\r\n\t\t\t})\r\n\t\t\t.on(\"click\", (event, d) => {\r\n\t\t\t\temit(\"itemClick\", d.data);\r\n\t\t\t});\r\n\r\n\t\tconst legendWidth = 120;\r\n\t\tconst legendGroup = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"legend\")\r\n\t\t\t.attr(\r\n\t\t\t\t\"transform\",\r\n\t\t\t\t`translate(${width / 2 - radius - legendWidth - 20},${\r\n\t\t\t\t\t-height / 2 + radius\r\n\t\t\t\t})`\r\n\t\t\t);\r\n\r\n\t\tconst legendItem = legendGroup\r\n\t\t\t.selectAll(\".legend-item\")\r\n\t\t\t.data(processedData.value)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", \"legend-item\")\r\n\t\t\t.attr(\"transform\", (d, i) => `translate(0, ${i * 24})`)\r\n\t\t\t.on(\"click\", (event, d) => {\r\n\t\t\t\temit(\"itemClick\", d);\r\n\t\t\t});\r\n\r\n\t\tlegendItem\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"width\", 14)\r\n\t\t\t.attr(\"height\", 14)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3)\r\n\t\t\t.attr(\"fill\", (d, i) => (i < colors.length ? colors[i] : remainderColor));\r\n\r\n\t\tlegendItem\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"x\", 18)\r\n\t\t\t.attr(\"y\", 12)\r\n\t\t\t.text(d => d.name);\r\n\r\n\t\tconst tooltip = d3\r\n\t\t\t.select(chartContainer.value)\r\n\t\t\t.append(\"div\")\r\n\t\t\t.attr(\"class\", \"chart-tooltip\")\r\n\t\t\t.style(\"opacity\", 0);\r\n\r\n\t\tconst showTooltip = (event, name, value) => {\r\n\t\t\ttooltip\r\n\t\t\t\t.html(\r\n\t\t\t\t\t`\r\n      <div class=\"tooltip-title\">${name}</div>\r\n      <div class=\"tooltip-value\">${value}</div>\r\n    `\r\n\t\t\t\t)\r\n\t\t\t\t.style(\"left\", `${event.pageX + 10}px`)\r\n\t\t\t\t.style(\"top\", `${event.pageY + 10}px`)\r\n\t\t\t\t.style(\"opacity\", 1);\r\n\t\t};\r\n\r\n\t\tconst hideTooltip = () => {\r\n\t\t\ttooltip.style(\"opacity\", 0);\r\n\t\t};\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.pie-chart-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.no-data {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tfont-size: 16px;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.legend-item:hover {\r\n\t\topacity: 0.8;\r\n\t}\r\n\r\n\t.legend-item text {\r\n\t\tfont-size: 12px;\r\n\t\tfill: #333;\r\n\t}\r\n\r\n\t.legend-item rect {\r\n\t\twidth: 14px;\r\n\t\theight: 14px;\r\n\t\trx: 3;\r\n\t\try: 3;\r\n\t\tfill: #3498db;\r\n\t\topacity: 0.8;\r\n\t}\r\n\r\n\t.legend-item + .legend-item {\r\n\t\tmargin-top: 8px;\r\n\t}\r\n\r\n\t.chart-tooltip {\r\n\t\tposition: absolute;\r\n\t\tpadding: 10px 12px;\r\n\t\tbackground: rgba(0, 0, 0, 0.85);\r\n\t\tcolor: white;\r\n\t\tborder-radius: 8px;\r\n\t\tfont-size: 13px;\r\n\t\tfont-family: Arial, sans-serif;\r\n\t\tpointer-events: none;\r\n\t\tz-index: 10;\r\n\t\ttransition: all 0.2s;\r\n\t\tbox-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n\t\tmax-width: 200px;\r\n\t\tline-height: 1.5;\r\n\t\topacity: 0;\r\n\t}\r\n\r\n\t.tooltip-title {\r\n\t\tfont-weight: 600;\r\n\t\tmargin-bottom: 4px;\r\n\t\tcolor: #fff;\r\n\t}\r\n\r\n\t.tooltip-value {\r\n\t\tfont-weight: 500;\r\n\t\tcolor: #f0f0f0;\r\n\t}\r\n\r\n\t:deep(.legend-item text) {\r\n\t\tfont-family: Arial, sans-serif;\r\n\t\tuser-select: none;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}