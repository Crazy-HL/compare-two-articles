{"ast":null,"code":"import { ref, onMounted, onUnmounted, nextTick } from \"vue\";\nimport { useChartRenderer } from \"@/composables/useChartRenderer\";\nexport default {\n  setup() {\n    // 状态管理\n    const initialized = ref(false);\n    const userInput = ref(\"\");\n    const chatHistory = ref([]);\n    const sourceTexts = ref({\n      text1: \"\",\n      text2: \"\"\n    });\n    const commonAttributes = ref([]);\n    const activeAttributeIndex = ref(-1);\n    const chartRefs = ref({\n      chart1: [],\n      chart2: []\n    });\n\n    // 组合式函数\n    const {\n      renderChart\n    } = useChartRenderer();\n\n    // 计算属性\n    const emptyTableMessage = computed(() => {\n      if (!sourceTexts.value.text1 && !sourceTexts.value.text2) return \"请选择两篇文章\";\n      if (!sourceTexts.value.text1) return \"请选择文章1\";\n      if (!sourceTexts.value.text2) return \"请选择文章2\";\n      return \"没有公共属性\";\n    });\n    const isCompareReady = computed(() => sourceTexts.value.text1 && sourceTexts.value.text2);\n\n    // 方法\n    const setChartRef = (el, index, type) => {\n      if (el) {\n        chartRefs.value[type][index] = el;\n      }\n    };\n    const selectAttribute = index => {\n      if (index < 0 || index >= commonAttributes.value.length) return;\n      activeAttributeIndex.value = index;\n      renderSelectedCharts();\n    };\n    const renderSelectedCharts = () => {\n      const index = activeAttributeIndex.value;\n      if (index === -1) return;\n      const attr = commonAttributes.value[index];\n      if (!attr) return;\n      const chartData1 = articleData.value?.article1?.[attr];\n      const chartData2 = articleData.value?.article2?.[attr];\n      if (chartData1 && chartRefs.value.chart1[index]) {\n        renderChart(chartRefs.value.chart1[index], chartData1);\n      }\n      if (chartData2 && chartRefs.value.chart2[index]) {\n        renderChart(chartRefs.value.chart2[index], chartData2);\n      }\n    };\n    const compareAttributes = async () => {\n      if (!isCompareReady.value) return;\n      try {\n        const response = await api.post(\"/compare\", {\n          texts: sourceTexts.value\n        });\n        if (response.success) {\n          commonAttributes.value = response.data.attributes || [];\n          articleData.value = response.data.chartData;\n          activeAttributeIndex.value = -1;\n          nextTick(() => {\n            if (commonAttributes.value.length > 0) {\n              selectAttribute(0);\n            }\n          });\n        }\n      } catch (error) {\n        console.error(\"对比失败:\", error);\n      }\n    };\n\n    // 生命周期\n    onMounted(() => {\n      initialized.value = true;\n      setupEventListeners();\n    });\n    onUnmounted(() => {\n      cleanupEventListeners();\n    });\n    return {\n      initialized,\n      userInput,\n      chatHistory,\n      commonAttributes,\n      emptyTableMessage,\n      isCompareReady,\n      setChartRef,\n      selectAttribute,\n      compareAttributes\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","nextTick","useChartRenderer","setup","initialized","userInput","chatHistory","sourceTexts","text1","text2","commonAttributes","activeAttributeIndex","chartRefs","chart1","chart2","renderChart","emptyTableMessage","computed","value","isCompareReady","setChartRef","el","index","type","selectAttribute","length","renderSelectedCharts","attr","chartData1","articleData","article1","chartData2","article2","compareAttributes","response","api","post","texts","success","data","attributes","chartData","error","console","setupEventListeners","cleanupEventListeners"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\Div2.vue"],"sourcesContent":["<template>\r\n\t<div class=\"main-container\">\r\n\t\t<!-- 聊天容器 -->\r\n\t\t<div class=\"chat-container\" @dragover.prevent @drop.prevent=\"handleDrop\">\r\n\t\t\t<div class=\"chat-history\">\r\n\t\t\t\t<template v-for=\"(message, index) in chatHistory\" :key=\"index\">\r\n\t\t\t\t\t<div v-if=\"message?.content\" :class=\"['message', message.role]\">\r\n\t\t\t\t\t\t<div class=\"message-content\">\r\n\t\t\t\t\t\t\t<strong>{{ message.role === \"user\" ? \"用户\" : \"GPT\" }}:</strong>\r\n\t\t\t\t\t\t\t<p v-html=\"message.content\"></p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 视觉内容容器 -->\r\n\t\t<div class=\"vis-container\">\r\n\t\t\t<!-- 三列对比表格 -->\r\n\t\t\t<div class=\"comparison-table\" v-if=\"initialized\">\r\n\t\t\t\t<div class=\"table-header\">\r\n\t\t\t\t\t<div class=\"header-cell\">文章1可视化</div>\r\n\t\t\t\t\t<div class=\"header-cell\">公共属性</div>\r\n\t\t\t\t\t<div class=\"header-cell\">文章2可视化</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"table-body\">\r\n\t\t\t\t\t<template v-if=\"commonAttributes.length > 0\">\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tv-for=\"(attr, index) in commonAttributes\"\r\n\t\t\t\t\t\t\t:key=\"attr\"\r\n\t\t\t\t\t\t\tclass=\"table-row\">\r\n\t\t\t\t\t\t\t<div class=\"table-cell chart-cell\">\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t:ref=\"el => setChartRef(el, index, 'chart1')\"\r\n\t\t\t\t\t\t\t\t\tclass=\"chart-box\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\"table-cell attr-cell\" @click=\"selectAttribute(index)\">\r\n\t\t\t\t\t\t\t\t{{ attr }}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div class=\"table-cell chart-cell\">\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t:ref=\"el => setChartRef(el, index, 'chart2')\"\r\n\t\t\t\t\t\t\t\t\tclass=\"chart-box\"></div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</template>\r\n\r\n\t\t\t\t\t<div v-else class=\"empty-table\">\r\n\t\t\t\t\t\t{{ emptyTableMessage }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<!-- 输入区域 -->\r\n\t\t\t<div class=\"input-area\">\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tv-model=\"userInput\"\r\n\t\t\t\t\tplaceholder=\"请输入问题...\"\r\n\t\t\t\t\trows=\"3\"></textarea>\r\n\t\t\t\t<div class=\"action-buttons\">\r\n\t\t\t\t\t<button @click=\"submitQuestion\">发送</button>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\t@click=\"compareAttributes\"\r\n\t\t\t\t\t\t:disabled=\"!isCompareReady\"\r\n\t\t\t\t\t\tclass=\"compare-btn\">\r\n\t\t\t\t\t\t对比属性\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport { ref, onMounted, onUnmounted, nextTick } from \"vue\";\r\n\timport { useChartRenderer } from \"@/composables/useChartRenderer\";\r\n\r\n\texport default {\r\n\t\tsetup() {\r\n\t\t\t// 状态管理\r\n\t\t\tconst initialized = ref(false);\r\n\t\t\tconst userInput = ref(\"\");\r\n\t\t\tconst chatHistory = ref([]);\r\n\t\t\tconst sourceTexts = ref({ text1: \"\", text2: \"\" });\r\n\t\t\tconst commonAttributes = ref([]);\r\n\t\t\tconst activeAttributeIndex = ref(-1);\r\n\t\t\tconst chartRefs = ref({ chart1: [], chart2: [] });\r\n\r\n\t\t\t// 组合式函数\r\n\t\t\tconst { renderChart } = useChartRenderer();\r\n\r\n\t\t\t// 计算属性\r\n\t\t\tconst emptyTableMessage = computed(() => {\r\n\t\t\t\tif (!sourceTexts.value.text1 && !sourceTexts.value.text2)\r\n\t\t\t\t\treturn \"请选择两篇文章\";\r\n\t\t\t\tif (!sourceTexts.value.text1) return \"请选择文章1\";\r\n\t\t\t\tif (!sourceTexts.value.text2) return \"请选择文章2\";\r\n\t\t\t\treturn \"没有公共属性\";\r\n\t\t\t});\r\n\r\n\t\t\tconst isCompareReady = computed(\r\n\t\t\t\t() => sourceTexts.value.text1 && sourceTexts.value.text2\r\n\t\t\t);\r\n\r\n\t\t\t// 方法\r\n\t\t\tconst setChartRef = (el, index, type) => {\r\n\t\t\t\tif (el) {\r\n\t\t\t\t\tchartRefs.value[type][index] = el;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst selectAttribute = index => {\r\n\t\t\t\tif (index < 0 || index >= commonAttributes.value.length) return;\r\n\t\t\t\tactiveAttributeIndex.value = index;\r\n\t\t\t\trenderSelectedCharts();\r\n\t\t\t};\r\n\r\n\t\t\tconst renderSelectedCharts = () => {\r\n\t\t\t\tconst index = activeAttributeIndex.value;\r\n\t\t\t\tif (index === -1) return;\r\n\r\n\t\t\t\tconst attr = commonAttributes.value[index];\r\n\t\t\t\tif (!attr) return;\r\n\r\n\t\t\t\tconst chartData1 = articleData.value?.article1?.[attr];\r\n\t\t\t\tconst chartData2 = articleData.value?.article2?.[attr];\r\n\r\n\t\t\t\tif (chartData1 && chartRefs.value.chart1[index]) {\r\n\t\t\t\t\trenderChart(chartRefs.value.chart1[index], chartData1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (chartData2 && chartRefs.value.chart2[index]) {\r\n\t\t\t\t\trenderChart(chartRefs.value.chart2[index], chartData2);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst compareAttributes = async () => {\r\n\t\t\t\tif (!isCompareReady.value) return;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst response = await api.post(\"/compare\", {\r\n\t\t\t\t\t\ttexts: sourceTexts.value\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (response.success) {\r\n\t\t\t\t\t\tcommonAttributes.value = response.data.attributes || [];\r\n\t\t\t\t\t\tarticleData.value = response.data.chartData;\r\n\t\t\t\t\t\tactiveAttributeIndex.value = -1;\r\n\r\n\t\t\t\t\t\tnextTick(() => {\r\n\t\t\t\t\t\t\tif (commonAttributes.value.length > 0) {\r\n\t\t\t\t\t\t\t\tselectAttribute(0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"对比失败:\", error);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// 生命周期\r\n\t\t\tonMounted(() => {\r\n\t\t\t\tinitialized.value = true;\r\n\t\t\t\tsetupEventListeners();\r\n\t\t\t});\r\n\r\n\t\t\tonUnmounted(() => {\r\n\t\t\t\tcleanupEventListeners();\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tinitialized,\r\n\t\t\t\tuserInput,\r\n\t\t\t\tchatHistory,\r\n\t\t\t\tcommonAttributes,\r\n\t\t\t\temptyTableMessage,\r\n\t\t\t\tisCompareReady,\r\n\t\t\t\tsetChartRef,\r\n\t\t\t\tselectAttribute,\r\n\t\t\t\tcompareAttributes\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.main-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tpadding: 16px;\r\n\t\tgap: 16px;\r\n\t}\r\n\r\n\t.chat-container {\r\n\t\tflex: 1;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 8px;\r\n\t\tpadding: 16px;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.chat-history {\r\n\t\tflex: 1;\r\n\t\toverflow-y: auto;\r\n\t\tpadding: 8px;\r\n\t}\r\n\r\n\t.vis-container {\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 16px;\r\n\t}\r\n\r\n\t.comparison-table {\r\n\t\tflex: 1;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t\tborder-radius: 8px;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.table-header {\r\n\t\tdisplay: flex;\r\n\t\tbackground: #f5f5f5;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.header-cell {\r\n\t\tflex: 1;\r\n\t\tpadding: 12px;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.table-body {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.table-row {\r\n\t\tdisplay: flex;\r\n\t\tmin-height: 120px;\r\n\t\tborder-top: 1px solid #e0e0e0;\r\n\t}\r\n\r\n\t.table-cell {\r\n\t\tflex: 1;\r\n\t\tpadding: 12px;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.chart-box {\r\n\t\twidth: 100%;\r\n\t\theight: 100px;\r\n\t\tbackground: #f9f9f9;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.attr-cell {\r\n\t\tcursor: pointer;\r\n\t\ttransition: background 0.2s;\r\n\t}\r\n\r\n\t.attr-cell:hover {\r\n\t\tbackground: #e3f2fd;\r\n\t}\r\n\r\n\t.empty-table {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\theight: 100px;\r\n\t\tcolor: #757575;\r\n\t}\r\n\r\n\t.input-area {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 12px;\r\n\t}\r\n\r\n\ttextarea {\r\n\t\twidth: 100%;\r\n\t\tpadding: 12px;\r\n\t\tborder: 1px solid #e0e0e0;\r\n\t\tborder-radius: 4px;\r\n\t\tresize: none;\r\n\t}\r\n\r\n\t.action-buttons {\r\n\t\tdisplay: flex;\r\n\t\tgap: 12px;\r\n\t}\r\n\r\n\tbutton {\r\n\t\tflex: 1;\r\n\t\tpadding: 12px;\r\n\t\tborder: none;\r\n\t\tborder-radius: 4px;\r\n\t\tbackground: #1976d2;\r\n\t\tcolor: white;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\tbutton:disabled {\r\n\t\tbackground: #e0e0e0;\r\n\t\tcursor: not-allowed;\r\n\t}\r\n\r\n\t.compare-btn {\r\n\t\tbackground: #388e3c;\r\n\t}\r\n\r\n\t.message {\r\n\t\tmargin-bottom: 16px;\r\n\t}\r\n\r\n\t.message-content {\r\n\t\tpadding: 12px;\r\n\t\tborder-radius: 8px;\r\n\t\tbackground: #f5f5f5;\r\n\t}\r\n\r\n\t.message.user .message-content {\r\n\t\tbackground: #bbdefb;\r\n\t\ttext-align: right;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}