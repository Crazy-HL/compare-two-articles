{"ast":null,"code":"import { ref, onMounted, watch, computed } from \"vue\";\nimport * as echarts from \"echarts\";\nexport default {\n  __name: 'PieChart',\n  props: {\n    data: {\n      type: Array,\n      default: () => [],\n      validator: data => {\n        return data.every(item => {\n          // 支持两种格式：\n          // 1. { name: \"Agriculture\", value: 22.8, year: \"2023\" }\n          // 2. \"Agriculture: 22.8% (2023)\"\n          return item.name && !isNaN(item.value) || typeof item === \"string\" && item.includes(\":\");\n        });\n      }\n    },\n    title: String\n  },\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const props = __props;\n    const chartEl = ref(null);\n    let chartInstance = null;\n\n    // 标准化数据格式\n    const normalizedData = computed(() => {\n      return props.data.map(item => {\n        // 处理字符串格式 \"Label: 22.8% (2023)\"\n        if (typeof item === \"string\") {\n          const match = item.match(/(.*?):\\s*([\\d.]+)%?\\s*(?:\\((\\d{4})\\))?/);\n          if (match) {\n            return {\n              name: match[1].trim(),\n              value: parseFloat(match[2]),\n              year: match[3] || \"\"\n            };\n          }\n          return {\n            name: item,\n            value: 0\n          };\n        }\n        // 处理对象格式\n        return {\n          name: item.name,\n          value: parseFloat(item.value),\n          year: item.year || \"\"\n        };\n      }).filter(item => !isNaN(item.value));\n    });\n\n    // 计算比例（确保总和为100%）\n    const proportionalData = computed(() => {\n      const total = normalizedData.value.reduce((sum, item) => sum + Math.abs(item.value), 0);\n      return normalizedData.value.map(item => ({\n        ...item,\n        displayValue: total > 0 ? item.value / total * 100 : 0\n      }));\n    });\n    const initChart = () => {\n      if (!chartEl.value || proportionalData.value.length === 0) return;\n      chartInstance = echarts.init(chartEl.value);\n      const option = {\n        title: {\n          text: props.title,\n          left: \"center\",\n          top: 10,\n          textStyle: {\n            fontSize: 16,\n            fontWeight: \"bold\"\n          }\n        },\n        tooltip: {\n          trigger: \"item\",\n          formatter: params => {\n            const data = proportionalData.value[params.dataIndex];\n            return `\n\t          <div style=\"font-weight:bold\">${data.name}</div>\n\t          <div>比例: ${params.percent}%</div>\n\t          ${data.year ? `<div>年份: ${data.year}</div>` : \"\"}\n\t          <div>原始值: ${data.value}%</div>\n\t        `;\n          }\n        },\n        legend: {\n          orient: \"vertical\",\n          right: 10,\n          top: \"center\",\n          formatter: name => {\n            const item = proportionalData.value.find(d => d.name === name);\n            return `${name}: ${item?.value}%`;\n          }\n        },\n        series: [{\n          type: \"pie\",\n          radius: [\"40%\", \"70%\"],\n          center: [\"50%\", \"55%\"],\n          data: proportionalData.value.map((item, index) => ({\n            name: item.name,\n            value: item.displayValue,\n            itemStyle: {\n              color: [\"#5470c6\", \"#91cc75\", \"#fac858\", \"#ee6666\", \"#73c0de\", \"#3ba272\", \"#9a60b4\", \"#ea7ccc\"][index % 8]\n            },\n            label: {\n              formatter: `{b}: {d}%`\n            }\n          })),\n          emphasis: {\n            itemStyle: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: \"rgba(0, 0, 0, 0.5)\"\n            }\n          }\n        }]\n      };\n      chartInstance.setOption(option);\n    };\n    onMounted(() => {\n      initChart();\n      window.addEventListener(\"resize\", () => chartInstance?.resize());\n    });\n    watch(() => [props.data, props.title], initChart, {\n      deep: true\n    });\n    const __returned__ = {\n      props,\n      chartEl,\n      get chartInstance() {\n        return chartInstance;\n      },\n      set chartInstance(v) {\n        chartInstance = v;\n      },\n      normalizedData,\n      proportionalData,\n      initChart,\n      ref,\n      onMounted,\n      watch,\n      computed,\n      get echarts() {\n        return echarts;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","watch","computed","echarts","props","__props","chartEl","chartInstance","normalizedData","data","map","item","match","name","trim","value","parseFloat","year","filter","isNaN","proportionalData","total","reduce","sum","Math","abs","displayValue","initChart","length","init","option","title","text","left","top","textStyle","fontSize","fontWeight","tooltip","trigger","formatter","params","dataIndex","percent","legend","orient","right","find","d","series","type","radius","center","index","itemStyle","color","label","emphasis","shadowBlur","shadowOffsetX","shadowColor","setOption","window","addEventListener","resize","deep"],"sources":["D:/vue_frame/vue_frame/wikitable-vue/client/src/components/compoents_base/charts/PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartEl\" class=\"fixed-pie-chart\"></div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, watch, computed } from \"vue\";\r\n\timport * as echarts from \"echarts\";\r\n\r\n\tconst props = defineProps({\r\n\t\tdata: {\r\n\t\t\ttype: Array,\r\n\t\t\tdefault: () => [],\r\n\t\t\tvalidator: data => {\r\n\t\t\t\treturn data.every(item => {\r\n\t\t\t\t\t// 支持两种格式：\r\n\t\t\t\t\t// 1. { name: \"Agriculture\", value: 22.8, year: \"2023\" }\r\n\t\t\t\t\t// 2. \"Agriculture: 22.8% (2023)\"\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t(item.name && !isNaN(item.value)) ||\r\n\t\t\t\t\t\t(typeof item === \"string\" && item.includes(\":\"))\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\ttitle: String\r\n\t});\r\n\r\n\tconst chartEl = ref(null);\r\n\tlet chartInstance = null;\r\n\r\n\t// 标准化数据格式\r\n\tconst normalizedData = computed(() => {\r\n\t\treturn props.data\r\n\t\t\t.map(item => {\r\n\t\t\t\t// 处理字符串格式 \"Label: 22.8% (2023)\"\r\n\t\t\t\tif (typeof item === \"string\") {\r\n\t\t\t\t\tconst match = item.match(/(.*?):\\s*([\\d.]+)%?\\s*(?:\\((\\d{4})\\))?/);\r\n\t\t\t\t\tif (match) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tname: match[1].trim(),\r\n\t\t\t\t\t\t\tvalue: parseFloat(match[2]),\r\n\t\t\t\t\t\t\tyear: match[3] || \"\"\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn { name: item, value: 0 };\r\n\t\t\t\t}\r\n\t\t\t\t// 处理对象格式\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tvalue: parseFloat(item.value),\r\n\t\t\t\t\tyear: item.year || \"\"\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.filter(item => !isNaN(item.value));\r\n\t});\r\n\r\n\t// 计算比例（确保总和为100%）\r\n\tconst proportionalData = computed(() => {\r\n\t\tconst total = normalizedData.value.reduce(\r\n\t\t\t(sum, item) => sum + Math.abs(item.value),\r\n\t\t\t0\r\n\t\t);\r\n\t\treturn normalizedData.value.map(item => ({\r\n\t\t\t...item,\r\n\t\t\tdisplayValue: total > 0 ? (item.value / total) * 100 : 0\r\n\t\t}));\r\n\t});\r\n\r\n\tconst initChart = () => {\r\n\t\tif (!chartEl.value || proportionalData.value.length === 0) return;\r\n\r\n\t\tchartInstance = echarts.init(chartEl.value);\r\n\r\n\t\tconst option = {\r\n\t\t\ttitle: {\r\n\t\t\t\ttext: props.title,\r\n\t\t\t\tleft: \"center\",\r\n\t\t\t\ttop: 10,\r\n\t\t\t\ttextStyle: {\r\n\t\t\t\t\tfontSize: 16,\r\n\t\t\t\t\tfontWeight: \"bold\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ttooltip: {\r\n\t\t\t\ttrigger: \"item\",\r\n\t\t\t\tformatter: params => {\r\n\t\t\t\t\tconst data = proportionalData.value[params.dataIndex];\r\n\t\t\t\t\treturn `\r\n\t          <div style=\"font-weight:bold\">${data.name}</div>\r\n\t          <div>比例: ${params.percent}%</div>\r\n\t          ${data.year ? `<div>年份: ${data.year}</div>` : \"\"}\r\n\t          <div>原始值: ${data.value}%</div>\r\n\t        `;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlegend: {\r\n\t\t\t\torient: \"vertical\",\r\n\t\t\t\tright: 10,\r\n\t\t\t\ttop: \"center\",\r\n\t\t\t\tformatter: name => {\r\n\t\t\t\t\tconst item = proportionalData.value.find(d => d.name === name);\r\n\t\t\t\t\treturn `${name}: ${item?.value}%`;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tseries: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: \"pie\",\r\n\t\t\t\t\tradius: [\"40%\", \"70%\"],\r\n\t\t\t\t\tcenter: [\"50%\", \"55%\"],\r\n\t\t\t\t\tdata: proportionalData.value.map((item, index) => ({\r\n\t\t\t\t\t\tname: item.name,\r\n\t\t\t\t\t\tvalue: item.displayValue,\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\tcolor: [\r\n\t\t\t\t\t\t\t\t\"#5470c6\",\r\n\t\t\t\t\t\t\t\t\"#91cc75\",\r\n\t\t\t\t\t\t\t\t\"#fac858\",\r\n\t\t\t\t\t\t\t\t\"#ee6666\",\r\n\t\t\t\t\t\t\t\t\"#73c0de\",\r\n\t\t\t\t\t\t\t\t\"#3ba272\",\r\n\t\t\t\t\t\t\t\t\"#9a60b4\",\r\n\t\t\t\t\t\t\t\t\"#ea7ccc\"\r\n\t\t\t\t\t\t\t][index % 8]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tlabel: {\r\n\t\t\t\t\t\t\tformatter: `{b}: {d}%`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})),\r\n\t\t\t\t\temphasis: {\r\n\t\t\t\t\t\titemStyle: {\r\n\t\t\t\t\t\t\tshadowBlur: 10,\r\n\t\t\t\t\t\t\tshadowOffsetX: 0,\r\n\t\t\t\t\t\t\tshadowColor: \"rgba(0, 0, 0, 0.5)\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\r\n\t\tchartInstance.setOption(option);\r\n\t};\r\n\r\n\tonMounted(() => {\r\n\t\tinitChart();\r\n\t\twindow.addEventListener(\"resize\", () => chartInstance?.resize());\r\n\t});\r\n\r\n\twatch(() => [props.data, props.title], initChart, { deep: true });\r\n</script>\r\n\r\n<style scoped>\r\n\t.fixed-pie-chart {\r\n\t\twidth: 100%;\r\n\t\theight: 400px;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}