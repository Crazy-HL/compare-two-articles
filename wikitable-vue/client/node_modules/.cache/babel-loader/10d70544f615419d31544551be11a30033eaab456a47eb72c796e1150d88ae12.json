{"ast":null,"code":"import * as d3 from \"d3\";\nexport default {\n  name: \"D3SingleValuePie\",\n  props: {\n    value: {\n      type: Number,\n      required: true,\n      validator: v => v >= 0 && v <= 100\n    },\n    title: {\n      type: String,\n      default: \"\"\n    },\n    unit: {\n      type: String,\n      default: \"%\"\n    },\n    color: {\n      type: String,\n      default: \"#36a2eb\"\n    },\n    size: {\n      type: Number,\n      default: 300\n    },\n    innerRadius: {\n      type: Number,\n      default: 0.35\n    },\n    outerRadius: {\n      type: Number,\n      default: 0.45\n    }\n  },\n  data() {\n    return {\n      svg: null,\n      arcGenerator: null,\n      pieGenerator: null\n    };\n  },\n  watch: {\n    value(newVal) {\n      this.updateChart(newVal);\n    },\n    title() {\n      this.updateText();\n    }\n  },\n  mounted() {\n    this.initChart();\n  },\n  beforeUnmount() {\n    window.removeEventListener(\"resize\", this.handleResize);\n  },\n  methods: {\n    initChart() {\n      // 清除旧图表\n      d3.select(this.$refs.chartContainer).selectAll(\"*\").remove();\n\n      // 创建SVG容器\n      this.svg = d3.select(this.$refs.chartContainer).append(\"svg\").attr(\"width\", this.size).attr(\"height\", this.size).append(\"g\").attr(\"transform\", `translate(${this.size / 2},${this.size / 2})`);\n\n      // 初始化生成器\n      this.pieGenerator = d3.pie().startAngle(-0.5 * Math.PI).endAngle(1.5 * Math.PI).sort(null);\n      this.arcGenerator = d3.arc().innerRadius(this.size * this.innerRadius).outerRadius(this.size * this.outerRadius);\n\n      // 绘制初始图表\n      this.updateChart(this.value);\n      this.updateText();\n\n      // 添加响应式\n      window.addEventListener(\"resize\", this.handleResize);\n    },\n    updateChart(newValue) {\n      if (!this.svg) return;\n      const displayValue = Math.min(Math.max(newValue, 0), 100);\n      const isFull = displayValue >= 99.99;\n      const data = isFull ? [100] : [displayValue, 100 - displayValue];\n\n      // 更新饼图数据\n      const paths = this.svg.selectAll(\"path\").data(this.pieGenerator(data));\n\n      // 进入/更新/退出模式\n      paths.enter().append(\"path\").attr(\"d\", this.arcGenerator).attr(\"fill\", (d, i) => this.getFillColor(i, isFull)).attr(\"stroke\", \"#fff\").attr(\"stroke-width\", 2).merge(paths).attr(\"d\", this.arcGenerator).attr(\"fill\", (d, i) => this.getFillColor(i, isFull));\n      paths.exit().remove();\n\n      // 更新中心值\n      this.svg.select(\".value-text\").text(`${displayValue.toFixed(1)}${this.unit}`);\n    },\n    updateText() {\n      if (!this.svg) return;\n\n      // 标题处理\n      let title = this.svg.select(\".title-text\");\n      if (title.empty()) {\n        title = this.svg.append(\"text\").attr(\"class\", \"title-text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", -15);\n      }\n      title.text(this.title);\n\n      // 数值处理\n      let value = this.svg.select(\".value-text\");\n      if (value.empty()) {\n        value = this.svg.append(\"text\").attr(\"class\", \"value-text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", 15);\n      }\n    },\n    getFillColor(index, isFull) {\n      if (isFull) return this.color;\n      return index === 0 ? this.color : \"#f0f0f0\";\n    },\n    handleResize() {\n      if (!this.svg) return;\n      // 简单的响应式处理 - 实际项目可能需要更复杂的逻辑\n      const containerWidth = this.$refs.chartContainer.clientWidth;\n      const newSize = Math.min(containerWidth, 500);\n      this.svg.attr(\"width\", newSize).attr(\"height\", newSize).select(\"g\").attr(\"transform\", `translate(${newSize / 2},${newSize / 2})`);\n      this.arcGenerator.innerRadius(newSize * this.innerRadius).outerRadius(newSize * this.outerRadius);\n      this.updateChart(this.value);\n    }\n  }\n};","map":{"version":3,"names":["d3","name","props","value","type","Number","required","validator","v","title","String","default","unit","color","size","innerRadius","outerRadius","data","svg","arcGenerator","pieGenerator","watch","newVal","updateChart","updateText","mounted","initChart","beforeUnmount","window","removeEventListener","handleResize","methods","select","$refs","chartContainer","selectAll","remove","append","attr","pie","startAngle","Math","PI","endAngle","sort","arc","addEventListener","newValue","displayValue","min","max","isFull","paths","enter","d","i","getFillColor","merge","exit","text","toFixed","empty","index","containerWidth","clientWidth","newSize"],"sources":["D:\\vue_frame\\vue_frame\\wikitable-vue\\client\\src\\components\\compoents_base\\charts\\PieChart.vue"],"sourcesContent":["<template>\r\n\t<div ref=\"chartContainer\" class=\"d3-single-value-pie\">\r\n\t\t<!-- 图表将在这里渲染 -->\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\timport * as d3 from \"d3\";\r\n\r\n\texport default {\r\n\t\tname: \"D3SingleValuePie\",\r\n\t\tprops: {\r\n\t\t\tvalue: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\trequired: true,\r\n\t\t\t\tvalidator: v => v >= 0 && v <= 100\r\n\t\t\t},\r\n\t\t\ttitle: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\tunit: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"%\"\r\n\t\t\t},\r\n\t\t\tcolor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: \"#36a2eb\"\r\n\t\t\t},\r\n\t\t\tsize: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 300\r\n\t\t\t},\r\n\t\t\tinnerRadius: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0.35\r\n\t\t\t},\r\n\t\t\touterRadius: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 0.45\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tsvg: null,\r\n\t\t\t\tarcGenerator: null,\r\n\t\t\t\tpieGenerator: null\r\n\t\t\t};\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tvalue(newVal) {\r\n\t\t\t\tthis.updateChart(newVal);\r\n\t\t\t},\r\n\t\t\ttitle() {\r\n\t\t\t\tthis.updateText();\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.initChart();\r\n\t\t},\r\n\t\tbeforeUnmount() {\r\n\t\t\twindow.removeEventListener(\"resize\", this.handleResize);\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinitChart() {\r\n\t\t\t\t// 清除旧图表\r\n\t\t\t\td3.select(this.$refs.chartContainer).selectAll(\"*\").remove();\r\n\r\n\t\t\t\t// 创建SVG容器\r\n\t\t\t\tthis.svg = d3\r\n\t\t\t\t\t.select(this.$refs.chartContainer)\r\n\t\t\t\t\t.append(\"svg\")\r\n\t\t\t\t\t.attr(\"width\", this.size)\r\n\t\t\t\t\t.attr(\"height\", this.size)\r\n\t\t\t\t\t.append(\"g\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(${this.size / 2},${this.size / 2})`);\r\n\r\n\t\t\t\t// 初始化生成器\r\n\t\t\t\tthis.pieGenerator = d3\r\n\t\t\t\t\t.pie()\r\n\t\t\t\t\t.startAngle(-0.5 * Math.PI)\r\n\t\t\t\t\t.endAngle(1.5 * Math.PI)\r\n\t\t\t\t\t.sort(null);\r\n\r\n\t\t\t\tthis.arcGenerator = d3\r\n\t\t\t\t\t.arc()\r\n\t\t\t\t\t.innerRadius(this.size * this.innerRadius)\r\n\t\t\t\t\t.outerRadius(this.size * this.outerRadius);\r\n\r\n\t\t\t\t// 绘制初始图表\r\n\t\t\t\tthis.updateChart(this.value);\r\n\t\t\t\tthis.updateText();\r\n\r\n\t\t\t\t// 添加响应式\r\n\t\t\t\twindow.addEventListener(\"resize\", this.handleResize);\r\n\t\t\t},\r\n\t\t\tupdateChart(newValue) {\r\n\t\t\t\tif (!this.svg) return;\r\n\r\n\t\t\t\tconst displayValue = Math.min(Math.max(newValue, 0), 100);\r\n\t\t\t\tconst isFull = displayValue >= 99.99;\r\n\t\t\t\tconst data = isFull ? [100] : [displayValue, 100 - displayValue];\r\n\r\n\t\t\t\t// 更新饼图数据\r\n\t\t\t\tconst paths = this.svg.selectAll(\"path\").data(this.pieGenerator(data));\r\n\r\n\t\t\t\t// 进入/更新/退出模式\r\n\t\t\t\tpaths\r\n\t\t\t\t\t.enter()\r\n\t\t\t\t\t.append(\"path\")\r\n\t\t\t\t\t.attr(\"d\", this.arcGenerator)\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => this.getFillColor(i, isFull))\r\n\t\t\t\t\t.attr(\"stroke\", \"#fff\")\r\n\t\t\t\t\t.attr(\"stroke-width\", 2)\r\n\t\t\t\t\t.merge(paths)\r\n\t\t\t\t\t.attr(\"d\", this.arcGenerator)\r\n\t\t\t\t\t.attr(\"fill\", (d, i) => this.getFillColor(i, isFull));\r\n\r\n\t\t\t\tpaths.exit().remove();\r\n\r\n\t\t\t\t// 更新中心值\r\n\t\t\t\tthis.svg\r\n\t\t\t\t\t.select(\".value-text\")\r\n\t\t\t\t\t.text(`${displayValue.toFixed(1)}${this.unit}`);\r\n\t\t\t},\r\n\t\t\tupdateText() {\r\n\t\t\t\tif (!this.svg) return;\r\n\r\n\t\t\t\t// 标题处理\r\n\t\t\t\tlet title = this.svg.select(\".title-text\");\r\n\t\t\t\tif (title.empty()) {\r\n\t\t\t\t\ttitle = this.svg\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"class\", \"title-text\")\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"dy\", -15);\r\n\t\t\t\t}\r\n\t\t\t\ttitle.text(this.title);\r\n\r\n\t\t\t\t// 数值处理\r\n\t\t\t\tlet value = this.svg.select(\".value-text\");\r\n\t\t\t\tif (value.empty()) {\r\n\t\t\t\t\tvalue = this.svg\r\n\t\t\t\t\t\t.append(\"text\")\r\n\t\t\t\t\t\t.attr(\"class\", \"value-text\")\r\n\t\t\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t\t\t.attr(\"dy\", 15);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetFillColor(index, isFull) {\r\n\t\t\t\tif (isFull) return this.color;\r\n\t\t\t\treturn index === 0 ? this.color : \"#f0f0f0\";\r\n\t\t\t},\r\n\t\t\thandleResize() {\r\n\t\t\t\tif (!this.svg) return;\r\n\t\t\t\t// 简单的响应式处理 - 实际项目可能需要更复杂的逻辑\r\n\t\t\t\tconst containerWidth = this.$refs.chartContainer.clientWidth;\r\n\t\t\t\tconst newSize = Math.min(containerWidth, 500);\r\n\r\n\t\t\t\tthis.svg\r\n\t\t\t\t\t.attr(\"width\", newSize)\r\n\t\t\t\t\t.attr(\"height\", newSize)\r\n\t\t\t\t\t.select(\"g\")\r\n\t\t\t\t\t.attr(\"transform\", `translate(${newSize / 2},${newSize / 2})`);\r\n\r\n\t\t\t\tthis.arcGenerator\r\n\t\t\t\t\t.innerRadius(newSize * this.innerRadius)\r\n\t\t\t\t\t.outerRadius(newSize * this.outerRadius);\r\n\r\n\t\t\t\tthis.updateChart(this.value);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.d3-single-value-pie {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tmin-height: 300px;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.d3-single-value-pie >>> .title-text {\r\n\t\tfont-size: 16px;\r\n\t\tfont-weight: bold;\r\n\t\tfill: #666;\r\n\t}\r\n\r\n\t.d3-single-value-pie >>> .value-text {\r\n\t\tfont-size: 24px;\r\n\t\tfont-weight: bold;\r\n\t\tfill: #333;\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}